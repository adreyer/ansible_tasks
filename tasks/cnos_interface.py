#!/usr/bin/python
# -*- coding: utf-8 -*-
ANSIBALLZ_WRAPPER = True # For test-module script to tell this is a ANSIBALLZ_WRAPPER
import os
import os.path
import sys
import __main__
scriptdir = None
try:
    scriptdir = os.path.dirname(os.path.abspath(__main__.__file__))
except (AttributeError, OSError):
    pass
if scriptdir is not None:
    sys.path = [p for p in sys.path if p != scriptdir]
import base64
import json
import shutil
import zipfile
import tempfile
import subprocess
if sys.version_info < (3,):
    bytes = str
    PY3 = False
else:
    unicode = str
    PY3 = True
try:
    from io import BytesIO as IOStream
except ImportError:
    from StringIO import StringIO as IOStream
ZIPDATA = """UEsDBBQAAAAAAOC7K0uPp/FSdwAAAHcAAAATAAAAYW5zaWJsZS9fX2luaXRfXy5weWZyb20gcGtndXRpbCBpbXBvcnQgZXh0ZW5kX3BhdGgKX19wYXRoX189ZXh0ZW5kX3BhdGgoX19wYXRoX18sX19uYW1lX18pCl9fdmVyc2lvbl9fPSIyLjQuMCIKX19hdXRob3JfXz0iQW5zaWJsZSwgSW5jLiIKUEsDBBQAAAAAAOC7K0udxfFrSAAAAEgAAAAgAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvX19pbml0X18ucHlmcm9tIHBrZ3V0aWwgaW1wb3J0IGV4dGVuZF9wYXRoCl9fcGF0aF9fPWV4dGVuZF9wYXRoKF9fcGF0aF9fLF9fbmFtZV9fKQpQSwMEFAAAAAAA4LsrS46RqFZLaQAAS2kAACAAAABhbnNpYmxlX21vZHVsZV9jbm9zX2ludGVyZmFjZS5weSMhL3Vzci9iaW4vcHl0aG9uCiMgLSotIGNvZGluZzogdXRmLTggLSotCiMKIyBDb3B5cmlnaHQgKEMpIDIwMTcgTGVub3ZvLCBJbmMuCiMKIyBUaGlzIGZpbGUgaXMgcGFydCBvZiBBbnNpYmxlCiMKIyBBbnNpYmxlIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKIyBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQojIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yCiMgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KIwojIEFuc2libGUgaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKIyBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgojIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKIyBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgojCiMgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKIyBhbG9uZyB3aXRoIEFuc2libGUuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiMKIyBNb2R1bGUgdG8gc2VuZCBQb3J0IGNoYW5uZWwgY29tbWFuZHMgdG8gTGVub3ZvIFN3aXRjaGVzCiMgTGVub3ZvIE5ldHdvcmtpbmcKIwpBTlNJQkxFX01FVEFEQVRBID0geydtZXRhZGF0YV92ZXJzaW9uJzogJzEuMCcsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cyc6IFsncHJldmlldyddLAogICAgICAgICAgICAgICAgICAgICdzdXBwb3J0ZWRfYnknOiAnY29tbXVuaXR5J30KCgpET0NVTUVOVEFUSU9OID0gJycnCi0tLQptb2R1bGU6IGNub3NfaW50ZXJmYWNlCmF1dGhvcjogIkRhdmUgS2FzYmVyZyAoQGRrYXNiZXJnKSIKc2hvcnRfZGVzY3JpcHRpb246IE1hbmFnZSBpbnRlcmZhY2UgY29uZmlndXJhdGlvbiBvbiBkZXZpY2VzIHJ1bm5pbmcgTGVub3ZvIENOT1MKZGVzY3JpcHRpb246CiAgICAtIFRoaXMgbW9kdWxlIGFsbG93cyB5b3UgdG8gd29yayB3aXRoIGludGVyZmFjZSByZWxhdGVkIGNvbmZpZ3VyYXRpb25zLiBUaGUgb3BlcmF0b3JzIHVzZWQgYXJlCiAgICAgb3ZlcmxvYWRlZCB0byBlbnN1cmUgY29udHJvbCBvdmVyIHN3aXRjaCBpbnRlcmZhY2UgY29uZmlndXJhdGlvbnMuIEFwYXJ0IGZyb20gdGhlIHJlZ3VsYXIgZGV2aWNlCiAgICAgY29ubmVjdGlvbiByZWxhdGVkIGF0dHJpYnV0ZXMsIHRoZXJlIGFyZSBzZXZlbiBpbnRlcmZhY2UgYXJndW1lbnRzIHRoYXQgd2lsbCBwZXJmb3JtIGZ1cnRoZXIKICAgICBjb25maWd1cmF0aW9ucy4gVGhleSBhcmUgaW50ZXJmYWNlQXJnMSwgaW50ZXJmYWNlQXJnMiwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwgaW50ZXJmYWNlQXJnNSwKICAgICBpbnRlcmZhY2VBcmc2LCBhbmQgaW50ZXJmYWNlQXJnNy4gRm9yIG1vcmUgZGV0YWlscyBvbiBob3cgdG8gdXNlIHRoZXNlIGFyZ3VtZW50cywgc2VlCiAgICAgW092ZXJsb2FkZWQgVmFyaWFibGVzXS4gSW50ZXJmYWNlIGNvbmZpZ3VyYXRpb25zIGFyZSB0YWtlbiBjYXJlIGF0IHNpeCBjb250ZXh0cyBpbiBhIHJlZ3VsYXIgQ0xJLgogICAgIFRoZXkgYXJlCiAgICAgMS4gSW50ZXJmYWNlIE5hbWUgLSBDb25maWd1cmF0aW9ucwogICAgIDIuIEV0aGVybmV0IEludGVyZmFjZSAtIENvbmZpZ3VyYXRpb25zCiAgICAgMy4gTG9vcGJhY2sgSW50ZXJmYWNlIENvbmZpZ3VyYXRpb25zCiAgICAgNC4gTWFuYWdlbWVudCBJbnRlcmZhY2UgQ29uZmlndXJhdGlvbnMKICAgICA1LiBQb3J0IEFnZ3JlZ2F0aW9uIC0gQ29uZmlndXJhdGlvbnMKICAgICA2LiBWTEFOIENvbmZpZ3VyYXRpb25zCiAgICAgVGhpcyBtb2R1bGUgdXNlcyBTU0ggdG8gbWFuYWdlIG5ldHdvcmsgZGV2aWNlIGNvbmZpZ3VyYXRpb24uCiAgICAgVGhlIHJlc3VsdHMgb2YgdGhlIG9wZXJhdGlvbiB3aWxsIGJlIHBsYWNlZCBpbiBhIGRpcmVjdG9yeSBuYW1lZCAncmVzdWx0cycKICAgICB0aGF0IG11c3QgYmUgY3JlYXRlZCBieSB0aGUgdXNlciBpbiB0aGVpciBsb2NhbCBkaXJlY3RvcnkgdG8gd2hlcmUgdGhlIHBsYXlib29rIGlzIHJ1bi4KICAgICBGb3IgbW9yZSBpbmZvcm1hdGlvbiBhYm91dCB0aGlzIG1vZHVsZSBmcm9tIExlbm92byBhbmQgY3VzdG9taXppbmcgaXQgdXNhZ2UgZm9yIHlvdXIKICAgICB1c2UgY2FzZXMsIHBsZWFzZSB2aXNpdCBVKGh0dHA6Ly9zeXN0ZW14Lmxlbm92b2ZpbGVzLmNvbS9oZWxwL2luZGV4LmpzcD90b3BpYz0lMkZjb20ubGVub3ZvLnN3aXRjaG1ndC5hbnNpYmxlLmRvYyUyRmNub3NfaW50ZXJmYWNlLmh0bWwpCnZlcnNpb25fYWRkZWQ6ICIyLjMiCmV4dGVuZHNfZG9jdW1lbnRhdGlvbl9mcmFnbWVudDogY25vcwpvcHRpb25zOgogICAgaW50ZXJmYWNlUmFuZ2U6CiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAgIC0gVGhpcyBzcGVjaWZpZXMgdGhlIGludGVyZmFjZSByYW5nZSBpbiB3aGljaCB0aGUgcG9ydCBhZ2dyZWdhdGlvbiBpcyBlbnZpc2FnZWQKICAgICAgICByZXF1aXJlZDogWWVzCiAgICAgICAgZGVmYXVsdDogTnVsbAogICAgaW50ZXJmYWNlT3B0aW9uOgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAtIFRoaXMgc3BlY2lmaWVzIHRoZSBhdHRyaWJ1dGUgeW91IHNwZWNpZnkgc3Vic2VxdWVudCB0byBpbnRlcmZhY2UgY29tbWFuZAogICAgICAgIHJlcXVpcmVkOiBZZXMKICAgICAgICBkZWZhdWx0OiBOdWxsCiAgICAgICAgY2hvaWNlczogW05vbmUsIGV0aGVybmV0LCBsb29wYmFjaywgbWdtdCwgcG9ydC1hZ2dyZWdhdGlvbiwgdmxhbl0KICAgIGludGVyZmFjZUFyZzE6CiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIGludGVyZmFjZSBmaXJzdCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgICAgICByZXF1aXJlZDogWWVzCiAgICAgICAgZGVmYXVsdDogTnVsbAogICAgICAgIGNob2ljZXM6IFthZ2dyZWdhdGlvbi1ncm91cCwgYmZkLCBicmlkZ2Vwb3J0LCBkZXNjcmlwdGlvbiwgZHVwbGV4LCBmbG93Y29udHJvbCwgaXAsIGlwdjYsIGxhY3AsIGxsZHAsCiAgICAgICAgbG9hZC1pbnRlcnZhbCwgbWFjLCBtYWMtYWRkcmVzcywgbWFjLWxlYXJuLCBtaWNyb2J1cnN0LWRldGVjdGlvbiwgbXR1LCBzZXJ2aWNlLCBzZXJ2aWNlLXBvbGljeSwKICAgICAgICBzaHV0ZG93biwgc25tcCwgc3Bhbm5pbmctdHJlZSwgc3BlZWQsIHN0b3JtLWNvbnRyb2wsIHZsYW4sIHZycnAsIHBvcnQtYWdncmVnYXRpb25dCiAgICBpbnRlcmZhY2VBcmcyOgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAtIFRoaXMgaXMgYW4gb3ZlcmxvYWRlZCBpbnRlcmZhY2Ugc2Vjb25kIGFyZ3VtZW50LiBVc2FnZSBvZiB0aGlzIGFyZ3VtZW50IGNhbiBiZSBmb3VuZCBpcyB0aGUgVXNlciBHdWlkZSByZWZlcmVuY2VkIGFib3ZlLgogICAgICAgIHJlcXVpcmVkOiBObwogICAgICAgIGRlZmF1bHQ6IE51bGwKICAgICAgICBjaG9pY2VzOiBbYWdncmVnYXRpb24tZ3JvdXAgbnVtYmVyLCBhY2Nlc3Mgb3IgbW9kZSBvciB0cnVuaywgZGVzY3JpcHRpb24sIGF1dG8gb3IgZnVsbCBvciBoYWxmLAogICAgICAgIHJlY2lldmUgb3Igc2VuZCwgcG9ydC1wcmlvcml0eSwgc3VzcGVuZC1pbmRpdmlkdWFsLCB0aW1lb3V0LCByZWNlaXZlIG9yIHRyYW5zbWl0IG9yIHRyYXAtbm90aWZpY2F0aW9uLAogICAgICAgIHRsdi1zZWxlY3QsIExvYWQgaW50ZXJ2YWwgZGVsYXkgaW4gc2Vjb25kcywgY291bnRlciwgTmFtZSBmb3IgdGhlIE1BQyBBY2Nlc3MgTGlzdCwgbWFjLWFkZHJlc3MgaW4gSEhISC5ISEhILkhISEggZm9ybWF0LAogICAgICAgIFRIUkVTSE9MRCAgVmFsdWUgaW4gdW5pdCBvZiBidWZmZXIgY2VsbCwgPDY0LTkyMTY+ICBNVFUgaW4gYnl0ZXMtPDY0LTkyMTY+IGZvciBMMiBwYWNrZXQsPDU3Ni05MjE2PiBmb3IgTDMgSVB2NCBwYWNrZXQsCiAgICAgICAgPDEyODAtOTIxNj4gZm9yIEwzIElQdjYgcGFja2V0LCBlbnRlciB0aGUgaW5zdGFuY2UgaWQsIGlucHV0IG9yIG91dHB1dCwgY29wcC1zeXN0ZW0tcG9saWN5LAogICAgICAgIHR5cGUsIDEwMDAgIG9yICAxMDAwMCAgb3IgICA0MDAwMCBvciAgIGF1dG8sIGJyb2FkY2FzdCBvciBtdWx0aWNhc3Qgb3IgdW5pY2FzdCwgZGlzYWJsZSBvciBlbmFibGUgb3IgZWdyZXNzLW9ubHksCiAgICAgICAgVmlydHVhbCByb3V0ZXIgaWRlbnRpZmllciwgZGVzdGluYXRpb24taXAgb3IgZGVzdGluYXRpb24tbWFjIG9yIGRlc3RpbmF0aW9uLXBvcnQgb3Igc291cmNlLWRlc3QtaXAgb3IKICAgICAgICBzb3VyY2UtZGVzdC1tYWMgb3Igc291cmNlLWRlc3QtcG9ydCBvciBzb3VyY2UtaW50ZXJmYWNlIG9yIHNvdXJjZS1pcCBvciBzb3VyY2UtbWFjIG9yIHNvdXJjZS1wb3J0XQogICAgaW50ZXJmYWNlQXJnMzoKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgLSBUaGlzIGlzIGFuIG92ZXJsb2FkZWQgaW50ZXJmYWNlIHRoaXJkIGFyZ3VtZW50LiBVc2FnZSBvZiB0aGlzIGFyZ3VtZW50IGNhbiBiZSBmb3VuZCBpcyB0aGUgVXNlciBHdWlkZSByZWZlcmVuY2VkIGFib3ZlLgogICAgICAgIHJlcXVpcmVkOiBObwogICAgICAgIGRlZmF1bHQ6IE51bGwKICAgICAgICBjaG9pY2VzOiBbYWN0aXZlIG9yIG9uIG9yIHBhc3NpdmUsIG9uIG9yIG9mZiwgTEFDUCBwb3J0IHByaW9yaXR5LCBsb25nIG9yIHNob3J0LCBsaW5rLWFnZ3JlZ2F0aW9uIG9yCiAgICAgICAgbWFjLXBoeS1zdGF0dXMgb3IgbWFuYWdlbWVudC1hZGRyZXNzIG9yIG1heC1mcmFtZS1zaXplIG9yIHBvcnQtZGVzY3JpcHRpb24gb3IgcG9ydC1wcm90b2NvbC12bGFuIG9yCiAgICAgICAgcG9ydC12bGFuIG9yIHBvd2VyLW1kaSBvciBwcm90b2NvbC1pZGVudGl0eSBvciBzeXN0ZW0tY2FwYWJpbGl0aWVzIG9yIHN5c3RlbS1kZXNjcmlwdGlvbiBvciBzeXN0ZW0tbmFtZQogICAgICAgIG9yIHZpZC1tYW5hZ2VtZW50IG9yIHZsYW4tbmFtZSwgY291bnRlciBmb3IgbG9hZCBpbnRlcnZhbCwgcG9saWN5IGlucHV0IG5hbWUsIGFsbCBvciBDb3BwIGNsYXNzIG5hbWUgdG8gYXR0YWNoLAogICAgICAgIHFvcywgcXVlaW5nLCBFbnRlciB0aGUgYWxsb3dlZCB0cmFmZmljIGxldmVsLCBpcHY2XQogICAgaW50ZXJmYWNlQXJnNDoKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgLSBUaGlzIGlzIGFuIG92ZXJsb2FkZWQgaW50ZXJmYWNlIGZvdXJ0aCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgICAgICByZXF1aXJlZDogTm8KICAgICAgICBkZWZhdWx0OiBOdWxsCiAgICAgICAgY2hvaWNlczogW2tleS1jaGFpbiwga2V5LWlkLCBrZXllZC1tZDUgb3Iga2V5ZWQtc2hhMSBvciBtZXRpY3Vsb3VzLWtleWVkLW1kNSBvciBtZXRpY3Vsb3VzLWtleWVkLXNoYTEgb3Igc2ltcGxlLCBJbnRlcnZhbCB2YWx1ZSBpbiBtaWxsaXNlY29uZHMsCiAgICAgICAgIERlc3RpbmF0aW9uIElQIChCb3RoIElQVjQgYW5kIElQVjYpLGluIG9yIG91dCwgTUFDIGFkZHJlc3MsIFRpbWUtb3V0IHZhbHVlIGluIHNlY29uZHMsIGNsYXNzLWlkLCByZXF1ZXN0LCBTcGVjaWZ5IHRoZSBJUHY0IGFkZHJlc3MsCiAgICAgICAgIE9TUEYgYXJlYSBJRCBhcyBhIGRlY2ltYWwgdmFsdWUsIE9TUEYgYXJlYSBJRCBpbiBJUCBhZGRyZXNzIGZvcm1hdCwgYW55Y2FzdCBvciBzZWNvbmRhcnksIGV0aGVybmV0LCB2bGFuLAogICAgICAgICBNQUMgKGhhcmR3YXJlKSBhZGRyZXNzIGluIEhISEguSEhISC5ISEhIIGZvcm1hdCwKICAgICAgICAgTG9hZCBpbnRlcnZhbCBkZWxheSBpbiBzZWNvbmRzLCBTcGVjaWZ5IHBvbGljeSBpbnB1dCBuYW1lLCBpbnB1dCBvciBvdXRwdXQsIGNvc3QsIHBvcnQtcHJpb3JpdHksIEJGRCBtaW5pbXVtIHJlY2VpdmUgaW50ZXJ2YWwsc291cmNlLWludGVyZmFjZV0KICAgIGludGVyZmFjZUFyZzU6CiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIGludGVyZmFjZSBmaWZ0aCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgICAgICByZXF1aXJlZDogTm8KICAgICAgICBkZWZhdWx0OiBOdWxsCiAgICAgICAgY2hvaWNlczogW25hbWUgb2Yga2V5LWNoYWluLCAga2V5LUlkIFZhbHVlLCBrZXktY2hhaW4gLCBrZXktaWQsIEJGRCBtaW5pbXVtIHJlY2VpdmUgaW50ZXJ2YWwsIFZhbHVlIG9mIEhlbGxvIE11bHRpcGxpZXIsCiAgICAgICAgYWRtaW4tZG93biBvciBtdWx0aWhvcCBvciBub24tcGVyc2lzdGVudCwgVmVuZG9yIGNsYXNzLWlkZW50aWZpZXIgbmFtZSwgYm9vdGZpbGUtbmFtZSBvciBob3N0LW5hbWUgb3IgbG9nLXNlcnZlciBvciBudHAtc2VydmVyIG9yIHRmdHAtc2VydmVyLW5hbWUsCiAgICAgICAgU2xvdC9jaGFzc2lzIG51bWJlciwgVmxhbiBpbnRlcmZhY2UsIFNwZWNpZnkgcG9saWN5IGlucHV0IG5hbWUsIFBvcnQgcGF0aCBjb3N0IG9yIGF1dG8sIFBvcnQgcHJpb3JpdHkgaW5jcmVtZW50cyBvZiAzMl0KICAgIGludGVyZmFjZUFyZzY6CiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIGludGVyZmFjZSBzaXh0aCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgICAgICByZXF1aXJlZDogTm8KICAgICAgICBkZWZhdWx0OiBOdWxsCiAgICAgICAgY2hvaWNlczogW0F1dGhlbnRpY2F0aW9uIGtleSBzdHJpbmcsIG5hbWUgb2Yga2V5LWNoYWluLCBrZXktSWQgVmFsdWUsIFZhbHVlIG9mIEhlbGxvIE11bHRpcGxpZXIsIGFkbWluLWRvd24gb3Igbm9uLXBlcnNpc3RlbnRdCiAgICBpbnRlcmZhY2VBcmc3OgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAtIFRoaXMgaXMgYW4gb3ZlcmxvYWRlZCBpbnRlcmZhY2Ugc2V2ZW50aCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgICAgICByZXF1aXJlZDogTm8KICAgICAgICBkZWZhdWx0OiBOdWxsCiAgICAgICAgY2hvaWNlczogW0F1dGhlbnRpY2F0aW9uIGtleSBzdHJpbmcsIGFkbWluLWRvd25dCgonJycKRVhBTVBMRVMgPSAnJycKVGFza3MgOiBUaGUgZm9sbG93aW5nIGFyZSBleGFtcGxlcyBvZiB1c2luZyB0aGUgbW9kdWxlIGNub3NfaW50ZXJmYWNlLiBUaGVzZSBhcmUgd3JpdHRlbiBpbiB0aGUgbWFpbi55bWwgZmlsZSBvZiB0aGUgdGFza3MgZGlyZWN0b3J5LgotLS0KLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIGFnZ3JlZ2F0aW9uLWdyb3VwCiAgY25vc19pbnRlcmZhY2U6CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF9pbnRlcmZhY2Vfe3sgaW52ZW50b3J5X2hvc3RuYW1lIH19X291dHB1dC50eHQiCiAgICAgIGludGVyZmFjZU9wdGlvbjogJ2V0aGVybmV0JwogICAgICBpbnRlcmZhY2VSYW5nZTogMQogICAgICBpbnRlcmZhY2VBcmcxOiAiYWdncmVnYXRpb24tZ3JvdXAiCiAgICAgIGludGVyZmFjZUFyZzI6IDMzCiAgICAgIGludGVyZmFjZUFyZzM6ICJvbiIKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgLSBicmlkZ2UtcG9ydAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJicmlkZ2UtcG9ydCIKICAgICAgaW50ZXJmYWNlQXJnMjogImFjY2VzcyIKICAgICAgaW50ZXJmYWNlQXJnMzogMzMKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgLSBicmlkZ2Vwb3J0IG1vZGUKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAiYnJpZGdlLXBvcnQiCiAgICAgIGludGVyZmFjZUFyZzI6ICJtb2RlIgogICAgICBpbnRlcmZhY2VBcmczOiAiYWNjZXNzIgoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAgLSBEZXNjcmlwdGlvbgogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJkZXNjcmlwdGlvbiIKICAgICAgaW50ZXJmYWNlQXJnMjogIkhlbnRhbW1vbyAiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gRHVwbGV4CiAgY25vc19pbnRlcmZhY2U6CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF9pbnRlcmZhY2Vfe3sgaW52ZW50b3J5X2hvc3RuYW1lIH19X291dHB1dC50eHQiCiAgICAgIGludGVyZmFjZU9wdGlvbjogJ2V0aGVybmV0JwogICAgICBpbnRlcmZhY2VSYW5nZTogMQogICAgICBpbnRlcmZhY2VBcmcxOiAiZHVwbGV4IgogICAgICBpbnRlcmZhY2VBcmcyOiAiYXV0byIKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgLSBmbG93Y29udHJvbAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJmbG93Y29udHJvbCIKICAgICAgaW50ZXJmYWNlQXJnMjogInNlbmQiCiAgICAgIGludGVyZmFjZUFyZzM6ICJvZmYiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gbGFjcAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJsYWNwIgogICAgICBpbnRlcmZhY2VBcmcyOiAicG9ydC1wcmlvcml0eSIKICAgICAgaW50ZXJmYWNlQXJnMzogMzMKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgIC0gbGxkcAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJsbGRwIgogICAgICBpbnRlcmZhY2VBcmcyOiAidGx2LXNlbGVjdCIKICAgICAgaW50ZXJmYWNlQXJnMzogIm1heC1mcmFtZS1zaXplIgoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIGxvYWQtaW50ZXJ2YWwKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAibG9hZC1pbnRlcnZhbCIKICAgICAgaW50ZXJmYWNlQXJnMjogImNvdW50ZXIiCiAgICAgIGludGVyZmFjZUFyZzM6IDIKICAgICAgaW50ZXJmYWNlQXJnNDogMzMKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgLSBtYWMKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAibWFjIgogICAgICBpbnRlcmZhY2VBcmcyOiAiY29wcC1zeXN0ZW0tYWNsLXZsYWctaGMiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gbWljcm9idXJzdC1kZXRlY3Rpb24KICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAibWljcm9idXJzdC1kZXRlY3Rpb24iCiAgICAgIGludGVyZmFjZUFyZzI6IDI1CgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0ICAtIG10dQogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJtdHUiCiAgICAgIGludGVyZmFjZUFyZzI6IDY2CgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gc2VydmljZS1wb2xpY3kKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAic2VydmljZS1wb2xpY3kiCiAgICAgIGludGVyZmFjZUFyZzI6ICJpbnB1dCIKICAgICAgaW50ZXJmYWNlQXJnMzogIkFuaWwiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gc3BlZWQKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAxCiAgICAgIGludGVyZmFjZUFyZzE6ICJzcGVlZCIKICAgICAgaW50ZXJmYWNlQXJnMjogImF1dG8iCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gc3Rvcm0KICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAic3Rvcm0tY29udHJvbCIKICAgICAgaW50ZXJmYWNlQXJnMjogImJyb2FkY2FzdCIKICAgICAgaW50ZXJmYWNlQXJnMzogMTIuNQoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIHZsYW4KICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAidmxhbiIKICAgICAgaW50ZXJmYWNlQXJnMjogImRpc2FibGUiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gdnJycAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJ2cnJwIgogICAgICBpbnRlcmZhY2VBcmcyOiAzMwoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIHNwYW5uaW5nIHRyZWUxCiAgY25vc19pbnRlcmZhY2U6CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF9pbnRlcmZhY2Vfe3sgaW52ZW50b3J5X2hvc3RuYW1lIH19X291dHB1dC50eHQiCiAgICAgIGludGVyZmFjZU9wdGlvbjogJ2V0aGVybmV0JwogICAgICBpbnRlcmZhY2VSYW5nZTogMzMKICAgICAgaW50ZXJmYWNlQXJnMTogInNwYW5uaW5nLXRyZWUiCiAgICAgIGludGVyZmFjZUFyZzI6ICJicGR1Z3VhcmQiCiAgICAgIGludGVyZmFjZUFyZzM6ICJlbmFibGUiCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gc3Bhbm5pbmcgdHJlZSAyCiAgY25vc19pbnRlcmZhY2U6CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF9pbnRlcmZhY2Vfe3sgaW52ZW50b3J5X2hvc3RuYW1lIH19X291dHB1dC50eHQiCiAgICAgIGludGVyZmFjZU9wdGlvbjogJ2V0aGVybmV0JwogICAgICBpbnRlcmZhY2VSYW5nZTogMzMKICAgICAgaW50ZXJmYWNlQXJnMTogInNwYW5uaW5nLXRyZWUiCiAgICAgIGludGVyZmFjZUFyZzI6ICJtc3QiCiAgICAgIGludGVyZmFjZUFyZzM6ICIzMy0zNSIKICAgICAgaW50ZXJmYWNlQXJnNDogImNvc3QiCiAgICAgIGludGVyZmFjZUFyZzU6IDMzCgotIG5hbWU6IFRlc3QgSW50ZXJmYWNlIEV0aGVybmV0IC0gaXAxCiAgY25vc19pbnRlcmZhY2U6CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF9pbnRlcmZhY2Vfe3sgaW52ZW50b3J5X2hvc3RuYW1lIH19X291dHB1dC50eHQiCiAgICAgIGludGVyZmFjZU9wdGlvbjogJ2V0aGVybmV0JwogICAgICBpbnRlcmZhY2VSYW5nZTogMzMKICAgICAgaW50ZXJmYWNlQXJnMTogImlwIgogICAgICBpbnRlcmZhY2VBcmcyOiAiYWNjZXNzLWdyb3VwIgogICAgICBpbnRlcmZhY2VBcmczOiAiYW5pbCIKICAgICAgaW50ZXJmYWNlQXJnNDogImluIgoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIGlwMgogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJpcCIKICAgICAgaW50ZXJmYWNlQXJnMjogInBvcnQiCiAgICAgIGludGVyZmFjZUFyZzM6ICJhbmlsIgoKLSBuYW1lOiBUZXN0IEludGVyZmFjZSBFdGhlcm5ldCAtIGJmZAogIGNub3NfaW50ZXJmYWNlOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3RfaW50ZXJmYWNlX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICBpbnRlcmZhY2VPcHRpb246ICdldGhlcm5ldCcKICAgICAgaW50ZXJmYWNlUmFuZ2U6IDMzCiAgICAgIGludGVyZmFjZUFyZzE6ICJiZmQiCiAgICAgIGludGVyZmFjZUFyZzI6ICJpbnRlcnZhbCIKICAgICAgaW50ZXJmYWNlQXJnMzogNTUKICAgICAgaW50ZXJmYWNlQXJnNDogNTUKICAgICAgaW50ZXJmYWNlQXJnNTogMzMKCi0gbmFtZTogVGVzdCBJbnRlcmZhY2UgRXRoZXJuZXQgLSBiZmQKICBjbm9zX2ludGVyZmFjZToKICAgICAgaG9zdDogInt7IGludmVudG9yeV9ob3N0bmFtZSB9fSIKICAgICAgdXNlcm5hbWU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWyd1c2VybmFtZSddIH19IgogICAgICBwYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3Bhc3N3b3JkJ10gfX0iCiAgICAgIGRldmljZVR5cGU6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydkZXZpY2VUeXBlJ10gfX0iCiAgICAgIGVuYWJsZVBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZW5hYmxlUGFzc3dvcmQnXSB9fSIKICAgICAgb3V0cHV0ZmlsZTogIi4vcmVzdWx0cy90ZXN0X2ludGVyZmFjZV97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgaW50ZXJmYWNlT3B0aW9uOiAnZXRoZXJuZXQnCiAgICAgIGludGVyZmFjZVJhbmdlOiAzMwogICAgICBpbnRlcmZhY2VBcmcxOiAiYmZkIgogICAgICBpbnRlcmZhY2VBcmcyOiAiaXB2NCIKICAgICAgaW50ZXJmYWNlQXJnMzogImF1dGhlbnRpY2F0aW9uIgogICAgICBpbnRlcmZhY2VBcmc0OiAibWV0aWN1bG91cy1rZXllZC1tZDUiCiAgICAgIGludGVyZmFjZUFyZzU6ICJrZXktY2hhaW4iCiAgICAgIGludGVyZmFjZUFyZzY6ICJteWNoYWluIgoKJycnClJFVFVSTiA9ICcnJwptc2c6CiAgZGVzY3JpcHRpb246IFN1Y2Nlc3Mgb3IgZmFpbHVyZSBtZXNzYWdlCiAgcmV0dXJuZWQ6IGFsd2F5cwogIHR5cGU6IHN0cmluZwogIHNhbXBsZTogIkludGVyZmFjZSBjb25maWd1cmF0aW9ucyBhY2NvbXBsaXNoZWQuIgonJycKCmltcG9ydCBzeXMKaW1wb3J0IHBhcmFtaWtvCmltcG9ydCB0aW1lCmltcG9ydCBhcmdwYXJzZQppbXBvcnQgc29ja2V0CmltcG9ydCBhcnJheQppbXBvcnQganNvbgppbXBvcnQgdGltZQppbXBvcnQgcmUKdHJ5OgogICAgZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscyBpbXBvcnQgY25vcwogICAgSEFTX0xJQiA9IFRydWUKZXhjZXB0OgogICAgSEFTX0xJQiA9IEZhbHNlCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuYmFzaWMgaW1wb3J0IEFuc2libGVNb2R1bGUKZnJvbSBjb2xsZWN0aW9ucyBpbXBvcnQgZGVmYXVsdGRpY3QKCgpkZWYgbWFpbigpOgogICAgbW9kdWxlID0gQW5zaWJsZU1vZHVsZSgKICAgICAgICBhcmd1bWVudF9zcGVjPWRpY3QoCiAgICAgICAgICAgIG91dHB1dGZpbGU9ZGljdChyZXF1aXJlZD1UcnVlKSwKICAgICAgICAgICAgaG9zdD1kaWN0KHJlcXVpcmVkPVRydWUpLAogICAgICAgICAgICB1c2VybmFtZT1kaWN0KHJlcXVpcmVkPVRydWUpLAogICAgICAgICAgICBwYXNzd29yZD1kaWN0KHJlcXVpcmVkPVRydWUsIG5vX2xvZz1UcnVlKSwKICAgICAgICAgICAgZW5hYmxlUGFzc3dvcmQ9ZGljdChyZXF1aXJlZD1GYWxzZSwgbm9fbG9nPVRydWUpLAogICAgICAgICAgICBkZXZpY2VUeXBlPWRpY3QocmVxdWlyZWQ9VHJ1ZSksCiAgICAgICAgICAgIGludGVyZmFjZVJhbmdlPWRpY3QocmVxdWlyZWQ9RmFsc2UpLAogICAgICAgICAgICBpbnRlcmZhY2VPcHRpb249ZGljdChyZXF1aXJlZD1GYWxzZSksCiAgICAgICAgICAgIGludGVyZmFjZUFyZzE9ZGljdChyZXF1aXJlZD1UcnVlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnMj1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnMz1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnND1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNT1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNj1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNz1kaWN0KHJlcXVpcmVkPUZhbHNlKSwpLAogICAgICAgIHN1cHBvcnRzX2NoZWNrX21vZGU9RmFsc2UpCgogICAgdXNlcm5hbWUgPSBtb2R1bGUucGFyYW1zWyd1c2VybmFtZSddCiAgICBwYXNzd29yZCA9IG1vZHVsZS5wYXJhbXNbJ3Bhc3N3b3JkJ10KICAgIGVuYWJsZVBhc3N3b3JkID0gbW9kdWxlLnBhcmFtc1snZW5hYmxlUGFzc3dvcmQnXQogICAgaW50ZXJmYWNlUmFuZ2UgPSBtb2R1bGUucGFyYW1zWydpbnRlcmZhY2VSYW5nZSddCiAgICBpbnRlcmZhY2VPcHRpb24gPSBtb2R1bGUucGFyYW1zWydpbnRlcmZhY2VPcHRpb24nXQogICAgaW50ZXJmYWNlQXJnMSA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzEnXQogICAgaW50ZXJmYWNlQXJnMiA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzInXQogICAgaW50ZXJmYWNlQXJnMyA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzMnXQogICAgaW50ZXJmYWNlQXJnNCA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzQnXQogICAgaW50ZXJmYWNlQXJnNSA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzUnXQogICAgaW50ZXJmYWNlQXJnNiA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzYnXQogICAgaW50ZXJmYWNlQXJnNyA9IG1vZHVsZS5wYXJhbXNbJ2ludGVyZmFjZUFyZzcnXQogICAgb3V0cHV0ZmlsZSA9IG1vZHVsZS5wYXJhbXNbJ291dHB1dGZpbGUnXQogICAgaG9zdElQID0gbW9kdWxlLnBhcmFtc1snaG9zdCddCiAgICBkZXZpY2VUeXBlID0gbW9kdWxlLnBhcmFtc1snZGV2aWNlVHlwZSddCgogICAgb3V0cHV0ID0gIiIKCiAgICAjIENyZWF0ZSBpbnN0YW5jZSBvZiBTU0hDbGllbnQgb2JqZWN0CiAgICByZW1vdGVfY29ubl9wcmUgPSBwYXJhbWlrby5TU0hDbGllbnQoKQoKICAgICMgQXV0b21hdGljYWxseSBhZGQgdW50cnVzdGVkIGhvc3RzIChtYWtlIHN1cmUgb2theSBmb3Igc2VjdXJpdHkgcG9saWN5IGluIHlvdXIgZW52aXJvbm1lbnQpCiAgICByZW1vdGVfY29ubl9wcmUuc2V0X21pc3NpbmdfaG9zdF9rZXlfcG9saWN5KHBhcmFtaWtvLkF1dG9BZGRQb2xpY3koKSkKCiAgICAjIGluaXRpYXRlIFNTSCBjb25uZWN0aW9uIHdpdGggdGhlIHN3aXRjaAogICAgcmVtb3RlX2Nvbm5fcHJlLmNvbm5lY3QoaG9zdElQLCB1c2VybmFtZT11c2VybmFtZSwgcGFzc3dvcmQ9cGFzc3dvcmQpCiAgICB0aW1lLnNsZWVwKDIpCgogICAgIyBVc2UgaW52b2tlX3NoZWxsIHRvIGVzdGFibGlzaCBhbiAnaW50ZXJhY3RpdmUgc2Vzc2lvbicKICAgIHJlbW90ZV9jb25uID0gcmVtb3RlX2Nvbm5fcHJlLmludm9rZV9zaGVsbCgpCiAgICB0aW1lLnNsZWVwKDIpCgogICAgIyBFbmFibGUgYW5kIGVudGVyIGNvbmZpZ3VyZSB0ZXJtaW5hbCB0aGVuIHNlbmQgY29tbWFuZAogICAgb3V0cHV0ID0gb3V0cHV0ICsgY25vcy53YWl0Rm9yRGV2aWNlUmVzcG9uc2UoIlxuIiwgIj4iLCAyLCByZW1vdGVfY29ubikKCiAgICBvdXRwdXQgPSBvdXRwdXQgKyBjbm9zLmVudGVyRW5hYmxlTW9kZUZvckRldmljZShlbmFibGVQYXNzd29yZCwgMywgcmVtb3RlX2Nvbm4pCgogICAgIyBNYWtlIHRlcm1pbmFsIGxlbmd0aCA9IDAKICAgIG91dHB1dCA9IG91dHB1dCArIGNub3Mud2FpdEZvckRldmljZVJlc3BvbnNlKCJ0ZXJtaW5hbCBsZW5ndGggMFxuIiwgIiMiLCAyLCByZW1vdGVfY29ubikKCiAgICAjIEdvIHRvIGNvbmZpZyBtb2RlCiAgICBvdXRwdXQgPSBvdXRwdXQgKyBjbm9zLndhaXRGb3JEZXZpY2VSZXNwb25zZSgiY29uZmlndXJlIGRcbiIsICIoY29uZmlnKSMiLCAyLCByZW1vdGVfY29ubikKCiAgICAjIFNlbmQgdGhlIENMaSBjb21tYW5kCiAgICBpZihpbnRlcmZhY2VPcHRpb24gaXMgTm9uZSBvciBpbnRlcmZhY2VPcHRpb24gPT0gIiIpOgogICAgICAgIG91dHB1dCA9IG91dHB1dCArIGNub3MuaW50ZXJmYWNlQ29uZmlnKHJlbW90ZV9jb25uLCBkZXZpY2VUeXBlLCAiKGNvbmZpZykjIiwgMiwgTm9uZSwgaW50ZXJmYWNlUmFuZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlQXJnMSwgaW50ZXJmYWNlQXJnMiwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNykKICAgIGVsaWYoaW50ZXJmYWNlT3B0aW9uID09ICJldGhlcm5ldCIpOgogICAgICAgIG91dHB1dCA9IG91dHB1dCArIGNub3MuaW50ZXJmYWNlQ29uZmlnKHJlbW90ZV9jb25uLCBkZXZpY2VUeXBlLCAiKGNvbmZpZykjIiwgMiwgImV0aGVybmV0IiwgaW50ZXJmYWNlUmFuZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlQXJnMSwgaW50ZXJmYWNlQXJnMiwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNykKICAgIGVsaWYoaW50ZXJmYWNlT3B0aW9uID09ICJsb29wYmFjayIpOgogICAgICAgIG91dHB1dCA9IG91dHB1dCArIGNub3MuaW50ZXJmYWNlQ29uZmlnKHJlbW90ZV9jb25uLCBkZXZpY2VUeXBlLCAiKGNvbmZpZykjIiwgMiwgImxvb3BiYWNrIiwgaW50ZXJmYWNlUmFuZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlQXJnMSwgaW50ZXJmYWNlQXJnMiwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNykKICAgIGVsaWYoaW50ZXJmYWNlT3B0aW9uID09ICJtZ210Iik6CiAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgY25vcy5pbnRlcmZhY2VDb25maWcocmVtb3RlX2Nvbm4sIGRldmljZVR5cGUsICIoY29uZmlnKSMiLCAyLCAibWdtdCIsIGludGVyZmFjZVJhbmdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUFyZzEsIGludGVyZmFjZUFyZzIsIGludGVyZmFjZUFyZzMsIGludGVyZmFjZUFyZzQsIGludGVyZmFjZUFyZzUsIGludGVyZmFjZUFyZzYsIGludGVyZmFjZUFyZzcpCiAgICBlbGlmKGludGVyZmFjZU9wdGlvbiA9PSAicG9ydC1hZ2dyZWdhdGlvbiIpOgogICAgICAgIG91dHB1dCA9IG91dHB1dCArIGNub3MuaW50ZXJmYWNlQ29uZmlnKHJlbW90ZV9jb25uLCBkZXZpY2VUeXBlLCAiKGNvbmZpZykjIiwgMiwgInBvcnQtYWdncmVnYXRpb24iLCBpbnRlcmZhY2VSYW5nZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VBcmcxLCBpbnRlcmZhY2VBcmcyLCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LCBpbnRlcmZhY2VBcmc1LCBpbnRlcmZhY2VBcmc2LCBpbnRlcmZhY2VBcmc3KQogICAgZWxpZihpbnRlcmZhY2VPcHRpb24gPT0gInZsYW4iKToKICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBjbm9zLmludGVyZmFjZUNvbmZpZyhyZW1vdGVfY29ubiwgZGV2aWNlVHlwZSwgIihjb25maWcpIyIsIDIsICJ2bGFuIiwgaW50ZXJmYWNlUmFuZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlQXJnMSwgaW50ZXJmYWNlQXJnMiwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNykKICAgIGVsc2U6CiAgICAgICAgb3V0cHV0ID0gIkludmFsaWQgaW50ZXJmYWNlIG9wdGlvbiBcbiIKICAgICMgU2F2ZSBpdCBpbnRvIHRoZSBmaWxlCiAgICBmaWxlID0gb3BlbihvdXRwdXRmaWxlLCAiYSIpCiAgICBmaWxlLndyaXRlKG91dHB1dCkKICAgIGZpbGUuY2xvc2UoKQoKICAgICMgTG9naWMgdG8gY2hlY2sgd2hlbiBjaGFuZ2VzIG9jY3VyIG9yIG5vdAogICAgZXJyb3JNc2cgPSBjbm9zLmNoZWNrT3V0cHV0Rm9yRXJyb3Iob3V0cHV0KQogICAgaWYoZXJyb3JNc2cgaXMgTm9uZSk6CiAgICAgICAgbW9kdWxlLmV4aXRfanNvbihjaGFuZ2VkPVRydWUsIG1zZz0iSW50ZXJmYWNlIENvbmZpZ3VyYXRpb24gaXMgZG9uZSIpCiAgICBlbHNlOgogICAgICAgIG1vZHVsZS5mYWlsX2pzb24obXNnPWVycm9yTXNnKQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICAgICAgbWFpbigpClBLAwQUAAAAAADguytLO985lTCKAQAwigEAHQAAAGFuc2libGUvbW9kdWxlX3V0aWxzL2Jhc2ljLnB5IyBUaGlzIGNvZGUgaXMgcGFydCBvZiBBbnNpYmxlLCBidXQgaXMgYW4gaW5kZXBlbmRlbnQgY29tcG9uZW50LgojIFRoaXMgcGFydGljdWxhciBmaWxlIHNuaXBwZXQsIGFuZCB0aGlzIGZpbGUgc25pcHBldCBvbmx5LCBpcyBCU0QgbGljZW5zZWQuCiMgTW9kdWxlcyB5b3Ugd3JpdGUgdXNpbmcgdGhpcyBzbmlwcGV0LCB3aGljaCBpcyBlbWJlZGRlZCBkeW5hbWljYWxseSBieSBBbnNpYmxlCiMgc3RpbGwgYmVsb25nIHRvIHRoZSBhdXRob3Igb2YgdGhlIG1vZHVsZSwgYW5kIG1heSBhc3NpZ24gdGhlaXIgb3duIGxpY2Vuc2UKIyB0byB0aGUgY29tcGxldGUgd29yay4KIwojIENvcHlyaWdodCAoYyksIE1pY2hhZWwgRGVIYWFuIDxtaWNoYWVsLmRlaGFhbkBnbWFpbC5jb20+LCAyMDEyLTIwMTMKIyBDb3B5cmlnaHQgKGMpLCBUb3NoaW8gS3VyYXRvbWkgPHRrdXJhdG9taUBhbnNpYmxlLmNvbT4gMjAxNgojIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiMKIyBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLAojIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKIwojICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKIyAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KIyAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKIyAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KIyAgICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgojCiMgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiIEFORAojIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVECiMgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELgojIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULAojIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKIyBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKIyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUCiMgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFCiMgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiMKCkJPT0xFQU5TX1RSVUUgPSBbJ3knLCAneWVzJywgJ29uJywgJzEnLCAndHJ1ZScsIDEsIFRydWVdCkJPT0xFQU5TX0ZBTFNFID0gWyduJywgJ25vJywgJ29mZicsICcwJywgJ2ZhbHNlJywgMCwgRmFsc2VdCkJPT0xFQU5TID0gQk9PTEVBTlNfVFJVRSArIEJPT0xFQU5TX0ZBTFNFCgpTSVpFX1JBTkdFUyA9IHsgJ1knOiAxPDw4MCwgJ1onOiAxPDw3MCwgJ0UnOiAxPDw2MCwgJ1AnOiAxPDw1MCwgJ1QnOiAxPDw0MCwgJ0cnOiAxPDwzMCwgJ00nOiAxPDwyMCwgJ0snOiAxPDwxMCwgJ0InOiAxIH0KCkZJTEVfQVRUUklCVVRFUyA9IHsKICAgICdBJzogJ25vYXRpbWUnLAogICAgJ2EnOiAnYXBwZW5kJywKICAgICdjJzogJ2NvbXByZXNzZWQnLAogICAgJ0MnOiAnbm9jb3cnLAogICAgJ2QnOiAnbm9kdW1wJywKICAgICdEJzogJ2RpcnN5bmMnLAogICAgJ2UnOiAnZXh0ZW50cycsCiAgICAnRSc6ICdlbmNyeXB0ZWQnLAogICAgJ2gnOiAnYmxvY2tzaXplJywKICAgICdpJzogJ2ltbXV0YWJsZScsCiAgICAnSSc6ICdpbmRleGVkJywKICAgICdqJzogJ2pvdXJuYWxsZWQnLAogICAgJ04nOiAnaW5saW5lJywKICAgICdzJzogJ3plcm8nLAogICAgJ1MnOiAnc3luY2hyb25vdXMnLAogICAgJ3QnOiAnbm90YWlsJywKICAgICdUJzogJ2Jsb2Nrcm9vdCcsCiAgICAndSc6ICd1bmRlbGV0ZScsCiAgICAnWCc6ICdjb21wcmVzc2VkcmF3JywKICAgICdaJzogJ2NvbXByZXNzZWRkaXJ0eScsCn0KCiMgYW5zaWJsZSBtb2R1bGVzIGNhbiBiZSB3cml0dGVuIGluIGFueSBsYW5ndWFnZS4gIFRvIHNpbXBsaWZ5CiMgZGV2ZWxvcG1lbnQgb2YgUHl0aG9uIG1vZHVsZXMsIHRoZSBmdW5jdGlvbnMgYXZhaWxhYmxlIGhlcmUgY2FuCiMgYmUgdXNlZCB0byBkbyBtYW55IGNvbW1vbiB0YXNrcwoKaW1wb3J0IGxvY2FsZQppbXBvcnQgb3MKaW1wb3J0IHJlCmltcG9ydCBzaGxleAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0eXBlcwppbXBvcnQgdGltZQppbXBvcnQgc2VsZWN0CmltcG9ydCBzaHV0aWwKaW1wb3J0IHN0YXQKaW1wb3J0IHRlbXBmaWxlCmltcG9ydCB0cmFjZWJhY2sKaW1wb3J0IGdycAppbXBvcnQgcHdkCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgZXJybm8KaW1wb3J0IGRhdGV0aW1lCmZyb20gaXRlcnRvb2xzIGltcG9ydCByZXBlYXQsIGNoYWluCgp0cnk6CiAgICBpbXBvcnQgc3lzbG9nCiAgICBIQVNfU1lTTE9HPVRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgSEFTX1NZU0xPRz1GYWxzZQoKdHJ5OgogICAgZnJvbSBzeXN0ZW1kIGltcG9ydCBqb3VybmFsCiAgICBoYXNfam91cm5hbCA9IFRydWUKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaGFzX2pvdXJuYWwgPSBGYWxzZQoKSEFWRV9TRUxJTlVYPUZhbHNlCnRyeToKICAgIGltcG9ydCBzZWxpbnV4CiAgICBIQVZFX1NFTElOVVg9VHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBwYXNzCgojIFB5dGhvbjIgJiAzIHdheSB0byBnZXQgTm9uZVR5cGUKTm9uZVR5cGUgPSB0eXBlKE5vbmUpCgp0cnk6CiAgICBmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBTZXF1ZW5jZSwgTWFwcGluZwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAjIHB5dGhvbjIuNQogICAgU2VxdWVuY2UgPSAobGlzdCwgdHVwbGUpCiAgICBNYXBwaW5nID0gKGRpY3QsKQoKIyBOb3RlOiBXaGVuIGdldHRpbmcgU2VxdWVuY2UgZnJvbSBjb2xsZWN0aW9ucywgaXQgbWF0Y2hlcyB3aXRoIHN0cmluZ3MuICBJZgojIHRoaXMgbWF0dGVycywgbWFrZSBzdXJlIHRvIGNoZWNrIGZvciBzdHJpbmdzIGJlZm9yZSBjaGVja2luZyBmb3Igc2VxdWVuY2V0eXBlCnRyeToKICAgIGZyb20gY29sbGVjdGlvbnMuYWJjIGltcG9ydCBLZXlzVmlldwogICAgU0VRVUVOQ0VUWVBFID0gKFNlcXVlbmNlLCBLZXlzVmlldykKZXhjZXB0OgogICAgU0VRVUVOQ0VUWVBFID0gU2VxdWVuY2UKCnRyeToKICAgIGltcG9ydCBqc29uCiAgICAjIERldGVjdCB0aGUgcHl0aG9uLWpzb24gbGlicmFyeSB3aGljaCBpcyBpbmNvbXBhdGlibGUKICAgICMgTG9vayBmb3Igc2ltcGxlanNvbiBpZiB0aGF0J3MgdGhlIGNhc2UKICAgIHRyeToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShqc29uLmxvYWRzLCB0eXBlcy5GdW5jdGlvblR5cGUpIG9yIG5vdCBpc2luc3RhbmNlKGpzb24uZHVtcHMsIHR5cGVzLkZ1bmN0aW9uVHlwZSk6CiAgICAgICAgICAgIHJhaXNlIEltcG9ydEVycm9yCiAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IKZXhjZXB0IEltcG9ydEVycm9yOgogICAgdHJ5OgogICAgICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICBwcmludCgnXG57Im1zZyI6ICJFcnJvcjogYW5zaWJsZSByZXF1aXJlcyB0aGUgc3RkbGliIGpzb24gb3Igc2ltcGxlanNvbiBtb2R1bGUsIG5laXRoZXIgd2FzIGZvdW5kISIsICJmYWlsZWQiOiB0cnVlfScpCiAgICAgICAgc3lzLmV4aXQoMSkKICAgIGV4Y2VwdCBTeW50YXhFcnJvcjoKICAgICAgICBwcmludCgnXG57Im1zZyI6ICJTeW50YXhFcnJvcjogcHJvYmFibHkgZHVlIHRvIGluc3RhbGxlZCBzaW1wbGVqc29uIGJlaW5nIGZvciBhIGRpZmZlcmVudCBweXRob24gdmVyc2lvbiIsICJmYWlsZWQiOiB0cnVlfScpCiAgICAgICAgc3lzLmV4aXQoMSkKCkFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVMgPSBkaWN0KCkKdHJ5OgogICAgaW1wb3J0IGhhc2hsaWIKCiAgICAjIHB5dGhvbiAyLjcuOSsgYW5kIDIuNy4wKwogICAgZm9yIGF0dHJpYnV0ZSBpbiAoJ2F2YWlsYWJsZV9hbGdvcml0aG1zJywgJ2FsZ29yaXRobXMnKToKICAgICAgICBhbGdvcml0aG1zID0gZ2V0YXR0cihoYXNobGliLCBhdHRyaWJ1dGUsIE5vbmUpCiAgICAgICAgaWYgYWxnb3JpdGhtczoKICAgICAgICAgICAgYnJlYWsKICAgIGlmIGFsZ29yaXRobXMgaXMgTm9uZToKICAgICAgICAjIHB5dGhvbiAyLjUrCiAgICAgICAgYWxnb3JpdGhtcyA9ICgnbWQ1JywgJ3NoYTEnLCAnc2hhMjI0JywgJ3NoYTI1NicsICdzaGEzODQnLCAnc2hhNTEyJykKICAgIGZvciBhbGdvcml0aG0gaW4gYWxnb3JpdGhtczoKICAgICAgICBBVkFJTEFCTEVfSEFTSF9BTEdPUklUSE1TW2FsZ29yaXRobV0gPSBnZXRhdHRyKGhhc2hsaWIsIGFsZ29yaXRobSkKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaW1wb3J0IHNoYQogICAgQVZBSUxBQkxFX0hBU0hfQUxHT1JJVEhNUyA9IHsnc2hhMSc6IHNoYS5zaGF9CiAgICB0cnk6CiAgICAgICAgaW1wb3J0IG1kNQogICAgICAgIEFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVNbJ21kNSddID0gbWQ1Lm1kNQogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHBhc3MKCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMucHljb21wYXQyNCBpbXBvcnQgZ2V0X2V4Y2VwdGlvbiwgbGl0ZXJhbF9ldmFsCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4IGltcG9ydCAoUFkyLCBQWTMsIGIsIGJpbmFyeV90eXBlLCBpbnRlZ2VyX3R5cGVzLAogICAgICAgIGl0ZXJpdGVtcywgdGV4dF90eXBlLCBzdHJpbmdfdHlwZXMpCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4Lm1vdmVzIGltcG9ydCBtYXAsIHJlZHVjZSwgc2hsZXhfcXVvdGUKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5fdGV4dCBpbXBvcnQgdG9fbmF0aXZlLCB0b19ieXRlcywgdG9fdGV4dAoKUEFTU1dPUkRfTUFUQ0ggPSByZS5jb21waWxlKHInXig/Oi4rWy1fXHNdKT9wYXNzKD86Wy1fXHNdPyg/OndvcmR8cGhyYXNlfHdyZHx3ZCk/KSg/OlstX1xzXS4rKT8kJywgcmUuSSkKCl9OVU1CRVJUWVBFUyA9IHR1cGxlKGxpc3QoaW50ZWdlcl90eXBlcykgKyBbZmxvYXRdKQoKIyBEZXByZWNhdGVkIGNvbXBhdC4gIE9ubHkga2VwdCBpbiBjYXNlIGFub3RoZXIgbW9kdWxlIHVzZWQgdGhlc2UgbmFtZXMgIFVzaW5nCiMgYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4IGlzIHByZWZlcnJlZAoKTlVNQkVSVFlQRVMgPSBfTlVNQkVSVFlQRVMKCmltYXAgPSBtYXAKCnRyeToKICAgICMgUHl0aG9uIDIKICAgIHVuaWNvZGUKZXhjZXB0IE5hbWVFcnJvcjoKICAgICMgUHl0aG9uIDMKICAgIHVuaWNvZGUgPSB0ZXh0X3R5cGUKCnRyeToKICAgICMgUHl0aG9uIDIuNisKICAgIGJ5dGVzCmV4Y2VwdCBOYW1lRXJyb3I6CiAgICAjIFB5dGhvbiAyLjQKICAgIGJ5dGVzID0gYmluYXJ5X3R5cGUKCnRyeToKICAgICMgUHl0aG9uIDIKICAgIGJhc2VzdHJpbmcKZXhjZXB0IE5hbWVFcnJvcjoKICAgICMgUHl0aG9uIDMKICAgIGJhc2VzdHJpbmcgPSBzdHJpbmdfdHlwZXMKCl9saXRlcmFsX2V2YWwgPSBsaXRlcmFsX2V2YWwKCiMgRW5kIG9mIGRlcHJlY2F0ZWQgbmFtZXMKCiMgSW50ZXJuYWwgZ2xvYmFsIGhvbGRpbmcgcGFzc2VkIGluIHBhcmFtcy4gIFRoaXMgaXMgY29uc3VsdGVkIGluIGNhc2UKIyBtdWx0aXBsZSBBbnNpYmxlTW9kdWxlcyBhcmUgY3JlYXRlZC4gIE90aGVyd2lzZSBlYWNoIEFuc2libGVNb2R1bGUgd291bGQKIyBhdHRlbXB0IHRvIHJlYWQgZnJvbSBzdGRpbi4gIE90aGVyIGNvZGUgc2hvdWxkIG5vdCB1c2UgdGhpcyBkaXJlY3RseSBhcyBpdAojIGlzIGFuIGludGVybmFsIGltcGxlbWVudGF0aW9uIGRldGFpbApfQU5TSUJMRV9BUkdTID0gTm9uZQoKRklMRV9DT01NT05fQVJHVU1FTlRTPWRpY3QoCiAgICBzcmMgPSBkaWN0KCksCiAgICBtb2RlID0gZGljdCh0eXBlPSdyYXcnKSwKICAgIG93bmVyID0gZGljdCgpLAogICAgZ3JvdXAgPSBkaWN0KCksCiAgICBzZXVzZXIgPSBkaWN0KCksCiAgICBzZXJvbGUgPSBkaWN0KCksCiAgICBzZWxldmVsID0gZGljdCgpLAogICAgc2V0eXBlID0gZGljdCgpLAogICAgZm9sbG93ID0gZGljdCh0eXBlPSdib29sJywgZGVmYXVsdD1GYWxzZSksCiAgICAjIG5vdCB0YWtlbiBieSB0aGUgZmlsZSBtb2R1bGUsIGJ1dCBvdGhlciBtb2R1bGVzIGNhbGwgZmlsZSBzbyBpdCBtdXN0IGlnbm9yZSB0aGVtLgogICAgY29udGVudCA9IGRpY3Qobm9fbG9nPVRydWUpLAogICAgYmFja3VwID0gZGljdCgpLAogICAgZm9yY2UgPSBkaWN0KCksCiAgICByZW1vdGVfc3JjID0gZGljdCgpLCAjIHVzZWQgYnkgYXNzZW1ibGUKICAgIHJlZ2V4cCA9IGRpY3QoKSwgIyB1c2VkIGJ5IGFzc2VtYmxlCiAgICBkZWxpbWl0ZXIgPSBkaWN0KCksICMgdXNlZCBieSBhc3NlbWJsZQogICAgZGlyZWN0b3J5X21vZGUgPSBkaWN0KCksICMgdXNlZCBieSBjb3B5CiAgICB1bnNhZmVfd3JpdGVzICA9IGRpY3QodHlwZT0nYm9vbCcpLCAjIHNob3VsZCBiZSBhdmFpbGFibGUgdG8gYW55IG1vZHVsZSB1c2luZyBhdG9taWNfbW92ZQogICAgYXR0cmlidXRlcyA9IGRpY3QoYWxpYXNlcz1bJ2F0dHInXSksCikKClBBU1NXRF9BUkdfUkUgPSByZS5jb21waWxlKHInXlstXXswLDJ9cGFzc1stXT8od29yZHx3ZCk/JykKCiMgQ2FuJ3QgdXNlIDA3Nzc3IG9uIFB5dGhvbiAzLCBjYW4ndCB1c2UgMG83Nzc3IG9uIFB5dGhvbiAyLjQKUEVSTV9CSVRTID0gaW50KCcwNzc3NycsIDgpICAgICAgIyBmaWxlIG1vZGUgcGVybWlzc2lvbiBiaXRzCkVYRUNfUEVSTV9CSVRTID0gaW50KCcwMDExMScsIDgpICMgZXhlY3V0ZSBwZXJtaXNzaW9uIGJpdHMKREVGQVVMVF9QRVJNID0gaW50KCcwNjY2JywgOCkgICAgIyBkZWZhdWx0IGZpbGUgcGVybWlzc2lvbiBiaXRzCgoKZGVmIGdldF9wbGF0Zm9ybSgpOgogICAgJycnIHdoYXQncyB0aGUgcGxhdGZvcm0/ICBleGFtcGxlOiBMaW51eCBpcyBhIHBsYXRmb3JtLiAnJycKICAgIHJldHVybiBwbGF0Zm9ybS5zeXN0ZW0oKQoKZGVmIGdldF9kaXN0cmlidXRpb24oKToKICAgICcnJyByZXR1cm4gdGhlIGRpc3RyaWJ1dGlvbiBuYW1lICcnJwogICAgaWYgcGxhdGZvcm0uc3lzdGVtKCkgPT0gJ0xpbnV4JzoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN1cHBvcnRlZF9kaXN0cyA9IHBsYXRmb3JtLl9zdXBwb3J0ZWRfZGlzdHMgKyAoJ2FyY2gnLCdhbHBpbmUnKQogICAgICAgICAgICBkaXN0cmlidXRpb24gPSBwbGF0Zm9ybS5saW51eF9kaXN0cmlidXRpb24oc3VwcG9ydGVkX2Rpc3RzPXN1cHBvcnRlZF9kaXN0cylbMF0uY2FwaXRhbGl6ZSgpCiAgICAgICAgICAgIGlmIG5vdCBkaXN0cmlidXRpb24gYW5kIG9zLnBhdGguaXNmaWxlKCcvZXRjL3N5c3RlbS1yZWxlYXNlJyk6CiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb24gPSBwbGF0Zm9ybS5saW51eF9kaXN0cmlidXRpb24oc3VwcG9ydGVkX2Rpc3RzPVsnc3lzdGVtJ10pWzBdLmNhcGl0YWxpemUoKQogICAgICAgICAgICAgICAgaWYgJ0FtYXpvbicgaW4gZGlzdHJpYnV0aW9uOgogICAgICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9ICdBbWF6b24nCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9ICdPdGhlckxpbnV4JwogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgIyBGSVhNRTogTWV0aG9kTWlzc2luZywgSSBhc3N1bWU/CiAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9IHBsYXRmb3JtLmRpc3QoKVswXS5jYXBpdGFsaXplKCkKICAgIGVsc2U6CiAgICAgICAgZGlzdHJpYnV0aW9uID0gTm9uZQogICAgcmV0dXJuIGRpc3RyaWJ1dGlvbgoKZGVmIGdldF9kaXN0cmlidXRpb25fdmVyc2lvbigpOgogICAgJycnIHJldHVybiB0aGUgZGlzdHJpYnV0aW9uIHZlcnNpb24gJycnCiAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgogICAgICAgIHRyeToKICAgICAgICAgICAgZGlzdHJpYnV0aW9uX3ZlcnNpb24gPSBwbGF0Zm9ybS5saW51eF9kaXN0cmlidXRpb24oKVsxXQogICAgICAgICAgICBpZiBub3QgZGlzdHJpYnV0aW9uX3ZlcnNpb24gYW5kIG9zLnBhdGguaXNmaWxlKCcvZXRjL3N5c3RlbS1yZWxlYXNlJyk6CiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb25fdmVyc2lvbiA9IHBsYXRmb3JtLmxpbnV4X2Rpc3RyaWJ1dGlvbihzdXBwb3J0ZWRfZGlzdHM9WydzeXN0ZW0nXSlbMV0KICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICMgRklYTUU6IE1ldGhvZE1pc3NpbmcsIEkgYXNzdW1lPwogICAgICAgICAgICBkaXN0cmlidXRpb25fdmVyc2lvbiA9IHBsYXRmb3JtLmRpc3QoKVsxXQogICAgZWxzZToKICAgICAgICBkaXN0cmlidXRpb25fdmVyc2lvbiA9IE5vbmUKICAgIHJldHVybiBkaXN0cmlidXRpb25fdmVyc2lvbgoKZGVmIGdldF9hbGxfc3ViY2xhc3NlcyhjbHMpOgogICAgJycnCiAgICB1c2VkIGJ5IG1vZHVsZXMgbGlrZSBIYXJkd2FyZSBvciBOZXR3b3JrIGZhY3QgY2xhc3NlcyB0byByZXRyaWV2ZSBhbGwgc3ViY2xhc3NlcyBvZiBhIGdpdmVuIGNsYXNzLgogICAgX19zdWJjbGFzc2VzX18gcmV0dXJuIG9ubHkgZGlyZWN0IHN1YiBjbGFzc2VzLiBUaGlzIG9uZSBnbyBkb3duIGludG8gdGhlIGNsYXNzIHRyZWUuCiAgICAnJycKICAgICMgUmV0cmlldmUgZGlyZWN0IHN1YmNsYXNzZXMKICAgIHN1YmNsYXNzZXMgPSBjbHMuX19zdWJjbGFzc2VzX18oKQogICAgdG9fdmlzaXQgPSBsaXN0KHN1YmNsYXNzZXMpCiAgICAjIFRoZW4gdmlzaXQgYWxsIHN1YmNsYXNzZXMKICAgIHdoaWxlIHRvX3Zpc2l0OgogICAgICAgIGZvciBzYyBpbiB0b192aXNpdDoKICAgICAgICAgICAgIyBUaGUgY3VycmVudCBjbGFzcyBpcyBub3cgdmlzaXRlZCwgc28gcmVtb3ZlIGl0IGZyb20gbGlzdAogICAgICAgICAgICB0b192aXNpdC5yZW1vdmUoc2MpCiAgICAgICAgICAgICMgQXBwZW5kaW5nIGFsbCBzdWJjbGFzc2VzIHRvIHZpc2l0IGFuZCBrZWVwIGEgcmVmZXJlbmNlIG9mIGF2YWlsYWJsZSBjbGFzcwogICAgICAgICAgICBmb3Igc3NjIGluIHNjLl9fc3ViY2xhc3Nlc19fKCk6CiAgICAgICAgICAgICAgICBzdWJjbGFzc2VzLmFwcGVuZChzc2MpCiAgICAgICAgICAgICAgICB0b192aXNpdC5hcHBlbmQoc3NjKQogICAgcmV0dXJuIHN1YmNsYXNzZXMKCgpkZWYgbG9hZF9wbGF0Zm9ybV9zdWJjbGFzcyhjbHMsICphcmdzLCAqKmt3YXJncyk6CiAgICAnJycKICAgIHVzZWQgYnkgbW9kdWxlcyBsaWtlIFVzZXIgdG8gaGF2ZSBkaWZmZXJlbnQgaW1wbGVtZW50YXRpb25zIGJhc2VkIG9uIGRldGVjdGVkIHBsYXRmb3JtLiAgU2VlIFVzZXIKICAgIG1vZHVsZSBmb3IgYW4gZXhhbXBsZS4KICAgICcnJwoKICAgIHRoaXNfcGxhdGZvcm0gPSBnZXRfcGxhdGZvcm0oKQogICAgZGlzdHJpYnV0aW9uID0gZ2V0X2Rpc3RyaWJ1dGlvbigpCiAgICBzdWJjbGFzcyA9IE5vbmUKCiAgICAjIGdldCB0aGUgbW9zdCBzcGVjaWZpYyBzdXBlcmNsYXNzIGZvciB0aGlzIHBsYXRmb3JtCiAgICBpZiBkaXN0cmlidXRpb24gaXMgbm90IE5vbmU6CiAgICAgICAgZm9yIHNjIGluIGdldF9hbGxfc3ViY2xhc3NlcyhjbHMpOgogICAgICAgICAgICBpZiBzYy5kaXN0cmlidXRpb24gaXMgbm90IE5vbmUgYW5kIHNjLmRpc3RyaWJ1dGlvbiA9PSBkaXN0cmlidXRpb24gYW5kIHNjLnBsYXRmb3JtID09IHRoaXNfcGxhdGZvcm06CiAgICAgICAgICAgICAgICBzdWJjbGFzcyA9IHNjCiAgICBpZiBzdWJjbGFzcyBpcyBOb25lOgogICAgICAgIGZvciBzYyBpbiBnZXRfYWxsX3N1YmNsYXNzZXMoY2xzKToKICAgICAgICAgICAgaWYgc2MucGxhdGZvcm0gPT0gdGhpc19wbGF0Zm9ybSBhbmQgc2MuZGlzdHJpYnV0aW9uIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBzdWJjbGFzcyA9IHNjCiAgICBpZiBzdWJjbGFzcyBpcyBOb25lOgogICAgICAgIHN1YmNsYXNzID0gY2xzCgogICAgcmV0dXJuIHN1cGVyKGNscywgc3ViY2xhc3MpLl9fbmV3X18oc3ViY2xhc3MpCgoKZGVmIGpzb25fZGljdF91bmljb2RlX3RvX2J5dGVzKGQsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpOgogICAgJycnIFJlY3Vyc2l2ZWx5IGNvbnZlcnQgZGljdCBrZXlzIGFuZCB2YWx1ZXMgdG8gYnl0ZSBzdHIKCiAgICAgICAgU3BlY2lhbGl6ZWQgZm9yIGpzb24gcmV0dXJuIGJlY2F1c2UgdGhpcyBvbmx5IGhhbmRsZXMsIGxpc3RzLCB0dXBsZXMsCiAgICAgICAgYW5kIGRpY3QgY29udGFpbmVyIHR5cGVzICh0aGUgY29udGFpbmVycyB0aGF0IHRoZSBqc29uIG1vZHVsZSByZXR1cm5zKQogICAgJycnCgogICAgaWYgaXNpbnN0YW5jZShkLCB0ZXh0X3R5cGUpOgogICAgICAgIHJldHVybiB0b19ieXRlcyhkLCBlbmNvZGluZz1lbmNvZGluZywgZXJyb3JzPWVycm9ycykKICAgIGVsaWYgaXNpbnN0YW5jZShkLCBkaWN0KToKICAgICAgICByZXR1cm4gZGljdChtYXAoanNvbl9kaWN0X3VuaWNvZGVfdG9fYnl0ZXMsIGl0ZXJpdGVtcyhkKSwgcmVwZWF0KGVuY29kaW5nKSwgcmVwZWF0KGVycm9ycykpKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIGxpc3QpOgogICAgICAgIHJldHVybiBsaXN0KG1hcChqc29uX2RpY3RfdW5pY29kZV90b19ieXRlcywgZCwgcmVwZWF0KGVuY29kaW5nKSwgcmVwZWF0KGVycm9ycykpKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIHR1cGxlKToKICAgICAgICByZXR1cm4gdHVwbGUobWFwKGpzb25fZGljdF91bmljb2RlX3RvX2J5dGVzLCBkLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbHNlOgogICAgICAgIHJldHVybiBkCgpkZWYganNvbl9kaWN0X2J5dGVzX3RvX3VuaWNvZGUoZCwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0Jyk6CiAgICAnJycgUmVjdXJzaXZlbHkgY29udmVydCBkaWN0IGtleXMgYW5kIHZhbHVlcyB0byBieXRlIHN0cgoKICAgICAgICBTcGVjaWFsaXplZCBmb3IganNvbiByZXR1cm4gYmVjYXVzZSB0aGlzIG9ubHkgaGFuZGxlcywgbGlzdHMsIHR1cGxlcywKICAgICAgICBhbmQgZGljdCBjb250YWluZXIgdHlwZXMgKHRoZSBjb250YWluZXJzIHRoYXQgdGhlIGpzb24gbW9kdWxlIHJldHVybnMpCiAgICAnJycKCiAgICBpZiBpc2luc3RhbmNlKGQsIGJpbmFyeV90eXBlKToKICAgICAgICAjIFdhcm5pbmcsIGNhbiB0cmFjZWJhY2sKICAgICAgICByZXR1cm4gdG9fdGV4dChkLCBlbmNvZGluZz1lbmNvZGluZywgZXJyb3JzPWVycm9ycykKICAgIGVsaWYgaXNpbnN0YW5jZShkLCBkaWN0KToKICAgICAgICByZXR1cm4gZGljdChtYXAoanNvbl9kaWN0X2J5dGVzX3RvX3VuaWNvZGUsIGl0ZXJpdGVtcyhkKSwgcmVwZWF0KGVuY29kaW5nKSwgcmVwZWF0KGVycm9ycykpKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIGxpc3QpOgogICAgICAgIHJldHVybiBsaXN0KG1hcChqc29uX2RpY3RfYnl0ZXNfdG9fdW5pY29kZSwgZCwgcmVwZWF0KGVuY29kaW5nKSwgcmVwZWF0KGVycm9ycykpKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIHR1cGxlKToKICAgICAgICByZXR1cm4gdHVwbGUobWFwKGpzb25fZGljdF9ieXRlc190b191bmljb2RlLCBkLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbHNlOgogICAgICAgIHJldHVybiBkCgpkZWYgcmV0dXJuX3ZhbHVlcyhvYmopOgogICAgIiIiIFJldHVybiBuYXRpdmUgc3RyaW5naWZpZWQgdmFsdWVzIGZyb20gZGF0YXN0cnVjdHVyZXMuCgogICAgRm9yIHVzZSB3aXRoIHJlbW92aW5nIHNlbnNpdGl2ZSB2YWx1ZXMgcHJlLWpzb25pZmljYXRpb24uIiIiCiAgICBpZiBpc2luc3RhbmNlKG9iaiwgKHRleHRfdHlwZSwgYmluYXJ5X3R5cGUpKToKICAgICAgICBpZiBvYmo6CiAgICAgICAgICAgIHlpZWxkIHRvX25hdGl2ZShvYmosIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCiAgICAgICAgcmV0dXJuCiAgICBlbGlmIGlzaW5zdGFuY2Uob2JqLCBTRVFVRU5DRVRZUEUpOgogICAgICAgIGZvciBlbGVtZW50IGluIG9iajoKICAgICAgICAgICAgZm9yIHN1YmVsZW1lbnQgaW4gcmV0dXJuX3ZhbHVlcyhlbGVtZW50KToKICAgICAgICAgICAgICAgIHlpZWxkIHN1YmVsZW1lbnQKICAgIGVsaWYgaXNpbnN0YW5jZShvYmosIE1hcHBpbmcpOgogICAgICAgIGZvciBlbGVtZW50IGluIG9iai5pdGVtcygpOgogICAgICAgICAgICBmb3Igc3ViZWxlbWVudCBpbiByZXR1cm5fdmFsdWVzKGVsZW1lbnRbMV0pOgogICAgICAgICAgICAgICAgeWllbGQgc3ViZWxlbWVudAogICAgZWxpZiBpc2luc3RhbmNlKG9iaiwgKGJvb2wsIE5vbmVUeXBlKSk6CiAgICAgICAgIyBUaGlzIG11c3QgY29tZSBiZWZvcmUgaW50IGJlY2F1c2UgYm9vbHMgYXJlIGFsc28gaW50cwogICAgICAgIHJldHVybgogICAgZWxpZiBpc2luc3RhbmNlKG9iaiwgTlVNQkVSVFlQRVMpOgogICAgICAgIHlpZWxkIHRvX25hdGl2ZShvYmosIG5vbnN0cmluZz0nc2ltcGxlcmVwcicpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignVW5rbm93biBwYXJhbWV0ZXIgdHlwZTogJXMsICVzJyAlICh0eXBlKG9iaiksIG9iaikpCgpkZWYgcmVtb3ZlX3ZhbHVlcyh2YWx1ZSwgbm9fbG9nX3N0cmluZ3MpOgogICAgIiIiIFJlbW92ZSBzdHJpbmdzIGluIG5vX2xvZ19zdHJpbmdzIGZyb20gdmFsdWUuICBJZiB2YWx1ZSBpcyBhIGNvbnRhaW5lcgogICAgdHlwZSwgdGhlbiByZW1vdmUgYSBsb3QgbW9yZSIiIgogICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKHRleHRfdHlwZSwgYmluYXJ5X3R5cGUpKToKICAgICAgICAjIE5lZWQgbmF0aXZlIHN0ciB0eXBlCiAgICAgICAgbmF0aXZlX3N0cl92YWx1ZSA9IHZhbHVlCiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgdGV4dF90eXBlKToKICAgICAgICAgICAgdmFsdWVfaXNfdGV4dCA9IFRydWUKICAgICAgICAgICAgaWYgUFkyOgogICAgICAgICAgICAgICAgbmF0aXZlX3N0cl92YWx1ZSA9IHRvX2J5dGVzKHZhbHVlLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgYmluYXJ5X3R5cGUpOgogICAgICAgICAgICB2YWx1ZV9pc190ZXh0ID0gRmFsc2UKICAgICAgICAgICAgaWYgUFkzOgogICAgICAgICAgICAgICAgbmF0aXZlX3N0cl92YWx1ZSA9IHRvX3RleHQodmFsdWUsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCgogICAgICAgIGlmIG5hdGl2ZV9zdHJfdmFsdWUgaW4gbm9fbG9nX3N0cmluZ3M6CiAgICAgICAgICAgIHJldHVybiAnVkFMVUVfU1BFQ0lGSUVEX0lOX05PX0xPR19QQVJBTUVURVInCiAgICAgICAgZm9yIG9taXRfbWUgaW4gbm9fbG9nX3N0cmluZ3M6CiAgICAgICAgICAgIG5hdGl2ZV9zdHJfdmFsdWUgPSBuYXRpdmVfc3RyX3ZhbHVlLnJlcGxhY2Uob21pdF9tZSwgJyonICogOCkKCiAgICAgICAgaWYgdmFsdWVfaXNfdGV4dCBhbmQgaXNpbnN0YW5jZShuYXRpdmVfc3RyX3ZhbHVlLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgICAgIHZhbHVlID0gdG9fdGV4dChuYXRpdmVfc3RyX3ZhbHVlLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3JlcGxhY2UnKQogICAgICAgIGVsaWYgbm90IHZhbHVlX2lzX3RleHQgYW5kIGlzaW5zdGFuY2UobmF0aXZlX3N0cl92YWx1ZSwgdGV4dF90eXBlKToKICAgICAgICAgICAgdmFsdWUgPSB0b19ieXRlcyhuYXRpdmVfc3RyX3ZhbHVlLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3JlcGxhY2UnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbHVlID0gbmF0aXZlX3N0cl92YWx1ZQogICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCBTRVFVRU5DRVRZUEUpOgogICAgICAgIHJldHVybiBbcmVtb3ZlX3ZhbHVlcyhlbGVtLCBub19sb2dfc3RyaW5ncykgZm9yIGVsZW0gaW4gdmFsdWVdCiAgICBlbGlmIGlzaW5zdGFuY2UodmFsdWUsIE1hcHBpbmcpOgogICAgICAgIHJldHVybiBkaWN0KChrLCByZW1vdmVfdmFsdWVzKHYsIG5vX2xvZ19zdHJpbmdzKSkgZm9yIGssIHYgaW4gdmFsdWUuaXRlbXMoKSkKICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgdHVwbGUoY2hhaW4oTlVNQkVSVFlQRVMsIChib29sLCBOb25lVHlwZSkpKSk6CiAgICAgICAgc3RyaW5neV92YWx1ZSA9IHRvX25hdGl2ZSh2YWx1ZSwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICBpZiBzdHJpbmd5X3ZhbHVlIGluIG5vX2xvZ19zdHJpbmdzOgogICAgICAgICAgICByZXR1cm4gJ1ZBTFVFX1NQRUNJRklFRF9JTl9OT19MT0dfUEFSQU1FVEVSJwogICAgICAgIGZvciBvbWl0X21lIGluIG5vX2xvZ19zdHJpbmdzOgogICAgICAgICAgICBpZiBvbWl0X21lIGluIHN0cmluZ3lfdmFsdWU6CiAgICAgICAgICAgICAgICByZXR1cm4gJ1ZBTFVFX1NQRUNJRklFRF9JTl9OT19MT0dfUEFSQU1FVEVSJwogICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCBkYXRldGltZS5kYXRldGltZSk6CiAgICAgICAgdmFsdWUgPSB2YWx1ZS5pc29mb3JtYXQoKQogICAgZWxzZToKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ1ZhbHVlIG9mIHVua25vd24gdHlwZTogJXMsICVzJyAlICh0eXBlKHZhbHVlKSwgdmFsdWUpKQogICAgcmV0dXJuIHZhbHVlCgoKZGVmIGhldXJpc3RpY19sb2dfc2FuaXRpemUoZGF0YSwgbm9fbG9nX3ZhbHVlcz1Ob25lKToKICAgICcnJyBSZW1vdmUgc3RyaW5ncyB0aGF0IGxvb2sgbGlrZSBwYXNzd29yZHMgZnJvbSBsb2cgbWVzc2FnZXMgJycnCiAgICAjIEN1cnJlbnRseSBmaWx0ZXJzOgogICAgIyB1c2VyOnBhc3NAZm9vL3doYXRldmVyIGFuZCBodHRwOi8vdXNlcm5hbWU6cGFzc0B3aGVyZXZlci9mb28KICAgICMgVGhpcyBjb2RlIGhhcyBmYWxzZSBwb3NpdGl2ZXMgYW5kIGNvbnN1bWVzIHBhcnRzIG9mIGxvZ3MgdGhhdCBhcmUKICAgICMgbm90IHBhc3N3ZHMKCiAgICAjIGJlZ2luOiBzdGFydCBvZiBhIHBhc3N3ZCBjb250YWluaW5nIHN0cmluZwogICAgIyBlbmQ6IGVuZCBvZiBhIHBhc3N3ZCBjb250YWluaW5nIHN0cmluZwogICAgIyBzZXA6IGNoYXIgYmV0d2VlbiB1c2VyIGFuZCBwYXNzd2QKICAgICMgcHJldl9iZWdpbjogd2hlcmUgaW4gdGhlIG92ZXJhbGwgc3RyaW5nIHRvIHN0YXJ0IGEgc2VhcmNoIGZvcgogICAgIyAgIGEgcGFzc3dkCiAgICAjIHNlcF9zZWFyY2hfZW5kOiB3aGVyZSBpbiB0aGUgc3RyaW5nIHRvIGVuZCBhIHNlYXJjaCBmb3IgdGhlIHNlcAogICAgZGF0YSA9IHRvX25hdGl2ZShkYXRhKQoKICAgIG91dHB1dCA9IFtdCiAgICBiZWdpbiA9IGxlbihkYXRhKQogICAgcHJldl9iZWdpbiA9IGJlZ2luCiAgICBzZXAgPSAxCiAgICB3aGlsZSBzZXA6CiAgICAgICAgIyBGaW5kIHRoZSBwb3RlbnRpYWwgZW5kIG9mIGEgcGFzc3dkCiAgICAgICAgdHJ5OgogICAgICAgICAgICBlbmQgPSBkYXRhLnJpbmRleCgnQCcsIDAsIGJlZ2luKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAjIE5vIHBhc3N3ZCBpbiB0aGUgcmVzdCBvZiB0aGUgZGF0YQogICAgICAgICAgICBvdXRwdXQuaW5zZXJ0KDAsIGRhdGFbMDpiZWdpbl0pCiAgICAgICAgICAgIGJyZWFrCgogICAgICAgICMgU2VhcmNoIGZvciB0aGUgYmVnaW5uaW5nIG9mIGEgcGFzc3dkCiAgICAgICAgc2VwID0gTm9uZQogICAgICAgIHNlcF9zZWFyY2hfZW5kID0gZW5kCiAgICAgICAgd2hpbGUgbm90IHNlcDoKICAgICAgICAgICAgIyBVUkwtc3R5bGUgdXNlcm5hbWUrcGFzc3dvcmQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYmVnaW4gPSBkYXRhLnJpbmRleCgnOi8vJywgMCwgc2VwX3NlYXJjaF9lbmQpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgIyBObyB1cmwgc3R5bGUgaW4gdGhlIGRhdGEsIGNoZWNrIGZvciBzc2ggc3R5bGUgaW4gdGhlCiAgICAgICAgICAgICAgICAjIHJlc3Qgb2YgdGhlIHN0cmluZwogICAgICAgICAgICAgICAgYmVnaW4gPSAwCiAgICAgICAgICAgICMgU2VhcmNoIGZvciBzZXBhcmF0b3IKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VwID0gZGF0YS5pbmRleCgnOicsIGJlZ2luICsgMywgZW5kKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgICMgTm8gc2VwYXJhdG9yOyBjaG9pY2VzOgogICAgICAgICAgICAgICAgaWYgYmVnaW4gPT0gMDoKICAgICAgICAgICAgICAgICAgICAjIFNlYXJjaGVkIHRoZSB3aG9sZSBzdHJpbmcgc28gdGhlcmUncyBubyBwYXNzd29yZAogICAgICAgICAgICAgICAgICAgICMgaGVyZS4gIFJldHVybiB0aGUgcmVtYWluaW5nIGRhdGEKICAgICAgICAgICAgICAgICAgICBvdXRwdXQuaW5zZXJ0KDAsIGRhdGFbMDpiZWdpbl0pCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICMgU2VhcmNoIGZvciBhIGRpZmZlcmVudCBiZWdpbm5pbmcgb2YgdGhlIHBhc3N3b3JkIGZpZWxkLgogICAgICAgICAgICAgICAgc2VwX3NlYXJjaF9lbmQgPSBiZWdpbgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBpZiBzZXA6CiAgICAgICAgICAgICMgUGFzc3dvcmQgd2FzIGZvdW5kOyByZW1vdmUgaXQuCiAgICAgICAgICAgIG91dHB1dC5pbnNlcnQoMCwgZGF0YVtlbmQ6cHJldl9iZWdpbl0pCiAgICAgICAgICAgIG91dHB1dC5pbnNlcnQoMCwgJyoqKioqKioqJykKICAgICAgICAgICAgb3V0cHV0Lmluc2VydCgwLCBkYXRhW2JlZ2luOnNlcCArIDFdKQogICAgICAgICAgICBwcmV2X2JlZ2luID0gYmVnaW4KCiAgICBvdXRwdXQgPSAnJy5qb2luKG91dHB1dCkKICAgIGlmIG5vX2xvZ192YWx1ZXM6CiAgICAgICAgb3V0cHV0ID0gcmVtb3ZlX3ZhbHVlcyhvdXRwdXQsIG5vX2xvZ192YWx1ZXMpCiAgICByZXR1cm4gb3V0cHV0CgpkZWYgYnl0ZXNfdG9faHVtYW4oc2l6ZSwgaXNiaXRzPUZhbHNlLCB1bml0PU5vbmUpOgoKICAgIGJhc2UgPSAnQnl0ZXMnCiAgICBpZiBpc2JpdHM6CiAgICAgICAgYmFzZSA9ICdiaXRzJwogICAgc3VmZml4ID0gJycKCiAgICBmb3Igc3VmZml4LCBsaW1pdCBpbiBzb3J0ZWQoaXRlcml0ZW1zKFNJWkVfUkFOR0VTKSwga2V5PWxhbWJkYSBpdGVtOiAtaXRlbVsxXSk6CiAgICAgICAgaWYgKHVuaXQgaXMgTm9uZSBhbmQgc2l6ZSA+PSBsaW1pdCkgb3IgdW5pdCBpcyBub3QgTm9uZSBhbmQgdW5pdC51cHBlcigpID09IHN1ZmZpeFswXToKICAgICAgICAgICAgYnJlYWsKCiAgICBpZiBsaW1pdCAhPSAxOgogICAgICAgIHN1ZmZpeCArPSBiYXNlWzBdCiAgICBlbHNlOgogICAgICAgIHN1ZmZpeCA9IGJhc2UKCiAgICByZXR1cm4gJyUuMmYgJXMnICUgKGZsb2F0KHNpemUpLyBsaW1pdCwgc3VmZml4KQoKZGVmIGh1bWFuX3RvX2J5dGVzKG51bWJlciwgZGVmYXVsdF91bml0PU5vbmUsIGlzYml0cz1GYWxzZSk6CgogICAgJycnCiAgICBDb252ZXJ0IG51bWJlciBpbiBzdHJpbmcgZm9ybWF0IGludG8gYnl0ZXMgKGV4OiAnMksnID0+IDIwNDgpIG9yIHVzaW5nIHVuaXQgYXJndW1lbnQKICAgIGV4OgogICAgICBodW1hbl90b19ieXRlcygnMTBNJykgPD0+IGh1bWFuX3RvX2J5dGVzKDEwLCAnTScpCiAgICAnJycKICAgIG0gPSByZS5zZWFyY2goJ15ccyooXGQqXC4/XGQqKVxzKihbQS1aYS16XSspPycsIHN0cihudW1iZXIpLCBmbGFncz1yZS5JR05PUkVDQVNFKQogICAgaWYgbSBpcyBOb25lOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoImh1bWFuX3RvX2J5dGVzKCkgY2FuJ3QgaW50ZXJwcmV0IGZvbGxvd2luZyBzdHJpbmc6ICVzIiAlIHN0cihudW1iZXIpKQogICAgdHJ5OgogICAgICAgIG51bSA9IGZsb2F0KG0uZ3JvdXAoMSkpCiAgICBleGNlcHQ6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiaHVtYW5fdG9fYnl0ZXMoKSBjYW4ndCBpbnRlcnByZXQgZm9sbG93aW5nIG51bWJlcjogJXMgKG9yaWdpbmFsIGlucHV0IHN0cmluZzogJXMpIiAlIChtLmdyb3VwKDEpLCBudW1iZXIpKQoKICAgIHVuaXQgPSBtLmdyb3VwKDIpCiAgICBpZiB1bml0IGlzIE5vbmU6CiAgICAgICAgdW5pdCA9IGRlZmF1bHRfdW5pdAoKICAgIGlmIHVuaXQgaXMgTm9uZToKICAgICAgICAnJycgTm8gdW5pdCBnaXZlbiwgcmV0dXJuaW5nIHJhdyBudW1iZXIgJycnCiAgICAgICAgcmV0dXJuIGludChyb3VuZChudW0pKQogICAgcmFuZ2Vfa2V5ID0gdW5pdFswXS51cHBlcigpCiAgICB0cnk6CiAgICAgICAgbGltaXQgPSBTSVpFX1JBTkdFU1tyYW5nZV9rZXldCiAgICBleGNlcHQ6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiaHVtYW5fdG9fYnl0ZXMoKSBmYWlsZWQgdG8gY29udmVydCAlcyAodW5pdCA9ICVzKS4gVGhlIHN1ZmZpeCBtdXN0IGJlIG9uZSBvZiAlcyIgJSAobnVtYmVyLCB1bml0LCAiLCAiLmpvaW4oU0laRV9SQU5HRVMua2V5cygpKSkpCgogICAgIyBkZWZhdWx0IHZhbHVlCiAgICB1bml0X2NsYXNzID0gJ0InCiAgICB1bml0X2NsYXNzX25hbWUgPSAnYnl0ZScKICAgICMgaGFuZGxpbmcgYml0cyBjYXNlCiAgICBpZiBpc2JpdHM6CiAgICAgICAgdW5pdF9jbGFzcyA9ICdiJwogICAgICAgIHVuaXRfY2xhc3NfbmFtZSA9ICdiaXQnCiAgICAjIGNoZWNrIHVuaXQgdmFsdWUgaWYgbW9yZSB0aGFuIG9uZSBjaGFyYWN0ZXIgKEtCLCBNQikKICAgIGlmIGxlbih1bml0KSA+IDE6CiAgICAgICAgZXhwZWN0X21lc3NhZ2UgPSAnZXhwZWN0ICVzJXMgb3IgJXMnICUgKHJhbmdlX2tleSwgdW5pdF9jbGFzcywgcmFuZ2Vfa2V5KQogICAgICAgIGlmIHJhbmdlX2tleSA9PSAnQic6CiAgICAgICAgICAgIGV4cGVjdF9tZXNzYWdlID0gJ2V4cGVjdCAlcyBvciAlcycgJSAodW5pdF9jbGFzcywgdW5pdF9jbGFzc19uYW1lKQoKICAgICAgICBpZiB1bml0X2NsYXNzX25hbWUgaW4gdW5pdC5sb3dlcigpOgogICAgICAgICAgICBwYXNzCiAgICAgICAgZWxpZiB1bml0WzFdICE9IHVuaXRfY2xhc3M6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoImh1bWFuX3RvX2J5dGVzKCkgZmFpbGVkIHRvIGNvbnZlcnQgJXMuIFZhbHVlIGlzIG5vdCBhIHZhbGlkIHN0cmluZyAoJXMpIiAlIChudW1iZXIsIGV4cGVjdF9tZXNzYWdlKSkKCiAgICByZXR1cm4gaW50KHJvdW5kKG51bSAqIGxpbWl0KSkKCmRlZiBpc19leGVjdXRhYmxlKHBhdGgpOgogICAgJycnaXMgdGhlIGdpdmVuIHBhdGggZXhlY3V0YWJsZT8KCiAgICBMaW1pdGF0aW9uczoKICAgICogRG9lcyBub3QgYWNjb3VudCBmb3IgRlNBQ0xzLgogICAgKiBNb3N0IHRpbWVzIHdlIHJlYWxseSB3YW50IHRvIGtub3cgIkNhbiB0aGUgY3VycmVudCB1c2VyIGV4ZWN1dGUgdGhpcwogICAgICBmaWxlIiAgVGhpcyBmdW5jdGlvbiBkb2VzIG5vdCB0ZWxsIHVzIHRoYXQsIG9ubHkgaWYgYW4gZXhlY3V0ZSBiaXQgaXMgc2V0LgogICAgJycnCiAgICAjIFRoZXNlIGFyZSBhbGwgYml0ZmllbGRzIHNvIGZpcnN0IGJpdHdpc2Utb3IgYWxsIHRoZSBwZXJtaXNzaW9ucyB3ZSdyZQogICAgIyBsb29raW5nIGZvciwgdGhlbiBiaXR3aXNlLWFuZCB3aXRoIHRoZSBmaWxlJ3MgbW9kZSB0byBkZXRlcm1pbmUgaWYgYW55CiAgICAjIGV4ZWN1dGUgYml0cyBhcmUgc2V0LgogICAgcmV0dXJuICgoc3RhdC5TX0lYVVNSIHwgc3RhdC5TX0lYR1JQIHwgc3RhdC5TX0lYT1RIKSAmIG9zLnN0YXQocGF0aClbc3RhdC5TVF9NT0RFXSkKCmRlZiBfbG9hZF9wYXJhbXMoKToKICAgICcnJyByZWFkIHRoZSBtb2R1bGVzIHBhcmFtZXRlcnMgYW5kIHN0b3JlIHRoZW0gZ2xvYmFsbHkuCgogICAgVGhpcyBmdW5jdGlvbiBtYXkgYmUgbmVlZGVkIGZvciBjZXJ0YWluIHZlcnkgZHluYW1pYyBjdXN0b20gbW9kdWxlcyB3aGljaAogICAgd2FudCB0byBwcm9jZXNzIHRoZSBwYXJhbWV0ZXJzIHRoYXQgYXJlIGJlaW5nIGhhbmRlZCB0aGUgbW9kdWxlLiAgU2luY2UKICAgIHRoaXMgaXMgc28gY2xvc2VseSB0aWVkIHRvIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBtb2R1bGVzIHdlIGNhbm5vdAogICAgZ3VhcmFudGVlIEFQSSBzdGFiaWxpdHkgZm9yIGl0IChpdCBtYXkgY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMpIGhvd2V2ZXIgd2UKICAgIHdpbGwgdHJ5IG5vdCB0byBicmVhayBpdCBncmF0dWl0b3VzbHkuICBJdCBpcyBjZXJ0YWlubHkgbW9yZSBmdXR1cmUtcHJvb2YKICAgIHRvIGNhbGwgdGhpcyBmdW5jdGlvbiBhbmQgY29uc3VtZSBpdHMgb3V0cHV0cyB0aGFuIHRvIGltcGxlbWVudCB0aGUgbG9naWMKICAgIGluc2lkZSBpdCBhcyBhIGNvcHkgaW4geW91ciBvd24gY29kZS4KICAgICcnJwogICAgZ2xvYmFsIF9BTlNJQkxFX0FSR1MKICAgIGlmIF9BTlNJQkxFX0FSR1MgaXMgbm90IE5vbmU6CiAgICAgICAgYnVmZmVyID0gX0FOU0lCTEVfQVJHUwogICAgZWxzZToKICAgICAgICAjIGRlYnVnIG92ZXJyaWRlcyB0byByZWFkIGFyZ3MgZnJvbSBmaWxlIG9yIGNtZGxpbmUKCiAgICAgICAgIyBBdm9pZCB0cmFjZWJhY2tzIHdoZW4gbG9jYWxlIGlzIG5vbi11dGY4CiAgICAgICAgIyBXZSBjb250cm9sIHRoZSBhcmdzIGFuZCB3ZSBwYXNzIHRoZW0gYXMgdXRmOAogICAgICAgIGlmIGxlbihzeXMuYXJndikgPiAxOgogICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShzeXMuYXJndlsxXSk6CiAgICAgICAgICAgICAgICBmZCA9IG9wZW4oc3lzLmFyZ3ZbMV0sICdyYicpCiAgICAgICAgICAgICAgICBidWZmZXIgPSBmZC5yZWFkKCkKICAgICAgICAgICAgICAgIGZkLmNsb3NlKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHN5cy5hcmd2WzFdCiAgICAgICAgICAgICAgICBpZiBQWTM6CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyID0gYnVmZmVyLmVuY29kZSgndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZWVzY2FwZScpCiAgICAgICAgIyBkZWZhdWx0IGNhc2UsIHJlYWQgZnJvbSBzdGRpbgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIFBZMjoKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHN5cy5zdGRpbi5yZWFkKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHN5cy5zdGRpbi5idWZmZXIucmVhZCgpCiAgICAgICAgX0FOU0lCTEVfQVJHUyA9IGJ1ZmZlcgoKICAgIHRyeToKICAgICAgICBwYXJhbXMgPSBqc29uLmxvYWRzKGJ1ZmZlci5kZWNvZGUoJ3V0Zi04JykpCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAjIFRoaXMgaGVscGVyIHVzZWQgdG9vIGVhcmx5IGZvciBmYWlsX2pzb24gdG8gd29yay4KICAgICAgICBwcmludCgnXG57Im1zZyI6ICJFcnJvcjogTW9kdWxlIHVuYWJsZSB0byBkZWNvZGUgdmFsaWQgSlNPTiBvbiBzdGRpbi4gIFVuYWJsZSB0byBmaWd1cmUgb3V0IHdoYXQgcGFyYW1ldGVycyB3ZXJlIHBhc3NlZCIsICJmYWlsZWQiOiB0cnVlfScpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICBpZiBQWTI6CiAgICAgICAgcGFyYW1zID0ganNvbl9kaWN0X3VuaWNvZGVfdG9fYnl0ZXMocGFyYW1zKQoKICAgIHRyeToKICAgICAgICByZXR1cm4gcGFyYW1zWydBTlNJQkxFX01PRFVMRV9BUkdTJ10KICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAjIFRoaXMgaGVscGVyIGRvZXMgbm90IGhhdmUgYWNjZXNzIHRvIGZhaWxfanNvbiBzbyB3ZSBoYXZlIHRvIHByaW50CiAgICAgICAgIyBqc29uIG91dHB1dCBvbiBvdXIgb3duLgogICAgICAgIHByaW50KCdcbnsibXNnIjogIkVycm9yOiBNb2R1bGUgdW5hYmxlIHRvIGxvY2F0ZSBBTlNJQkxFX01PRFVMRV9BUkdTIGluIGpzb24gZGF0YSBmcm9tIHN0ZGluLiAgVW5hYmxlIHRvIGZpZ3VyZSBvdXQgd2hhdCBwYXJhbWV0ZXJzIHdlcmUgcGFzc2VkIiwgJwogICAgICAgICAgICAgICciZmFpbGVkIjogdHJ1ZX0nKQogICAgICAgIHN5cy5leGl0KDEpCgpkZWYgZW52X2ZhbGxiYWNrKCphcmdzLCAqKmt3YXJncyk6CiAgICAnJycgTG9hZCB2YWx1ZSBmcm9tIGVudmlyb25tZW50ICcnJwogICAgZm9yIGFyZyBpbiBhcmdzOgogICAgICAgIGlmIGFyZyBpbiBvcy5lbnZpcm9uOgogICAgICAgICAgICByZXR1cm4gb3MuZW52aXJvblthcmddCiAgICBlbHNlOgogICAgICAgIHJhaXNlIEFuc2libGVGYWxsYmFja05vdEZvdW5kCgpkZWYgX2xlbmllbnRfbG93ZXJjYXNlKGxzdCk6CiAgICAiIiJMb3dlcmNhc2UgZWxlbWVudHMgb2YgYSBsaXN0LgoKICAgIElmIGFuIGVsZW1lbnQgaXMgbm90IGEgc3RyaW5nLCBwYXNzIGl0IHRocm91Z2ggdW50b3VjaGVkLgogICAgIiIiCiAgICBsb3dlcmVkID0gW10KICAgIGZvciB2YWx1ZSBpbiBsc3Q6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb3dlcmVkLmFwcGVuZCh2YWx1ZS5sb3dlcigpKQogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICAgICAgbG93ZXJlZC5hcHBlbmQodmFsdWUpCiAgICByZXR1cm4gbG93ZXJlZAoKZGVmIGZvcm1hdF9hdHRyaWJ1dGVzKGF0dHJpYnV0ZXMpOgogICAgYXR0cmlidXRlX2xpc3QgPSBbXQogICAgZm9yIGF0dHIgaW4gYXR0cmlidXRlczoKICAgICAgICBpZiBhdHRyIGluIEZJTEVfQVRUUklCVVRFUzoKICAgICAgICAgICAgYXR0cmlidXRlX2xpc3QuYXBwZW5kKEZJTEVfQVRUUklCVVRFU1thdHRyXSkKICAgIHJldHVybiBhdHRyaWJ1dGVfbGlzdAoKZGVmIGdldF9mbGFnc19mcm9tX2F0dHJpYnV0ZXMoYXR0cmlidXRlcyk6CiAgICBmbGFncyA9IFtdCiAgICBmb3Iga2V5LGF0dHIgaW4gRklMRV9BVFRSSUJVVEVTLml0ZW1zKCk6CiAgICAgICAgaWYgYXR0ciBpbiBhdHRyaWJ1dGVzOgogICAgICAgICAgICBmbGFncy5hcHBlbmQoa2V5KQogICAgcmV0dXJuICcnLmpvaW4oZmxhZ3MpCgpjbGFzcyBBbnNpYmxlRmFsbGJhY2tOb3RGb3VuZChFeGNlcHRpb24pOgogICAgcGFzcwoKCmNsYXNzIEFuc2libGVNb2R1bGUob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhcmd1bWVudF9zcGVjLCBieXBhc3NfY2hlY2tzPUZhbHNlLCBub19sb2c9RmFsc2UsCiAgICAgICAgICAgICAgICAgY2hlY2tfaW52YWxpZF9hcmd1bWVudHM9VHJ1ZSwgbXV0dWFsbHlfZXhjbHVzaXZlPU5vbmUsIHJlcXVpcmVkX3RvZ2V0aGVyPU5vbmUsCiAgICAgICAgICAgICAgICAgcmVxdWlyZWRfb25lX29mPU5vbmUsIGFkZF9maWxlX2NvbW1vbl9hcmdzPUZhbHNlLCBzdXBwb3J0c19jaGVja19tb2RlPUZhbHNlLAogICAgICAgICAgICAgICAgIHJlcXVpcmVkX2lmPU5vbmUpOgoKICAgICAgICAnJycKICAgICAgICBjb21tb24gY29kZSBmb3IgcXVpY2tseSBidWlsZGluZyBhbiBhbnNpYmxlIG1vZHVsZSBpbiBQeXRob24KICAgICAgICAoYWx0aG91Z2ggeW91IGNhbiB3cml0ZSBtb2R1bGVzIGluIGFueXRoaW5nIHRoYXQgY2FuIHJldHVybiBKU09OKQogICAgICAgIHNlZSBsaWJyYXJ5LyogZm9yIGV4YW1wbGVzCiAgICAgICAgJycnCgogICAgICAgIHNlbGYuX25hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKF9fZmlsZV9fKSAjaW5pdGlhbGl6ZSBuYW1lIHVudGlsIHdlIGNhbiBwYXJzZSBmcm9tIG9wdGlvbnMKICAgICAgICBzZWxmLmFyZ3VtZW50X3NwZWMgPSBhcmd1bWVudF9zcGVjCiAgICAgICAgc2VsZi5zdXBwb3J0c19jaGVja19tb2RlID0gc3VwcG9ydHNfY2hlY2tfbW9kZQogICAgICAgIHNlbGYuY2hlY2tfbW9kZSA9IEZhbHNlCiAgICAgICAgc2VsZi5ub19sb2cgPSBub19sb2cKICAgICAgICBzZWxmLmNsZWFudXBfZmlsZXMgPSBbXQogICAgICAgIHNlbGYuX2RlYnVnID0gRmFsc2UKICAgICAgICBzZWxmLl9kaWZmID0gRmFsc2UKICAgICAgICBzZWxmLl9zb2NrZXRfcGF0aCA9IE5vbmUKICAgICAgICBzZWxmLl92ZXJib3NpdHkgPSAwCiAgICAgICAgIyBNYXkgYmUgdXNlZCB0byBzZXQgbW9kaWZpY2F0aW9ucyB0byB0aGUgZW52aXJvbm1lbnQgZm9yIGFueQogICAgICAgICMgcnVuX2NvbW1hbmQgaW52b2NhdGlvbgogICAgICAgIHNlbGYucnVuX2NvbW1hbmRfZW52aXJvbl91cGRhdGUgPSB7fQogICAgICAgIHNlbGYuX3dhcm5pbmdzID0gW10KICAgICAgICBzZWxmLl9kZXByZWNhdGlvbnMgPSBbXQoKICAgICAgICBzZWxmLmFsaWFzZXMgPSB7fQogICAgICAgIHNlbGYuX2xlZ2FsX2lucHV0cyA9IFsnX2Fuc2libGVfY2hlY2tfbW9kZScsICdfYW5zaWJsZV9ub19sb2cnLCAnX2Fuc2libGVfZGVidWcnLCAnX2Fuc2libGVfZGlmZicsICdfYW5zaWJsZV92ZXJib3NpdHknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnX2Fuc2libGVfc2VsaW51eF9zcGVjaWFsX2ZzJywgJ19hbnNpYmxlX21vZHVsZV9uYW1lJywgJ19hbnNpYmxlX3ZlcnNpb24nLCAnX2Fuc2libGVfc3lzbG9nX2ZhY2lsaXR5JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ19hbnNpYmxlX3NvY2tldCddCgogICAgICAgIGlmIGFkZF9maWxlX2NvbW1vbl9hcmdzOgogICAgICAgICAgICBmb3IgaywgdiBpbiBGSUxFX0NPTU1PTl9BUkdVTUVOVFMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIGsgbm90IGluIHNlbGYuYXJndW1lbnRfc3BlYzoKICAgICAgICAgICAgICAgICAgICBzZWxmLmFyZ3VtZW50X3NwZWNba10gPSB2CgogICAgICAgIHNlbGYuX2xvYWRfcGFyYW1zKCkKICAgICAgICBzZWxmLl9zZXRfZmFsbGJhY2tzKCkKCiAgICAgICAgIyBhcHBlbmQgdG8gbGVnYWxfaW5wdXRzIGFuZCB0aGVuIHBvc3NpYmx5IGNoZWNrIGFnYWluc3QgdGhlbQogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5hbGlhc2VzID0gc2VsZi5faGFuZGxlX2FsaWFzZXMoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgIyBVc2UgZXhjZXB0aW9ucyBoZXJlIGJlY2F1c2UgaXQgaXNuJ3Qgc2FmZSB0byBjYWxsIGZhaWxfanNvbiB1bnRpbCBub19sb2cgaXMgcHJvY2Vzc2VkCiAgICAgICAgICAgIHByaW50KCdcbnsiZmFpbGVkIjogdHJ1ZSwgIm1zZyI6ICJNb2R1bGUgYWxpYXMgZXJyb3I6ICVzIn0nICUgc3RyKGUpKQogICAgICAgICAgICBzeXMuZXhpdCgxKQoKICAgICAgICAjIFNhdmUgcGFyYW1ldGVyIHZhbHVlcyB0aGF0IHNob3VsZCBuZXZlciBiZSBsb2dnZWQKICAgICAgICBzZWxmLm5vX2xvZ192YWx1ZXMgPSBzZXQoKQogICAgICAgICMgVXNlIHRoZSBhcmdzcGVjIHRvIGRldGVybWluZSB3aGljaCBhcmdzIGFyZSBub19sb2cKICAgICAgICBmb3IgYXJnX25hbWUsIGFyZ19vcHRzIGluIHNlbGYuYXJndW1lbnRfc3BlYy5pdGVtcygpOgogICAgICAgICAgICBpZiBhcmdfb3B0cy5nZXQoJ25vX2xvZycsIEZhbHNlKToKICAgICAgICAgICAgICAgICMgRmluZCB0aGUgdmFsdWUgZm9yIHRoZSBub19sb2cnZCBwYXJhbQogICAgICAgICAgICAgICAgbm9fbG9nX29iamVjdCA9IHNlbGYucGFyYW1zLmdldChhcmdfbmFtZSwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIG5vX2xvZ19vYmplY3Q6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5ub19sb2dfdmFsdWVzLnVwZGF0ZShyZXR1cm5fdmFsdWVzKG5vX2xvZ19vYmplY3QpKQoKICAgICAgICAgICAgaWYgYXJnX29wdHMuZ2V0KCdyZW1vdmVkX2luX3ZlcnNpb24nKSBpcyBub3QgTm9uZSBhbmQgYXJnX25hbWUgaW4gc2VsZi5wYXJhbXM6CiAgICAgICAgICAgICAgICBzZWxmLl9kZXByZWNhdGlvbnMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAnbXNnJzogIlBhcmFtICclcycgaXMgZGVwcmVjYXRlZC4gU2VlIHRoZSBtb2R1bGUgZG9jcyBmb3IgbW9yZSBpbmZvcm1hdGlvbiIgJSBhcmdfbmFtZSwKICAgICAgICAgICAgICAgICAgICAndmVyc2lvbic6IGFyZ19vcHRzLmdldCgncmVtb3ZlZF9pbl92ZXJzaW9uJykKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICMgY2hlY2sgdGhlIGxvY2FsZSBhcyBzZXQgYnkgdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQsIGFuZCByZXNldCB0bwogICAgICAgICMgYSBrbm93biB2YWxpZCAoTEFORz1DKSBpZiBpdCdzIGFuIGludmFsaWQvdW5hdmFpbGFibGUgbG9jYWxlCiAgICAgICAgc2VsZi5fY2hlY2tfbG9jYWxlKCkKCiAgICAgICAgc2VsZi5fY2hlY2tfYXJndW1lbnRzKGNoZWNrX2ludmFsaWRfYXJndW1lbnRzKQoKICAgICAgICAjIGNoZWNrIGV4Y2x1c2l2ZSBlYXJseQogICAgICAgIGlmIG5vdCBieXBhc3NfY2hlY2tzOgogICAgICAgICAgICBzZWxmLl9jaGVja19tdXR1YWxseV9leGNsdXNpdmUobXV0dWFsbHlfZXhjbHVzaXZlKQoKICAgICAgICBzZWxmLl9zZXRfZGVmYXVsdHMocHJlPVRydWUpCgogICAgICAgIHNlbGYuX0NIRUNLX0FSR1VNRU5UX1RZUEVTX0RJU1BBVENIRVIgPSB7CiAgICAgICAgICAgICdzdHInOiBzZWxmLl9jaGVja190eXBlX3N0ciwKICAgICAgICAgICAgJ2xpc3QnOiBzZWxmLl9jaGVja190eXBlX2xpc3QsCiAgICAgICAgICAgICdkaWN0Jzogc2VsZi5fY2hlY2tfdHlwZV9kaWN0LAogICAgICAgICAgICAnYm9vbCc6IHNlbGYuX2NoZWNrX3R5cGVfYm9vbCwKICAgICAgICAgICAgJ2ludCc6IHNlbGYuX2NoZWNrX3R5cGVfaW50LAogICAgICAgICAgICAnZmxvYXQnOiBzZWxmLl9jaGVja190eXBlX2Zsb2F0LAogICAgICAgICAgICAncGF0aCc6IHNlbGYuX2NoZWNrX3R5cGVfcGF0aCwKICAgICAgICAgICAgJ3Jhdyc6IHNlbGYuX2NoZWNrX3R5cGVfcmF3LAogICAgICAgICAgICAnanNvbmFyZyc6IHNlbGYuX2NoZWNrX3R5cGVfanNvbmFyZywKICAgICAgICAgICAgJ2pzb24nOiBzZWxmLl9jaGVja190eXBlX2pzb25hcmcsCiAgICAgICAgICAgICdieXRlcyc6IHNlbGYuX2NoZWNrX3R5cGVfYnl0ZXMsCiAgICAgICAgICAgICdiaXRzJzogc2VsZi5fY2hlY2tfdHlwZV9iaXRzLAogICAgICAgIH0KICAgICAgICBpZiBub3QgYnlwYXNzX2NoZWNrczoKICAgICAgICAgICAgc2VsZi5fY2hlY2tfcmVxdWlyZWRfYXJndW1lbnRzKCkKICAgICAgICAgICAgc2VsZi5fY2hlY2tfYXJndW1lbnRfdHlwZXMoKQogICAgICAgICAgICBzZWxmLl9jaGVja19hcmd1bWVudF92YWx1ZXMoKQogICAgICAgICAgICBzZWxmLl9jaGVja19yZXF1aXJlZF90b2dldGhlcihyZXF1aXJlZF90b2dldGhlcikKICAgICAgICAgICAgc2VsZi5fY2hlY2tfcmVxdWlyZWRfb25lX29mKHJlcXVpcmVkX29uZV9vZikKICAgICAgICAgICAgc2VsZi5fY2hlY2tfcmVxdWlyZWRfaWYocmVxdWlyZWRfaWYpCgogICAgICAgIHNlbGYuX3NldF9kZWZhdWx0cyhwcmU9RmFsc2UpCgogICAgICAgIGlmIG5vdCBzZWxmLm5vX2xvZzoKICAgICAgICAgICAgc2VsZi5fbG9nX2ludm9jYXRpb24oKQoKICAgICAgICAjIGZpbmFsbHksIG1ha2Ugc3VyZSB3ZSdyZSBpbiBhIHNhbmUgd29ya2luZyBkaXIKICAgICAgICBzZWxmLl9zZXRfY3dkKCkKCiAgICBkZWYgd2FybihzZWxmLCB3YXJuaW5nKToKCiAgICAgICAgaWYgaXNpbnN0YW5jZSh3YXJuaW5nLCBzdHJpbmdfdHlwZXMpOgogICAgICAgICAgICBzZWxmLl93YXJuaW5ncy5hcHBlbmQod2FybmluZykKICAgICAgICAgICAgc2VsZi5sb2coJ1tXQVJOSU5HXSAlcycgJSB3YXJuaW5nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigid2FybiByZXF1aXJlcyBhIHN0cmluZyBub3QgYSAlcyIgJSB0eXBlKHdhcm5pbmcpKQoKICAgIGRlZiBkZXByZWNhdGUoc2VsZiwgbXNnLCB2ZXJzaW9uPU5vbmUpOgogICAgICAgIGlmIGlzaW5zdGFuY2UobXNnLCBzdHJpbmdfdHlwZXMpOgogICAgICAgICAgICBzZWxmLl9kZXByZWNhdGlvbnMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICdtc2cnOiBtc2csCiAgICAgICAgICAgICAgICAndmVyc2lvbic6IHZlcnNpb24KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5sb2coJ1tERVBSRUNBVElPTiBXQVJOSU5HXSAlcyAlcycgJSAobXNnLCB2ZXJzaW9uKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoImRlcHJlY2F0ZSByZXF1aXJlcyBhIHN0cmluZyBub3QgYSAlcyIgJSB0eXBlKG1zZykpCgogICAgZGVmIGxvYWRfZmlsZV9jb21tb25fYXJndW1lbnRzKHNlbGYsIHBhcmFtcyk6CiAgICAgICAgJycnCiAgICAgICAgbWFueSBtb2R1bGVzIGRlYWwgd2l0aCBmaWxlcywgdGhpcyBlbmNhcHN1bGF0ZXMgY29tbW9uCiAgICAgICAgb3B0aW9ucyB0aGF0IHRoZSBmaWxlIG1vZHVsZSBhY2NlcHRzIHN1Y2ggdGhhdCBpdCBpcyBkaXJlY3RseQogICAgICAgIGF2YWlsYWJsZSB0byBhbGwgbW9kdWxlcyBhbmQgdGhleSBjYW4gc2hhcmUgY29kZS4KICAgICAgICAnJycKCiAgICAgICAgcGF0aCA9IHBhcmFtcy5nZXQoJ3BhdGgnLCBwYXJhbXMuZ2V0KCdkZXN0JywgTm9uZSkpCiAgICAgICAgaWYgcGF0aCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4ge30KICAgICAgICBlbHNlOgogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhwYXRoKSkKCiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICAjIGlmIHRoZSBwYXRoIGlzIGEgc3ltbGluaywgYW5kIHdlJ3JlIGZvbGxvd2luZyBsaW5rcywgZ2V0CiAgICAgICAgIyB0aGUgdGFyZ2V0IG9mIHRoZSBsaW5rIGluc3RlYWQgZm9yIHRlc3RpbmcKICAgICAgICBpZiBwYXJhbXMuZ2V0KCdmb2xsb3cnLCBGYWxzZSkgYW5kIG9zLnBhdGguaXNsaW5rKGJfcGF0aCk6CiAgICAgICAgICAgIGJfcGF0aCA9IG9zLnBhdGgucmVhbHBhdGgoYl9wYXRoKQogICAgICAgICAgICBwYXRoID0gdG9fbmF0aXZlKGJfcGF0aCkKCiAgICAgICAgbW9kZSAgID0gcGFyYW1zLmdldCgnbW9kZScsIE5vbmUpCiAgICAgICAgb3duZXIgID0gcGFyYW1zLmdldCgnb3duZXInLCBOb25lKQogICAgICAgIGdyb3VwICA9IHBhcmFtcy5nZXQoJ2dyb3VwJywgTm9uZSkKCiAgICAgICAgIyBzZWxpbnV4IHJlbGF0ZWQgb3B0aW9ucwogICAgICAgIHNldXNlciAgICA9IHBhcmFtcy5nZXQoJ3NldXNlcicsIE5vbmUpCiAgICAgICAgc2Vyb2xlICAgID0gcGFyYW1zLmdldCgnc2Vyb2xlJywgTm9uZSkKICAgICAgICBzZXR5cGUgICAgPSBwYXJhbXMuZ2V0KCdzZXR5cGUnLCBOb25lKQogICAgICAgIHNlbGV2ZWwgICA9IHBhcmFtcy5nZXQoJ3NlbGV2ZWwnLCBOb25lKQogICAgICAgIHNlY29udGV4dCA9IFtzZXVzZXIsIHNlcm9sZSwgc2V0eXBlXQoKICAgICAgICBpZiBzZWxmLnNlbGludXhfbWxzX2VuYWJsZWQoKToKICAgICAgICAgICAgc2Vjb250ZXh0LmFwcGVuZChzZWxldmVsKQoKICAgICAgICBkZWZhdWx0X3NlY29udGV4dCA9IHNlbGYuc2VsaW51eF9kZWZhdWx0X2NvbnRleHQocGF0aCkKICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZGVmYXVsdF9zZWNvbnRleHQpKToKICAgICAgICAgICAgaWYgaSBpcyBub3QgTm9uZSBhbmQgc2Vjb250ZXh0W2ldID09ICdfZGVmYXVsdCc6CiAgICAgICAgICAgICAgICBzZWNvbnRleHRbaV0gPSBkZWZhdWx0X3NlY29udGV4dFtpXQoKICAgICAgICBhdHRyaWJ1dGVzID0gcGFyYW1zLmdldCgnYXR0cmlidXRlcycsIE5vbmUpCiAgICAgICAgcmV0dXJuIGRpY3QoCiAgICAgICAgICAgIHBhdGg9cGF0aCwgbW9kZT1tb2RlLCBvd25lcj1vd25lciwgZ3JvdXA9Z3JvdXAsCiAgICAgICAgICAgIHNldXNlcj1zZXVzZXIsIHNlcm9sZT1zZXJvbGUsIHNldHlwZT1zZXR5cGUsCiAgICAgICAgICAgIHNlbGV2ZWw9c2VsZXZlbCwgc2Vjb250ZXh0PXNlY29udGV4dCwgYXR0cmlidXRlcz1hdHRyaWJ1dGVzLAogICAgICAgICkKCgogICAgIyBEZXRlY3Qgd2hldGhlciB1c2luZyBzZWxpbnV4IHRoYXQgaXMgTUxTLWF3YXJlLgogICAgIyBXaGlsZSB0aGlzIG1lYW5zIHlvdSBjYW4gc2V0IHRoZSBsZXZlbC9yYW5nZSB3aXRoCiAgICAjIHNlbGludXgubHNldGZpbGVjb24oKSwgaXQgbWF5IG9yIG1heSBub3QgbWVhbiB0aGF0IHlvdQogICAgIyB3aWxsIGdldCB0aGUgc2VsZXZlbCBhcyBwYXJ0IG9mIHRoZSBjb250ZXh0IHJldHVybmVkCiAgICAjIGJ5IHNlbGludXgubGdldGZpbGVjb24oKS4KCiAgICBkZWYgc2VsaW51eF9tbHNfZW5hYmxlZChzZWxmKToKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBpZiBzZWxpbnV4LmlzX3NlbGludXhfbWxzX2VuYWJsZWQoKSA9PSAxOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzZWxpbnV4X2VuYWJsZWQoc2VsZik6CiAgICAgICAgaWYgbm90IEhBVkVfU0VMSU5VWDoKICAgICAgICAgICAgc2VlbmFibGVkID0gc2VsZi5nZXRfYmluX3BhdGgoJ3NlbGludXhlbmFibGVkJykKICAgICAgICAgICAgaWYgc2VlbmFibGVkIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgKHJjLG91dCxlcnIpID0gc2VsZi5ydW5fY29tbWFuZChzZWVuYWJsZWQpCiAgICAgICAgICAgICAgICBpZiByYyA9PSAwOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iQWJvcnRpbmcsIHRhcmdldCB1c2VzIHNlbGludXggYnV0IHB5dGhvbiBiaW5kaW5ncyAobGlic2VsaW51eC1weXRob24pIGFyZW4ndCBpbnN0YWxsZWQhIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgaWYgc2VsaW51eC5pc19zZWxpbnV4X2VuYWJsZWQoKSA9PSAxOgogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICMgRGV0ZXJtaW5lIHdoZXRoZXIgd2UgbmVlZCBhIHBsYWNlaG9sZGVyIGZvciBzZWxldmVsL21scwogICAgZGVmIHNlbGludXhfaW5pdGlhbF9jb250ZXh0KHNlbGYpOgogICAgICAgIGNvbnRleHQgPSBbTm9uZSwgTm9uZSwgTm9uZV0KICAgICAgICBpZiBzZWxmLnNlbGludXhfbWxzX2VuYWJsZWQoKToKICAgICAgICAgICAgY29udGV4dC5hcHBlbmQoTm9uZSkKICAgICAgICByZXR1cm4gY29udGV4dAoKICAgICMgSWYgc2VsaW51eCBmYWlscyB0byBmaW5kIGEgZGVmYXVsdCwgcmV0dXJuIGFuIGFycmF5IG9mIE5vbmUKICAgIGRlZiBzZWxpbnV4X2RlZmF1bHRfY29udGV4dChzZWxmLCBwYXRoLCBtb2RlPTApOgogICAgICAgIGNvbnRleHQgPSBzZWxmLnNlbGludXhfaW5pdGlhbF9jb250ZXh0KCkKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYIG9yIG5vdCBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICByZXR1cm4gY29udGV4dAogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0ID0gc2VsaW51eC5tYXRjaHBhdGhjb24odG9fbmF0aXZlKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpLCBtb2RlKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICByZXR1cm4gY29udGV4dAogICAgICAgIGlmIHJldFswXSA9PSAtMToKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQKICAgICAgICAjIExpbWl0IHNwbGl0IHRvIDQgYmVjYXVzZSB0aGUgc2VsZXZlbCwgdGhlIGxhc3QgaW4gdGhlIGxpc3QsCiAgICAgICAgIyBtYXkgY29udGFpbiAnOicgY2hhcmFjdGVycwogICAgICAgIGNvbnRleHQgPSByZXRbMV0uc3BsaXQoJzonLCAzKQogICAgICAgIHJldHVybiBjb250ZXh0CgogICAgZGVmIHNlbGludXhfY29udGV4dChzZWxmLCBwYXRoKToKICAgICAgICBjb250ZXh0ID0gc2VsZi5zZWxpbnV4X2luaXRpYWxfY29udGV4dCgpCiAgICAgICAgaWYgbm90IEhBVkVfU0VMSU5VWCBvciBub3Qgc2VsZi5zZWxpbnV4X2VuYWJsZWQoKToKICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJldCA9IHNlbGludXgubGdldGZpbGVjb25fcmF3KHRvX25hdGl2ZShwYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKSkKICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBpZiBlLmVycm5vID09IGVycm5vLkVOT0VOVDoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdwYXRoICVzIGRvZXMgbm90IGV4aXN0JyAlIHBhdGgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsIG1zZz0nZmFpbGVkIHRvIHJldHJpZXZlIHNlbGludXggY29udGV4dCcpCiAgICAgICAgaWYgcmV0WzBdID09IC0xOgogICAgICAgICAgICByZXR1cm4gY29udGV4dAogICAgICAgICMgTGltaXQgc3BsaXQgdG8gNCBiZWNhdXNlIHRoZSBzZWxldmVsLCB0aGUgbGFzdCBpbiB0aGUgbGlzdCwKICAgICAgICAjIG1heSBjb250YWluICc6JyBjaGFyYWN0ZXJzCiAgICAgICAgY29udGV4dCA9IHJldFsxXS5zcGxpdCgnOicsIDMpCiAgICAgICAgcmV0dXJuIGNvbnRleHQKCiAgICBkZWYgdXNlcl9hbmRfZ3JvdXAoc2VsZiwgcGF0aCwgZXhwYW5kPVRydWUpOgogICAgICAgIGJfcGF0aCA9IHRvX2J5dGVzKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fc3RyaWN0JykKICAgICAgICBpZiBleHBhbmQ6CiAgICAgICAgICAgIGJfcGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnMoYl9wYXRoKSkKICAgICAgICBzdCA9IG9zLmxzdGF0KGJfcGF0aCkKICAgICAgICB1aWQgPSBzdC5zdF91aWQKICAgICAgICBnaWQgPSBzdC5zdF9naWQKICAgICAgICByZXR1cm4gKHVpZCwgZ2lkKQoKICAgIGRlZiBmaW5kX21vdW50X3BvaW50KHNlbGYsIHBhdGgpOgogICAgICAgIHBhdGhfaXNfYnl0ZXMgPSBGYWxzZQogICAgICAgIGlmIGlzaW5zdGFuY2UocGF0aCwgYmluYXJ5X3R5cGUpOgogICAgICAgICAgICBwYXRoX2lzX2J5dGVzID0gVHJ1ZQoKICAgICAgICBiX3BhdGggPSBvcy5wYXRoLnJlYWxwYXRoKHRvX2J5dGVzKG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnMocGF0aCkpLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKSkKICAgICAgICB3aGlsZSBub3Qgb3MucGF0aC5pc21vdW50KGJfcGF0aCk6CiAgICAgICAgICAgIGJfcGF0aCA9IG9zLnBhdGguZGlybmFtZShiX3BhdGgpCgogICAgICAgIGlmIHBhdGhfaXNfYnl0ZXM6CiAgICAgICAgICAgIHJldHVybiBiX3BhdGgKCiAgICAgICAgcmV0dXJuIHRvX3RleHQoYl9wYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQoKICAgIGRlZiBpc19zcGVjaWFsX3NlbGludXhfcGF0aChzZWxmLCBwYXRoKToKICAgICAgICAiIiIKICAgICAgICBSZXR1cm5zIGEgdHVwbGUgY29udGFpbmluZyAoVHJ1ZSwgc2VsaW51eF9jb250ZXh0KSBpZiB0aGUgZ2l2ZW4gcGF0aCBpcyBvbiBhCiAgICAgICAgTkZTIG9yIG90aGVyICdzcGVjaWFsJyBmcyAgbW91bnQgcG9pbnQsIG90aGVyd2lzZSB0aGUgcmV0dXJuIHdpbGwgYmUgKEZhbHNlLCBOb25lKS4KICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGYgPSBvcGVuKCcvcHJvYy9tb3VudHMnLCAncicpCiAgICAgICAgICAgIG1vdW50X2RhdGEgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgICAgIGYuY2xvc2UoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuIChGYWxzZSwgTm9uZSkKICAgICAgICBwYXRoX21vdW50X3BvaW50ID0gc2VsZi5maW5kX21vdW50X3BvaW50KHBhdGgpCiAgICAgICAgZm9yIGxpbmUgaW4gbW91bnRfZGF0YToKICAgICAgICAgICAgKGRldmljZSwgbW91bnRfcG9pbnQsIGZzdHlwZSwgb3B0aW9ucywgcmVzdCkgPSBsaW5lLnNwbGl0KCcgJywgNCkKCiAgICAgICAgICAgIGlmIHBhdGhfbW91bnRfcG9pbnQgPT0gbW91bnRfcG9pbnQ6CiAgICAgICAgICAgICAgICBmb3IgZnMgaW4gc2VsZi5fc2VsaW51eF9zcGVjaWFsX2ZzOgogICAgICAgICAgICAgICAgICAgIGlmIGZzIGluIGZzdHlwZToKICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lhbF9jb250ZXh0ID0gc2VsZi5zZWxpbnV4X2NvbnRleHQocGF0aF9tb3VudF9wb2ludCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChUcnVlLCBzcGVjaWFsX2NvbnRleHQpCgogICAgICAgIHJldHVybiAoRmFsc2UsIE5vbmUpCgogICAgZGVmIHNldF9kZWZhdWx0X3NlbGludXhfY29udGV4dChzZWxmLCBwYXRoLCBjaGFuZ2VkKToKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYIG9yIG5vdCBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICByZXR1cm4gY2hhbmdlZAogICAgICAgIGNvbnRleHQgPSBzZWxmLnNlbGludXhfZGVmYXVsdF9jb250ZXh0KHBhdGgpCiAgICAgICAgcmV0dXJuIHNlbGYuc2V0X2NvbnRleHRfaWZfZGlmZmVyZW50KHBhdGgsIGNvbnRleHQsIEZhbHNlKQoKICAgIGRlZiBzZXRfY29udGV4dF9pZl9kaWZmZXJlbnQoc2VsZiwgcGF0aCwgY29udGV4dCwgY2hhbmdlZCwgZGlmZj1Ob25lKToKCiAgICAgICAgaWYgbm90IEhBVkVfU0VMSU5VWCBvciBub3Qgc2VsZi5zZWxpbnV4X2VuYWJsZWQoKToKICAgICAgICAgICAgcmV0dXJuIGNoYW5nZWQKICAgICAgICBjdXJfY29udGV4dCA9IHNlbGYuc2VsaW51eF9jb250ZXh0KHBhdGgpCiAgICAgICAgbmV3X2NvbnRleHQgPSBsaXN0KGN1cl9jb250ZXh0KQogICAgICAgICMgSXRlcmF0ZSBvdmVyIHRoZSBjdXJyZW50IGNvbnRleHQgaW5zdGVhZCBvZiB0aGUKICAgICAgICAjIGFyZ3VtZW50IGNvbnRleHQsIHdoaWNoIG1heSBoYXZlIHNlbGV2ZWwuCgogICAgICAgIChpc19zcGVjaWFsX3NlLCBzcF9jb250ZXh0KSA9IHNlbGYuaXNfc3BlY2lhbF9zZWxpbnV4X3BhdGgocGF0aCkKICAgICAgICBpZiBpc19zcGVjaWFsX3NlOgogICAgICAgICAgICBuZXdfY29udGV4dCA9IHNwX2NvbnRleHQKICAgICAgICBlbHNlOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oY3VyX2NvbnRleHQpKToKICAgICAgICAgICAgICAgIGlmIGxlbihjb250ZXh0KSA+IGk6CiAgICAgICAgICAgICAgICAgICAgaWYgY29udGV4dFtpXSBpcyBub3QgTm9uZSBhbmQgY29udGV4dFtpXSAhPSBjdXJfY29udGV4dFtpXToKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2NvbnRleHRbaV0gPSBjb250ZXh0W2ldCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjb250ZXh0W2ldIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld19jb250ZXh0W2ldID0gY3VyX2NvbnRleHRbaV0KCiAgICAgICAgaWYgY3VyX2NvbnRleHQgIT0gbmV3X2NvbnRleHQ6CiAgICAgICAgICAgIGlmIGRpZmYgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBpZiAnYmVmb3JlJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXSA9IHt9CiAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXVsnc2Vjb250ZXh0J10gPSBjdXJfY29udGV4dAogICAgICAgICAgICAgICAgaWYgJ2FmdGVyJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydhZnRlciddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ11bJ3NlY29udGV4dCddID0gbmV3X2NvbnRleHQKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIHNlbGYuY2hlY2tfbW9kZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgcmMgPSBzZWxpbnV4LmxzZXRmaWxlY29uKHRvX25hdGl2ZShwYXRoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIoJzonLmpvaW4obmV3X2NvbnRleHQpKSkKICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsIG1zZz0naW52YWxpZCBzZWxpbnV4IGNvbnRleHQ6ICVzJyAlIHN0cihlKSwgbmV3X2NvbnRleHQ9bmV3X2NvbnRleHQsIGN1cl9jb250ZXh0PWN1cl9jb250ZXh0LCBpbnB1dF93YXM9Y29udGV4dCkKICAgICAgICAgICAgaWYgcmMgIT0gMDoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdzZXQgc2VsaW51eCBjb250ZXh0IGZhaWxlZCcpCiAgICAgICAgICAgIGNoYW5nZWQgPSBUcnVlCiAgICAgICAgcmV0dXJuIGNoYW5nZWQKCiAgICBkZWYgc2V0X293bmVyX2lmX2RpZmZlcmVudChzZWxmLCBwYXRoLCBvd25lciwgY2hhbmdlZCwgZGlmZj1Ob25lLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIGV4cGFuZDoKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhiX3BhdGgpKQogICAgICAgIHBhdGggPSB0b190ZXh0KGJfcGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIG93bmVyIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkCiAgICAgICAgb3JpZ191aWQsIG9yaWdfZ2lkID0gc2VsZi51c2VyX2FuZF9ncm91cChwYXRoLCBleHBhbmQpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1aWQgPSBpbnQob3duZXIpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVpZCA9IHB3ZC5nZXRwd25hbShvd25lcikucHdfdWlkCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdjaG93biBmYWlsZWQ6IGZhaWxlZCB0byBsb29rIHVwIHVzZXIgJXMnICUgb3duZXIpCiAgICAgICAgaWYgb3JpZ191aWQgIT0gdWlkOgoKICAgICAgICAgICAgaWYgZGlmZiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmICdiZWZvcmUnIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddWydvd25lciddID0gb3JpZ191aWQKICAgICAgICAgICAgICAgIGlmICdhZnRlcicgbm90IGluIGRpZmY6CiAgICAgICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXSA9IHt9CiAgICAgICAgICAgICAgICBkaWZmWydhZnRlciddWydvd25lciddID0gdWlkCgogICAgICAgICAgICBpZiBzZWxmLmNoZWNrX21vZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5sY2hvd24oYl9wYXRoLCB1aWQsIC0xKQogICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdjaG93biBmYWlsZWQnKQogICAgICAgICAgICBjaGFuZ2VkID0gVHJ1ZQogICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgZGVmIHNldF9ncm91cF9pZl9kaWZmZXJlbnQoc2VsZiwgcGF0aCwgZ3JvdXAsIGNoYW5nZWQsIGRpZmY9Tm9uZSwgZXhwYW5kPVRydWUpOgogICAgICAgIGJfcGF0aCA9IHRvX2J5dGVzKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fc3RyaWN0JykKICAgICAgICBpZiBleHBhbmQ6CiAgICAgICAgICAgIGJfcGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnMoYl9wYXRoKSkKICAgICAgICBwYXRoID0gdG9fdGV4dChiX3BhdGgsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fc3RyaWN0JykKICAgICAgICBpZiBncm91cCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gY2hhbmdlZAogICAgICAgIG9yaWdfdWlkLCBvcmlnX2dpZCA9IHNlbGYudXNlcl9hbmRfZ3JvdXAoYl9wYXRoLCBleHBhbmQpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBnaWQgPSBpbnQoZ3JvdXApCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdpZCA9IGdycC5nZXRncm5hbShncm91cCkuZ3JfZ2lkCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdjaGdycCBmYWlsZWQ6IGZhaWxlZCB0byBsb29rIHVwIGdyb3VwICVzJyAlIGdyb3VwKQogICAgICAgIGlmIG9yaWdfZ2lkICE9IGdpZDoKCiAgICAgICAgICAgIGlmIGRpZmYgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBpZiAnYmVmb3JlJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXSA9IHt9CiAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXVsnZ3JvdXAnXSA9IG9yaWdfZ2lkCiAgICAgICAgICAgICAgICBpZiAnYWZ0ZXInIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ10gPSB7fQogICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXVsnZ3JvdXAnXSA9IGdpZAoKICAgICAgICAgICAgaWYgc2VsZi5jaGVja19tb2RlOgogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MubGNob3duKGJfcGF0aCwgLTEsIGdpZCkKICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsIG1zZz0nY2hncnAgZmFpbGVkJykKICAgICAgICAgICAgY2hhbmdlZCA9IFRydWUKICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgIGRlZiBzZXRfbW9kZV9pZl9kaWZmZXJlbnQoc2VsZiwgcGF0aCwgbW9kZSwgY2hhbmdlZCwgZGlmZj1Ob25lLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIGV4cGFuZDoKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhiX3BhdGgpKQogICAgICAgIHBhdGggPSB0b190ZXh0KGJfcGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIHBhdGhfc3RhdCA9IG9zLmxzdGF0KGJfcGF0aCkKCiAgICAgICAgaWYgbW9kZSBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShtb2RlLCBpbnQpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBtb2RlID0gaW50KG1vZGUsIDgpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbW9kZSA9IHNlbGYuX3N5bWJvbGljX21vZGVfdG9fb2N0YWwocGF0aF9zdGF0LCBtb2RlKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZz0ibW9kZSBtdXN0IGJlIGluIG9jdGFsIG9yIHN5bWJvbGljIGZvcm0iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbHM9c3RyKGUpKQoKICAgICAgICAgICAgICAgIGlmIG1vZGUgIT0gc3RhdC5TX0lNT0RFKG1vZGUpOgogICAgICAgICAgICAgICAgICAgICMgcHJldmVudCBtb2RlIGZyb20gaGF2aW5nIGV4dHJhIGluZm8gb3JiZWluZyBpbnZhbGlkIGxvbmcgbnVtYmVyCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9IkludmFsaWQgbW9kZSBzdXBwbGllZCwgb25seSBwZXJtaXNzaW9uIGluZm8gaXMgYWxsb3dlZCIsIGRldGFpbHM9bW9kZSkKCiAgICAgICAgcHJldl9tb2RlID0gc3RhdC5TX0lNT0RFKHBhdGhfc3RhdC5zdF9tb2RlKQoKICAgICAgICBpZiBwcmV2X21vZGUgIT0gbW9kZToKCiAgICAgICAgICAgIGlmIGRpZmYgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBpZiAnYmVmb3JlJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXSA9IHt9CiAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXVsnbW9kZSddID0gJzAlMDNvJyAlIHByZXZfbW9kZQogICAgICAgICAgICAgICAgaWYgJ2FmdGVyJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydhZnRlciddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ11bJ21vZGUnXSA9ICcwJTAzbycgJSBtb2RlCgogICAgICAgICAgICBpZiBzZWxmLmNoZWNrX21vZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAjIEZJWE1FOiBjb21wYXJpc29uIGFnYWluc3Qgc3RyaW5nIGFib3ZlIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBleGVjdXRlZAogICAgICAgICAgICAjIGV2ZXJ5IHRpbWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgaGFzYXR0cihvcywgJ2xjaG1vZCcpOgogICAgICAgICAgICAgICAgICAgIG9zLmxjaG1vZChiX3BhdGgsIG1vZGUpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzbGluayhiX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBvcy5jaG1vZChiX3BhdGgsIG1vZGUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgIyBBdHRlbXB0IHRvIHNldCB0aGUgcGVybXMgb2YgdGhlIHN5bWxpbmsgYnV0IGJlCiAgICAgICAgICAgICAgICAgICAgICAgICMgY2FyZWZ1bCBub3QgdG8gY2hhbmdlIHRoZSBwZXJtcyBvZiB0aGUgdW5kZXJseWluZwogICAgICAgICAgICAgICAgICAgICAgICAjIGZpbGUgd2hpbGUgdHJ5aW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVybHlpbmdfc3RhdCA9IG9zLnN0YXQoYl9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICBvcy5jaG1vZChiX3BhdGgsIG1vZGUpCiAgICAgICAgICAgICAgICAgICAgICAgIG5ld191bmRlcmx5aW5nX3N0YXQgPSBvcy5zdGF0KGJfcGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdW5kZXJseWluZ19zdGF0LnN0X21vZGUgIT0gbmV3X3VuZGVybHlpbmdfc3RhdC5zdF9tb2RlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MuY2htb2QoYl9wYXRoLCBzdGF0LlNfSU1PREUodW5kZXJseWluZ19zdGF0LnN0X21vZGUpKQogICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNsaW5rKGJfcGF0aCkgYW5kIGUuZXJybm8gPT0gZXJybm8uRVBFUk06ICAjIENhbid0IHNldCBtb2RlIG9uIHN5bWJvbGljIGxpbmtzCiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgZWxpZiBlLmVycm5vIGluIChlcnJuby5FTk9FTlQsIGVycm5vLkVMT09QKTogIyBDYW4ndCBzZXQgbW9kZSBvbiBicm9rZW4gc3ltYm9saWMgbGlua3MKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJhaXNlIGUKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdjaG1vZCBmYWlsZWQnLCBkZXRhaWxzPXN0cihlKSkKCiAgICAgICAgICAgIHBhdGhfc3RhdCA9IG9zLmxzdGF0KGJfcGF0aCkKICAgICAgICAgICAgbmV3X21vZGUgPSBzdGF0LlNfSU1PREUocGF0aF9zdGF0LnN0X21vZGUpCgogICAgICAgICAgICBpZiBuZXdfbW9kZSAhPSBwcmV2X21vZGU6CiAgICAgICAgICAgICAgICBjaGFuZ2VkID0gVHJ1ZQogICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgZGVmIHNldF9hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudChzZWxmLCBwYXRoLCBhdHRyaWJ1dGVzLCBjaGFuZ2VkLCBkaWZmPU5vbmUsIGV4cGFuZD1UcnVlKToKCiAgICAgICAgaWYgYXR0cmlidXRlcyBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgICAgICBiX3BhdGggPSB0b19ieXRlcyhwYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCiAgICAgICAgaWYgZXhwYW5kOgogICAgICAgICAgICBiX3BhdGggPSBvcy5wYXRoLmV4cGFuZHVzZXIob3MucGF0aC5leHBhbmR2YXJzKGJfcGF0aCkpCiAgICAgICAgcGF0aCA9IHRvX3RleHQoYl9wYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCgogICAgICAgIGV4aXN0aW5nID0gc2VsZi5nZXRfZmlsZV9hdHRyaWJ1dGVzKGJfcGF0aCkKCiAgICAgICAgaWYgZXhpc3RpbmcuZ2V0KCdhdHRyX2ZsYWdzJywnJykgIT0gYXR0cmlidXRlczoKICAgICAgICAgICAgYXR0cmNtZCA9IHNlbGYuZ2V0X2Jpbl9wYXRoKCdjaGF0dHInKQogICAgICAgICAgICBpZiBhdHRyY21kOgogICAgICAgICAgICAgICAgYXR0cmNtZCA9IFthdHRyY21kLCAnPSVzJyAlIGF0dHJpYnV0ZXMsIGJfcGF0aF0KICAgICAgICAgICAgICAgIGNoYW5nZWQgPSBUcnVlCgogICAgICAgICAgICAgICAgaWYgZGlmZiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBpZiAnYmVmb3JlJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZlsnYmVmb3JlJ10gPSB7fQogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddWydhdHRyaWJ1dGVzJ10gPSBleGlzdGluZy5nZXQoJ2F0dHJfZmxhZ3MnKQogICAgICAgICAgICAgICAgICAgIGlmICdhZnRlcicgbm90IGluIGRpZmY6CiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ10gPSB7fQogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ11bJ2F0dHJpYnV0ZXMnXSA9IGF0dHJpYnV0ZXMKCiAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi5jaGVja19tb2RlOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgcmMsIG91dCwgZXJyID0gc2VsZi5ydW5fY29tbWFuZChhdHRyY21kKQogICAgICAgICAgICAgICAgICAgICAgICBpZiByYyAhPSAwIG9yIGVycjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiRXJyb3Igd2hpbGUgc2V0dGluZyBhdHRyaWJ1dGVzOiAlcyIgJSAob3V0ICsgZXJyKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J2NoYXR0ciBmYWlsZWQnLCBkZXRhaWxzPXN0cihlKSkKICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgIGRlZiBnZXRfZmlsZV9hdHRyaWJ1dGVzKHNlbGYsIHBhdGgpOgogICAgICAgIG91dHB1dCA9IHt9CiAgICAgICAgYXR0cmNtZCA9IHNlbGYuZ2V0X2Jpbl9wYXRoKCdsc2F0dHInLCBGYWxzZSkKICAgICAgICBpZiBhdHRyY21kOgogICAgICAgICAgICBhdHRyY21kID0gW2F0dHJjbWQsICctdmQnLCBwYXRoXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByYywgb3V0LCBlcnIgPSBzZWxmLnJ1bl9jb21tYW5kKGF0dHJjbWQpCiAgICAgICAgICAgICAgICBpZiByYyA9PSAwOgogICAgICAgICAgICAgICAgICAgIHJlcyA9IG91dC5zcGxpdCgnICcpWzA6Ml0KICAgICAgICAgICAgICAgICAgICBvdXRwdXRbJ2F0dHJfZmxhZ3MnXSA9ICByZXNbMV0ucmVwbGFjZSgnLScsJycpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbJ3ZlcnNpb24nXSA9IHJlc1swXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0WydhdHRyaWJ1dGVzJ10gPSBmb3JtYXRfYXR0cmlidXRlcyhvdXRwdXRbJ2F0dHJfZmxhZ3MnXSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHJldHVybiBvdXRwdXQKCgogICAgZGVmIF9zeW1ib2xpY19tb2RlX3RvX29jdGFsKHNlbGYsIHBhdGhfc3RhdCwgc3ltYm9saWNfbW9kZSk6CiAgICAgICAgbmV3X21vZGUgPSBzdGF0LlNfSU1PREUocGF0aF9zdGF0LnN0X21vZGUpCgogICAgICAgIG1vZGVfcmUgPSByZS5jb21waWxlKHInXig/UDx1c2Vycz5bdWdvYV0rKSg/UDxvcGVyYXRvcj5bLSs9XSkoP1A8cGVybXM+W3J3eFhzdC1dKnxbdWdvXSkkJykKICAgICAgICBmb3IgbW9kZSBpbiBzeW1ib2xpY19tb2RlLnNwbGl0KCcsJyk6CiAgICAgICAgICAgIG1hdGNoID0gbW9kZV9yZS5tYXRjaChtb2RlKQogICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgIHVzZXJzID0gbWF0Y2guZ3JvdXAoJ3VzZXJzJykKICAgICAgICAgICAgICAgIG9wZXJhdG9yID0gbWF0Y2guZ3JvdXAoJ29wZXJhdG9yJykKICAgICAgICAgICAgICAgIHBlcm1zID0gbWF0Y2guZ3JvdXAoJ3Blcm1zJykKCiAgICAgICAgICAgICAgICBpZiB1c2VycyA9PSAnYSc6CiAgICAgICAgICAgICAgICAgICAgdXNlcnMgPSAndWdvJwoKICAgICAgICAgICAgICAgIGZvciB1c2VyIGluIHVzZXJzOgogICAgICAgICAgICAgICAgICAgIG1vZGVfdG9fYXBwbHkgPSBzZWxmLl9nZXRfb2N0YWxfbW9kZV9mcm9tX3N5bWJvbGljX3Blcm1zKHBhdGhfc3RhdCwgdXNlciwgcGVybXMpCiAgICAgICAgICAgICAgICAgICAgbmV3X21vZGUgPSBzZWxmLl9hcHBseV9vcGVyYXRpb25fdG9fbW9kZSh1c2VyLCBvcGVyYXRvciwgbW9kZV90b19hcHBseSwgbmV3X21vZGUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJiYWQgc3ltYm9saWMgcGVybWlzc2lvbiBmb3IgbW9kZTogJXMiICUgbW9kZSkKICAgICAgICByZXR1cm4gbmV3X21vZGUKCiAgICBkZWYgX2FwcGx5X29wZXJhdGlvbl90b19tb2RlKHNlbGYsIHVzZXIsIG9wZXJhdG9yLCBtb2RlX3RvX2FwcGx5LCBjdXJyZW50X21vZGUpOgogICAgICAgIGlmIG9wZXJhdG9yICA9PSAgJz0nOgogICAgICAgICAgICBpZiB1c2VyID09ICd1JzoKICAgICAgICAgICAgICAgIG1hc2sgPSBzdGF0LlNfSVJXWFUgfCBzdGF0LlNfSVNVSUQKICAgICAgICAgICAgZWxpZiB1c2VyID09ICdnJzoKICAgICAgICAgICAgICAgIG1hc2sgPSBzdGF0LlNfSVJXWEcgfCBzdGF0LlNfSVNHSUQKICAgICAgICAgICAgZWxpZiB1c2VyID09ICdvJzoKICAgICAgICAgICAgICAgIG1hc2sgPSBzdGF0LlNfSVJXWE8gfCBzdGF0LlNfSVNWVFgKCiAgICAgICAgICAgICMgbWFzayBvdXQgdSwgZywgb3IgbyBwZXJtaXNzaW9ucyBmcm9tIGN1cnJlbnRfbW9kZSBhbmQgYXBwbHkgbmV3IHBlcm1pc3Npb25zCiAgICAgICAgICAgIGludmVyc2VfbWFzayA9IG1hc2sgXiBQRVJNX0JJVFMKICAgICAgICAgICAgbmV3X21vZGUgPSAoY3VycmVudF9tb2RlICYgaW52ZXJzZV9tYXNrKSB8IG1vZGVfdG9fYXBwbHkKICAgICAgICBlbGlmIG9wZXJhdG9yID09ICcrJzoKICAgICAgICAgICAgbmV3X21vZGUgPSBjdXJyZW50X21vZGUgfCBtb2RlX3RvX2FwcGx5CiAgICAgICAgZWxpZiBvcGVyYXRvciA9PSAnLSc6CiAgICAgICAgICAgIG5ld19tb2RlID0gY3VycmVudF9tb2RlIC0gKGN1cnJlbnRfbW9kZSAmIG1vZGVfdG9fYXBwbHkpCiAgICAgICAgcmV0dXJuIG5ld19tb2RlCgogICAgZGVmIF9nZXRfb2N0YWxfbW9kZV9mcm9tX3N5bWJvbGljX3Blcm1zKHNlbGYsIHBhdGhfc3RhdCwgdXNlciwgcGVybXMpOgogICAgICAgIHByZXZfbW9kZSA9IHN0YXQuU19JTU9ERShwYXRoX3N0YXQuc3RfbW9kZSkKCiAgICAgICAgaXNfZGlyZWN0b3J5ID0gc3RhdC5TX0lTRElSKHBhdGhfc3RhdC5zdF9tb2RlKQogICAgICAgIGhhc194X3Blcm1pc3Npb25zID0gKHByZXZfbW9kZSAmIEVYRUNfUEVSTV9CSVRTKSA+IDAKICAgICAgICBhcHBseV9YX3Blcm1pc3Npb24gPSBpc19kaXJlY3Rvcnkgb3IgaGFzX3hfcGVybWlzc2lvbnMKCiAgICAgICAgIyBQZXJtaXNzaW9uIGJpdHMgY29uc3RhbnRzIGRvY3VtZW50ZWQgYXQ6CiAgICAgICAgIyBodHRwOi8vZG9jcy5weXRob24ub3JnLzIvbGlicmFyeS9zdGF0Lmh0bWwjc3RhdC5TX0lTVUlECiAgICAgICAgaWYgYXBwbHlfWF9wZXJtaXNzaW9uOgogICAgICAgICAgICBYX3Blcm1zID0gewogICAgICAgICAgICAgICAgJ3UnOiB7J1gnOiBzdGF0LlNfSVhVU1J9LAogICAgICAgICAgICAgICAgJ2cnOiB7J1gnOiBzdGF0LlNfSVhHUlB9LAogICAgICAgICAgICAgICAgJ28nOiB7J1gnOiBzdGF0LlNfSVhPVEh9CiAgICAgICAgICAgIH0KICAgICAgICBlbHNlOgogICAgICAgICAgICBYX3Blcm1zID0gewogICAgICAgICAgICAgICAgJ3UnOiB7J1gnOiAwfSwKICAgICAgICAgICAgICAgICdnJzogeydYJzogMH0sCiAgICAgICAgICAgICAgICAnbyc6IHsnWCc6IDB9CiAgICAgICAgICAgIH0KCiAgICAgICAgdXNlcl9wZXJtc190b19tb2RlcyA9IHsKICAgICAgICAgICAgJ3UnOiB7CiAgICAgICAgICAgICAgICAncic6IHN0YXQuU19JUlVTUiwKICAgICAgICAgICAgICAgICd3Jzogc3RhdC5TX0lXVVNSLAogICAgICAgICAgICAgICAgJ3gnOiBzdGF0LlNfSVhVU1IsCiAgICAgICAgICAgICAgICAncyc6IHN0YXQuU19JU1VJRCwKICAgICAgICAgICAgICAgICd0JzogMCwKICAgICAgICAgICAgICAgICd1JzogcHJldl9tb2RlICYgc3RhdC5TX0lSV1hVLAogICAgICAgICAgICAgICAgJ2cnOiAocHJldl9tb2RlICYgc3RhdC5TX0lSV1hHKSA8PCAzLAogICAgICAgICAgICAgICAgJ28nOiAocHJldl9tb2RlICYgc3RhdC5TX0lSV1hPKSA8PCA2IH0sCiAgICAgICAgICAgICdnJzogewogICAgICAgICAgICAgICAgJ3InOiBzdGF0LlNfSVJHUlAsCiAgICAgICAgICAgICAgICAndyc6IHN0YXQuU19JV0dSUCwKICAgICAgICAgICAgICAgICd4Jzogc3RhdC5TX0lYR1JQLAogICAgICAgICAgICAgICAgJ3MnOiBzdGF0LlNfSVNHSUQsCiAgICAgICAgICAgICAgICAndCc6IDAsCiAgICAgICAgICAgICAgICAndSc6IChwcmV2X21vZGUgJiBzdGF0LlNfSVJXWFUpID4+IDMsCiAgICAgICAgICAgICAgICAnZyc6IHByZXZfbW9kZSAmIHN0YXQuU19JUldYRywKICAgICAgICAgICAgICAgICdvJzogKHByZXZfbW9kZSAmIHN0YXQuU19JUldYTykgPDwgMyB9LAogICAgICAgICAgICAnbyc6IHsKICAgICAgICAgICAgICAgICdyJzogc3RhdC5TX0lST1RILAogICAgICAgICAgICAgICAgJ3cnOiBzdGF0LlNfSVdPVEgsCiAgICAgICAgICAgICAgICAneCc6IHN0YXQuU19JWE9USCwKICAgICAgICAgICAgICAgICdzJzogMCwKICAgICAgICAgICAgICAgICd0Jzogc3RhdC5TX0lTVlRYLAogICAgICAgICAgICAgICAgJ3UnOiAocHJldl9tb2RlICYgc3RhdC5TX0lSV1hVKSA+PiA2LAogICAgICAgICAgICAgICAgJ2cnOiAocHJldl9tb2RlICYgc3RhdC5TX0lSV1hHKSA+PiAzLAogICAgICAgICAgICAgICAgJ28nOiBwcmV2X21vZGUgJiBzdGF0LlNfSVJXWE8gfQogICAgICAgIH0KCiAgICAgICAgIyBJbnNlcnQgWF9wZXJtcyBpbnRvIHVzZXJfcGVybXNfdG9fbW9kZXMKICAgICAgICBmb3Iga2V5LCB2YWx1ZSBpbiBYX3Blcm1zLml0ZW1zKCk6CiAgICAgICAgICAgIHVzZXJfcGVybXNfdG9fbW9kZXNba2V5XS51cGRhdGUodmFsdWUpCgogICAgICAgIG9yX3JlZHVjZSA9IGxhbWJkYSBtb2RlLCBwZXJtOiBtb2RlIHwgdXNlcl9wZXJtc190b19tb2Rlc1t1c2VyXVtwZXJtXQogICAgICAgIHJldHVybiByZWR1Y2Uob3JfcmVkdWNlLCBwZXJtcywgMCkKCiAgICBkZWYgc2V0X2ZzX2F0dHJpYnV0ZXNfaWZfZGlmZmVyZW50KHNlbGYsIGZpbGVfYXJncywgY2hhbmdlZCwgZGlmZj1Ob25lLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgIyBzZXQgbW9kZXMgb3duZXJzIGFuZCBjb250ZXh0IGFzIG5lZWRlZAogICAgICAgIGNoYW5nZWQgPSBzZWxmLnNldF9jb250ZXh0X2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgZmlsZV9hcmdzWydwYXRoJ10sIGZpbGVfYXJnc1snc2Vjb250ZXh0J10sIGNoYW5nZWQsIGRpZmYKICAgICAgICApCiAgICAgICAgY2hhbmdlZCA9IHNlbGYuc2V0X293bmVyX2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgZmlsZV9hcmdzWydwYXRoJ10sIGZpbGVfYXJnc1snb3duZXInXSwgY2hhbmdlZCwgZGlmZiwgZXhwYW5kCiAgICAgICAgKQogICAgICAgIGNoYW5nZWQgPSBzZWxmLnNldF9ncm91cF9pZl9kaWZmZXJlbnQoCiAgICAgICAgICAgIGZpbGVfYXJnc1sncGF0aCddLCBmaWxlX2FyZ3NbJ2dyb3VwJ10sIGNoYW5nZWQsIGRpZmYsIGV4cGFuZAogICAgICAgICkKICAgICAgICBjaGFuZ2VkID0gc2VsZi5zZXRfbW9kZV9pZl9kaWZmZXJlbnQoCiAgICAgICAgICAgIGZpbGVfYXJnc1sncGF0aCddLCBmaWxlX2FyZ3NbJ21vZGUnXSwgY2hhbmdlZCwgZGlmZiwgZXhwYW5kCiAgICAgICAgKQogICAgICAgIGNoYW5nZWQgPSBzZWxmLnNldF9hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgZmlsZV9hcmdzWydwYXRoJ10sIGZpbGVfYXJnc1snYXR0cmlidXRlcyddLCBjaGFuZ2VkLCBkaWZmLCBleHBhbmQKICAgICAgICApCiAgICAgICAgcmV0dXJuIGNoYW5nZWQKCiAgICBkZWYgc2V0X2RpcmVjdG9yeV9hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudChzZWxmLCBmaWxlX2FyZ3MsIGNoYW5nZWQsIGRpZmY9Tm9uZSwgZXhwYW5kPVRydWUpOgogICAgICAgIHJldHVybiBzZWxmLnNldF9mc19hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudChmaWxlX2FyZ3MsIGNoYW5nZWQsIGRpZmYsIGV4cGFuZCkKCiAgICBkZWYgc2V0X2ZpbGVfYXR0cmlidXRlc19pZl9kaWZmZXJlbnQoc2VsZiwgZmlsZV9hcmdzLCBjaGFuZ2VkLCBkaWZmPU5vbmUsIGV4cGFuZD1UcnVlKToKICAgICAgICByZXR1cm4gc2VsZi5zZXRfZnNfYXR0cmlidXRlc19pZl9kaWZmZXJlbnQoZmlsZV9hcmdzLCBjaGFuZ2VkLCBkaWZmLCBleHBhbmQpCgogICAgZGVmIGFkZF9wYXRoX2luZm8oc2VsZiwga3dhcmdzKToKICAgICAgICAnJycKICAgICAgICBmb3IgcmVzdWx0cyB0aGF0IGFyZSBmaWxlcywgc3VwcGxlbWVudCB0aGUgaW5mbyBhYm91dCB0aGUgZmlsZQogICAgICAgIGluIHRoZSByZXR1cm4gcGF0aCB3aXRoIHN0YXRzIGFib3V0IHRoZSBmaWxlIHBhdGguCiAgICAgICAgJycnCgogICAgICAgIHBhdGggPSBrd2FyZ3MuZ2V0KCdwYXRoJywga3dhcmdzLmdldCgnZGVzdCcsIE5vbmUpKQogICAgICAgIGlmIHBhdGggaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIGt3YXJncwogICAgICAgIGJfcGF0aCA9IHRvX2J5dGVzKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoYl9wYXRoKToKICAgICAgICAgICAgKHVpZCwgZ2lkKSA9IHNlbGYudXNlcl9hbmRfZ3JvdXAocGF0aCkKICAgICAgICAgICAga3dhcmdzWyd1aWQnXSA9IHVpZAogICAgICAgICAgICBrd2FyZ3NbJ2dpZCddID0gZ2lkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVzZXIgPSBwd2QuZ2V0cHd1aWQodWlkKVswXQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICB1c2VyID0gc3RyKHVpZCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ3JvdXAgPSBncnAuZ2V0Z3JnaWQoZ2lkKVswXQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICBncm91cCA9IHN0cihnaWQpCiAgICAgICAgICAgIGt3YXJnc1snb3duZXInXSA9IHVzZXIKICAgICAgICAgICAga3dhcmdzWydncm91cCddID0gZ3JvdXAKICAgICAgICAgICAgc3QgPSBvcy5sc3RhdChiX3BhdGgpCiAgICAgICAgICAgIGt3YXJnc1snbW9kZSddID0gJzAlMDNvJyAlIHN0YXQuU19JTU9ERShzdFtzdGF0LlNUX01PREVdKQogICAgICAgICAgICAjIHNlY29udGV4dCBub3QgeWV0IHN1cHBvcnRlZAogICAgICAgICAgICBpZiBvcy5wYXRoLmlzbGluayhiX3BhdGgpOgogICAgICAgICAgICAgICAga3dhcmdzWydzdGF0ZSddID0gJ2xpbmsnCiAgICAgICAgICAgIGVsaWYgb3MucGF0aC5pc2RpcihiX3BhdGgpOgogICAgICAgICAgICAgICAga3dhcmdzWydzdGF0ZSddID0gJ2RpcmVjdG9yeScKICAgICAgICAgICAgZWxpZiBvcy5zdGF0KGJfcGF0aCkuc3RfbmxpbmsgPiAxOgogICAgICAgICAgICAgICAga3dhcmdzWydzdGF0ZSddID0gJ2hhcmQnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBrd2FyZ3NbJ3N0YXRlJ10gPSAnZmlsZScKICAgICAgICAgICAgaWYgSEFWRV9TRUxJTlVYIGFuZCBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICAgICAga3dhcmdzWydzZWNvbnRleHQnXSA9ICc6Jy5qb2luKHNlbGYuc2VsaW51eF9jb250ZXh0KHBhdGgpKQogICAgICAgICAgICBrd2FyZ3NbJ3NpemUnXSA9IHN0W3N0YXQuU1RfU0laRV0KICAgICAgICBlbHNlOgogICAgICAgICAgICBrd2FyZ3NbJ3N0YXRlJ10gPSAnYWJzZW50JwogICAgICAgIHJldHVybiBrd2FyZ3MKCiAgICBkZWYgX2NoZWNrX2xvY2FsZShzZWxmKToKICAgICAgICAnJycKICAgICAgICBVc2VzIHRoZSBsb2NhbGUgbW9kdWxlIHRvIHRlc3QgdGhlIGN1cnJlbnRseSBzZXQgbG9jYWxlCiAgICAgICAgKHBlciB0aGUgTEFORyBhbmQgTENfQ1RZUEUgZW52aXJvbm1lbnQgc2V0dGluZ3MpCiAgICAgICAgJycnCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHNldHRpbmcgdGhlIGxvY2FsZSB0byAnJyB1c2VzIHRoZSBkZWZhdWx0IGxvY2FsZQogICAgICAgICAgICAjIGFzIGl0IHdvdWxkIGJlIHJldHVybmVkIGJ5IGxvY2FsZS5nZXRkZWZhdWx0bG9jYWxlKCkKICAgICAgICAgICAgbG9jYWxlLnNldGxvY2FsZShsb2NhbGUuTENfQUxMLCAnJykKICAgICAgICBleGNlcHQgbG9jYWxlLkVycm9yOgogICAgICAgICAgICAjIGZhbGxiYWNrIHRvIHRoZSAnQycgbG9jYWxlLCB3aGljaCBtYXkgY2F1c2UgdW5pY29kZQogICAgICAgICAgICAjIGlzc3VlcyBidXQgaXMgcHJlZmVyYWJsZSB0byBzaW1wbHkgZmFpbGluZyBiZWNhdXNlCiAgICAgICAgICAgICMgb2YgYW4gdW5rbm93biBsb2NhbGUKICAgICAgICAgICAgbG9jYWxlLnNldGxvY2FsZShsb2NhbGUuTENfQUxMLCAnQycpCiAgICAgICAgICAgIG9zLmVudmlyb25bJ0xBTkcnXSA9ICdDJwogICAgICAgICAgICBvcy5lbnZpcm9uWydMQ19BTEwnXSA9ICdDJwogICAgICAgICAgICBvcy5lbnZpcm9uWydMQ19NRVNTQUdFUyddID0gJ0MnCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9IkFuIHVua25vd24gZXJyb3Igd2FzIGVuY291bnRlcmVkIHdoaWxlIGF0dGVtcHRpbmcgdG8gdmFsaWRhdGUgdGhlIGxvY2FsZTogJXMiICUgZSkKCiAgICBkZWYgX2hhbmRsZV9hbGlhc2VzKHNlbGYsIHNwZWM9Tm9uZSk6CiAgICAgICAgIyB0aGlzIHVzZXMgZXhjZXB0aW9ucyBhcyBpdCBoYXBwZW5zIGJlZm9yZSB3ZSBjYW4gc2FmZWx5IGNhbGwgZmFpbF9qc29uCiAgICAgICAgYWxpYXNlc19yZXN1bHRzID0ge30gI2FsaWFzOmNhbm9uCiAgICAgICAgaWYgc3BlYyBpcyBOb25lOgogICAgICAgICAgICBzcGVjID0gc2VsZi5hcmd1bWVudF9zcGVjCiAgICAgICAgZm9yIChrLHYpIGluIHNwZWMuaXRlbXMoKToKICAgICAgICAgICAgc2VsZi5fbGVnYWxfaW5wdXRzLmFwcGVuZChrKQogICAgICAgICAgICBhbGlhc2VzID0gdi5nZXQoJ2FsaWFzZXMnLCBOb25lKQogICAgICAgICAgICBkZWZhdWx0ID0gdi5nZXQoJ2RlZmF1bHQnLCBOb25lKQogICAgICAgICAgICByZXF1aXJlZCA9IHYuZ2V0KCdyZXF1aXJlZCcsIEZhbHNlKQogICAgICAgICAgICBpZiBkZWZhdWx0IGlzIG5vdCBOb25lIGFuZCByZXF1aXJlZDoKICAgICAgICAgICAgICAgICMgbm90IGFsaWFzIHNwZWNpZmljIGJ1dCB0aGlzIGlzIGEgZ29vZCBwbGFjZSB0byBjaGVjayB0aGlzCiAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oImludGVybmFsIGVycm9yOiByZXF1aXJlZCBhbmQgZGVmYXVsdCBhcmUgbXV0dWFsbHkgZXhjbHVzaXZlIGZvciAlcyIgJSBrKQogICAgICAgICAgICBpZiBhbGlhc2VzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShhbGlhc2VzLCBTRVFVRU5DRVRZUEUpIG9yIGlzaW5zdGFuY2UoYWxpYXNlcywgKGJpbmFyeV90eXBlLCB0ZXh0X3R5cGUpKToKICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbignaW50ZXJuYWwgZXJyb3I6IGFsaWFzZXMgbXVzdCBiZSBhIGxpc3Qgb3IgdHVwbGUnKQogICAgICAgICAgICBmb3IgYWxpYXMgaW4gYWxpYXNlczoKICAgICAgICAgICAgICAgIHNlbGYuX2xlZ2FsX2lucHV0cy5hcHBlbmQoYWxpYXMpCiAgICAgICAgICAgICAgICBhbGlhc2VzX3Jlc3VsdHNbYWxpYXNdID0gawogICAgICAgICAgICAgICAgaWYgYWxpYXMgaW4gc2VsZi5wYXJhbXM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXJhbXNba10gPSBzZWxmLnBhcmFtc1thbGlhc10KCiAgICAgICAgcmV0dXJuIGFsaWFzZXNfcmVzdWx0cwoKICAgIGRlZiBfY2hlY2tfYXJndW1lbnRzKHNlbGYsIGNoZWNrX2ludmFsaWRfYXJndW1lbnRzKToKICAgICAgICBzZWxmLl9zeXNsb2dfZmFjaWxpdHkgPSAnTE9HX1VTRVInCiAgICAgICAgdW5zdXBwb3J0ZWRfcGFyYW1ldGVycyA9IHNldCgpCiAgICAgICAgZm9yIChrLHYpIGluIGxpc3Qoc2VsZi5wYXJhbXMuaXRlbXMoKSk6CgogICAgICAgICAgICBpZiBrID09ICdfYW5zaWJsZV9jaGVja19tb2RlJyBhbmQgdjoKICAgICAgICAgICAgICAgIHNlbGYuY2hlY2tfbW9kZSA9IFRydWUKCiAgICAgICAgICAgIGVsaWYgayA9PSAnX2Fuc2libGVfbm9fbG9nJzoKICAgICAgICAgICAgICAgIHNlbGYubm9fbG9nID0gc2VsZi5ib29sZWFuKHYpCgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX2RlYnVnJzoKICAgICAgICAgICAgICAgIHNlbGYuX2RlYnVnID0gc2VsZi5ib29sZWFuKHYpCgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX2RpZmYnOgogICAgICAgICAgICAgICAgc2VsZi5fZGlmZiA9IHNlbGYuYm9vbGVhbih2KQoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV92ZXJib3NpdHknOgogICAgICAgICAgICAgICAgc2VsZi5fdmVyYm9zaXR5ID0gdgoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV9zZWxpbnV4X3NwZWNpYWxfZnMnOgogICAgICAgICAgICAgICAgc2VsZi5fc2VsaW51eF9zcGVjaWFsX2ZzID0gdgoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV9zeXNsb2dfZmFjaWxpdHknOgogICAgICAgICAgICAgICAgc2VsZi5fc3lzbG9nX2ZhY2lsaXR5ID0gdgoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV92ZXJzaW9uJzoKICAgICAgICAgICAgICAgIHNlbGYuYW5zaWJsZV92ZXJzaW9uID0gdgoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV9tb2R1bGVfbmFtZSc6CiAgICAgICAgICAgICAgICBzZWxmLl9uYW1lID0gdgoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV9zb2NrZXQnOgogICAgICAgICAgICAgICAgc2VsZi5fc29ja2V0X3BhdGggPSB2CgogICAgICAgICAgICBlbGlmIGNoZWNrX2ludmFsaWRfYXJndW1lbnRzIGFuZCBrIG5vdCBpbiBzZWxmLl9sZWdhbF9pbnB1dHM6CiAgICAgICAgICAgICAgICB1bnN1cHBvcnRlZF9wYXJhbWV0ZXJzLmFkZChrKQoKICAgICAgICAgICAgI2NsZWFuIHVwIGludGVybmFsIHBhcmFtczoKICAgICAgICAgICAgaWYgay5zdGFydHN3aXRoKCdfYW5zaWJsZV8nKToKICAgICAgICAgICAgICAgIGRlbCBzZWxmLnBhcmFtc1trXQoKICAgICAgICBpZiB1bnN1cHBvcnRlZF9wYXJhbWV0ZXJzOgogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9IlVuc3VwcG9ydGVkIHBhcmFtZXRlcnMgZm9yICglcykgbW9kdWxlOiAlcy4gU3VwcG9ydGVkIHBhcmFtZXRlcnMgaW5jbHVkZTogJXMiICUgKHNlbGYuX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJywnLmpvaW4oc29ydGVkKGxpc3QodW5zdXBwb3J0ZWRfcGFyYW1ldGVycykpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLCcuam9pbihzb3J0ZWQoc2VsZi5hcmd1bWVudF9zcGVjLmtleXMoKSkpKSkKICAgICAgICBpZiBzZWxmLmNoZWNrX21vZGUgYW5kIG5vdCBzZWxmLnN1cHBvcnRzX2NoZWNrX21vZGU6CiAgICAgICAgICAgIHNlbGYuZXhpdF9qc29uKHNraXBwZWQ9VHJ1ZSwgbXNnPSJyZW1vdGUgbW9kdWxlICglcykgZG9lcyBub3Qgc3VwcG9ydCBjaGVjayBtb2RlIiAlIHNlbGYuX25hbWUpCgogICAgZGVmIF9jb3VudF90ZXJtcyhzZWxmLCBjaGVjayk6CiAgICAgICAgY291bnQgPSAwCiAgICAgICAgZm9yIHRlcm0gaW4gY2hlY2s6CiAgICAgICAgICAgIGlmIHRlcm0gaW4gc2VsZi5wYXJhbXM6CiAgICAgICAgICAgICAgICBjb3VudCArPSAxCiAgICAgICAgcmV0dXJuIGNvdW50CgogICAgZGVmIF9jaGVja19tdXR1YWxseV9leGNsdXNpdmUoc2VsZiwgc3BlYyk6CiAgICAgICAgaWYgc3BlYyBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBmb3IgY2hlY2sgaW4gc3BlYzoKICAgICAgICAgICAgY291bnQgPSBzZWxmLl9jb3VudF90ZXJtcyhjaGVjaykKICAgICAgICAgICAgaWYgY291bnQgPiAxOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJwYXJhbWV0ZXJzIGFyZSBtdXR1YWxseSBleGNsdXNpdmU6ICVzIiAlIChjaGVjaywpKQoKICAgIGRlZiBfY2hlY2tfcmVxdWlyZWRfb25lX29mKHNlbGYsIHNwZWMpOgogICAgICAgIGlmIHNwZWMgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZm9yIGNoZWNrIGluIHNwZWM6CiAgICAgICAgICAgIGNvdW50ID0gc2VsZi5fY291bnRfdGVybXMoY2hlY2spCiAgICAgICAgICAgIGlmIGNvdW50ID09IDA6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9Im9uZSBvZiB0aGUgZm9sbG93aW5nIGlzIHJlcXVpcmVkOiAlcyIgJSAnLCcuam9pbihjaGVjaykpCgogICAgZGVmIF9jaGVja19yZXF1aXJlZF90b2dldGhlcihzZWxmLCBzcGVjKToKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZvciBjaGVjayBpbiBzcGVjOgogICAgICAgICAgICBjb3VudHMgPSBbIHNlbGYuX2NvdW50X3Rlcm1zKFtmaWVsZF0pIGZvciBmaWVsZCBpbiBjaGVjayBdCiAgICAgICAgICAgIG5vbl96ZXJvID0gWyBjIGZvciBjIGluIGNvdW50cyBpZiBjID4gMCBdCiAgICAgICAgICAgIGlmIGxlbihub25femVybykgPiAwOgogICAgICAgICAgICAgICAgaWYgMCBpbiBjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCB0b2dldGhlcjogJXMiICUgKGNoZWNrLCkpCgogICAgZGVmIF9jaGVja19yZXF1aXJlZF9hcmd1bWVudHMoc2VsZiwgc3BlYz1Ob25lLCBwYXJhbT1Ob25lICk6CiAgICAgICAgJycnIGVuc3VyZSBhbGwgcmVxdWlyZWQgYXJndW1lbnRzIGFyZSBwcmVzZW50ICcnJwogICAgICAgIG1pc3NpbmcgPSBbXQogICAgICAgIGlmIHNwZWMgaXMgTm9uZToKICAgICAgICAgICAgc3BlYyA9IHNlbGYuYXJndW1lbnRfc3BlYwogICAgICAgIGlmIHBhcmFtIGlzIE5vbmU6CiAgICAgICAgICAgIHBhcmFtID0gc2VsZi5wYXJhbXMKICAgICAgICBmb3IgKGssdikgaW4gc3BlYy5pdGVtcygpOgogICAgICAgICAgICByZXF1aXJlZCA9IHYuZ2V0KCdyZXF1aXJlZCcsIEZhbHNlKQogICAgICAgICAgICBpZiByZXF1aXJlZCBhbmQgayBub3QgaW4gcGFyYW06CiAgICAgICAgICAgICAgICBtaXNzaW5nLmFwcGVuZChrKQogICAgICAgIGlmIGxlbihtaXNzaW5nKSA+IDA6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0ibWlzc2luZyByZXF1aXJlZCBhcmd1bWVudHM6ICVzIiAlICIsIi5qb2luKG1pc3NpbmcpKQoKICAgIGRlZiBfY2hlY2tfcmVxdWlyZWRfaWYoc2VsZiwgc3BlYyk6CiAgICAgICAgJycnIGVuc3VyZSB0aGF0IHBhcmFtZXRlcnMgd2hpY2ggY29uZGl0aW9uYWxseSByZXF1aXJlZCBhcmUgcHJlc2VudCAnJycKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZvciBzcCBpbiBzcGVjOgogICAgICAgICAgICBtaXNzaW5nID0gW10KICAgICAgICAgICAgbWF4X21pc3NpbmdfY291bnQgPSAwCiAgICAgICAgICAgIGlzX29uZV9vZiA9IEZhbHNlCiAgICAgICAgICAgIGlmIGxlbihzcCkgPT0gNDoKICAgICAgICAgICAgICAgIGtleSwgdmFsLCByZXF1aXJlbWVudHMsIGlzX29uZV9vZiA9IHNwCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBrZXksIHZhbCwgcmVxdWlyZW1lbnRzID0gc3AKCiAgICAgICAgICAgICMgaXNfb25lX29mIGlzIFRydWUgYXQgbGVhc3Qgb25lIHJlcXVpcmVtZW50IHNob3VsZCBiZQogICAgICAgICAgICAjIHByZXNlbnQsIGVsc2UgYWxsIHJlcXVpcmVtZW50cyBzaG91bGQgYmUgcHJlc2VudC4KICAgICAgICAgICAgaWYgaXNfb25lX29mOgogICAgICAgICAgICAgICAgbWF4X21pc3NpbmdfY291bnQgPSBsZW4ocmVxdWlyZW1lbnRzKQoKICAgICAgICAgICAgaWYga2V5IGluIHNlbGYucGFyYW1zIGFuZCBzZWxmLnBhcmFtc1trZXldID09IHZhbDoKICAgICAgICAgICAgICAgIGZvciBjaGVjayBpbiByZXF1aXJlbWVudHM6CiAgICAgICAgICAgICAgICAgICAgY291bnQgPSBzZWxmLl9jb3VudF90ZXJtcygoY2hlY2ssKSkKICAgICAgICAgICAgICAgICAgICBpZiBjb3VudCA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICBtaXNzaW5nLmFwcGVuZChjaGVjaykKICAgICAgICAgICAgaWYgbGVuKG1pc3NpbmcpIGFuZCBsZW4obWlzc2luZykgPj0gbWF4X21pc3NpbmdfY291bnQ6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9IiVzIGlzICVzIGJ1dCB0aGUgZm9sbG93aW5nIGFyZSBtaXNzaW5nOiAlcyIgJSAoa2V5LCB2YWwsICcsJy5qb2luKG1pc3NpbmcpKSkKCiAgICBkZWYgX2NoZWNrX2FyZ3VtZW50X3ZhbHVlcyhzZWxmLCBzcGVjPU5vbmUsIHBhcmFtPU5vbmUpOgogICAgICAgICcnJyBlbnN1cmUgYWxsIGFyZ3VtZW50cyBoYXZlIHRoZSByZXF1ZXN0ZWQgdmFsdWVzLCBhbmQgdGhlcmUgYXJlIG5vIHN0cmF5IGFyZ3VtZW50cyAnJycKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHNwZWMgPSBzZWxmLmFyZ3VtZW50X3NwZWMKICAgICAgICBpZiBwYXJhbSBpcyBOb25lOgogICAgICAgICAgICBwYXJhbSA9IHNlbGYucGFyYW1zCiAgICAgICAgZm9yIChrLHYpIGluIHNwZWMuaXRlbXMoKToKICAgICAgICAgICAgY2hvaWNlcyA9IHYuZ2V0KCdjaG9pY2VzJyxOb25lKQogICAgICAgICAgICBpZiBjaG9pY2VzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGNob2ljZXMsIFNFUVVFTkNFVFlQRSkgYW5kIG5vdCBpc2luc3RhbmNlKGNob2ljZXMsIChiaW5hcnlfdHlwZSwgdGV4dF90eXBlKSk6CiAgICAgICAgICAgICAgICBpZiBrIGluIHBhcmFtOgogICAgICAgICAgICAgICAgICAgIGlmIHBhcmFtW2tdIG5vdCBpbiBjaG9pY2VzOgogICAgICAgICAgICAgICAgICAgICAgICAjIFB5WWFtbCBjb252ZXJ0cyBjZXJ0YWluIHN0cmluZ3MgdG8gYm9vbHMuICBJZiB3ZSBjYW4gdW5hbWJpZ3VvdXNseSBjb252ZXJ0IGJhY2ssIGRvIHNvIGJlZm9yZSBjaGVja2luZwogICAgICAgICAgICAgICAgICAgICAgICAjIHRoZSB2YWx1ZS4gIElmIHdlIGNhbid0IGZpZ3VyZSB0aGlzIG91dCwgbW9kdWxlIGF1dGhvciBpcyByZXNwb25zaWJsZS4KICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJlZF9jaG9pY2VzID0gTm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJhbVtrXSA9PSAnRmFsc2UnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJlZF9jaG9pY2VzID0gX2xlbmllbnRfbG93ZXJjYXNlKGNob2ljZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGQUxTRVkgPSBmcm96ZW5zZXQoQk9PTEVBTlNfRkFMU0UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwID0gRkFMU0VZLmludGVyc2VjdGlvbihjaG9pY2VzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKG92ZXJsYXApID09IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IGZyb20gYSBzZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGFyYW1ba10sKSA9IG92ZXJsYXAKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcmFtW2tdID09ICdUcnVlJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxvd2VyZWRfY2hvaWNlcyBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvd2VyZWRfY2hvaWNlcyA9IF9sZW5pZW50X2xvd2VyY2FzZShjaG9pY2VzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVVEhZID0gZnJvemVuc2V0KEJPT0xFQU5TX1RSVUUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGFwID0gVFJVVEhZLmludGVyc2VjdGlvbihjaG9pY2VzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKG92ZXJsYXApID09IDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBhcmFtW2tdLCkgPSBvdmVybGFwCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBwYXJhbVtrXSBub3QgaW4gY2hvaWNlczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZXNfc3RyPSIsIi5qb2luKFt0b19uYXRpdmUoYykgZm9yIGMgaW4gY2hvaWNlc10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c9InZhbHVlIG9mICVzIG11c3QgYmUgb25lIG9mOiAlcywgZ290OiAlcyIgJSAoaywgY2hvaWNlc19zdHIsIHBhcmFtW2tdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPW1zZykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iaW50ZXJuYWwgZXJyb3I6IGNob2ljZXMgZm9yIGFyZ3VtZW50ICVzIGFyZSBub3QgaXRlcmFibGU6ICVzIiAlIChrLCBjaG9pY2VzKSkKCiAgICBkZWYgc2FmZV9ldmFsKHNlbGYsIHZhbHVlLCBsb2NhbHM9Tm9uZSwgaW5jbHVkZV9leGNlcHRpb25zPUZhbHNlKToKCiAgICAgICAgIyBkbyBub3QgYWxsb3cgbWV0aG9kIGNhbGxzIHRvIG1vZHVsZXMKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgIyBhbHJlYWR5IHRlbXBsYXRlZCB0byBhIGRhdGF2YWx1ZXN0cnVjdHVyZSwgcGVyaGFwcz8KICAgICAgICAgICAgaWYgaW5jbHVkZV9leGNlcHRpb25zOgogICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSwgTm9uZSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgaWYgcmUuc2VhcmNoKHInXHdcLlx3K1woJywgdmFsdWUpOgogICAgICAgICAgICBpZiBpbmNsdWRlX2V4Y2VwdGlvbnM6CiAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlLCBOb25lKQogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAjIGRvIG5vdCBhbGxvdyBpbXBvcnRzCiAgICAgICAgaWYgcmUuc2VhcmNoKHInaW1wb3J0IFx3KycsIHZhbHVlKToKICAgICAgICAgICAgaWYgaW5jbHVkZV9leGNlcHRpb25zOgogICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSwgTm9uZSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBsaXRlcmFsX2V2YWwodmFsdWUpCiAgICAgICAgICAgIGlmIGluY2x1ZGVfZXhjZXB0aW9uczoKICAgICAgICAgICAgICAgIHJldHVybiAocmVzdWx0LCBOb25lKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgaWYgaW5jbHVkZV9leGNlcHRpb25zOgogICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSwgZSkKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgZGVmIF9jaGVja190eXBlX3N0cihzZWxmLCB2YWx1ZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgIyBOb3RlOiBUaGlzIGNvdWxkIHRocm93IGEgdW5pY29kZSBlcnJvciBpZiB2YWx1ZSdzIF9fc3RyX18oKSBtZXRob2QKICAgICAgICAjIHJldHVybnMgbm9uLWFzY2lpLiAgSGF2ZSB0byBwb3J0IHV0aWxzLnRvX2J5dGVzKCkgaWYgdGhhdCBoYXBwZW5zCiAgICAgICAgcmV0dXJuIHN0cih2YWx1ZSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfbGlzdChzZWxmLCB2YWx1ZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgbGlzdCk6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZQoKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBzdHJpbmdfdHlwZXMpOgogICAgICAgICAgICByZXR1cm4gdmFsdWUuc3BsaXQoIiwiKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgaW50KSBvciBpc2luc3RhbmNlKHZhbHVlLCBmbG9hdCk6CiAgICAgICAgICAgIHJldHVybiBbIHN0cih2YWx1ZSkgXQoKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJyVzIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gYSBsaXN0JyAlIHR5cGUodmFsdWUpKQoKICAgIGRlZiBfY2hlY2tfdHlwZV9kaWN0KHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBkaWN0KToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIGlmIHZhbHVlLnN0YXJ0c3dpdGgoInsiKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5sb2Fkcyh2YWx1ZSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAocmVzdWx0LCBleGMpID0gc2VsZi5zYWZlX2V2YWwodmFsdWUsIGRpY3QoKSwgaW5jbHVkZV9leGNlcHRpb25zPVRydWUpCiAgICAgICAgICAgICAgICAgICAgaWYgZXhjIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ3VuYWJsZSB0byBldmFsdWF0ZSBzdHJpbmcgYXMgZGljdGlvbmFyeScpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICAgICAgICBlbGlmICc9JyBpbiB2YWx1ZToKICAgICAgICAgICAgICAgIGZpZWxkcyA9IFtdCiAgICAgICAgICAgICAgICBmaWVsZF9idWZmZXIgPSBbXQogICAgICAgICAgICAgICAgaW5fcXVvdGUgPSBGYWxzZQogICAgICAgICAgICAgICAgaW5fZXNjYXBlID0gRmFsc2UKICAgICAgICAgICAgICAgIGZvciBjIGluIHZhbHVlLnN0cmlwKCk6CiAgICAgICAgICAgICAgICAgICAgaWYgaW5fZXNjYXBlOgogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZF9idWZmZXIuYXBwZW5kKGMpCiAgICAgICAgICAgICAgICAgICAgICAgIGluX2VzY2FwZSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjID09ICdcXCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGluX2VzY2FwZSA9IFRydWUKICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBpbl9xdW90ZSBhbmQgYyBpbiAoJ1wnJywgJyInKToKICAgICAgICAgICAgICAgICAgICAgICAgaW5fcXVvdGUgPSBjCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpbl9xdW90ZSBhbmQgaW5fcXVvdGUgPT0gYzoKICAgICAgICAgICAgICAgICAgICAgICAgaW5fcXVvdGUgPSBGYWxzZQogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IGluX3F1b3RlIGFuZCBjIGluICgnLCcsICcgJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkID0gJycuam9pbihmaWVsZF9idWZmZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZpZWxkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRzLmFwcGVuZChmaWVsZCkKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGRfYnVmZmVyID0gW10KICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZF9idWZmZXIuYXBwZW5kKGMpCgogICAgICAgICAgICAgICAgZmllbGQgPSAnJy5qb2luKGZpZWxkX2J1ZmZlcikKICAgICAgICAgICAgICAgIGlmIGZpZWxkOgogICAgICAgICAgICAgICAgICAgIGZpZWxkcy5hcHBlbmQoZmllbGQpCiAgICAgICAgICAgICAgICByZXR1cm4gZGljdCh4LnNwbGl0KCI9IiwgMSkgZm9yIHggaW4gZmllbGRzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJkaWN0aW9uYXJ5IHJlcXVlc3RlZCwgY291bGQgbm90IHBhcnNlIEpTT04gb3Iga2V5PXZhbHVlIikKCiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCclcyBjYW5ub3QgYmUgY29udmVydGVkIHRvIGEgZGljdCcgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfYm9vbChzZWxmLCB2YWx1ZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgYm9vbCk6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZQoKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBzdHJpbmdfdHlwZXMpIG9yIGlzaW5zdGFuY2UodmFsdWUsIGludCk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmJvb2xlYW4odmFsdWUpCgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhIGJvb2wnICUgdHlwZSh2YWx1ZSkpCgogICAgZGVmIF9jaGVja190eXBlX2ludChzZWxmLCB2YWx1ZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgaW50KToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIHJldHVybiBpbnQodmFsdWUpCgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhbiBpbnQnICUgdHlwZSh2YWx1ZSkpCgogICAgZGVmIF9jaGVja190eXBlX2Zsb2F0KHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBmbG9hdCk6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZQoKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAoYmluYXJ5X3R5cGUsIHRleHRfdHlwZSwgaW50KSk6CiAgICAgICAgICAgIHJldHVybiBmbG9hdCh2YWx1ZSkKCiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCclcyBjYW5ub3QgYmUgY29udmVydGVkIHRvIGEgZmxvYXQnICUgdHlwZSh2YWx1ZSkpCgogICAgZGVmIF9jaGVja190eXBlX3BhdGgoc2VsZiwgdmFsdWUpOgogICAgICAgIHZhbHVlID0gc2VsZi5fY2hlY2tfdHlwZV9zdHIodmFsdWUpCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnModmFsdWUpKQoKICAgIGRlZiBfY2hlY2tfdHlwZV9qc29uYXJnKHNlbGYsIHZhbHVlKToKICAgICAgICAjIFJldHVybiBhIGpzb25pZmllZCBzdHJpbmcuICBTb21ldGltZXMgdGhlIGNvbnRyb2xsZXIgdHVybnMgYSBqc29uCiAgICAgICAgIyBzdHJpbmcgaW50byBhIGRpY3QvbGlzdCBzbyB0cmFuc2Zvcm0gaXQgYmFjayBpbnRvIGpzb24gaGVyZQogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsICh0ZXh0X3R5cGUsIGJpbmFyeV90eXBlKSk6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5zdHJpcCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKGxpc3QsIHR1cGxlLCBkaWN0KSk6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5kdW1wcyh2YWx1ZSkKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJyVzIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gYSBqc29uIHN0cmluZycgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfcmF3KHNlbGYsIHZhbHVlKToKICAgICAgICByZXR1cm4gdmFsdWUKCgogICAgZGVmIF9jaGVja190eXBlX2J5dGVzKHNlbGYsIHZhbHVlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaHVtYW5fdG9fYnl0ZXModmFsdWUpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhIEJ5dGUgdmFsdWUnICUgdHlwZSh2YWx1ZSkpCgoKICAgIGRlZiBfY2hlY2tfdHlwZV9iaXRzKHNlbGYsIHZhbHVlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNlbGYuaHVtYW5fdG9fYnl0ZXModmFsdWUsIGlzYml0cz1UcnVlKQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoJyVzIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gYSBCaXQgdmFsdWUnICUgdHlwZSh2YWx1ZSkpCgogICAgZGVmIF9jaGVja19hcmd1bWVudF90eXBlcyhzZWxmLCBzcGVjPU5vbmUsIHBhcmFtPU5vbmUpOgogICAgICAgICcnJyBlbnN1cmUgYWxsIGFyZ3VtZW50cyBoYXZlIHRoZSByZXF1ZXN0ZWQgdHlwZSAnJycKCiAgICAgICAgaWYgc3BlYyBpcyBOb25lOgogICAgICAgICAgICBzcGVjID0gc2VsZi5hcmd1bWVudF9zcGVjCiAgICAgICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAgICAgcGFyYW0gPSBzZWxmLnBhcmFtcwoKICAgICAgICBmb3IgKGssIHYpIGluIHNwZWMuaXRlbXMoKToKICAgICAgICAgICAgd2FudGVkID0gdi5nZXQoJ3R5cGUnLCBOb25lKQogICAgICAgICAgICBpZiBrIG5vdCBpbiBwYXJhbToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIHdhbnRlZCBpcyBOb25lOgogICAgICAgICAgICAgICAgIyBNb3N0bHkgd2Ugd2FudCB0byBkZWZhdWx0IHRvIHN0ci4KICAgICAgICAgICAgICAgICMgRm9yIHZhbHVlcyBzZXQgdG8gTm9uZSBleHBsaWNpdGx5LCByZXR1cm4gTm9uZSBpbnN0ZWFkIGFzCiAgICAgICAgICAgICAgICAjIHRoYXQgYWxsb3dzIGEgdXNlciB0byB1bnNldCBhIHBhcmFtZXRlcgogICAgICAgICAgICAgICAgaWYgcGFyYW1ba10gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgd2FudGVkID0gJ3N0cicKCiAgICAgICAgICAgIHZhbHVlID0gcGFyYW1ba10KICAgICAgICAgICAgaWYgdmFsdWUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0eXBlX2NoZWNrZXIgPSBzZWxmLl9DSEVDS19BUkdVTUVOVF9UWVBFU19ESVNQQVRDSEVSW3dhbnRlZF0KICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJpbXBsZW1lbnRhdGlvbiBlcnJvcjogdW5rbm93biB0eXBlICVzIHJlcXVlc3RlZCBmb3IgJXMiICUgKHdhbnRlZCwgaykpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBhcmFtW2tdID0gdHlwZV9jaGVja2VyKHZhbHVlKQogICAgICAgICAgICBleGNlcHQgKFR5cGVFcnJvciwgVmFsdWVFcnJvcik6CiAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9ImFyZ3VtZW50ICVzIGlzIG9mIHR5cGUgJXMgYW5kIHdlIHdlcmUgdW5hYmxlIHRvIGNvbnZlcnQgdG8gJXM6ICVzIiAlIChrLCB0eXBlKHZhbHVlKSwgd2FudGVkLCBlKSkKCiAgICAgICAgICAgICMgZGVhbCB3aXRoIHN1YiBvcHRpb25zIHRvIGNyZWF0ZSBzdWIgc3BlYwogICAgICAgICAgICBzcGVjID0gTm9uZQogICAgICAgICAgICBpZiB3YW50ZWQgPT0gJ2RpY3QnIG9yICh3YW50ZWQgPT0gJ2xpc3QnIGFuZCB2LmdldCgnZWxlbWVudHMnLCAnJykgPT0gJ2RpY3QnKToKICAgICAgICAgICAgICAgIHNwZWMgPSB2LmdldCgnb3B0aW9ucycsIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBzcGVjOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2NoZWNrX3JlcXVpcmVkX2FyZ3VtZW50cyhzcGVjLCBwYXJhbVtrXSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9jaGVja19hcmd1bWVudF90eXBlcyhzcGVjLCBwYXJhbVtrXSkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9jaGVja19hcmd1bWVudF92YWx1ZXMoc3BlYywgcGFyYW1ba10pCgogICAgZGVmIF9zZXRfZGVmYXVsdHMoc2VsZiwgcHJlPVRydWUpOgogICAgICAgIGZvciAoayx2KSBpbiBzZWxmLmFyZ3VtZW50X3NwZWMuaXRlbXMoKToKICAgICAgICAgICAgZGVmYXVsdCA9IHYuZ2V0KCdkZWZhdWx0JywgTm9uZSkKICAgICAgICAgICAgaWYgcHJlIGlzIFRydWU6CiAgICAgICAgICAgICAgICAjIHRoaXMgcHJldmVudHMgc2V0dGluZyBkZWZhdWx0cyBvbiByZXF1aXJlZCBpdGVtcwogICAgICAgICAgICAgICAgaWYgZGVmYXVsdCBpcyBub3QgTm9uZSBhbmQgayBub3QgaW4gc2VsZi5wYXJhbXM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXJhbXNba10gPSBkZWZhdWx0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIG1ha2Ugc3VyZSB0aGluZ3Mgd2l0aG91dCBhIGRlZmF1bHQgc3RpbGwgZ2V0IHNldCBOb25lCiAgICAgICAgICAgICAgICBpZiBrIG5vdCBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgICAgICAgICBzZWxmLnBhcmFtc1trXSA9IGRlZmF1bHQKCiAgICBkZWYgX3NldF9mYWxsYmFja3Moc2VsZik6CiAgICAgICAgZm9yIGssdiBpbiBzZWxmLmFyZ3VtZW50X3NwZWMuaXRlbXMoKToKICAgICAgICAgICAgZmFsbGJhY2sgPSB2LmdldCgnZmFsbGJhY2snLCAoTm9uZSwpKQogICAgICAgICAgICBmYWxsYmFja19zdHJhdGVneSA9IGZhbGxiYWNrWzBdCiAgICAgICAgICAgIGZhbGxiYWNrX2FyZ3MgPSBbXQogICAgICAgICAgICBmYWxsYmFja19rd2FyZ3MgPSB7fQogICAgICAgICAgICBpZiBrIG5vdCBpbiBzZWxmLnBhcmFtcyBhbmQgZmFsbGJhY2tfc3RyYXRlZ3kgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBmYWxsYmFja1sxOl06CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpdGVtLCBkaWN0KToKICAgICAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tfa3dhcmdzID0gaXRlbQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrX2FyZ3MgPSBpdGVtCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5wYXJhbXNba10gPSBmYWxsYmFja19zdHJhdGVneSgqZmFsbGJhY2tfYXJncywgKipmYWxsYmFja19rd2FyZ3MpCiAgICAgICAgICAgICAgICBleGNlcHQgQW5zaWJsZUZhbGxiYWNrTm90Rm91bmQ6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICBkZWYgX2xvYWRfcGFyYW1zKHNlbGYpOgogICAgICAgICcnJyByZWFkIHRoZSBpbnB1dCBhbmQgc2V0IHRoZSBwYXJhbXMgYXR0cmlidXRlLgoKICAgICAgICBUaGlzIG1ldGhvZCBpcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuICBUaGUgZ3V0cyBvZiB0aGUgZnVuY3Rpb24KICAgICAgICB3ZXJlIG1vdmVkIG91dCBpbiAyLjEgc28gdGhhdCBjdXN0b20gbW9kdWxlcyBjb3VsZCByZWFkIHRoZSBwYXJhbWV0ZXJzLgogICAgICAgICcnJwogICAgICAgICMgZGVidWcgb3ZlcnJpZGVzIHRvIHJlYWQgYXJncyBmcm9tIGZpbGUgb3IgY21kbGluZQogICAgICAgIHNlbGYucGFyYW1zID0gX2xvYWRfcGFyYW1zKCkKCiAgICBkZWYgX2xvZ190b19zeXNsb2coc2VsZiwgbXNnKToKICAgICAgICBpZiBIQVNfU1lTTE9HOgogICAgICAgICAgICBtb2R1bGUgPSAnYW5zaWJsZS0lcycgJSBzZWxmLl9uYW1lCiAgICAgICAgICAgIGZhY2lsaXR5ID0gZ2V0YXR0cihzeXNsb2csIHNlbGYuX3N5c2xvZ19mYWNpbGl0eSwgc3lzbG9nLkxPR19VU0VSKQogICAgICAgICAgICBzeXNsb2cub3BlbmxvZyhzdHIobW9kdWxlKSwgMCwgZmFjaWxpdHkpCiAgICAgICAgICAgIHN5c2xvZy5zeXNsb2coc3lzbG9nLkxPR19JTkZPLCBtc2cpCgogICAgZGVmIGRlYnVnKHNlbGYsIG1zZyk6CiAgICAgICAgaWYgc2VsZi5fZGVidWc6CiAgICAgICAgICAgIHNlbGYubG9nKCdbZGVidWddICVzJyAlIG1zZykKCiAgICBkZWYgbG9nKHNlbGYsIG1zZywgbG9nX2FyZ3M9Tm9uZSk6CgogICAgICAgIGlmIG5vdCBzZWxmLm5vX2xvZzoKCiAgICAgICAgICAgIGlmIGxvZ19hcmdzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBsb2dfYXJncyA9IGRpY3QoKQoKICAgICAgICAgICAgbW9kdWxlID0gJ2Fuc2libGUtJXMnICUgc2VsZi5fbmFtZQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKG1vZHVsZSwgYmluYXJ5X3R5cGUpOgogICAgICAgICAgICAgICAgbW9kdWxlID0gbW9kdWxlLmRlY29kZSgndXRmLTgnLCAncmVwbGFjZScpCgogICAgICAgICAgICAjIDY2NTUgLSBhbGxvdyBmb3IgYWNjZW50ZWQgY2hhcmFjdGVycwogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShtc2csIChiaW5hcnlfdHlwZSwgdGV4dF90eXBlKSk6CiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoIm1zZyBzaG91bGQgYmUgYSBzdHJpbmcgKGdvdCAlcykiICUgdHlwZShtc2cpKQoKICAgICAgICAgICAgIyBXZSB3YW50IGpvdXJuYWwgdG8gYWx3YXlzIHRha2UgdGV4dCB0eXBlCiAgICAgICAgICAgICMgc3lzbG9nIHRha2VzIGJ5dGVzIG9uIHB5MiwgdGV4dCB0eXBlIG9uIHB5MwogICAgICAgICAgICBpZiBpc2luc3RhbmNlKG1zZywgYmluYXJ5X3R5cGUpOgogICAgICAgICAgICAgICAgam91cm5hbF9tc2cgPSByZW1vdmVfdmFsdWVzKG1zZy5kZWNvZGUoJ3V0Zi04JywgJ3JlcGxhY2UnKSwgc2VsZi5ub19sb2dfdmFsdWVzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBUT0RPOiBzdXJyb2dhdGVlc2NhcGUgaXMgYSBkYW5nZXIgaGVyZSBvbiBQeTMKICAgICAgICAgICAgICAgIGpvdXJuYWxfbXNnID0gcmVtb3ZlX3ZhbHVlcyhtc2csIHNlbGYubm9fbG9nX3ZhbHVlcykKCiAgICAgICAgICAgIGlmIFBZMzoKICAgICAgICAgICAgICAgIHN5c2xvZ19tc2cgPSBqb3VybmFsX21zZwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc3lzbG9nX21zZyA9IGpvdXJuYWxfbXNnLmVuY29kZSgndXRmLTgnLCAncmVwbGFjZScpCgogICAgICAgICAgICBpZiBoYXNfam91cm5hbDoKICAgICAgICAgICAgICAgIGpvdXJuYWxfYXJncyA9IFsoIk1PRFVMRSIsIG9zLnBhdGguYmFzZW5hbWUoX19maWxlX18pKV0KICAgICAgICAgICAgICAgIGZvciBhcmcgaW4gbG9nX2FyZ3M6CiAgICAgICAgICAgICAgICAgICAgam91cm5hbF9hcmdzLmFwcGVuZCgoYXJnLnVwcGVyKCksIHN0cihsb2dfYXJnc1thcmddKSkpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5zZW5kKHUiJXMgJXMiICUgKG1vZHVsZSwgam91cm5hbF9tc2cpLCAqKmRpY3Qoam91cm5hbF9hcmdzKSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBJT0Vycm9yOgogICAgICAgICAgICAgICAgICAgICMgZmFsbCBiYWNrIHRvIHN5c2xvZyBzaW5jZSBsb2dnaW5nIHRvIGpvdXJuYWwgZmFpbGVkCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fbG9nX3RvX3N5c2xvZyhzeXNsb2dfbXNnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5fbG9nX3RvX3N5c2xvZyhzeXNsb2dfbXNnKQoKICAgIGRlZiBfbG9nX2ludm9jYXRpb24oc2VsZik6CiAgICAgICAgJycnIGxvZyB0aGF0IGFuc2libGUgcmFuIHRoZSBtb2R1bGUgJycnCiAgICAgICAgIyBUT0RPOiBnZW5lcmFsaXplIGEgc2VwYXJhdGUgbG9nIGZ1bmN0aW9uIGFuZCBtYWtlIGxvZ19pbnZvY2F0aW9uIHVzZSBpdAogICAgICAgICMgU2FuaXRpemUgcG9zc2libGUgcGFzc3dvcmQgYXJndW1lbnQgd2hlbiBsb2dnaW5nLgogICAgICAgIGxvZ19hcmdzID0gZGljdCgpCgogICAgICAgIGZvciBwYXJhbSBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgY2Fub24gID0gc2VsZi5hbGlhc2VzLmdldChwYXJhbSwgcGFyYW0pCiAgICAgICAgICAgIGFyZ19vcHRzID0gc2VsZi5hcmd1bWVudF9zcGVjLmdldChjYW5vbiwge30pCiAgICAgICAgICAgIG5vX2xvZyA9IGFyZ19vcHRzLmdldCgnbm9fbG9nJywgRmFsc2UpCgogICAgICAgICAgICBpZiBzZWxmLmJvb2xlYW4obm9fbG9nKToKICAgICAgICAgICAgICAgIGxvZ19hcmdzW3BhcmFtXSA9ICdOT1RfTE9HR0lOR19QQVJBTUVURVInCiAgICAgICAgICAgICMgdHJ5IHRvIGNhcHR1cmUgYWxsIHBhc3N3b3Jkcy9wYXNzcGhyYXNlIG5hbWVkIGZpZWxkcyBtaXNzZWQgYnkgbm9fbG9nCiAgICAgICAgICAgIGVsaWYgUEFTU1dPUkRfTUFUQ0guc2VhcmNoKHBhcmFtKSBhbmQgXAogICAgICAgICAgICAgIGFyZ19vcHRzLmdldCgndHlwZScsICdzdHInKSAhPSAnYm9vbCcgYW5kIFwKICAgICAgICAgICAgICBub3QgYXJnX29wdHMuZ2V0KCdjaG9pY2VzJywgRmFsc2UpOgogICAgICAgICAgICAgICAgIyBza2lwIGJvb2xlYW4gYW5kIGVudW1zIGFzIHRoZXkgYXJlIGFib3V0ICdwYXNzd29yZCcgc3RhdGUKICAgICAgICAgICAgICAgIGxvZ19hcmdzW3BhcmFtXSA9ICdOT1RfTE9HR0lOR19QQVNTV09SRCcKICAgICAgICAgICAgICAgIHNlbGYud2FybignTW9kdWxlIGRpZCBub3Qgc2V0IG5vX2xvZyBmb3IgJXMnICUgcGFyYW0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwYXJhbV92YWwgPSBzZWxmLnBhcmFtc1twYXJhbV0KICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHBhcmFtX3ZhbCwgKHRleHRfdHlwZSwgYmluYXJ5X3R5cGUpKToKICAgICAgICAgICAgICAgICAgICBwYXJhbV92YWwgPSBzdHIocGFyYW1fdmFsKQogICAgICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKHBhcmFtX3ZhbCwgdGV4dF90eXBlKToKICAgICAgICAgICAgICAgICAgICBwYXJhbV92YWwgPSBwYXJhbV92YWwuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgICAgICBsb2dfYXJnc1twYXJhbV0gPSBoZXVyaXN0aWNfbG9nX3Nhbml0aXplKHBhcmFtX3ZhbCwgc2VsZi5ub19sb2dfdmFsdWVzKQoKICAgICAgICBtc2cgPSBbJyVzPSVzJyAlICh0b19uYXRpdmUoYXJnKSwgdG9fbmF0aXZlKHZhbCkpIGZvciBhcmcsIHZhbCBpbiBsb2dfYXJncy5pdGVtcygpXQogICAgICAgIGlmIG1zZzoKICAgICAgICAgICAgbXNnID0gJ0ludm9rZWQgd2l0aCAlcycgJSAnICcuam9pbihtc2cpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbXNnID0gJ0ludm9rZWQnCgogICAgICAgIHNlbGYubG9nKG1zZywgbG9nX2FyZ3M9bG9nX2FyZ3MpCgoKICAgIGRlZiBfc2V0X2N3ZChzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGN3ZCA9IG9zLmdldGN3ZCgpCiAgICAgICAgICAgIGlmIG5vdCBvcy5hY2Nlc3MoY3dkLCBvcy5GX09LfG9zLlJfT0spOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIGN3ZAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgIyB3ZSBkb24ndCBoYXZlIGFjY2VzcyB0byB0aGUgY3dkLCBwcm9iYWJseSBiZWNhdXNlIG9mIHN1ZG8uCiAgICAgICAgICAgICMgVHJ5IGFuZCBtb3ZlIHRvIGEgbmV1dHJhbCBsb2NhdGlvbiB0byBwcmV2ZW50IGVycm9ycwogICAgICAgICAgICBmb3IgY3dkIGluIFtvcy5wYXRoLmV4cGFuZHZhcnMoJyRIT01FJyksIHRlbXBmaWxlLmdldHRlbXBkaXIoKV06CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgb3MuYWNjZXNzKGN3ZCwgb3MuRl9PS3xvcy5SX09LKToKICAgICAgICAgICAgICAgICAgICAgICAgb3MuY2hkaXIoY3dkKQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3dkCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICMgd2Ugd29uJ3QgZXJyb3IgaGVyZSwgYXMgaXQgbWF5ICpub3QqIGJlIGEgcHJvYmxlbSwKICAgICAgICAjIGFuZCB3ZSBkb24ndCB3YW50IHRvIGJyZWFrIG1vZHVsZXMgdW5uZWNlc3NhcmlseQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF9iaW5fcGF0aChzZWxmLCBhcmcsIHJlcXVpcmVkPUZhbHNlLCBvcHRfZGlycz1bXSk6CiAgICAgICAgJycnCiAgICAgICAgZmluZCBzeXN0ZW0gZXhlY3V0YWJsZSBpbiBQQVRILgogICAgICAgIE9wdGlvbmFsIGFyZ3VtZW50czoKICAgICAgICAgICAtIHJlcXVpcmVkOiAgaWYgZXhlY3V0YWJsZSBpcyBub3QgZm91bmQgYW5kIHJlcXVpcmVkIGlzIHRydWUsIGZhaWxfanNvbgogICAgICAgICAgIC0gb3B0X2RpcnM6ICBvcHRpb25hbCBsaXN0IG9mIGRpcmVjdG9yaWVzIHRvIHNlYXJjaCBpbiBhZGRpdGlvbiB0byBQQVRICiAgICAgICAgaWYgZm91bmQgcmV0dXJuIGZ1bGwgcGF0aDsgb3RoZXJ3aXNlIHJldHVybiBOb25lCiAgICAgICAgJycnCiAgICAgICAgc2Jpbl9wYXRocyA9IFsnL3NiaW4nLCAnL3Vzci9zYmluJywgJy91c3IvbG9jYWwvc2JpbiddCiAgICAgICAgcGF0aHMgPSBbXQogICAgICAgIGZvciBkIGluIG9wdF9kaXJzOgogICAgICAgICAgICBpZiBkIGlzIG5vdCBOb25lIGFuZCBvcy5wYXRoLmV4aXN0cyhkKToKICAgICAgICAgICAgICAgIHBhdGhzLmFwcGVuZChkKQogICAgICAgIHBhdGhzICs9IG9zLmVudmlyb24uZ2V0KCdQQVRIJywgJycpLnNwbGl0KG9zLnBhdGhzZXApCiAgICAgICAgYmluX3BhdGggPSBOb25lCiAgICAgICAgIyBtYW5nbGUgUEFUSCB0byBpbmNsdWRlIC9zYmluIGRpcnMKICAgICAgICBmb3IgcCBpbiBzYmluX3BhdGhzOgogICAgICAgICAgICBpZiBwIG5vdCBpbiBwYXRocyBhbmQgb3MucGF0aC5leGlzdHMocCk6CiAgICAgICAgICAgICAgICBwYXRocy5hcHBlbmQocCkKICAgICAgICBmb3IgZCBpbiBwYXRoczoKICAgICAgICAgICAgaWYgbm90IGQ6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKGQsIGFyZykKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCkgYW5kIG5vdCBvcy5wYXRoLmlzZGlyKHBhdGgpIGFuZCBpc19leGVjdXRhYmxlKHBhdGgpOgogICAgICAgICAgICAgICAgYmluX3BhdGggPSBwYXRoCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmIHJlcXVpcmVkIGFuZCBiaW5fcGF0aCBpcyBOb25lOgogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0ZhaWxlZCB0byBmaW5kIHJlcXVpcmVkIGV4ZWN1dGFibGUgJXMgaW4gcGF0aHM6ICVzJyAlIChhcmcsIG9zLnBhdGhzZXAuam9pbihwYXRocykpKQogICAgICAgIHJldHVybiBiaW5fcGF0aAoKICAgIGRlZiBib29sZWFuKHNlbGYsIGFyZyk6CiAgICAgICAgJycnIHJldHVybiBhIGJvb2wgZm9yIHRoZSBhcmcgJycnCiAgICAgICAgaWYgYXJnIGlzIE5vbmUgb3IgaXNpbnN0YW5jZShhcmcsIGJvb2wpOgogICAgICAgICAgICByZXR1cm4gYXJnCiAgICAgICAgaWYgaXNpbnN0YW5jZShhcmcsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIGFyZyA9IGFyZy5sb3dlcigpCiAgICAgICAgaWYgYXJnIGluIEJPT0xFQU5TX1RSVUU6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxpZiBhcmcgaW4gQk9PTEVBTlNfRkFMU0U6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nJXMgaXMgbm90IGEgdmFsaWQgYm9vbGVhbi4gVmFsaWQgYm9vbGVhbnMgaW5jbHVkZTogJXMnICUgKHRvX3RleHQoYXJnKSwgJywnLmpvaW4oWyclcycgJSB4IGZvciB4IGluIEJPT0xFQU5TXSkpKQoKICAgIGRlZiBqc29uaWZ5KHNlbGYsIGRhdGEpOgogICAgICAgIGZvciBlbmNvZGluZyBpbiAoInV0Zi04IiwgImxhdGluLTEiKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmV0dXJuIGpzb24uZHVtcHMoZGF0YSwgZW5jb2Rpbmc9ZW5jb2RpbmcpCiAgICAgICAgICAgICMgT2xkIHN5c3RlbXMgdXNpbmcgb2xkIHNpbXBsZWpzb24gbW9kdWxlIGRvZXMgbm90IHN1cHBvcnQgZW5jb2Rpbmcga2V5d29yZC4KICAgICAgICAgICAgZXhjZXB0IFR5cGVFcnJvcjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBuZXdfZGF0YSA9IGpzb25fZGljdF9ieXRlc190b191bmljb2RlKGRhdGEsIGVuY29kaW5nPWVuY29kaW5nKQogICAgICAgICAgICAgICAgZXhjZXB0IFVuaWNvZGVEZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgcmV0dXJuIGpzb24uZHVtcHMobmV3X2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBVbmljb2RlRGVjb2RlRXJyb3I6CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nSW52YWxpZCB1bmljb2RlIGVuY29kaW5nIGVuY291bnRlcmVkJykKCiAgICBkZWYgZnJvbV9qc29uKHNlbGYsIGRhdGEpOgogICAgICAgIHJldHVybiBqc29uLmxvYWRzKGRhdGEpCgogICAgZGVmIGFkZF9jbGVhbnVwX2ZpbGUoc2VsZiwgcGF0aCk6CiAgICAgICAgaWYgcGF0aCBub3QgaW4gc2VsZi5jbGVhbnVwX2ZpbGVzOgogICAgICAgICAgICBzZWxmLmNsZWFudXBfZmlsZXMuYXBwZW5kKHBhdGgpCgogICAgZGVmIGRvX2NsZWFudXBfZmlsZXMoc2VsZik6CiAgICAgICAgZm9yIHBhdGggaW4gc2VsZi5jbGVhbnVwX2ZpbGVzOgogICAgICAgICAgICBzZWxmLmNsZWFudXAocGF0aCkKCiAgICBkZWYgX3JldHVybl9mb3JtYXR0ZWQoc2VsZiwga3dhcmdzKToKCiAgICAgICAgc2VsZi5hZGRfcGF0aF9pbmZvKGt3YXJncykKCiAgICAgICAgaWYgJ2ludm9jYXRpb24nIG5vdCBpbiBrd2FyZ3M6CiAgICAgICAgICAgIGt3YXJnc1snaW52b2NhdGlvbiddID0geydtb2R1bGVfYXJncyc6IHNlbGYucGFyYW1zfQoKICAgICAgICBpZiAnd2FybmluZ3MnIGluIGt3YXJnczoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShrd2FyZ3NbJ3dhcm5pbmdzJ10sIGxpc3QpOgogICAgICAgICAgICAgICAgZm9yIHcgaW4ga3dhcmdzWyd3YXJuaW5ncyddOgogICAgICAgICAgICAgICAgICAgIHNlbGYud2Fybih3KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi53YXJuKGt3YXJnc1snd2FybmluZ3MnXSkKCiAgICAgICAgaWYgc2VsZi5fd2FybmluZ3M6CiAgICAgICAgICAgIGt3YXJnc1snd2FybmluZ3MnXSA9IHNlbGYuX3dhcm5pbmdzCgogICAgICAgIGlmICdkZXByZWNhdGlvbnMnIGluIGt3YXJnczoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShrd2FyZ3NbJ2RlcHJlY2F0aW9ucyddLCBsaXN0KToKICAgICAgICAgICAgICAgIGZvciBkIGluIGt3YXJnc1snZGVwcmVjYXRpb25zJ106CiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShkLCBTRVFVRU5DRVRZUEUpIGFuZCBsZW4oZCkgPT0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kZXByZWNhdGUoZFswXSwgdmVyc2lvbj1kWzFdKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGVwcmVjYXRlKGQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmRlcHJlY2F0ZShrd2FyZ3NbJ2RlcHJlY2F0aW9ucyddKQoKICAgICAgICBpZiBzZWxmLl9kZXByZWNhdGlvbnM6CiAgICAgICAgICAgIGt3YXJnc1snZGVwcmVjYXRpb25zJ10gPSBzZWxmLl9kZXByZWNhdGlvbnMKCiAgICAgICAga3dhcmdzID0gcmVtb3ZlX3ZhbHVlcyhrd2FyZ3MsIHNlbGYubm9fbG9nX3ZhbHVlcykKICAgICAgICBwcmludCgnXG4lcycgJSBzZWxmLmpzb25pZnkoa3dhcmdzKSkKCiAgICBkZWYgZXhpdF9qc29uKHNlbGYsICoqa3dhcmdzKToKICAgICAgICAnJycgcmV0dXJuIGZyb20gdGhlIG1vZHVsZSwgd2l0aG91dCBlcnJvciAnJycKCiAgICAgICAgaWYgbm90ICdjaGFuZ2VkJyBpbiBrd2FyZ3M6CiAgICAgICAgICAgIGt3YXJnc1snY2hhbmdlZCddID0gRmFsc2UKCiAgICAgICAgc2VsZi5kb19jbGVhbnVwX2ZpbGVzKCkKICAgICAgICBzZWxmLl9yZXR1cm5fZm9ybWF0dGVkKGt3YXJncykKICAgICAgICBzeXMuZXhpdCgwKQoKICAgIGRlZiBmYWlsX2pzb24oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgICcnJyByZXR1cm4gZnJvbSB0aGUgbW9kdWxlLCB3aXRoIGFuIGVycm9yIG1lc3NhZ2UgJycnCgogICAgICAgIGFzc2VydCAnbXNnJyBpbiBrd2FyZ3MsICJpbXBsZW1lbnRhdGlvbiBlcnJvciAtLSBtc2cgdG8gZXhwbGFpbiB0aGUgZXJyb3IgaXMgcmVxdWlyZWQiCiAgICAgICAga3dhcmdzWydmYWlsZWQnXSA9IFRydWUKCiAgICAgICAgaWYgbm90ICdjaGFuZ2VkJyBpbiBrd2FyZ3M6CiAgICAgICAgICAgIGt3YXJnc1snY2hhbmdlZCddID0gRmFsc2UKCiAgICAgICAgc2VsZi5kb19jbGVhbnVwX2ZpbGVzKCkKICAgICAgICBzZWxmLl9yZXR1cm5fZm9ybWF0dGVkKGt3YXJncykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGRlZiBmYWlsX29uX21pc3NpbmdfcGFyYW1zKHNlbGYsIHJlcXVpcmVkX3BhcmFtcz1Ob25lKToKICAgICAgICAnJycgVGhpcyBpcyBmb3IgY2hlY2tpbmcgZm9yIHJlcXVpcmVkIHBhcmFtcyB3aGVuIHdlIGNhbiBub3QgY2hlY2sgdmlhIGFyZ3NwZWMgYmVjYXVzZSB3ZQogICAgICAgIG5lZWQgbW9yZSBpbmZvcm1hdGlvbiB0aGFuIGlzIHNpbXBseSBnaXZlbiBpbiB0aGUgYXJnc3BlYy4KICAgICAgICAnJycKICAgICAgICBpZiBub3QgcmVxdWlyZWRfcGFyYW1zOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBtaXNzaW5nX3BhcmFtcyA9IFtdCiAgICAgICAgZm9yIHJlcXVpcmVkX3BhcmFtIGluIHJlcXVpcmVkX3BhcmFtczoKICAgICAgICAgICAgaWYgbm90IHNlbGYucGFyYW1zLmdldChyZXF1aXJlZF9wYXJhbSk6CiAgICAgICAgICAgICAgICBtaXNzaW5nX3BhcmFtcy5hcHBlbmQocmVxdWlyZWRfcGFyYW0pCiAgICAgICAgaWYgbWlzc2luZ19wYXJhbXM6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0ibWlzc2luZyByZXF1aXJlZCBhcmd1bWVudHM6ICVzIiAlICcsJy5qb2luKG1pc3NpbmdfcGFyYW1zKSkKCiAgICBkZWYgZGlnZXN0X2Zyb21fZmlsZShzZWxmLCBmaWxlbmFtZSwgYWxnb3JpdGhtKToKICAgICAgICAnJycgUmV0dXJuIGhleCBkaWdlc3Qgb2YgbG9jYWwgZmlsZSBmb3IgYSBkaWdlc3RfbWV0aG9kIHNwZWNpZmllZCBieSBuYW1lLCBvciBOb25lIGlmIGZpbGUgaXMgbm90IHByZXNlbnQuICcnJwogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhmaWxlbmFtZSk6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgaWYgb3MucGF0aC5pc2RpcihmaWxlbmFtZSk6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iYXR0ZW1wdGVkIHRvIHRha2UgY2hlY2tzdW0gb2YgZGlyZWN0b3J5OiAlcyIgJSBmaWxlbmFtZSkKCiAgICAgICAgIyBwcmVzZXJ2ZSBvbGQgYmVoYXZpb3VyIHdoZXJlIHRoZSB0aGlyZCBwYXJhbWV0ZXIgd2FzIGEgaGFzaCBhbGdvcml0aG0gb2JqZWN0CiAgICAgICAgaWYgaGFzYXR0cihhbGdvcml0aG0sICdoZXhkaWdlc3QnKToKICAgICAgICAgICAgZGlnZXN0X21ldGhvZCA9IGFsZ29yaXRobQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRpZ2VzdF9tZXRob2QgPSBBVkFJTEFCTEVfSEFTSF9BTEdPUklUSE1TW2FsZ29yaXRobV0oKQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9IkNvdWxkIG5vdCBoYXNoIGZpbGUgJyVzJyB3aXRoIGFsZ29yaXRobSAnJXMnLiBBdmFpbGFibGUgYWxnb3JpdGhtczogJXMiICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZmlsZW5hbWUsIGFsZ29yaXRobSwgJywgJy5qb2luKEFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVMpKSkKCiAgICAgICAgYmxvY2tzaXplID0gNjQgKiAxMDI0CiAgICAgICAgaW5maWxlID0gb3Blbihvcy5wYXRoLnJlYWxwYXRoKGZpbGVuYW1lKSwgJ3JiJykKICAgICAgICBibG9jayA9IGluZmlsZS5yZWFkKGJsb2Nrc2l6ZSkKICAgICAgICB3aGlsZSBibG9jazoKICAgICAgICAgICAgZGlnZXN0X21ldGhvZC51cGRhdGUoYmxvY2spCiAgICAgICAgICAgIGJsb2NrID0gaW5maWxlLnJlYWQoYmxvY2tzaXplKQogICAgICAgIGluZmlsZS5jbG9zZSgpCiAgICAgICAgcmV0dXJuIGRpZ2VzdF9tZXRob2QuaGV4ZGlnZXN0KCkKCiAgICBkZWYgbWQ1KHNlbGYsIGZpbGVuYW1lKToKICAgICAgICAnJycgUmV0dXJuIE1ENSBoZXggZGlnZXN0IG9mIGxvY2FsIGZpbGUgdXNpbmcgZGlnZXN0X2Zyb21fZmlsZSgpLgoKICAgICAgICBEbyBub3QgdXNlIHRoaXMgZnVuY3Rpb24gdW5sZXNzIHlvdSBoYXZlIG5vIG90aGVyIGNob2ljZSBmb3I6CiAgICAgICAgICAgIDEpIE9wdGlvbmFsIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CiAgICAgICAgICAgIDIpIENvbXBhdGliaWxpdHkgd2l0aCBhIHRoaXJkIHBhcnR5IHByb3RvY29sCgogICAgICAgIFRoaXMgZnVuY3Rpb24gd2lsbCBub3Qgd29yayBvbiBzeXN0ZW1zIGNvbXBseWluZyB3aXRoIEZJUFMtMTQwLTIuCgogICAgICAgIE1vc3QgdXNlcyBvZiB0aGlzIGZ1bmN0aW9uIGNhbiB1c2UgdGhlIG1vZHVsZS5zaGExIGZ1bmN0aW9uIGluc3RlYWQuCiAgICAgICAgJycnCiAgICAgICAgaWYgJ21kNScgbm90IGluIEFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVM6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ01ENSBub3QgYXZhaWxhYmxlLiAgUG9zc2libHkgcnVubmluZyBpbiBGSVBTIG1vZGUnKQogICAgICAgIHJldHVybiBzZWxmLmRpZ2VzdF9mcm9tX2ZpbGUoZmlsZW5hbWUsICdtZDUnKQoKICAgIGRlZiBzaGExKHNlbGYsIGZpbGVuYW1lKToKICAgICAgICAnJycgUmV0dXJuIFNIQTEgaGV4IGRpZ2VzdCBvZiBsb2NhbCBmaWxlIHVzaW5nIGRpZ2VzdF9mcm9tX2ZpbGUoKS4gJycnCiAgICAgICAgcmV0dXJuIHNlbGYuZGlnZXN0X2Zyb21fZmlsZShmaWxlbmFtZSwgJ3NoYTEnKQoKICAgIGRlZiBzaGEyNTYoc2VsZiwgZmlsZW5hbWUpOgogICAgICAgICcnJyBSZXR1cm4gU0hBLTI1NiBoZXggZGlnZXN0IG9mIGxvY2FsIGZpbGUgdXNpbmcgZGlnZXN0X2Zyb21fZmlsZSgpLiAnJycKICAgICAgICByZXR1cm4gc2VsZi5kaWdlc3RfZnJvbV9maWxlKGZpbGVuYW1lLCAnc2hhMjU2JykKCiAgICBkZWYgYmFja3VwX2xvY2FsKHNlbGYsIGZuKToKICAgICAgICAnJydtYWtlIGEgZGF0ZS1tYXJrZWQgYmFja3VwIG9mIHRoZSBzcGVjaWZpZWQgZmlsZSwgcmV0dXJuIFRydWUgb3IgRmFsc2Ugb24gc3VjY2VzcyBvciBmYWlsdXJlJycnCgogICAgICAgIGJhY2t1cGRlc3QgPSAnJwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZuKToKICAgICAgICAgICAgIyBiYWNrdXBzIG5hbWVkIGJhc2VuYW1lLlBJRC5ZWVlZLU1NLUREQEhIOk1NOlNTfgogICAgICAgICAgICBleHQgPSB0aW1lLnN0cmZ0aW1lKCIlWS0lbS0lZEAlSDolTTolU34iLCB0aW1lLmxvY2FsdGltZSh0aW1lLnRpbWUoKSkpCiAgICAgICAgICAgIGJhY2t1cGRlc3QgPSAnJXMuJXMuJXMnICUgKGZuLCBvcy5nZXRwaWQoKSwgZXh0KQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGZuLCBiYWNrdXBkZXN0KQogICAgICAgICAgICBleGNlcHQgKHNodXRpbC5FcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0NvdWxkIG5vdCBtYWtlIGJhY2t1cCBvZiAlcyB0byAlczogJXMnICUgKGZuLCBiYWNrdXBkZXN0LCBlKSkKCiAgICAgICAgcmV0dXJuIGJhY2t1cGRlc3QKCiAgICBkZWYgY2xlYW51cChzZWxmLCB0bXBmaWxlKToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyh0bXBmaWxlKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MudW5saW5rKHRtcGZpbGUpCiAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgc3lzLnN0ZGVyci53cml0ZSgiY291bGQgbm90IGNsZWFudXAgJXM6ICVzIiAlICh0bXBmaWxlLCBlKSkKCiAgICBkZWYgYXRvbWljX21vdmUoc2VsZiwgc3JjLCBkZXN0LCB1bnNhZmVfd3JpdGVzPUZhbHNlKToKICAgICAgICAnJydhdG9taWNhbGx5IG1vdmUgc3JjIHRvIGRlc3QsIGNvcHlpbmcgYXR0cmlidXRlcyBmcm9tIGRlc3QsIHJldHVybnMgdHJ1ZSBvbiBzdWNjZXNzCiAgICAgICAgaXQgdXNlcyBvcy5yZW5hbWUgdG8gZW5zdXJlIHRoaXMgYXMgaXQgaXMgYW4gYXRvbWljIG9wZXJhdGlvbiwgcmVzdCBvZiB0aGUgZnVuY3Rpb24gaXMKICAgICAgICB0byB3b3JrIGFyb3VuZCBsaW1pdGF0aW9ucywgY29ybmVyIGNhc2VzIGFuZCBlbnN1cmUgc2VsaW51eCBjb250ZXh0IGlzIHNhdmVkIGlmIHBvc3NpYmxlJycnCiAgICAgICAgY29udGV4dCA9IE5vbmUKICAgICAgICBkZXN0X3N0YXQgPSBOb25lCiAgICAgICAgYl9zcmMgPSB0b19ieXRlcyhzcmMsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCiAgICAgICAgYl9kZXN0ID0gdG9fYnl0ZXMoZGVzdCwgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhiX2Rlc3QpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXN0X3N0YXQgPSBvcy5zdGF0KGJfZGVzdCkKCiAgICAgICAgICAgICAgICAjIGNvcHkgbW9kZSBhbmQgb3duZXJzaGlwCiAgICAgICAgICAgICAgICBvcy5jaG1vZChiX3NyYywgZGVzdF9zdGF0LnN0X21vZGUgJiBQRVJNX0JJVFMpCiAgICAgICAgICAgICAgICBvcy5jaG93bihiX3NyYywgZGVzdF9zdGF0LnN0X3VpZCwgZGVzdF9zdGF0LnN0X2dpZCkKCiAgICAgICAgICAgICAgICAjIHRyeSB0byBjb3B5IGZsYWdzIGlmIHBvc3NpYmxlCiAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKG9zLCAnY2hmbGFncycpIGFuZCBoYXNhdHRyKGRlc3Rfc3RhdCwgJ3N0X2ZsYWdzJyk6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBvcy5jaGZsYWdzKGJfc3JjLCBkZXN0X3N0YXQuc3RfZmxhZ3MpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGVyciBpbiAnRU9QTk9UU1VQUCcsICdFTk9UU1VQJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoZXJybm8sIGVycikgYW5kIGUuZXJybm8gPT0gZ2V0YXR0cihlcnJubywgZXJyKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBpZiBlLmVycm5vICE9IGVycm5vLkVQRVJNOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGlmIHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gc2VsZi5zZWxpbnV4X2NvbnRleHQoZGVzdCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICAgICAgY29udGV4dCA9IHNlbGYuc2VsaW51eF9kZWZhdWx0X2NvbnRleHQoZGVzdCkKCiAgICAgICAgY3JlYXRpbmcgPSBub3Qgb3MucGF0aC5leGlzdHMoYl9kZXN0KQoKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgT3B0aW1pc3RpY2FsbHkgdHJ5IGEgcmVuYW1lLCBzb2x2ZXMgc29tZSBjb3JuZXIgY2FzZXMgYW5kIGNhbiBhdm9pZCB1c2VsZXNzIHdvcmssIHRocm93cyBleGNlcHRpb24gaWYgbm90IGF0b21pYy4KICAgICAgICAgICAgb3MucmVuYW1lKGJfc3JjLCBiX2Rlc3QpCiAgICAgICAgZXhjZXB0IChJT0Vycm9yLCBPU0Vycm9yKToKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBpZiBlLmVycm5vIG5vdCBpbiBbZXJybm8uRVBFUk0sIGVycm5vLkVYREVWLCBlcnJuby5FQUNDRVMsIGVycm5vLkVUWFRCU1ksIGVycm5vLkVCVVNZXToKICAgICAgICAgICAgICAgICMgb25seSB0cnkgd29ya2Fyb3VuZHMgZm9yIGVycm5vIDE4IChjcm9zcyBkZXZpY2UpLCAxIChub3QgcGVybWl0dGVkKSwgIDEzIChwZXJtaXNzaW9uIGRlbmllZCkKICAgICAgICAgICAgICAgICMgYW5kIDI2ICh0ZXh0IGZpbGUgYnVzeSkgd2hpY2ggaGFwcGVucyBvbiB2YWdyYW50IHN5bmNlZCBmb2xkZXJzIGFuZCBvdGhlciAnZXhvdGljJyBub24gcG9zaXggZmlsZSBzeXN0ZW1zCiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0NvdWxkIG5vdCByZXBsYWNlIGZpbGU6ICVzIHRvICVzOiAlcycgJSAoc3JjLCBkZXN0LCBlKSwgZXhjZXB0aW9uPXRyYWNlYmFjay5mb3JtYXRfZXhjKCkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBiX2Rlc3RfZGlyID0gb3MucGF0aC5kaXJuYW1lKGJfZGVzdCkKICAgICAgICAgICAgICAgICMgVXNlIGJ5dGVzIGhlcmUuICBJbiB0aGUgc2hpcHBhYmxlIENJLCB0aGlzIGZhaWxzIHdpdGgKICAgICAgICAgICAgICAgICMgYSBVbmljb2RlRXJyb3Igd2l0aCBzdXJyb2dhdGVlc2NhcGUnZCBzdHJpbmdzIGZvciBhbiB1bmtub3duCiAgICAgICAgICAgICAgICAjIHJlYXNvbiAoZG9lc24ndCBoYXBwZW4gaW4gYSBsb2NhbCBVYnVudHUxNi4wNCBWTSkKICAgICAgICAgICAgICAgIG5hdGl2ZV9kZXN0X2RpciA9IGJfZGVzdF9kaXIKICAgICAgICAgICAgICAgIG5hdGl2ZV9zdWZmaXggPSBvcy5wYXRoLmJhc2VuYW1lKGJfZGVzdCkKICAgICAgICAgICAgICAgIG5hdGl2ZV9wcmVmaXggPSBiKCcuYW5zaWJsZV90bXAnKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHRtcF9kZXN0X2ZkLCB0bXBfZGVzdF9uYW1lID0gdGVtcGZpbGUubWtzdGVtcCggcHJlZml4PW5hdGl2ZV9wcmVmaXgsIGRpcj1uYXRpdmVfZGVzdF9kaXIsIHN1ZmZpeD1uYXRpdmVfc3VmZml4KQogICAgICAgICAgICAgICAgZXhjZXB0IChPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSdUaGUgZGVzdGluYXRpb24gZGlyZWN0b3J5ICglcykgaXMgbm90IHdyaXRhYmxlIGJ5IHRoZSBjdXJyZW50IHVzZXIuIEVycm9yIHdhczogJXMnICUgKG9zLnBhdGguZGlybmFtZShkZXN0KSwgZSkpCiAgICAgICAgICAgICAgICBleGNlcHQgVHlwZUVycm9yOgogICAgICAgICAgICAgICAgICAgICMgV2UgZXhwZWN0IHRoYXQgdGhpcyBpcyBoYXBwZW5pbmcgYmVjYXVzZSBweXRob24zLjQueCBhbmQKICAgICAgICAgICAgICAgICAgICAjIGJlbG93IGNhbid0IGhhbmRsZSBieXRlIHN0cmluZ3MgaW4gbWtzdGVtcCgpLiAgVHJhY2ViYWNrCiAgICAgICAgICAgICAgICAgICAgIyB3b3VsZCBlbmQgaW4gc29tZXRoaW5nIGxpa2U6CiAgICAgICAgICAgICAgICAgICAgIyAgICAgZmlsZSA9IF9vcy5wYXRoLmpvaW4oZGlyLCBwcmUgKyBuYW1lICsgc3VmKQogICAgICAgICAgICAgICAgICAgICMgVHlwZUVycm9yOiBjYW4ndCBjb25jYXQgYnl0ZXMgdG8gc3RyCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSdGYWlsZWQgY3JlYXRpbmcgdGVtcCBmaWxlIGZvciBhdG9taWMgbW92ZS4gIFRoaXMgdXN1YWxseSBoYXBwZW5zIHdoZW4gdXNpbmcgUHl0aG9uMyBsZXNzIHRoYW4gUHl0aG9uMy41LiAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQbGVhc2UgdXNlIFB5dGhvbjIueCBvciBQeXRob24zLjUgb3IgZ3JlYXRlci4nLCBleGNlcHRpb249dHJhY2ViYWNrLmZvcm1hdF9leGMoKSkKCiAgICAgICAgICAgICAgICBiX3RtcF9kZXN0X25hbWUgPSB0b19ieXRlcyh0bXBfZGVzdF9uYW1lLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgY2xvc2UgdG1wIGZpbGUgaGFuZGxlIGJlZm9yZSBmaWxlIG9wZXJhdGlvbnMgdG8gcHJldmVudCB0ZXh0IGZpbGUgYnVzeSBlcnJvcnMgb24gdmJveGZzIHN5bmNlZCBmb2xkZXJzICh3aW5kb3dzIGhvc3QpCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLmNsb3NlKHRtcF9kZXN0X2ZkKQogICAgICAgICAgICAgICAgICAgICAgICAjIGxlYXZlcyB0bXAgZmlsZSBiZWhpbmQgd2hlbiBzdWRvIGFuZCBub3Qgcm9vdAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaHV0aWwubW92ZShiX3NyYywgYl90bXBfZGVzdF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY2xlYW51cCB3aWxsIGhhcHBlbiBieSAncm0nIG9mIHRlbXBkaXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgY29weTIgd2lsbCBwcmVzZXJ2ZSBzb21lIG1ldGFkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIoYl9zcmMsIGJfdG1wX2Rlc3RfbmFtZSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF9jb250ZXh0X2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiX3RtcF9kZXN0X25hbWUsIGNvbnRleHQsIEZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXBfc3RhdCA9IG9zLnN0YXQoYl90bXBfZGVzdF9uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVzdF9zdGF0IGFuZCAodG1wX3N0YXQuc3RfdWlkICE9IGRlc3Rfc3RhdC5zdF91aWQgb3IgdG1wX3N0YXQuc3RfZ2lkICE9IGRlc3Rfc3RhdC5zdF9naWQpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLmNob3duKGJfdG1wX2Rlc3RfbmFtZSwgZGVzdF9zdGF0LnN0X3VpZCwgZGVzdF9zdGF0LnN0X2dpZCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlLmVycm5vICE9IGVycm5vLkVQRVJNOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbmFtZShiX3RtcF9kZXN0X25hbWUsIGJfZGVzdCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChzaHV0aWwuRXJyb3IsIE9TRXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdW5zYWZlX3dyaXRlcyBhbmQgZS5lcnJubyA9PSBlcnJuby5FQlVTWToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl91bnNhZmVfd3JpdGVzKGJfdG1wX2Rlc3RfbmFtZSwgYl9kZXN0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J1VuYWJsZSB0byByZW5hbWUgZmlsZTogJXMgdG8gJXM6ICVzJyAlIChzcmMsIGRlc3QsIGUpLCBleGNlcHRpb249dHJhY2ViYWNrLmZvcm1hdF9leGMoKSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgKHNodXRpbC5FcnJvciwgT1NFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSdGYWlsZWQgdG8gcmVwbGFjZSBmaWxlOiAlcyB0byAlczogJXMnICUgKHNyYywgZGVzdCwgZSksIGV4Y2VwdGlvbj10cmFjZWJhY2suZm9ybWF0X2V4YygpKQogICAgICAgICAgICAgICAgZmluYWxseToKICAgICAgICAgICAgICAgICAgICBzZWxmLmNsZWFudXAoYl90bXBfZGVzdF9uYW1lKQoKICAgICAgICBpZiBjcmVhdGluZzoKICAgICAgICAgICAgIyBtYWtlIHN1cmUgdGhlIGZpbGUgaGFzIHRoZSBjb3JyZWN0IHBlcm1pc3Npb25zCiAgICAgICAgICAgICMgYmFzZWQgb24gdGhlIGN1cnJlbnQgdmFsdWUgb2YgdW1hc2sKICAgICAgICAgICAgdW1hc2sgPSBvcy51bWFzaygwKQogICAgICAgICAgICBvcy51bWFzayh1bWFzaykKICAgICAgICAgICAgb3MuY2htb2QoYl9kZXN0LCBERUZBVUxUX1BFUk0gJiB+dW1hc2spCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLmNob3duKGJfZGVzdCwgb3MuZ2V0ZXVpZCgpLCBvcy5nZXRlZ2lkKCkpCiAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgIyBXZSdyZSBva2F5IHdpdGggdHJ5aW5nIG91ciBiZXN0IGhlcmUuICBJZiB0aGUgdXNlciBpcyBub3QKICAgICAgICAgICAgICAgICMgcm9vdCAob3Igb2xkIFVuaWNlcykgdGhleSB3b24ndCBiZSBhYmxlIHRvIGNob3duLgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBpZiBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICAjIHJlbmFtZSBtaWdodCBub3QgcHJlc2VydmUgY29udGV4dAogICAgICAgICAgICBzZWxmLnNldF9jb250ZXh0X2lmX2RpZmZlcmVudChkZXN0LCBjb250ZXh0LCBGYWxzZSkKCiAgICBkZWYgX3Vuc2FmZV93cml0ZXMoc2VsZiwgc3JjLCBkZXN0KToKICAgICAgICAjIHNhZGx5IHRoZXJlIGFyZSBzb21lIHNpdHVhdGlvbnMgd2hlcmUgd2UgY2Fubm90IGVuc3VyZSBhdG9taWNpdHksIGJ1dCBvbmx5IGlmCiAgICAgICAgIyB0aGUgdXNlciBpbnNpc3RzIGFuZCB3ZSBnZXQgdGhlIGFwcHJvcHJpYXRlIGVycm9yIHdlIHVwZGF0ZSB0aGUgZmlsZSB1bnNhZmVseQogICAgICAgIHRyeToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3V0X2Rlc3QgPSBvcGVuKGRlc3QsICd3YicpCiAgICAgICAgICAgICAgICBpbl9zcmMgPSBvcGVuKHNyYywgJ3JiJykKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZW9iaihpbl9zcmMsIG91dF9kZXN0KQogICAgICAgICAgICBmaW5hbGx5OiAgIyBhc3N1cmluZyBjbG9zZWQgZmlsZXMgaW4gMi40IGNvbXBhdGlibGUgd2F5CiAgICAgICAgICAgICAgICBpZiBvdXRfZGVzdDoKICAgICAgICAgICAgICAgICAgICBvdXRfZGVzdC5jbG9zZSgpCiAgICAgICAgICAgICAgICBpZiBpbl9zcmM6CiAgICAgICAgICAgICAgICAgICAgaW5fc3JjLmNsb3NlKCkKICAgICAgICBleGNlcHQgKHNodXRpbC5FcnJvciwgT1NFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSdDb3VsZCBub3Qgd3JpdGUgZGF0YSB0byBmaWxlICglcykgZnJvbSAoJXMpOiAlcycgJSAoZGVzdCwgc3JjLCBlKSwgZXhjZXB0aW9uPXRyYWNlYmFjay5mb3JtYXRfZXhjKCkpCgoKICAgIGRlZiBfcmVhZF9mcm9tX3BpcGVzKHNlbGYsIHJwaXBlcywgcmZkcywgZmlsZV9kZXNjcmlwdG9yKToKICAgICAgICBkYXRhID0gYignJykKICAgICAgICBpZiBmaWxlX2Rlc2NyaXB0b3IgaW4gcmZkczoKICAgICAgICAgICAgZGF0YSA9IG9zLnJlYWQoZmlsZV9kZXNjcmlwdG9yLmZpbGVubygpLCA5MDAwKQogICAgICAgICAgICBpZiBkYXRhID09IGIoJycpOgogICAgICAgICAgICAgICAgcnBpcGVzLnJlbW92ZShmaWxlX2Rlc2NyaXB0b3IpCgogICAgICAgIHJldHVybiBkYXRhCgogICAgZGVmIHJ1bl9jb21tYW5kKHNlbGYsIGFyZ3MsIGNoZWNrX3JjPUZhbHNlLCBjbG9zZV9mZHM9VHJ1ZSwgZXhlY3V0YWJsZT1Ob25lLCBkYXRhPU5vbmUsIGJpbmFyeV9kYXRhPUZhbHNlLCBwYXRoX3ByZWZpeD1Ob25lLCBjd2Q9Tm9uZSwKICAgICAgICAgICAgICAgICAgICB1c2VfdW5zYWZlX3NoZWxsPUZhbHNlLCBwcm9tcHRfcmVnZXg9Tm9uZSwgZW52aXJvbl91cGRhdGU9Tm9uZSwgdW1hc2s9Tm9uZSwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0Jyk6CiAgICAgICAgJycnCiAgICAgICAgRXhlY3V0ZSBhIGNvbW1hbmQsIHJldHVybnMgcmMsIHN0ZG91dCwgYW5kIHN0ZGVyci4KCiAgICAgICAgOmFyZyBhcmdzOiBpcyB0aGUgY29tbWFuZCB0byBydW4KICAgICAgICAgICAgKiBJZiBhcmdzIGlzIGEgbGlzdCwgdGhlIGNvbW1hbmQgd2lsbCBiZSBydW4gd2l0aCBzaGVsbD1GYWxzZS4KICAgICAgICAgICAgKiBJZiBhcmdzIGlzIGEgc3RyaW5nIGFuZCB1c2VfdW5zYWZlX3NoZWxsPUZhbHNlIGl0IHdpbGwgc3BsaXQgYXJncyB0byBhIGxpc3QgYW5kIHJ1biB3aXRoIHNoZWxsPUZhbHNlCiAgICAgICAgICAgICogSWYgYXJncyBpcyBhIHN0cmluZyBhbmQgdXNlX3Vuc2FmZV9zaGVsbD1UcnVlIGl0IHJ1bnMgd2l0aCBzaGVsbD1UcnVlLgogICAgICAgIDprdyBjaGVja19yYzogV2hldGhlciB0byBjYWxsIGZhaWxfanNvbiBpbiBjYXNlIG9mIG5vbiB6ZXJvIFJDLgogICAgICAgICAgICBEZWZhdWx0IEZhbHNlCiAgICAgICAgOmt3IGNsb3NlX2ZkczogU2VlIGRvY3VtZW50YXRpb24gZm9yIHN1YnByb2Nlc3MuUG9wZW4oKS4gRGVmYXVsdCBUcnVlCiAgICAgICAgOmt3IGV4ZWN1dGFibGU6IFNlZSBkb2N1bWVudGF0aW9uIGZvciBzdWJwcm9jZXNzLlBvcGVuKCkuIERlZmF1bHQgTm9uZQogICAgICAgIDprdyBkYXRhOiBJZiBnaXZlbiwgaW5mb3JtYXRpb24gdG8gd3JpdGUgdG8gdGhlIHN0ZGluIG9mIHRoZSBjb21tYW5kCiAgICAgICAgOmt3IGJpbmFyeV9kYXRhOiBJZiBGYWxzZSwgYXBwZW5kIGEgbmV3bGluZSB0byB0aGUgZGF0YS4gIERlZmF1bHQgRmFsc2UKICAgICAgICA6a3cgcGF0aF9wcmVmaXg6IElmIGdpdmVuLCBhZGRpdGlvbmFsIHBhdGggdG8gZmluZCB0aGUgY29tbWFuZCBpbi4KICAgICAgICAgICAgVGhpcyBhZGRzIHRvIHRoZSBQQVRIIGVudmlyb25tZW50IHZhaXJhYmxlIHNvIGhlbHBlciBjb21tYW5kcyBpbgogICAgICAgICAgICB0aGUgc2FtZSBkaXJlY3RvcnkgY2FuIGFsc28gYmUgZm91bmQKICAgICAgICA6a3cgY3dkOiBJZiBnaXZlbiwgd29ya2luZyBkaXJlY3RvcnkgdG8gcnVuIHRoZSBjb21tYW5kIGluc2lkZQogICAgICAgIDprdyB1c2VfdW5zYWZlX3NoZWxsOiBTZWUgYGFyZ3NgIHBhcmFtZXRlci4gIERlZmF1bHQgRmFsc2UKICAgICAgICA6a3cgcHJvbXB0X3JlZ2V4OiBSZWdleCBzdHJpbmcgKG5vdCBhIGNvbXBpbGVkIHJlZ2V4KSB3aGljaCBjYW4gYmUKICAgICAgICAgICAgdXNlZCB0byBkZXRlY3QgcHJvbXB0cyBpbiB0aGUgc3Rkb3V0IHdoaWNoIHdvdWxkIG90aGVyd2lzZSBjYXVzZQogICAgICAgICAgICB0aGUgZXhlY3V0aW9uIHRvIGhhbmcgKGVzcGVjaWFsbHkgaWYgbm8gaW5wdXQgZGF0YSBpcyBzcGVjaWZpZWQpCiAgICAgICAgOmt3IGVudmlyb25fdXBkYXRlOiBkaWN0aW9uYXJ5IHRvICp1cGRhdGUqIG9zLmVudmlyb24gd2l0aAogICAgICAgIDprdyB1bWFzazogVW1hc2sgdG8gYmUgdXNlZCB3aGVuIHJ1bm5pbmcgdGhlIGNvbW1hbmQuIERlZmF1bHQgTm9uZQogICAgICAgIDprdyBlbmNvZGluZzogU2luY2Ugd2UgcmV0dXJuIG5hdGl2ZSBzdHJpbmdzLCBvbiBweXRob24zIHdlIG5lZWQgdG8KICAgICAgICAgICAga25vdyB0aGUgZW5jb2RpbmcgdG8gdXNlIHRvIHRyYW5zZm9ybSBmcm9tIGJ5dGVzIHRvIHRleHQuICBJZiB5b3UKICAgICAgICAgICAgd2FudCB0byBhbHdheXMgZ2V0IGJ5dGVzIGJhY2ssIHVzZSBlbmNvZGluZz1Ob25lLiAgVGhlIGRlZmF1bHQgaXMKICAgICAgICAgICAgInV0Zi04Ii4gIFRoaXMgZG9lcyBub3QgYWZmZWN0IHRyYW5zZm9ybWF0aW9uIG9mIHN0cmluZ3MgZ2l2ZW4gYXMKICAgICAgICAgICAgYXJncy4KICAgICAgICA6a3cgZXJyb3JzOiBTaW5jZSB3ZSByZXR1cm4gbmF0aXZlIHN0cmluZ3MsIG9uIHB5dGhvbjMgd2UgbmVlZCB0bwogICAgICAgICAgICB0cmFuc2Zvcm0gc3Rkb3V0IGFuZCBzdGRlcnIgZnJvbSBieXRlcyB0byB0ZXh0LiAgSWYgdGhlIGJ5dGVzIGFyZQogICAgICAgICAgICB1bmRlY29kYWJsZSBpbiB0aGUgYGBlbmNvZGluZ2BgIHNwZWNpZmllZCwgdGhlbiB1c2UgdGhpcyBlcnJvcgogICAgICAgICAgICBoYW5kbGVyIHRvIGRlYWwgd2l0aCB0aGVtLiAgVGhlIGRlZmF1bHQgaXMgYGBzdXJyb2dhdGVfb3Jfc3RyaWN0YGAKICAgICAgICAgICAgd2hpY2ggbWVhbnMgdGhhdCB0aGUgYnl0ZXMgd2lsbCBiZSBkZWNvZGVkIHVzaW5nIHRoZQogICAgICAgICAgICBzdXJyb2dhdGVlc2NhcGUgZXJyb3IgaGFuZGxlciBpZiBhdmFpbGFibGUgKGF2YWlsYWJsZSBvbiBhbGwKICAgICAgICAgICAgcHl0aG9uMyB2ZXJzaW9ucyB3ZSBzdXBwb3J0KSBvdGhlcndpc2UgYSBVbmljb2RlRXJyb3IgdHJhY2ViYWNrCiAgICAgICAgICAgIHdpbGwgYmUgcmFpc2VkLiAgVGhpcyBkb2VzIG5vdCBhZmZlY3QgdHJhbnNmb3JtYXRpb25zIG9mIHN0cmluZ3MKICAgICAgICAgICAgZ2l2ZW4gYXMgYXJncy4KICAgICAgICA6cmV0dXJuczogQSAzLXR1cGxlIG9mIHJldHVybiBjb2RlIChpbnRlZ2VyKSwgc3Rkb3V0IChuYXRpdmUgc3RyaW5nKSwKICAgICAgICAgICAgYW5kIHN0ZGVyciAobmF0aXZlIHN0cmluZykuICBPbiBweXRob24yLCBzdGRvdXQgYW5kIHN0ZGVyciBhcmUgYm90aAogICAgICAgICAgICBieXRlIHN0cmluZ3MuICBPbiBweXRob24zLCBzdGRvdXQgYW5kIHN0ZGVyciBhcmUgdGV4dCBzdHJpbmdzIGNvbnZlcnRlZAogICAgICAgICAgICBhY2NvcmRpbmcgdG8gdGhlIGVuY29kaW5nIGFuZCBlcnJvcnMgcGFyYW1ldGVycy4gIElmIHlvdSB3YW50IGJ5dGUKICAgICAgICAgICAgc3RyaW5ncyBvbiBweXRob24zLCB1c2UgZW5jb2Rpbmc9Tm9uZSB0byB0dXJuIGRlY29kaW5nIHRvIHRleHQgb2ZmLgogICAgICAgICcnJwoKICAgICAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIGxpc3QpOgogICAgICAgICAgICBpZiB1c2VfdW5zYWZlX3NoZWxsOgogICAgICAgICAgICAgICAgYXJncyA9ICIgIi5qb2luKFtzaGxleF9xdW90ZSh4KSBmb3IgeCBpbiBhcmdzXSkKICAgICAgICAgICAgICAgIHNoZWxsID0gVHJ1ZQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShhcmdzLCAoYmluYXJ5X3R5cGUsIHRleHRfdHlwZSkpIGFuZCB1c2VfdW5zYWZlX3NoZWxsOgogICAgICAgICAgICBzaGVsbCA9IFRydWUKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoYXJncywgKGJpbmFyeV90eXBlLCB0ZXh0X3R5cGUpKToKICAgICAgICAgICAgaWYgbm90IHVzZV91bnNhZmVfc2hlbGw6CiAgICAgICAgICAgICAgICAjIE9uIHB5dGhvbjIuNiBhbmQgYmVsb3csIHNobGV4IGhhcyBwcm9ibGVtcyB3aXRoIHRleHQgdHlwZQogICAgICAgICAgICAgICAgIyBPbiBweXRob24zLCBzaGxleCBuZWVkcyBhIHRleHQgdHlwZS4KICAgICAgICAgICAgICAgIGlmIFBZMjoKICAgICAgICAgICAgICAgICAgICBhcmdzID0gdG9fYnl0ZXMoYXJncywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICAgICAgICAgIGVsaWYgUFkzOgogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSB0b190ZXh0KGFyZ3MsIGVycm9ycz0nc3Vycm9nYXRlZXNjYXBlJykKICAgICAgICAgICAgICAgIGFyZ3MgPSBzaGxleC5zcGxpdChhcmdzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG1zZyA9ICJBcmd1bWVudCAnYXJncycgdG8gcnVuX2NvbW1hbmQgbXVzdCBiZSBsaXN0IG9yIHN0cmluZyIKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocmM9MjU3LCBjbWQ9YXJncywgbXNnPW1zZykKCiAgICAgICAgc2hlbGwgPSBGYWxzZQogICAgICAgIGlmIHVzZV91bnNhZmVfc2hlbGw6CiAgICAgICAgICAgIGlmIGV4ZWN1dGFibGUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGV4ZWN1dGFibGUgPSBvcy5lbnZpcm9uLmdldCgnU0hFTEwnKQogICAgICAgICAgICBpZiBleGVjdXRhYmxlOgogICAgICAgICAgICAgICAgYXJncyA9IFtleGVjdXRhYmxlLCAnLWMnLCBhcmdzXQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2hlbGwgPSBUcnVlCgogICAgICAgIHByb21wdF9yZSA9IE5vbmUKICAgICAgICBpZiBwcm9tcHRfcmVnZXg6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocHJvbXB0X3JlZ2V4LCB0ZXh0X3R5cGUpOgogICAgICAgICAgICAgICAgaWYgUFkzOgogICAgICAgICAgICAgICAgICAgIHByb21wdF9yZWdleCA9IHRvX2J5dGVzKHByb21wdF9yZWdleCwgZXJyb3JzPSdzdXJyb2dhdGVlc2NhcGUnKQogICAgICAgICAgICAgICAgZWxpZiBQWTI6CiAgICAgICAgICAgICAgICAgICAgcHJvbXB0X3JlZ2V4ID0gdG9fYnl0ZXMocHJvbXB0X3JlZ2V4LCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwcm9tcHRfcmUgPSByZS5jb21waWxlKHByb21wdF9yZWdleCwgcmUuTVVMVElMSU5FKQogICAgICAgICAgICBleGNlcHQgcmUuZXJyb3I6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9ImludmFsaWQgcHJvbXB0IHJlZ3VsYXIgZXhwcmVzc2lvbiBnaXZlbiB0byBydW5fY29tbWFuZCIpCgogICAgICAgICMgZXhwYW5kIHRoaW5ncyBsaWtlICRIT01FIGFuZCB+CiAgICAgICAgaWYgbm90IHNoZWxsOgogICAgICAgICAgICBhcmdzID0gWyBvcy5wYXRoLmV4cGFuZHVzZXIob3MucGF0aC5leHBhbmR2YXJzKHgpKSBmb3IgeCBpbiBhcmdzIGlmIHggaXMgbm90IE5vbmUgXQoKICAgICAgICByYyA9IDAKICAgICAgICBtc2cgPSBOb25lCiAgICAgICAgc3RfaW4gPSBOb25lCgogICAgICAgICMgTWFuaXB1bGF0ZSB0aGUgZW52aXJvbiB3ZSdsbCBzZW5kIHRvIHRoZSBuZXcgcHJvY2VzcwogICAgICAgIG9sZF9lbnZfdmFscyA9IHt9CiAgICAgICAgIyBXZSBjYW4gc2V0IHRoaXMgZnJvbSBib3RoIGFuIGF0dHJpYnV0ZSBhbmQgcGVyIGNhbGwKICAgICAgICBmb3Iga2V5LCB2YWwgaW4gc2VsZi5ydW5fY29tbWFuZF9lbnZpcm9uX3VwZGF0ZS5pdGVtcygpOgogICAgICAgICAgICBvbGRfZW52X3ZhbHNba2V5XSA9IG9zLmVudmlyb24uZ2V0KGtleSwgTm9uZSkKICAgICAgICAgICAgb3MuZW52aXJvbltrZXldID0gdmFsCiAgICAgICAgaWYgZW52aXJvbl91cGRhdGU6CiAgICAgICAgICAgIGZvciBrZXksIHZhbCBpbiBlbnZpcm9uX3VwZGF0ZS5pdGVtcygpOgogICAgICAgICAgICAgICAgb2xkX2Vudl92YWxzW2tleV0gPSBvcy5lbnZpcm9uLmdldChrZXksIE5vbmUpCiAgICAgICAgICAgICAgICBvcy5lbnZpcm9uW2tleV0gPSB2YWwKICAgICAgICBpZiBwYXRoX3ByZWZpeDoKICAgICAgICAgICAgb2xkX2Vudl92YWxzWydQQVRIJ10gPSBvcy5lbnZpcm9uWydQQVRIJ10KICAgICAgICAgICAgb3MuZW52aXJvblsnUEFUSCddID0gIiVzOiVzIiAlIChwYXRoX3ByZWZpeCwgb3MuZW52aXJvblsnUEFUSCddKQoKICAgICAgICAjIElmIHVzaW5nIHRlc3QtbW9kdWxlIGFuZCBleHBsb2RlLCB0aGUgcmVtb3RlIGxpYiBwYXRoIHdpbGwgcmVzZW1ibGUgLi4uCiAgICAgICAgIyAgIC90bXAvdGVzdF9tb2R1bGVfc2NyYXRjaC9kZWJ1Z19kaXIvYW5zaWJsZS9tb2R1bGVfdXRpbHMvYmFzaWMucHkKICAgICAgICAjIElmIHVzaW5nIGFuc2libGUgb3IgYW5zaWJsZS1wbGF5Ym9vayB3aXRoIGEgcmVtb3RlIHN5c3RlbSAuLi4KICAgICAgICAjICAgL3RtcC9hbnNpYmxlX3Ztd2VMUS9hbnNpYmxlX21vZGxpYi56aXAvYW5zaWJsZS9tb2R1bGVfdXRpbHMvYmFzaWMucHkKCiAgICAgICAgIyBDbGVhbiBvdXQgcHl0aG9uIHBhdGhzIHNldCBieSBhbnNpYmFsbHoKICAgICAgICBpZiAnUFlUSE9OUEFUSCcgaW4gb3MuZW52aXJvbjoKICAgICAgICAgICAgcHlwYXRocyA9IG9zLmVudmlyb25bJ1BZVEhPTlBBVEgnXS5zcGxpdCgnOicpCiAgICAgICAgICAgIHB5cGF0aHMgPSBbeCBmb3IgeCBpbiBweXBhdGhzIFwKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHguZW5kc3dpdGgoJy9hbnNpYmxlX21vZGxpYi56aXAnKSBcCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBub3QgeC5lbmRzd2l0aCgnL2RlYnVnX2RpcicpXQogICAgICAgICAgICBvcy5lbnZpcm9uWydQWVRIT05QQVRIJ10gPSAnOicuam9pbihweXBhdGhzKQogICAgICAgICAgICBpZiBub3Qgb3MuZW52aXJvblsnUFlUSE9OUEFUSCddOgogICAgICAgICAgICAgICAgZGVsIG9zLmVudmlyb25bJ1BZVEhPTlBBVEgnXQoKICAgICAgICAjIGNyZWF0ZSBhIHByaW50YWJsZSB2ZXJzaW9uIG9mIHRoZSBjb21tYW5kIGZvciB1c2UKICAgICAgICAjIGluIHJlcG9ydGluZyBsYXRlciwgd2hpY2ggc3RyaXBzIG91dCB0aGluZ3MgbGlrZQogICAgICAgICMgcGFzc3dvcmRzIGZyb20gdGhlIGFyZ3MgbGlzdAogICAgICAgIHRvX2NsZWFuX2FyZ3MgPSBhcmdzCiAgICAgICAgaWYgUFkyOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIHRleHRfdHlwZSk6CiAgICAgICAgICAgICAgICB0b19jbGVhbl9hcmdzID0gdG9fYnl0ZXMoYXJncykKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFyZ3MsIGJpbmFyeV90eXBlKToKICAgICAgICAgICAgICAgIHRvX2NsZWFuX2FyZ3MgPSB0b190ZXh0KGFyZ3MpCiAgICAgICAgaWYgaXNpbnN0YW5jZShhcmdzLCAodGV4dF90eXBlLCBiaW5hcnlfdHlwZSkpOgogICAgICAgICAgICB0b19jbGVhbl9hcmdzID0gc2hsZXguc3BsaXQodG9fY2xlYW5fYXJncykKCiAgICAgICAgY2xlYW5fYXJncyA9IFtdCiAgICAgICAgaXNfcGFzc3dkID0gRmFsc2UKICAgICAgICBmb3IgYXJnIGluIHRvX2NsZWFuX2FyZ3M6CiAgICAgICAgICAgIGlmIGlzX3Bhc3N3ZDoKICAgICAgICAgICAgICAgIGlzX3Bhc3N3ZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBjbGVhbl9hcmdzLmFwcGVuZCgnKioqKioqKionKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgUEFTU1dEX0FSR19SRS5tYXRjaChhcmcpOgogICAgICAgICAgICAgICAgc2VwX2lkeCA9IGFyZy5maW5kKCc9JykKICAgICAgICAgICAgICAgIGlmIHNlcF9pZHggPiAtMToKICAgICAgICAgICAgICAgICAgICBjbGVhbl9hcmdzLmFwcGVuZCgnJXM9KioqKioqKionICUgYXJnWzpzZXBfaWR4XSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpc19wYXNzd2QgPSBUcnVlCiAgICAgICAgICAgIGFyZyA9IGhldXJpc3RpY19sb2dfc2FuaXRpemUoYXJnLCBzZWxmLm5vX2xvZ192YWx1ZXMpCiAgICAgICAgICAgIGNsZWFuX2FyZ3MuYXBwZW5kKGFyZykKICAgICAgICBjbGVhbl9hcmdzID0gJyAnLmpvaW4oc2hsZXhfcXVvdGUoYXJnKSBmb3IgYXJnIGluIGNsZWFuX2FyZ3MpCgogICAgICAgIGlmIGRhdGE6CiAgICAgICAgICAgIHN0X2luID0gc3VicHJvY2Vzcy5QSVBFCgogICAgICAgIGt3YXJncyA9IGRpY3QoCiAgICAgICAgICAgIGV4ZWN1dGFibGU9ZXhlY3V0YWJsZSwKICAgICAgICAgICAgc2hlbGw9c2hlbGwsCiAgICAgICAgICAgIGNsb3NlX2Zkcz1jbG9zZV9mZHMsCiAgICAgICAgICAgIHN0ZGluPXN0X2luLAogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICkKCiAgICAgICAgIyBzdG9yZSB0aGUgcHdkCiAgICAgICAgcHJldl9kaXIgPSBvcy5nZXRjd2QoKQoKICAgICAgICAjIG1ha2Ugc3VyZSB3ZSdyZSBpbiB0aGUgcmlnaHQgd29ya2luZyBkaXJlY3RvcnkKICAgICAgICBpZiBjd2QgYW5kIG9zLnBhdGguaXNkaXIoY3dkKToKICAgICAgICAgICAgY3dkID0gb3MucGF0aC5hYnNwYXRoKG9zLnBhdGguZXhwYW5kdXNlcihjd2QpKQogICAgICAgICAgICBrd2FyZ3NbJ2N3ZCddID0gY3dkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLmNoZGlyKGN3ZCkKICAgICAgICAgICAgZXhjZXB0IChPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHJjPWUuZXJybm8sIG1zZz0iQ291bGQgbm90IG9wZW4gJXMsICVzIiAlIChjd2QsIHN0cihlKSkpCgogICAgICAgIG9sZF91bWFzayA9IE5vbmUKICAgICAgICBpZiB1bWFzazoKICAgICAgICAgICAgb2xkX3VtYXNrID0gb3MudW1hc2sodW1hc2spCgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5fZGVidWc6CiAgICAgICAgICAgICAgICBzZWxmLmxvZygnRXhlY3V0aW5nOiAnICsgY2xlYW5fYXJncykKICAgICAgICAgICAgY21kID0gc3VicHJvY2Vzcy5Qb3BlbihhcmdzLCAqKmt3YXJncykKCiAgICAgICAgICAgICMgdGhlIGNvbW11bmljYXRpb24gbG9naWMgaGVyZSBpcyBlc3NlbnRpYWxseSB0YWtlbiBmcm9tIHRoYXQKICAgICAgICAgICAgIyBvZiB0aGUgX2NvbW11bmljYXRlKCkgZnVuY3Rpb24gaW4gc3NoLnB5CgogICAgICAgICAgICBzdGRvdXQgPSBiKCcnKQogICAgICAgICAgICBzdGRlcnIgPSBiKCcnKQogICAgICAgICAgICBycGlwZXMgPSBbY21kLnN0ZG91dCwgY21kLnN0ZGVycl0KCiAgICAgICAgICAgIGlmIGRhdGE6CiAgICAgICAgICAgICAgICBpZiBub3QgYmluYXJ5X2RhdGE6CiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSAnXG4nCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsIHRleHRfdHlwZSk6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHRvX2J5dGVzKGRhdGEpCiAgICAgICAgICAgICAgICBjbWQuc3RkaW4ud3JpdGUoZGF0YSkKICAgICAgICAgICAgICAgIGNtZC5zdGRpbi5jbG9zZSgpCgogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgcmZkcywgd2ZkcywgZWZkcyA9IHNlbGVjdC5zZWxlY3QocnBpcGVzLCBbXSwgcnBpcGVzLCAxKQogICAgICAgICAgICAgICAgc3Rkb3V0ICs9IHNlbGYuX3JlYWRfZnJvbV9waXBlcyhycGlwZXMsIHJmZHMsIGNtZC5zdGRvdXQpCiAgICAgICAgICAgICAgICBzdGRlcnIgKz0gc2VsZi5fcmVhZF9mcm9tX3BpcGVzKHJwaXBlcywgcmZkcywgY21kLnN0ZGVycikKICAgICAgICAgICAgICAgICMgaWYgd2UncmUgY2hlY2tpbmcgZm9yIHByb21wdHMsIGRvIGl0IG5vdwogICAgICAgICAgICAgICAgaWYgcHJvbXB0X3JlOgogICAgICAgICAgICAgICAgICAgIGlmIHByb21wdF9yZS5zZWFyY2goc3Rkb3V0KSBhbmQgbm90IGRhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVuY29kaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rkb3V0ID0gdG9fbmF0aXZlKHN0ZG91dCwgZW5jb2Rpbmc9ZW5jb2RpbmcsIGVycm9ycz1lcnJvcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQgPSBzdGRvdXQKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgyNTcsIHN0ZG91dCwgIkEgcHJvbXB0IHdhcyBlbmNvdW50ZXJlZCB3aGlsZSBydW5uaW5nIGEgY29tbWFuZCwgYnV0IG5vIGlucHV0IGRhdGEgd2FzIHNwZWNpZmllZCIpCiAgICAgICAgICAgICAgICAjIG9ubHkgYnJlYWsgb3V0IGlmIG5vIHBpcGVzIGFyZSBsZWZ0IHRvIHJlYWQgb3IKICAgICAgICAgICAgICAgICMgdGhlIHBpcGVzIGFyZSBjb21wbGV0ZWx5IHJlYWQgYW5kCiAgICAgICAgICAgICAgICAjIHRoZSBwcm9jZXNzIGlzIHRlcm1pbmF0ZWQKICAgICAgICAgICAgICAgIGlmIChub3QgcnBpcGVzIG9yIG5vdCByZmRzKSBhbmQgY21kLnBvbGwoKSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgIyBObyBwaXBlcyBhcmUgbGVmdCB0byByZWFkIGJ1dCBwcm9jZXNzIGlzIG5vdCB5ZXQgdGVybWluYXRlZAogICAgICAgICAgICAgICAgIyBPbmx5IHRoZW4gaXQgaXMgc2FmZSB0byB3YWl0IGZvciB0aGUgcHJvY2VzcyB0byBiZSBmaW5pc2hlZAogICAgICAgICAgICAgICAgIyBOT1RFOiBBY3R1YWxseSBjbWQucG9sbCgpIGlzIGFsd2F5cyBOb25lIGhlcmUgaWYgcnBpcGVzIGlzIGVtcHR5CiAgICAgICAgICAgICAgICBlbGlmIG5vdCBycGlwZXMgYW5kIGNtZC5wb2xsKCkgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBjbWQud2FpdCgpCiAgICAgICAgICAgICAgICAgICAgIyBUaGUgcHJvY2VzcyBpcyB0ZXJtaW5hdGVkLiBTaW5jZSBubyBwaXBlcyB0byByZWFkIGZyb20gYXJlCiAgICAgICAgICAgICAgICAgICAgIyBsZWZ0LCB0aGVyZSBpcyBubyBuZWVkIHRvIGNhbGwgc2VsZWN0KCkgYWdhaW4uCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGNtZC5zdGRvdXQuY2xvc2UoKQogICAgICAgICAgICBjbWQuc3RkZXJyLmNsb3NlKCkKCiAgICAgICAgICAgIHJjID0gY21kLnJldHVybmNvZGUKICAgICAgICBleGNlcHQgKE9TRXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgIHNlbGYubG9nKCJFcnJvciBFeGVjdXRpbmcgQ01EOiVzIEV4Y2VwdGlvbjolcyIgJSAoY2xlYW5fYXJncywgdG9fbmF0aXZlKGUpKSkKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocmM9ZS5lcnJubywgbXNnPXRvX25hdGl2ZShlKSwgY21kPWNsZWFuX2FyZ3MpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBzZWxmLmxvZygiRXJyb3IgRXhlY3V0aW5nIENNRDolcyBFeGNlcHRpb246JXMiICUgKGNsZWFuX2FyZ3MsdG9fbmF0aXZlKHRyYWNlYmFjay5mb3JtYXRfZXhjKCkpKSkKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocmM9MjU3LCBtc2c9dG9fbmF0aXZlKGUpLCBleGNlcHRpb249dHJhY2ViYWNrLmZvcm1hdF9leGMoKSwgY21kPWNsZWFuX2FyZ3MpCgogICAgICAgICMgUmVzdG9yZSBlbnYgc2V0dGluZ3MKICAgICAgICBmb3Iga2V5LCB2YWwgaW4gb2xkX2Vudl92YWxzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIHZhbCBpcyBOb25lOgogICAgICAgICAgICAgICAgZGVsIG9zLmVudmlyb25ba2V5XQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgb3MuZW52aXJvbltrZXldID0gdmFsCgogICAgICAgIGlmIG9sZF91bWFzazoKICAgICAgICAgICAgb3MudW1hc2sob2xkX3VtYXNrKQoKICAgICAgICBpZiByYyAhPSAwIGFuZCBjaGVja19yYzoKICAgICAgICAgICAgbXNnID0gaGV1cmlzdGljX2xvZ19zYW5pdGl6ZShzdGRlcnIucnN0cmlwKCksIHNlbGYubm9fbG9nX3ZhbHVlcykKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24oY21kPWNsZWFuX2FyZ3MsIHJjPXJjLCBzdGRvdXQ9c3Rkb3V0LCBzdGRlcnI9c3RkZXJyLCBtc2c9bXNnKQoKICAgICAgICAjIHJlc2V0IHRoZSBwd2QKICAgICAgICBvcy5jaGRpcihwcmV2X2RpcikKCiAgICAgICAgaWYgZW5jb2RpbmcgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIHJldHVybiAocmMsIHRvX25hdGl2ZShzdGRvdXQsIGVuY29kaW5nPWVuY29kaW5nLCBlcnJvcnM9ZXJyb3JzKSwKICAgICAgICAgICAgICAgICAgICB0b19uYXRpdmUoc3RkZXJyLCBlbmNvZGluZz1lbmNvZGluZywgZXJyb3JzPWVycm9ycykpCiAgICAgICAgcmV0dXJuIChyYywgc3Rkb3V0LCBzdGRlcnIpCgogICAgZGVmIGFwcGVuZF90b19maWxlKHNlbGYsIGZpbGVuYW1lLCBzdHIpOgogICAgICAgIGZpbGVuYW1lID0gb3MucGF0aC5leHBhbmR2YXJzKG9zLnBhdGguZXhwYW5kdXNlcihmaWxlbmFtZSkpCiAgICAgICAgZmggPSBvcGVuKGZpbGVuYW1lLCAnYScpCiAgICAgICAgZmgud3JpdGUoc3RyKQogICAgICAgIGZoLmNsb3NlKCkKCiAgICBkZWYgYnl0ZXNfdG9faHVtYW4oc2VsZiwgc2l6ZSk6CiAgICAgICAgcmV0dXJuIGJ5dGVzX3RvX2h1bWFuKHNpemUpCgogICAgIyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKICAgIHByZXR0eV9ieXRlcyA9IGJ5dGVzX3RvX2h1bWFuCgogICAgZGVmIGh1bWFuX3RvX2J5dGVzKHNlbGYsIG51bWJlciwgaXNiaXRzPUZhbHNlKToKICAgICAgICByZXR1cm4gaHVtYW5fdG9fYnl0ZXMobnVtYmVyLCBpc2JpdHMpCgogICAgIwogICAgIyBCYWNrd2FyZHMgY29tcGF0CiAgICAjCgogICAgIyBJbiAyLjAsIG1vdmVkIGZyb20gaW5zaWRlIHRoZSBtb2R1bGUgdG8gdGhlIHRvcGxldmVsCiAgICBpc19leGVjdXRhYmxlID0gaXNfZXhlY3V0YWJsZQoKCmRlZiBnZXRfbW9kdWxlX3BhdGgoKToKICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5yZWFscGF0aChfX2ZpbGVfXykpClBLAwQUAAAAAADguytLXozuKdgLAgDYCwIAHAAAAGFuc2libGUvbW9kdWxlX3V0aWxzL2Nub3MucHkjIFRoaXMgY29kZSBpcyBwYXJ0IG9mIEFuc2libGUsIGJ1dCBpcyBhbiBpbmRlcGVuZGVudCBjb21wb25lbnQuCiMgVGhpcyBwYXJ0aWN1bGFyIGZpbGUgc25pcHBldCwgYW5kIHRoaXMgZmlsZSBzbmlwcGV0IG9ubHksIGlzIEJTRCBsaWNlbnNlZC4KIyBNb2R1bGVzIHlvdSB3cml0ZSB1c2luZyB0aGlzIHNuaXBwZXQsIHdoaWNoIGlzIGVtYmVkZGVkIGR5bmFtaWNhbGx5IGJ5CiMgQW5zaWJsZSBzdGlsbCBiZWxvbmcgdG8gdGhlIGF1dGhvciBvZiB0aGUgbW9kdWxlLCBhbmQgbWF5IGFzc2lnbiB0aGVpciBvd24KIyBsaWNlbnNlIHRvIHRoZSBjb21wbGV0ZSB3b3JrLgojCiMgQ29weXJpZ2h0IChDKSAyMDE3IExlbm92bywgSW5jLgojIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiMKIyBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKIyBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKIwojICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiMgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKIyAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiMgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKIyBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiMgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKIyBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFCiMgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgojIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GCiMgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiMgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KIyBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKQojIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFCiMgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiMKIyBDb250YWlucyB1dGlsaXR5IG1ldGhvZHMKIyBMZW5vdm8gTmV0d29ya2luZwoKaW1wb3J0IHRpbWUKaW1wb3J0IGZ0cGxpYgppbXBvcnQgc29ja2V0CmltcG9ydCByZQp0cnk6CiAgICBpbXBvcnQgY25vc19lcnJvcmNvZGVzCiAgICBpbXBvcnQgY25vc19kZXZpY2VydWxlcwogICAgSEFTX0xJQiA9IFRydWUKZXhjZXB0OgogICAgSEFTX0xJQiA9IEZhbHNlCmZyb20gZGlzdHV0aWxzLmNtZCBpbXBvcnQgQ29tbWFuZAoKCmRlZiBpbnRlcmZhY2VDb25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgaW50ZXJmYWNlQXJnMSwKICAgICAgICBpbnRlcmZhY2VBcmcyLCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LCBpbnRlcmZhY2VBcmc1LAogICAgICAgIGludGVyZmFjZUFyZzYsIGludGVyZmFjZUFyZzcsIGludGVyZmFjZUFyZzgsIGludGVyZmFjZUFyZzkpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiaW50ZXJmYWNlICIKICAgIG5ld1Byb21wdCA9IHByb21wdAogICAgaWYoaW50ZXJmYWNlQXJnMSA9PSAicG9ydC1hZ2dyZWdhdGlvbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiAiICsgaW50ZXJmYWNlQXJnMSArICIgIiArIGludGVyZmFjZUFyZzIgKyAiXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaW50ZXJmYWNlX3ZhbHVlIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYpIyIKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIG5ld1Byb21wdCwgdGltZW91dCwgb2JqKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2ludGVyZmFjZV9yYW5nZSIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYtcmFuZ2UpIyIKICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaW50ZXJmYWNlX3N0cmluZyIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZi1yYW5nZSkjIgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIG5ld1Byb21wdCwgdGltZW91dCwgb2JqKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTAyIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgaW50ZXJmYWNlTGV2ZWwyQ29uZmlnKAogICAgICAgICAgICBvYmosIGRldmljZVR5cGUsIG5ld1Byb21wdCwgdGltZW91dCwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNywgaW50ZXJmYWNlQXJnOCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnOSkKICAgIGVsaWYoaW50ZXJmYWNlQXJnMSA9PSAiZXRoZXJuZXQiKToKICAgICAgICAjIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlQXJnMSArICIgMS8iCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJldGhlcm5ldF9pbnRlcmZhY2VfdmFsdWUiLCBpbnRlcmZhY2VBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZikjIgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUFyZzEgKyAiIDEvIiArIGludGVyZmFjZUFyZzIgKyAiIFxuIgogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiZXRoZXJuZXRfaW50ZXJmYWNlX3JhbmdlIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIFwKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VBcmcxICsgIiAxLyIgKyBpbnRlcmZhY2VBcmcyICsgIiBcbiIKICAgICAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmLXJhbmdlKSMiCiAgICAgICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIG5ld1Byb21wdCwgdGltZW91dCwgb2JqKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImV0aGVybmV0X2ludGVyZmFjZV9zdHJpbmciLCBpbnRlcmZhY2VBcmcyKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUFyZzEgKyAiICIgKyBpbnRlcmZhY2VBcmcyICsgIlxuIgogICAgICAgICAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmLXJhbmdlKSMiCiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBpbnRlcmZhY2VMZXZlbDJDb25maWcoCiAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgbmV3UHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc1LCBpbnRlcmZhY2VBcmc2LCBpbnRlcmZhY2VBcmc3LCBpbnRlcmZhY2VBcmc4LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc5KQogICAgZWxpZihpbnRlcmZhY2VBcmcxID09ICJsb29wYmFjayIpOgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAibG9vcGJhY2tfaW50ZXJmYWNlX3ZhbHVlIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYpIyIKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VBcmcxICsgIiAiICsgaW50ZXJmYWNlQXJnMiArICJcbiIKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIG5ld1Byb21wdCwgdGltZW91dCwgb2JqKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBpbnRlcmZhY2VMZXZlbDJDb25maWcoCiAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgbmV3UHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc1LCBpbnRlcmZhY2VBcmc2LCBpbnRlcmZhY2VBcmc3LCBpbnRlcmZhY2VBcmc4LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc5KQogICAgZWxpZihpbnRlcmZhY2VBcmcxID09ICJtZ210Iik6CiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJtZ210X2ludGVyZmFjZV92YWx1ZSIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmKSMiCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlQXJnMSArICIgIiArIGludGVyZmFjZUFyZzIgKyAiXG4iCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBuZXdQcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTAyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgaW50ZXJmYWNlTGV2ZWwyQ29uZmlnKAogICAgICAgICAgICBvYmosIGRldmljZVR5cGUsIG5ld1Byb21wdCwgdGltZW91dCwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNywgaW50ZXJmYWNlQXJnOCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnOSkKICAgIGVsaWYoaW50ZXJmYWNlQXJnMSA9PSAidmxhbiIpOgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9pbnRlcmZhY2VfdmFsdWUiLCBpbnRlcmZhY2VBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZikjIgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUFyZzEgKyAiICIgKyBpbnRlcmZhY2VBcmcyICsgIlxuIgogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIHJldFZhbCA9IHJldFZhbCArIGludGVyZmFjZUxldmVsMkNvbmZpZygKICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBuZXdQcm9tcHQsIHRpbWVvdXQsIGludGVyZmFjZUFyZzMsIGludGVyZmFjZUFyZzQsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzUsIGludGVyZmFjZUFyZzYsIGludGVyZmFjZUFyZzcsIGludGVyZmFjZUFyZzgsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzkpCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBpbnRlcmZhY2VMZXZlbDJDb25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgaW50ZXJmYWNlTDJBcmcxLCBpbnRlcmZhY2VMMkFyZzIsCiAgICBpbnRlcmZhY2VMMkFyZzMsIGludGVyZmFjZUwyQXJnNCwgaW50ZXJmYWNlTDJBcmc1LCBpbnRlcmZhY2VMMkFyZzYsCiAgICAgICAgaW50ZXJmYWNlTDJBcmc3KToKICAgIHJldFZhbCA9ICIiCiAgICBjb21tYW5kID0gIiIKICAgIGlmKGludGVyZmFjZUwyQXJnMSA9PSAiYWdncmVnYXRpb24tZ3JvdXAiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJhZ2dyZWdhdGlvbi1ncm91cCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWdncmVnYXRpb25fZ3JvdXBfbm8iLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiBtb2RlICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWdncmVnYXRpb25fZ3JvdXBfbW9kZSIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwMCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJiZmQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJiZmQiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzIgPT0gImVjaG8iKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJpbnRlcnZhbCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfaW50ZXJ2YWwiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX21pbnJ4IiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgbWlucnggIiArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfIG11bHRpcGxpZXIiLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIG11bHRpcGxpZXIgIiArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzYiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM0IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImF1dGhlbnRpY2F0aW9uIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9hdXRoX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKChpbnRlcmZhY2VMMkFyZzMgPT0gImtleWVkLW1kNSIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzMgPT0gImtleWVkLXNoYTEiKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmczID09ICJtZXRpY3Vsb3VzLWtleWVkLW1kNSIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzMgPT0gIm1ldGljdWxvdXMta2V5ZWQtc2hhMSIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmczID09ICJzaW1wbGUiKSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9rZXlfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJrZXktY2hhaW4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9rZXlfY2hhaW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzQgPT0gImtleS1pZCIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9pZCIsIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIGtleSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9rZXlfbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzOSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiaXB2NCIgb3IgaW50ZXJmYWNlTDJBcmcyID09ICJpcHY2Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9pcHY0X29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiYXV0aGVudGljYXRpb24iKToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2F1dGhfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGludGVyZmFjZUwyQXJnNCA9PSAia2V5ZWQtbWQ1Iikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmc0ID09ICJrZXllZC1zaGExIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmc0ID09ICJtZXRpY3Vsb3VzLWtleWVkLW1kNSIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnNCA9PSAibWV0aWN1bG91cy1rZXllZC1zaGExIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnNCA9PSAic2ltcGxlIikpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9vcHRpb25zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNSArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzUgPT0gImtleS1jaGFpbiIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9rZXlfY2hhaW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNSA9PSAia2V5LWlkIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9pZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNiArICIga2V5ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9rZXlfbmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMyA9PSAiZWNobyIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczID09ICJpbnRlcnZhbCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfaW50ZXJ2YWwiLCBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfbWlucngiLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgbWlucnggIiArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkXyBtdWx0aXBsaWVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgbXVsdGlwbGllciAiICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM1IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICAjIE5vbmUgaXMgdGFrZW4gY2FyZSBoZXJlCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAibmVpZ2hib3IiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiBzcmMtaXAgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9uZWlnaGJvcl9pcCIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiBkZXN0LWlwICIKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9uZWlnaGJvcl9pcCIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc1IGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfbmVpZ2hib3Jfb3B0aW9ucyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzYgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigoaW50ZXJmYWNlTDJBcmc2ID09ICJhZG1pbi1kb3duIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmc2ID09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJub24tcGVyc2lzdGVudCIpKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNiArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKGludGVyZmFjZUwyQXJnNyBpcyBub3QgTm9uZSkgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzcgPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhZG1pbi1kb3duIikpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc3CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3NyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEVsc2UgaXMgbm90IHRoZXJlIGFyZSBpdHMgb3B0aW9uc2FsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEVsc2UgaXMgbm90IHRoZXJlIGFzIHRoaXMgaXMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICAgICAgIyBFbHNlIGlzIG5vdCB0aGVyZSBhcyB0aGlzIGlzIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MiIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA1IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDUiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImJyaWRnZS1wb3J0Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiYnJpZGdlLXBvcnQiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzIgaXMgTm9uZSk6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImFjY2VzcyIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgdmxhbiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9hY2Nlc3NfdmxhbiIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwMiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAibW9kZSIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfYnJpZGdlcG9ydF9tb2RlIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAzIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJ0cnVuayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ0cnVua19vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICBpZigoaW50ZXJmYWNlTDJBcmczID09ICJhbGxvd2VkIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnMyA9PSAibmF0aXZlIikpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgInZsYW4gIiAgIyBPbmx5IHBlcm1pdGluZyBvbmUgdmxhbiBpZAogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiYWxsIiBvciBpbnRlcmZhY2VMMkFyZzQgPT0gIm5vbmUiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAiYWRkIiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0ID09ICJyZW1vdmUiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQgPT0gIm5vbmUiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2FjY2Vzc192bGFuIiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9hY2Nlc3NfdmxhbiIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwMiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwNCIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDUiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImRlc2NyaXB0aW9uIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiZGVzY3JpcHRpb24iKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRDaF9kZXNjcmlwdGlvbiIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImR1cGxleCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImR1cGxleCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiZHVwbGV4X29wdGlvbiIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImZsb3djb250cm9sIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiZmxvd2NvbnRyb2wiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImZsb3djb250cm9sX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAib24iIG9yIGludGVyZmFjZUwyQXJnMyA9PSAib2ZmIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwOCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA5IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImlwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiaXAiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYWNjZXNzLWdyb3VwIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWNjZXNzZ3JvdXBfbmFtZSIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJpbiIgb3IgaW50ZXJmYWNlTDJBcmc0ID09ICJvdXQiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQ1IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDYiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYWRkcmVzcyIpOgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJkaGNwIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjQiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjQiLCBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNSA9PSAic2Vjb25kYXJ5Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc1IGlzIE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3OSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pcHY0X21hc2siLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gInNlY29uZGFyeSIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCBpcyBOb25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjc4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYXJwIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYXJwX2lwYWRkcmVzcyIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhcnBfbWFjYWRkcmVzcyIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQ3IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMyA9PSAidGltZW91dCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhcnBfdGltZW91dF92YWx1ZSIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQ4IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDkiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiZGhjcCIpOgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJjbGllbnQiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiY2xhc3MtaWQiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0IGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzQgPT0gInJlcXVlc3QiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc1ID09ICJib290ZmlsZS1uYW1lIiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSA9PSAiaG9zdC1uYW1lIiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSA9PSAibG9nLXNlcnZlciIgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUgPT0gInRmdHAtc2VydmVyLW5hbWUiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjUwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTEiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczID09ICJyZWxheSIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiBhZGRyZXNzICIKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInJlbGF5X2lwYWRkcmVzcyIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjUyIgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAib3NwZiIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImlwX29zcGZfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU0IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJwb3J0Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICJhY2Nlc3MtZ3JvdXAgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFjY2Vzc2dyb3VwX25hbWUiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgaW4iCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDYiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAicG9ydC11bnJlYWNoYWJsZSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJyZWRpcmVjdHMiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAicm91dGVyIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgMCAiCiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImFyZWEiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnMyA9PSAibXVsdGktYXJlYSIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJvc3BmX2lkX2RlY2ltYWxfdmFsdWUiLCBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAib3NwZl9pZF9pcGFkZHJlc192YWx1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTYiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInVucmVhY2hhYmxlcyIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDQiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0NCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiaXB2NiIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImlwdjYiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJhZGRyZXNzIik6CiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImRoY3AiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfYWRkcmVzcyIsCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJhbnljYXN0IiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNCA9PSAic2Vjb25kYXJ5IiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNCBpcyBOb25lKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjc2IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzUiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImRoY3AiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pcHY2X2RoY3AiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICJyZWxheSBhZGRyZXNzICIgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImV0aGVybmV0Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2Nl9kaGNwX2V0aGVybmV0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgaW50ZXJmYWNlIGV0aGVybmV0ICIgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjcxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzQgPT0gInZsYW4iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pcHY2X2RoY3BfdmxhbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIGludGVyZmFjZSB2bGFuICIgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjcyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjkiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImxpbmstbG9jYWwiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pcHY2X2xpbmtsb2NhbCIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAibmQiKToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJuZWlnaGJvciIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfbmVpZ2hib3JfYWRkcmVzcyIsCiAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfbmVpZ2hib3JfbWFjIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjciCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2OCIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjY2IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImxhY3AiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJsYWNwIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJsYWNwX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAicG9ydC1wcmlvcml0eSIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRfcHJpb3JpdHkiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjEwIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInN1c3BlbmQtaW5kaXZpZHVhbCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInRpbWVvdXQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImxvbmciIG9yIGludGVyZmFjZUwyQXJnMyA9PSAic2hvcnQiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjExIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTIiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAibGxkcCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImxsZHAiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImxsZHBfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJyZWNlaXZlIiBvcgogICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnMiA9PSAidHJhcC1ub3RpZmljYXRpb24iIG9yCiAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmcyID09ICJ0cmFuc21pdCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInRsdi1zZWxlY3QiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJsbGRwX3Rsdl9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxMyIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjE0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTQiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImxvYWQtaW50ZXJ2YWwiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJsb2FkLWludGVydmFsIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJsb2FkX2ludGVydmFsX2RlbGF5IiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAiY291bnRlciIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJsb2FkX2ludGVydmFsX2NvdW50ZXIiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibG9hZF9pbnRlcnZhbF9kZWxheSIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjE1IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTYiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxNyIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gIm1hYyIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm1hYyIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgcG9ydCBhY2Nlc3MtZ3JvdXAgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAibWFjX2FjY2Vzc2dyb3VwX25hbWUiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxOCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJtYWMtYWRkcmVzcyIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm1hYy1hZGRyZXNzIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJtYWNfYWRkcmVzcyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjE5IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJtYWMtbGVhcm4iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJtYWMtbGVhcm4iKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiIGRpc2FibGUiCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJtaWNyb2J1cnN0LWRldGVjdGlvbiIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm1pY3JvYnVyc3QtZGV0ZWN0aW9uIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiBlbmFibGUgdGhyZXNob2xkICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm1pY3JvYnVyc3RfdGhyZXNob2xkIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gIm10dSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm10dSIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJtdHVfdmFsdWUiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyMSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic2VydmljZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInNlcnZpY2UiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiIGluc3RhbmNlICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNlcnZpY2VfaW5zdGFuY2UiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic2VydmljZS1wb2xpY3kiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzZXJ2aWNlLXBvbGljeSIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAic2VydmljZV9wb2xpY3lfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJpbnB1dCIgb3IgaW50ZXJmYWNlTDJBcmcyID09ICJvdXRwdXQiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzZXJ2aWNlX3BvbGljeV9uYW1lIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyMyIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJjb3BwLXN5c3RlbS1wb2xpY3kiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgImNsYXNzIGFsbCIKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInR5cGUiIGFuZCBpbnRlcmZhY2VMMkFyZzMgPT0gInFvcyIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiaW5wdXQiIG9yIGludGVyZmFjZUwyQXJnNCA9PSAib3V0cHV0Iik6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzZXJ2aWNlX3BvbGljeV9uYW1lIiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjIzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInR5cGUiIGFuZCBpbnRlcmZhY2VMMkFyZzMgPT0gInF1ZXVpbmciKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImlucHV0IiBvciBpbnRlcmZhY2VMMkFyZzQgPT0gIm91dHB1dCIpOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic2VydmljZV9wb2xpY3lfbmFtZSIsIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyMyIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjI0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic2h1dGRvd24iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzaHV0ZG93biIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMQoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic25tcCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInNubXAiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICB0cmFwIGxpbmstc3RhdHVzICIKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gInNwYW5uaW5nLXRyZWUiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzcGFubmluZy10cmVlIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYnBkdWZpbHRlciIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiZW5hYmxlIiBvcgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMgPT0gImRpc2FibGUiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU3IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImJwZHVndWFyZCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiZW5hYmxlIiBvcgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMgPT0gImRpc2FibGUiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU4IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImNvc3QiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Bhbm5pbmdfdHJlZV9jb3N0IiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczID09ICJhdXRvIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1OSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJkaXNhYmxlIiBvciBpbnRlcmZhY2VMMkFyZzIgPT0gImVuYWJsZSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImd1YXJkIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJsb29wIiBvciBpbnRlcmZhY2VMMkFyZzMgPT0gInJvb3QiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjYwIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImxpbmstdHlwZSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiYXV0byIgb3IKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczID09ICJwb2ludC10by1wb2ludCIgb3IKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczID09ICJzaGFyZWQiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjYxIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJtc3QiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Bhbm5pbmdfdHJlZV9pbnRlcmZhY2VyYW5nZSIsCiAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImNvc3QiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Bhbm5pbmdfdHJlZV9jb3N0IiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc1ID09ICJhdXRvIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1OSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAicG9ydC1wcmlvcml0eSIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX3BvcnRwcmlvcml0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1OSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjYzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInBvcnQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiB0eXBlIGVkZ2UiCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJwb3J0LXByaW9yaXR5Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNwYW5uaW5nX3RyZWVfcG9ydHByaW9yaXR5IiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2NCIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidmxhbiIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2lkX3JhbmdlIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImNvc3QiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Bhbm5pbmdfdHJlZV9jb3N0IiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc1ID09ICJhdXRvIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2MyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAicG9ydC1wcmlvcml0eSIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX3BvcnRwcmlvcml0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2NCIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM0IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gInNwZWVkIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgic3BlZWQiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImludGVyZmFjZV9zcGVlZCIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjI1IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gInN0b3JtLWNvbnRyb2wiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzdG9ybS1jb250cm9sIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJzdG9ybWNvbnRyb2xfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiIGxldmVsICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Rvcm1jb250cm9sX2xldmVsIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyNiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjI3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJ2bGFuIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgidmxhbiIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgZG90MXEgdGFnIG5hdGl2ZSAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9kb3QxcV90YWciLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAiZWdyZXNzLW9ubHkiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBlbmFibGUiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyOCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAidnJycCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInZycnAiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidnJycF9pZCIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJpcHY2Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMyBpcyBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjkiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzMCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzMyIKICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAjIENvbWUgYmFjayB0byBjb25maWcgbW9kZQogICAgaWYoKHByb21wdCA9PSAiKGNvbmZpZy1pZikjIikgb3IgKHByb21wdCA9PSAiKGNvbmZpZy1pZi1yYW5nZSkjIikpOgogICAgICAgIGNvbW1hbmQgPSAiZXhpdCBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIihjb25maWcpIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIHBvcnRDaGFubmVsQ29uZmlnKAogICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBwb3J0Q2hBcmcxLCBwb3J0Q2hBcmcyLCBwb3J0Q2hBcmczLAogICAgICAgIHBvcnRDaEFyZzQsIHBvcnRDaEFyZzUsIHBvcnRDaEFyZzYsIHBvcnRDaEFyZzcpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiIgogICAgaWYocG9ydENoQXJnMSA9PSAicG9ydC1hZ2dyZWdhdGlvbiIgYW5kIHByb21wdCA9PSAiKGNvbmZpZykjIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBwb3J0Q2hBcmcxICsgIiBsb2FkLWJhbGFuY2UgZXRoZXJuZXQgIgogICAgICAgIGlmKHBvcnRDaEFyZzIgPT0gImRlc3RpbmF0aW9uLWlwIiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gImRlc3RpbmF0aW9uLW1hYyIgb3IKICAgICAgICAgICBwb3J0Q2hBcmcyID09ICJkZXN0aW5hdGlvbi1wb3J0IiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gInNvdXJjZS1kZXN0LWlwIiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gInNvdXJjZS1kZXN0LW1hYyIgb3IKICAgICAgICAgICBwb3J0Q2hBcmcyID09ICJzb3VyY2UtZGVzdC1wb3J0IiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gInNvdXJjZS1pbnRlcmZhY2UiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLWlwIiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gInNvdXJjZS1tYWMiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLXBvcnQiKToKCiAgICAgICAgICAgICMgZGVidWdPdXRwdXQocG9ydENoQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBwb3J0Q2hBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKHBvcnRDaEFyZzMgaXMgTm9uZSk6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIiCiAgICAgICAgICAgIGVsaWYocG9ydENoQXJnMyA9PSAic291cmNlLWludGVyZmFjZSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBwb3J0Q2hBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjMxIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiMgRU9NCgoKZGVmIHJvdXRlckNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBwcm90b2NvbCwgYXNOdW0sIHJvdXRlckFyZzEsCiAgICByb3V0ZXJBcmcyLCByb3V0ZXJBcmczLCByb3V0ZXJBcmc0LCByb3V0ZXJBcmc1LCByb3V0ZXJBcmc2LCByb3V0ZXJBcmc3LAogICAgICAgIHJvdXRlckFyZzgpOgogICAgcmV0VmFsID0gIiIKICAgICMgV2FpdCB0aW1lIHRvIGdldCByZXNwb25zZSBmcm9tIHNlcnZlcgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgIGlmKHByb3RvY29sID09ICJiZ3AiKToKICAgICAgICAjIGJncCBjb25maWcgY29tbWFuZCBoYXBwZW5zIGhlcmUuCiAgICAgICAgY29tbWFuZCA9ICJyb3V0aW5nLXByb3RvY29sIGJncCAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgImJncF9hc19udW1iZXIiLCBhc051bSkKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgIyBCR1AgY29tbWFuZCBoYXBwZW5zIGhlcmUuIEl0IGNyZWF0ZXMgaWYgbm90IHByZXNlbnQKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBhc051bSArICJcbiIKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgICAgICByZXRWYWwgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBjb21tYW5kLCAiKGNvbmZpZy1yb3V0ZXIpIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgYmdwQ29uZmlnKAogICAgICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy1yb3V0ZXIpIyIsIHRpbWVvdXQsIHJvdXRlckFyZzEsCiAgICAgICAgICAgICAgICByb3V0ZXJBcmcyLCByb3V0ZXJBcmczLCByb3V0ZXJBcmc0LCByb3V0ZXJBcmc1LCByb3V0ZXJBcmc2LAogICAgICAgICAgICAgICAgcm91dGVyQXJnNywgcm91dGVyQXJnOCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTc2IgoKICAgIGVsaWYocHJvdG9jb2wgPT0gIm9zcGYiKToKICAgICAgICByZXRWYWwgPSAiQ29tbWFuZCBWYWx1ZSBpcyBOb3Qgc3VwcG9ydGVkIGFzIG9mIG5vdyIKCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzciCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBiZ3BOZWlnaGJvckFGQ29uZmlnKAogICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIGJncE5laWdoYm9yQUZBcmcxLCBiZ3BOZWlnaGJvckFGQXJnMiwKICAgICAgICBiZ3BOZWlnaGJvckFGQXJnMyk6CiAgICByZXRWYWwgPSAiIgogICAgY29tbWFuZCA9ICIiCiAgICB0aW1lb3V0ID0gdGltZW91dAogICAgaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gImFsbG93YXMtaW4iKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwTmVpZ2hib3JBRkFyZzIgaXMgbm90IE5vbmUpOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfb2NjdXJhbmNlcyIsIGJncE5laWdoYm9yQUZBcmcyKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMjUiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gImRlZmF1bHQtb3JpZ2luYXRlIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIGlmKGJncE5laWdoYm9yQUZBcmcyIGlzIG5vdCBOb25lIGFuZCBiZ3BOZWlnaGJvckFGQXJnMiA9PSAicm91dGUtbWFwIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2FmX3JvdXRlbWFwIiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyNCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gImZpbHRlci1saXN0Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2FmX2ZpbHRlcm5hbWUiLCBiZ3BOZWlnaGJvckFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMiArICIgIgogICAgICAgICAgICBpZihiZ3BOZWlnaGJvckFGQXJnMyA9PSAiaW4iIG9yIGJncE5laWdoYm9yQUZBcmczID09ICJvdXQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMjMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gIm1heGltdW0tcHJlZml4Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2FmX21heHByZWZpeCIsIGJncE5laWdoYm9yQUZBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQUZBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyNiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gIm5leHQtaG9wLXNlbGYiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAicHJlZml4LWxpc3QiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfcHJlZml4bmFtZSIsIGJncE5laWdoYm9yQUZBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQUZBcmczID09ICJpbiIgb3IgYmdwTmVpZ2hib3JBRkFyZzMgPT0gIm91dCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyMSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzIwIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAicm91dGUtbWFwIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2FmX3JvdXRlbWFwIiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE5IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKGJncE5laWdoYm9yQUZBcmcxID09ICJyb3V0ZS1yZWZsZWN0b3ItY2xpZW50Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMQoKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gInNlbmQtY29tbXVuaXR5Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIGlmKGJncE5laWdoYm9yQUZBcmcyIGlzIG5vdCBOb25lIGFuZCBiZ3BOZWlnaGJvckFGQXJnMiA9PSAiZXh0ZW5kZWQiKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAic29mdC1yZWNvbmZpZ3VyYXRpb24iKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiBpbmJvdW5kIgoKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gInVuc3VwcHJlc3MtbWFwIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2FmX3JvdXRlbWFwIiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE4IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxzZToKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE3IgogICAgICAgIHJldHVybiByZXRWYWwKCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgIGNvbW1hbmQgPSAiZXhpdCBcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoCiAgICAgICAgICAgIGNvbW1hbmQsICIoY29uZmlnLXJvdXRlci1uZWlnaGJvcikjIiwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBiZ3BOZWlnaGJvckNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBiZ3BOZWlnaGJvckFyZzEsIGJncE5laWdoYm9yQXJnMiwKICAgICAgICBiZ3BOZWlnaGJvckFyZzMsIGJncE5laWdoYm9yQXJnNCwgYmdwTmVpZ2hib3JBcmc1KToKICAgIHJldFZhbCA9ICIiCiAgICBjb21tYW5kID0gIiIKICAgIHRpbWVvdXQgPSB0aW1lb3V0CgogICAgaWYoYmdwTmVpZ2hib3JBcmcxID09ICJhZGRyZXNzLWZhbWlseSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWRkcmVzc19mYW1pbHkiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyICsgIiB1bmljYXN0IFxuIgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgICAgIGNvbW1hbmQsICIoY29uZmlnLXJvdXRlci1uZWlnaGJvci1hZikjIiwgdGltZW91dCwgb2JqKQogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBiZ3BOZWlnaGJvckFGQ29uZmlnKAogICAgICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy1yb3V0ZXItbmVpZ2hib3ItYWYpIyIsIHRpbWVvdXQsCiAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzMsIGJncE5laWdoYm9yQXJnNCwgYmdwTmVpZ2hib3JBcmc1KQogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMxNiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJhZHZlcnRpc2VtZW50LWludGVydmFsIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAiYmZkIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICBpZihiZ3BOZWlnaGJvckFyZzIgaXMgbm90IE5vbmUgYW5kIGJncE5laWdoYm9yQXJnMiA9PSAibXV0aWhvcCIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImNvbm5lY3Rpb24tcmV0cnktdGltZSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfY29ubmVjdGlvbl9yZXRyeXRpbWUiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMxNSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJkZXNjcmlwdGlvbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfZGVzY3JpcHRpb24iLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMxNCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJkaXNhbGxvdy1pbmZpbml0ZS1ob2xkdGltZSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImRvbnQtY2FwYWJpbGl0eS1uZWdvdGlhdGUiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMQoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJkeW5hbWljLWNhcGFiaWxpdHkiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMQoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJlYmdwLW11bHRpaG9wIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9tYXhob3Bjb3VudCIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzEzIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAiaW50ZXJmYWNlIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICAjIFRCRAogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImxvY2FsLWFzIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9sb2NhbF9hcyIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIgKyAiICIKICAgICAgICAgICAgaWYoYmdwTmVpZ2hib3JBcmczIGlzIG5vdCBOb25lIGFuZAogICAgICAgICAgICAgICAgICAgIGJncE5laWdoYm9yQXJnMyA9PSAibm8tcHJlcGVuZCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzMgKyAiICIKICAgICAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQXJnNCBpcyBub3QgTm9uZSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgYmdwTmVpZ2hib3JBcmc0ID09ICJyZXBsYWNlLWFzIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICBpZihiZ3BOZWlnaGJvckFyZzUgaXMgbm90IE5vbmUgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzUgPT0gImR1YWwtYXMiKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzEyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gIm1heGltdW0tcGVlcnMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX21heHBlZXJzIiwgYmdwTmVpZ2hib3JBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTEiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAicGFzc3dvcmQiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX3Bhc3N3b3JkIiwgYmdwTmVpZ2hib3JBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAicmVtb3ZlLXByaXZhdGUtQVMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMQoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJ0aW1lcnMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX3RpbWVyc19LZWVwYWxpdmUiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl90aW1lcnNfaG9sZHRpbWUiLCBiZ3BOZWlnaGJvckFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMDkiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwOCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJ0cmFuc3BvcnQiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgY29ubmVjdGlvbi1tb2RlIHBhc3NpdmUgIgoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJ0dGwtc2VjdXJpdHkiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgaG9wcyAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfdHRsX2hvcHMiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwNyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJ1cGRhdGUtc291cmNlIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICBpZihiZ3BOZWlnaGJvckFyZzIgaXMgbm90IE5vbmUpOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfdXBkYXRlX29wdGlvbnMiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQXJnMiA9PSAiZXRoZXJuZXQiKToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl91cGRhdGVfZXRoZXJuZXQiLAogICAgICAgICAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzMpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmczCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwNCIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxpZihiZ3BOZWlnaGJvckFyZzIgPT0gImxvb3BiYWNrIik6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfdXBkYXRlX2xvb3BiYWNrIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmdwTmVpZ2hib3JBcmczKQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMwogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMDUiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfdXBkYXRlX3ZsYW4iLAogICAgICAgICAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzMpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmczCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwNiIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzAzIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gIndlaWdodCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3Jfd2VpZ2h0IiwgYmdwTmVpZ2hib3JBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMDIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0zMDEiCiAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgY29tbWFuZCA9ICJleGl0IFxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKGNvbmZpZy1yb3V0ZXIpIyIsIHRpbWVvdXQsIG9iaikKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgYmdwQUZDb25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgYmdwQUZBcmcxLCBiZ3BBRkFyZzIsIGJncEFGQXJnMywKICAgICAgICBiZ3BBRkFyZzQsIGJncEFGQXJnNSwgYmdwQUZBcmc2KToKICAgIHJldFZhbCA9ICIiCiAgICBjb21tYW5kID0gIiIKICAgIHRpbWVvdXQgPSB0aW1lb3V0CiAgICBpZihiZ3BBRkFyZzEgPT0gImFnZ3JlZ2F0ZS1hZGRyZXNzIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9hZ2dyZWdhdGVfcHJlZml4IiwgYmdwQUZBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMiArICIgIgogICAgICAgICAgICBpZihiZ3BBRkFyZzIgaXMgTm9uZSk6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICBlbGlmKGJncEFGQXJnMiA9PSAiYXMtc2V0IiBvciBiZ3BBRkFyZzIgPT0gInN1bW1hcnktb25seSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnMyBpcyBOb25lKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICAgICAgZWxpZihiZ3BBRkFyZzIgPT0gImFzLXNldCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgInN1bW1hcnktb25seSIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiYXMtc2V0IgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5NyIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjk2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKGJncEFGQXJnMSA9PSAiY2xpZW50LXRvLWNsaWVudCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiByZWZsZWN0aW9uICIKICAgIGVsaWYoYmdwQUZBcmcxID09ICJkYW1wZW5pbmciKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgIgogICAgICAgIGlmKGJncEFGQXJnMiA9PSAicm91dGUtbWFwIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFkZHJmYW1pbHlfcm91dGVtYXBfbmFtZSIsIGJncEFGQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmKGJncEFGQXJnMiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInJlYWNoYWJpbGl0eV9oYWxmX2xpZmUiLCBiZ3BBRkFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnMyBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUxID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3RhcnRfcmV1c2Vfcm91dGVfdmFsdWUiLCBiZ3BBRkFyZzMpCiAgICAgICAgICAgICAgICAgICAgdmFsdWUyID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3RhcnRfc3VwcHJlc3Nfcm91dGVfdmFsdWUiLCBiZ3BBRkFyZzQpCiAgICAgICAgICAgICAgICAgICAgdmFsdWUzID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibWF4X2R1cmF0aW9uX3RvX3N1cHByZXNzX3JvdXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgYmdwQUZBcmc1KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlMSA9PSAib2siIGFuZCB2YWx1ZTIgPT0gIm9rIiBhbmQgdmFsdWUzID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMyArICIgIiArIGJncEFGQXJnNCArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgIiArIGJncEFGQXJnNSArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihiZ3BBRkFyZzYgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidW5yZWFjaGFiaWxpdHlfaGFsZnRpbWVfZm9yX3BlbmFsdHkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJncEFGQXJnNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmc2CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5NSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5NCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFGQXJnMSA9PSAiZGlzdGFuY2UiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiZGlzdGFuY2VfZXh0ZXJuYWxfQVMiLCBiZ3BBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImRpc3RhbmNlX2ludGVybmFsX0FTIiwgYmdwQUZBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiZGlzdGFuY2VfbG9jYWxfcm91dGVzIiwgYmdwQUZBcmc0KQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5MSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjkyIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTMiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwQUZBcmcxID09ICJtYXhpbXVtLXBhdGhzIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAibWF4cGF0aF9vcHRpb24iLCBiZ3BBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm1heHBhdGhfbnVtYmVycyIsIGJncEFGQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5OSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjkwIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBRkFyZzEgPT0gIm5ldHdvcmsiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgIgogICAgICAgIGlmKGJncEFGQXJnMiA9PSAic3luY2hyb25pemF0aW9uIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibmV0d29ya19pcF9wcmVmaXhfd2l0aF9tYXNrIiwgYmdwQUZBcmcyKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgICAgICBpZihiZ3BBRkFyZzMgaXMgbm90IE5vbmUgYW5kIGJncEFGQXJnMyA9PSAiYmFja2Rvb3IiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICAgICAgZWxpZihiZ3BBRkFyZzMgaXMgbm90IE5vbmUgYW5kIGJncEFGQXJnMyA9PSAicm91dGUtbWFwIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzMKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFkZHJmYW1pbHlfcm91dGVtYXBfbmFtZSIsIGJncEFGQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYmdwQUZBcmc1IGlzIG5vdCBOb25lIGFuZCBiZ3BBRkFyZzUgPT0gImJhY2tkb29yIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5OCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTk2IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibmV0d29ya19pcF9wcmVmaXhfdmFsdWUiLCBiZ3BBRkFyZzIpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMiArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnMyBpcyBub3QgTm9uZSBhbmQgYmdwQUZBcmczID09ICJiYWNrZG9vciIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICAgICAgICAgIGVsaWYoYmdwQUZBcmczIGlzIG5vdCBOb25lIGFuZCBiZ3BBRkFyZzMgPT0gInJvdXRlLW1hcCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhZGRyZmFtaWx5X3JvdXRlbWFwX25hbWUiLCBiZ3BBRkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnNSBpcyBub3QgTm9uZSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdwQUZBcmc1ID09ICJiYWNrZG9vciIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbGlmKGJncEFGQXJnMyBpcyBub3QgTm9uZSBhbmQgYmdwQUZBcmczID09ICJtYXNrIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm5ldHdvcmtfaXBfcHJlZml4X21hc2siLCBiZ3BBRkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzQgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwMCIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBRkFyZzEgPT0gIm5leHRob3AiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgdHJpZ2dlci1kZWxheSBjcml0aWNhbCAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJuZXh0aG9wX2NydGl0aWNhbF9kZWxheSIsIGJncEFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibmV4dGhvcF9ub25jcnRpdGljYWxfZGVsYXkiLCBiZ3BBRkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzMgKyAiICIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTgiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZihiZ3BBRkFyZzEgPT0gInJlZGlzdHJpYnV0ZSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJhZGRyZmFtaWx5X3JlZGlzdHJpYnV0ZV9vcHRpb24iLCBiZ3BBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncEFGQXJnMiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICJyb3V0ZS1tYXAgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFkZHJmYW1pbHlfcm91dGVtYXBfbmFtZSIsIGJncEFGQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTYiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTUiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwQUZBcmcxID09ICJzYXZlIiBvciBiZ3BBRkFyZzEgPT0gInN5bmNocm9uaXphdGlvbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTQiCiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICBjb21tYW5kID0gImV4aXQgXG4iCiAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoY29uZmlnLXJvdXRlcikjIiwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBiZ3BDb25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgYmdwQXJnMSwgYmdwQXJnMiwgYmdwQXJnMywgYmdwQXJnNCwKICAgICAgICBiZ3BBZ3I1LCBiZ3BBcmc2LCBiZ3BBcmc3LCBiZ3BBcmc4KToKICAgIHJldFZhbCA9ICIiCiAgICBjb21tYW5kID0gIiIKICAgICMgV2FpdCB0aW1lIHRvIGdldCByZXNwb25zZSBmcm9tIHNlcnZlcgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgIGlmKGJncEFyZzEgPT0gImFkZHJlc3MtZmFtaWx5Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX2FkZHJlc3NfZmFtaWx5IiwgYmdwQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyICsgIiAiICsgInVuaWNhc3QgXG4iCiAgICAgICAgICAgIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgICAgIGNvbW1hbmQsICIoY29uZmlnLXJvdXRlci1hZikjIiwgdGltZW91dCwgb2JqKQogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBiZ3BBRkNvbmZpZygKICAgICAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgIihjb25maWctcm91dGVyLWFmKSMiLCB0aW1lb3V0LAogICAgICAgICAgICAgICAgYmdwQXJnMywgYmdwQXJnNCwgYmdwQWdyNSwgYmdwQXJnNiwgYmdwQXJnNywgYmdwQXJnOCkKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzgiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gImJlc3RwYXRoIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgIgogICAgICAgIGlmKGJncEFyZzIgPT0gImFsd2F5cy1jb21wYXJlLW1lZCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsaWYoYmdwQXJnMiA9PSAiY29tcGFyZS1jb25mZWQtYXNwYXRoIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJjb21wYXJlLXJvdXRlcmlkIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJkb250LWNvbXBhcmUtb3JpZ2luYXRvci1pZCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsaWYoYmdwQXJnMiA9PSAidGllLWJyZWFrLW9uLWFnZSIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsaWYoYmdwQXJnMiA9PSAiYXMtcGF0aCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMiArICIgIgogICAgICAgICAgICBpZihiZ3BBcmczID09ICJpZ25vcmUiIG9yIGJncEFyZzMgPT0gIm11bHRpcGF0aC1yZWxheCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTc5IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYoYmdwQXJnMiA9PSAibWVkIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncEFyZzMgPT0gImNvbmZlZCIgb3IKICAgICAgICAgICAgICAgYmdwQXJnMyA9PSAibWlzc2luZy1hcy13b3JzdCIgb3IKICAgICAgICAgICAgICAgYmdwQXJnMyA9PSAibm9uLWRldGVybWluaXN0aWMiIG9yCiAgICAgICAgICAgICAgIGJncEFyZzMgPT0gInJlbW92ZS1yZWN2LW1lZCIgb3IKICAgICAgICAgICAgICAgYmdwQXJnMyA9PSAicmVtb3ZlLXNlbmQtbWVkIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODAiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4MSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiYmdwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgYXMtbG9jYWwtY291bnQgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX2JncF9sb2NhbF9jb3VudCIsIGJncEFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gImNsdXN0ZXItaWQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgImNsdXN0ZXJfaWRfYXNfaXAiLCBiZ3BBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJjbHVzdGVyX2lkX2FzX251bWJlciIsIGJncEFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTgzIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiY29uZmVkZXJhdGlvbiIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiICIKICAgICAgICBpZihiZ3BBcmcyID09ICJpZGVudGlmaWVyIik6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImNvbmZlZGVyYXRpb25faWRlbnRpZmllciIsIGJncEFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiICIgKyBiZ3BBcmcyICsgIiAiICsgYmdwQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4NCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmKGJncEFyZzIgPT0gInBlZXJzIik6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImNvbmZlZGVyYXRpb25fcGVlcnNfYXMiLCBiZ3BBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiAiICsgYmdwQXJnMiArICIgIiArIGJncEFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODUiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4NiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiZW5mb3JjZS1maXJzdC1hcyIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEKCiAgICBlbGlmKGJncEFyZzEgPT0gImZhc3QtZXh0ZXJuYWwtZmFpbG92ZXIiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxCgogICAgZWxpZihiZ3BBcmcxID09ICJncmFjZWZ1bC1yZXN0YXJ0Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgc3RhbGVwYXRoLXRpbWUgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAic3RhbGVwYXRoX2RlbGF5X3ZhbHVlIiwgYmdwQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4NyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiZ3JhY2VmdWwtcmVzdGFydC1oZWxwZXIiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxCgogICAgZWxpZihiZ3BBcmcxID09ICJsb2ctbmVpZ2hib3ItY2hhbmdlcyIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzFmCgogICAgZWxpZihiZ3BBcmcxID09ICJtYXhhcy1saW1pdCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAibWF4YXNfbGltaXRfYXMiLCBiZ3BBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTg4IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJuZWlnaGJvciIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm5laWdoYm9yX2lwYWRkcmVzcyIsIGJncEFyZzIpCiAgICAgICAgIyByZXRWYWwgPSAiRXJyb3ItMTAyIgogICAgICAgICMgcmV0dXJuIHJldFZhbAogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICAgICAgaWYoYmdwQXJnMyBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgcmVtb3RlLWFzICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJuZWlnaGJvcl9hcyIsIGJncEFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzMgKyAiXG4iCiAgICAgICAgICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCwgIihjb25maWctcm91dGVyLW5laWdoYm9yKSMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgYmdwTmVpZ2hib3JDb25maWcoCiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgIihjb25maWctcm91dGVyLW5laWdoYm9yKSMiLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0LCBiZ3BBcmc0LCBiZ3BBZ3I1LCBiZ3BBcmc2LCBiZ3BBcmc3LCBiZ3BBcmc4KQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTg5IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJyb3V0ZXItaWQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInJvdXRlcl9pZCIsIGJncEFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gInNodXRkb3duIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMQoKICAgIGVsaWYoYmdwQXJnMSA9PSAic3luY2hyb25pemF0aW9uIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMQoKICAgIGVsaWYoYmdwQXJnMSA9PSAidGltZXJzIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgYmdwICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9rZWVwYWxpdmVfaW50ZXJ2YWwiLCBiZ3BBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTkxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgaWYoYmdwQXJnMyBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJiZ3BfaG9sZHRpbWUiLCBiZ3BBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiAiICsgYmdwQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5MiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTkyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJ2cmYiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiBkZWZhdWx0IgogICAgZWxzZToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5MiIKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICMgQ29tZSBiYWNrIHRvIGNvbmZpZyBtb2RlCiAgICBjb21tYW5kID0gImV4aXQgXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIihjb25maWcpIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIHZsYW5Db25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgdmxhbkFyZzEsIHZsYW5BcmcyLCB2bGFuQXJnMywKICAgICAgICB2bGFuQXJnNCwgdmxhbkFyZzUpOgoKICAgIHJldFZhbCA9ICIiCiAgICAjIFdhaXQgdGltZSB0byBnZXQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIKICAgIHRpbWVvdXQgPSB0aW1lb3V0CiAgICAjIHZsYW4gY29uZmlnIGNvbW1hbmQgaGFwcGVucyBoZXJlLgogICAgY29tbWFuZCA9ICJ2bGFuICIKCiAgICBpZih2bGFuQXJnMSA9PSAiYWNjZXNzLW1hcCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImFjY2Vzcy1tYXAgIikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2FjY2Vzc19tYXBfbmFtZSIsIHZsYW5BcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmcyICsgIiBcbiIKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgICAgICByZXRWYWwgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoCiAgICAgICAgICAgICAgICBjb21tYW5kLCAiKGNvbmZpZy1hY2Nlc3MtbWFwKSMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIHZsYW5BY2Nlc3NNYXBDb25maWcoCiAgICAgICAgICAgICAgICBvYmosIGRldmljZVR5cGUsICIoY29uZmlnLWFjY2Vzcy1tYXApIyIsIHRpbWVvdXQsIHZsYW5BcmczLAogICAgICAgICAgICAgICAgdmxhbkFyZzQsIHZsYW5Bcmc1KQogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzMCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhbkFyZzEgPT0gImRvdDFxIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiZG90MXEiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzEgKyAiIHRhZyBuYXRpdmUgIgogICAgICAgIGlmKHZsYW5BcmcyIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9kb3QxcV90YWciLCB2bGFuQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmcyCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTMxIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhbkFyZzEgPT0gImZpbHRlciIpOgogICAgICAgICMgZGVidWdPdXRwdXQoICJmaWx0ZXIiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzEgKyAiICIKICAgICAgICBpZih2bGFuQXJnMiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fZmlsdGVyX25hbWUiLCB2bGFuQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmcyICsgIiB2bGFuLWxpc3QgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInZsYW5faWQiLCB2bGFuQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2lkX3JhbmdlIiwgdmxhbkFyZzMpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRVJST1ItMTMzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzIiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxzZToKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhbl9pZCIsIHZsYW5BcmcxKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICByZXRWYWwgPSBjcmVhdGVWbGFuKG9iaiwgZGV2aWNlVHlwZSwgIihjb25maWctdmxhbikjIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0LCB2bGFuQXJnMSwgdmxhbkFyZzIsIHZsYW5BcmczLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZsYW5Bcmc0LCB2bGFuQXJnNSkKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5faWRfcmFuZ2UiLCB2bGFuQXJnMSkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICByZXRWYWwgPSBjcmVhdGVWbGFuKG9iaiwgZGV2aWNlVHlwZSwgIihjb25maWctdmxhbikjIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCwgdmxhbkFyZzEsIHZsYW5BcmcyLCB2bGFuQXJnMywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmxhbkFyZzQsIHZsYW5Bcmc1KQogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTMzIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzNCIKICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIHZsYW5BY2Nlc3NNYXBDb25maWcoCiAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHZsYW5BcmczLCB2bGFuQXJnNCwgdmxhbkFyZzUpOgogICAgcmV0VmFsID0gIiIKICAgICMgV2FpdCB0aW1lIHRvIGdldCByZXNwb25zZSBmcm9tIHNlcnZlcgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgIGNvbW1hbmQgPSAiIgogICAgaWYodmxhbkFyZzMgPT0gImFjdGlvbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fYWNjZXNzbWFwX2FjdGlvbiIsIHZsYW5Bcmc0KQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzNSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZih2bGFuQXJnMyA9PSAibWF0Y2giKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgaWYodmxhbkFyZzQgPT0gImlwIiBvciB2bGFuQXJnNCA9PSAibWFjIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQgKyAiIGFkZHJlc3MgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2FjY2Vzc19tYXBfbmFtZSIsIHZsYW5Bcmc1KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzYiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzNyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZih2bGFuQXJnMyA9PSAic3RhdGlzdGljcyIpOgogICAgICAgIGNvbW1hbmQgPSB2bGFuQXJnMyArICIgcGVyLWVudHJ5IgogICAgZWxzZToKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM4IgogICAgICAgIHJldHVybiByZXRWYWwKCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgY2hlY2tWbGFuTmFtZU5vdEFzc2lnbmVkKAogICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCB2bGFuSWQsIHZsYW5OYW1lKToKICAgIHJldFZhbCA9ICJvayIKICAgIGNvbW1hbmQgPSAiZGlzcGxheSB2bGFuIGlkICIgKyB2bGFuSWQgKyAiIFxuIgogICAgcmV0VmFsID0gd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgaWYocmV0VmFsLmZpbmQodmxhbk5hbWUpICE9IC0xKToKICAgICAgICByZXR1cm4gIk5vayIKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgojIFV0aWxpdHkgTWV0aG9kIHRvIGNyZWF0ZSB2bGFuCmRlZiBjcmVhdGVWbGFuKAogICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCB2bGFuQXJnMSwgdmxhbkFyZzIsIHZsYW5BcmczLAogICAgICAgIHZsYW5Bcmc0LCB2bGFuQXJnNSk6CgogICAgIyB2bGFuIGNvbmZpZyBjb21tYW5kIGhhcHBlbnMgaGVyZS4gSXQgY3JlYXRlcyBpZiBub3QgcHJlc2VudAogICAgY29tbWFuZCA9ICJ2bGFuICIgKyB2bGFuQXJnMSArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgIGNvbW1hbmQgPSAiIgogICAgaWYodmxhbkFyZzIgPT0gIm5hbWUiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJuYW1lIikKICAgICAgICBjb21tYW5kID0gdmxhbkFyZzIgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhbl9uYW1lIiwgdmxhbkFyZzMpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tWbGFuTmFtZU5vdEFzc2lnbmVkKG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bGFuQXJnMSwgdmxhbkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29tbWFuZCA9ICJcbiIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM5IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmICh2bGFuQXJnMiA9PSAiZmxvb2QiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJmbG9vZCIpCiAgICAgICAgY29tbWFuZCA9IHZsYW5BcmcyICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInZsYW5fZmxvb2QiLCB2bGFuQXJnMykKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYW5BcmcyID09ICJzdGF0ZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInN0YXRlIikKICAgICAgICBjb21tYW5kID0gdmxhbkFyZzIgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhbl9zdGF0ZSIsIHZsYW5BcmczKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0MSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhbkFyZzIgPT0gImlwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiaXAiKQogICAgICAgIGNvbW1hbmQgPSB2bGFuQXJnMiArICIgaWdtcCBzbm9vcGluZyAiCiAgICAgICAgIyBkZWJ1Z091dHB1dCgidmxhbkFyZzMiKQogICAgICAgIGlmKHZsYW5BcmczIGlzIE5vbmUgb3IgdmxhbkFyZzMgPT0gIiIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJOb25lIG9yIGVtcHR5IikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBlbGlmKHZsYW5BcmczID09ICJmYXN0LWxlYXZlIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoImZhc3QtbGVhdmUiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczCgogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJsYXN0LW1lbWJlci1xdWVyeS1pbnRlcnZhbCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJsYXN0LW1lbWJlci1xdWVyeS1pbnRlcnZhbCIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9sYXN0X21lbWJlcl9xdWVyeV9pbnRlcnZhbCIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDIiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJxdWVyaWVyIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInF1ZXJpZXIiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2bGFuX3F1ZXJpZXIiLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQzIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJxdWVyaWVyLXRpbWVvdXQiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgicXVlcmllci10aW1lb3V0IikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX3F1ZXJpZXJfdGltZW91dCIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDQiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInF1ZXJ5LWludGVydmFsIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInF1ZXJ5LWludGVydmFsIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX3F1ZXJ5X2ludGVydmFsIiwgdmxhbkFyZzQpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0NSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAicXVlcnktbWF4LXJlc3BvbnNlLXRpbWUiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgicXVlcnktbWF4LXJlc3BvbnNlLXRpbWUiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fcXVlcnlfbWF4X3Jlc3BvbnNlX3RpbWUiLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQ2IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJyZXBvcnQtc3VwcHJlc3Npb24iKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgicmVwb3J0LXN1cHByZXNzaW9uIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwoKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAicm9idXN0bmVzcy12YXJpYWJsZSIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJyb2J1c3RuZXNzLXZhcmlhYmxlIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX3JvYnVzdG5lc3NfdmFyaWFibGUiLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQ3IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJzdGFydHVwLXF1ZXJ5LWNvdW50Iik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInN0YXJ0dXAtcXVlcnktY291bnQiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fc3RhcnR1cF9xdWVyeV9jb3VudCIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDgiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInN0YXJ0dXAtcXVlcnktaW50ZXJ2YWwiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgic3RhcnR1cC1xdWVyeS1pbnRlcnZhbCIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9zdGFydHVwX3F1ZXJ5X2ludGVydmFsIiwgdmxhbkFyZzQpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0OSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAic3RhdGljLWdyb3VwIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInN0YXRpYy1ncm91cCIpCiAgICAgICAgICAgICMgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICAjIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsIHZhcmlhYmxlSWQsIHZsYW5Bcmc0KQogICAgICAgICAgICAjIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAjICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKCiAgICAgICAgICAgICMgZWxzZSA6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAidmVyc2lvbiIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJ2ZXJzaW9uIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX3Nub29waW5nX3ZlcnNpb24iLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTUwIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJtcm91dGVyIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoIm1yb3V0ZXIiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiBpbnRlcmZhY2UgIgogICAgICAgICAgICBpZih2bGFuQXJnNCA9PSAiZXRoZXJuZXQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2V0aGVybmV0X2ludGVyZmFjZSIsIHZsYW5Bcmc1KQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTUxIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZih2bGFuQXJnNCA9PSAicG9ydC1hZ2dyZWdhdGlvbiIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNCArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fcG9ydGFnZ19udW1iZXIiLCB2bGFuQXJnNSkKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE1MiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTUzIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMKCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xNTQiCiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyAiXG4iICsgXAogICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICMgQ29tZSBiYWNrIHRvIGNvbmZpZyBtb2RlCiAgICBjb21tYW5kID0gImV4aXQgXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIihjb25maWcpIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIHZsYWdDb25maWcoCiAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHZsYWdBcmcxLCB2bGFnQXJnMiwgdmxhZ0FyZzMsCiAgICAgICAgdmxhZ0FyZzQpOgoKICAgIHJldFZhbCA9ICIiCiAgICAjIFdhaXQgdGltZSB0byBnZXQgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIKICAgIHRpbWVvdXQgPSB0aW1lb3V0CiAgICAjIHZsYWcgY29uZmlnIGNvbW1hbmQgaGFwcGVucyBoZXJlLgogICAgY29tbWFuZCA9ICJ2bGFnICIKCiAgICBpZih2bGFnQXJnMSA9PSAiZW5hYmxlIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiZW5hYmxlIikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCgogICAgZWxpZih2bGFnQXJnMSA9PSAiYXV0by1yZWNvdmVyeSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImF1dG8tcmVjb3ZlcnkiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYWdfYXV0b19yZWNvdmVyeSIsIHZsYWdBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2MCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhZ0FyZzEgPT0gImNvbmZpZy1jb25zaXN0ZW5jeSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImNvbmZpZy1jb25zaXN0ZW5jeSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19jb25maWdfY29uc2lzdGVuY3kiLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjEiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYWdBcmcxID09ICJpc2wiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJpc2wiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiIHBvcnQtYWdncmVnYXRpb24gIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19wb3J0X2FnZ3JlZ2F0aW9uIiwgdmxhZ0FyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTYyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFnQXJnMSA9PSAibWFjLWFkZHJlc3MtdGFibGUiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJtYWMtYWRkcmVzcy10YWJsZSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgcmVmcmVzaCIKCiAgICBlbGlmKHZsYWdBcmcxID09ICJwZWVyLWdhdGV3YXkiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJwZWVyLWdhdGV3YXkiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKCiAgICBlbGlmKHZsYWdBcmcxID09ICJwcmlvcml0eSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInByaW9yaXR5IikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInZsYWdfcHJpb3JpdHkiLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjMiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYWdBcmcxID09ICJzdGFydHVwLWRlbGF5Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgic3RhcnR1cC1kZWxheSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19zdGFydHVwX2RlbGF5IiwgdmxhZ0FyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY0IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFnQXJnMSA9PSAidGllci1pZCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInRpZXItaWQiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhZ190aWVyX2lkIiwgdmxhZ0FyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY1IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFnQXJnMSA9PSAidnJycCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInZycnAiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiIGFjdGl2ZSIKCiAgICBlbGlmKHZsYWdBcmcxID09ICJpbnN0YW5jZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImluc3RhbmNlIikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInZsYWdfaW5zdGFuY2UiLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgICAgICBpZih2bGFnQXJnMyBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgcG9ydC1hZ2dyZWdhdGlvbiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19wb3J0X2FnZ3JlZ2F0aW9uIiwgdmxhZ0FyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIGVuYWJsZSAiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2NiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhZ0FyZzEgPT0gImhsdGhjaGsiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJobHRoY2hrIikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX2hsdGhjaGtfb3B0aW9ucyIsIHZsYWdBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBpZih2bGFnQXJnMiA9PSAia2VlcGFsaXZlLWF0dGVtcHRzIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19rZWVwYWxpdmVfYXR0ZW1wdHMiLCB2bGFnQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIgKyAiICIgKyB2bGFnQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY3IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZih2bGFnQXJnMiA9PSAia2VlcGFsaXZlLWludGVydmFsIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19rZWVwYWxpdmVfaW50ZXJ2YWwiLCB2bGFnQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIgKyAiICIgKyB2bGFnQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY4IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZih2bGFnQXJnMiA9PSAicmV0cnktaW50ZXJ2YWwiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3JldHJ5X2ludGVydmFsIiwgdmxhZ0FyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyICsgIiAiICsgdmxhZ0FyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2OSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYodmxhZ0FyZzIgPT0gInBlZXItaXAiKToKICAgICAgICAgICAgICAgICMgSGVyZSBJIGFtIG5vdCB0YWtpbmcgY2FyZSBvZiBJUFY2IG9wdGlvbi4KICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3BlZXJpcCIsIHZsYWdBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMiArICIgIiArIHZsYWdBcmczCiAgICAgICAgICAgICAgICAgICAgaWYodmxhZ0FyZzQgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3BlZXJpcF92cmYiLCB2bGFnQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgdnJmICIgKyB2bGFnQXJnNAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE3MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTcxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxzZToKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTcyIgogICAgICAgIHJldHVybiByZXRWYWwKCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKGNvbmZpZykjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgVXRpbGl0eSBNZXRob2QgdG8gYmFjayB1cCB0aGUgc3RhcnQgdXAgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBURlRQIG9yIEZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvU3RhcnR1cENvbmZpZ0JhY2tVcCgKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgJiAoY29uZlBhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gY29uZlBhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgY29uZmlnIGJhY2t1cCBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgaWYocHJvdG9jb2wgPT0gImZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3Agc3RhcnR1cC1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICAgICAgdXNlcm5hbWUgKyAiQCIgKyBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiB2cmYgbWFuYWdlbWVudFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKHBhc3N3b3JkLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgIGVsaWYocHJvdG9jb2wgPT0gInRmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwIHN0YXJ0dXAtY29uZmlnICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgXAogICAgICAgICAgICAiOi8vIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBVdGlsaXR5IE1ldGhvZCB0byBiYWNrIHVwIHRoZSBzdGFydCB1cCBjb25maWcKIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFNDUCBvciBTRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9TZWN1cmVTdGFydHVwQ29uZmlnQmFja1VwKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSBhbmQgKGNvbmZQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGNvbmZQYXRoCgogICAgcmV0VmFsID0gIiIKCiAgICAjIGNvbmZpZyBiYWNrdXAgY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGNvbW1hbmQgPSAiY3Agc3RhcnR1cC1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICB1c2VybmFtZSArICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXNwb25zZSA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKHllcy9ubykiLCAzLCBvYmopCiAgICBpZihyZXNwb25zZS5sb3dlcigpLmZpbmQoImVycm9yLTEwMSIpKToKICAgICAgICBjb21tYW5kID0gcGFzc3dvcmQgKyAiXG4iCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgICAgIHJldHVybiByZXRWYWwKICAgIHJldFZhbCA9IHJldFZhbCArIHJlc3BvbnNlCiAgICBpZihwcm90b2NvbCA9PSAic2NwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAidGltZW91dDoiLCAzLCBvYmopCiAgICAgICAgY29tbWFuZCA9ICIwXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAic2Z0cCIpOgogICAgICAgIGNvbW1hbmQgPSAieWVzIFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgIyBQYXNzd29yZCBlbnRyeSBoYXBwZW5zIGhlcmUKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIHJlc3RvcmUgdGhlIFJ1bm5pbmcgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBURlRQIG9yIEZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvU3RhcnRVcENvbmZpZ1JvbGxiYWNrKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSAmIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBpZihwcm90b2NvbCA9PSAiZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgdXNlcm5hbWUgKyBcCiAgICAgICAgICAgICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHN0YXJ0dXAtY29uZmlnIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIHRpbWVvdXQsIG9iaikKICAgICAgICBjb21tYW5kID0gInlcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UocGFzc3dvcmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAidGZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICAgICAgc2VydmVyICsgIi8iICsgcGF0aCArICIgc3RhcnR1cC1jb25maWcgdnJmIG1hbmFnZW1lbnRcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJbbl0iLCB0aW1lb3V0LCBvYmopCiAgICAgICAgY29tbWFuZCA9ICJ5XG4iCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIHJlc3RvcmUgdGhlIHN0YXJ0IHVwIGNvbmZpZwojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgU0NQIG9yIFNGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwoKCmRlZiBkb1NlY3VyZVN0YXJ0VXBDb25maWdSb2xsYmFjaygKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgYW5kIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCgogICAgIyBjcCBzZnRwIHNmdHA6Ly9yb290QDEwLjI0MS4xMDYuMTE4L2Nub3NfY29uZmlnL3J1bm5pbmdfY29uZmlnLmNvbmYKICAgICMgc3RhcnR1cC1jb25maWcgdnJmIG1hbmFnZW1lbnQKICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIHVzZXJuYW1lICsgXAogICAgICAgICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHN0YXJ0dXAtY29uZmlnIHZyZiBtYW5hZ2VtZW50IFxuIgoKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJlc3BvbnNlID0gd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoeWVzL25vKSIsIDMsIG9iaikKICAgIGlmKHJlc3BvbnNlLmxvd2VyKCkuZmluZCgiZXJyb3ItMTAxIikpOgogICAgICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIHRpbWVvdXQsIG9iaikKICAgICAgICBjb21tYW5kID0gInlcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgcmV0VmFsID0gcmV0VmFsICsgcmVzcG9uc2UKICAgIGlmKHByb3RvY29sID09ICJzY3AiKToKICAgICAgICBjb21tYW5kID0gInllcyBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJ0aW1lb3V0OiIsIDMsIG9iaikKICAgICAgICBjb21tYW5kID0gIjBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbGlmKHByb3RvY29sID09ICJzZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICAjIFBhc3N3b3JkIGVudHJ5IGhhcHBlbnMgaGVyZQogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJbbl0iLCB0aW1lb3V0LCBvYmopCiAgICBjb21tYW5kID0gInlcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIGJhY2sgdXAgdGhlIFJ1bm5pbmcgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBURlRQIG9yIEZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvUnVubmluZ0NvbmZpZ0JhY2tVcCgKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgJiAoY29uZlBhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gY29uZlBhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgY29uZmlnIGJhY2t1cCBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgaWYocHJvdG9jb2wgPT0gImZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgcnVubmluZy1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICAgICAgdXNlcm5hbWUgKyAiQCIgKyBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiB2cmYgbWFuYWdlbWVudFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKHBhc3N3b3JkLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgIGVsaWYocHJvdG9jb2wgPT0gInRmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwIHJ1bm5pbmctY29uZmlnICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgXAogICAgICAgICAgICAiOi8vIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCiMgVXRpbGl0eSBNZXRob2QgdG8gYmFjayB1cCB0aGUgcnVubmluZyBjb25maWcKIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFNDUCBvciBTRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKZGVmIGRvU2VjdXJlUnVubmluZ0NvbmZpZ0JhY2tVcCgKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgYW5kIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBjb21tYW5kID0gImNwIHJ1bm5pbmctY29uZmlnICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgIjovLyIgKyBcCiAgICAgICAgdXNlcm5hbWUgKyAiQCIgKyBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiB2cmYgbWFuYWdlbWVudFxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmVzcG9uc2UgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIih5ZXMvbm8pIiwgMywgb2JqKQogICAgaWYocmVzcG9uc2UubG93ZXIoKS5maW5kKCJlcnJvci0xMDEiKSk6CiAgICAgICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICByZXRWYWwgPSByZXRWYWwgKyByZXNwb25zZQogICAgaWYocHJvdG9jb2wgPT0gInNjcCIpOgogICAgICAgIGNvbW1hbmQgPSAieWVzIFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgInRpbWVvdXQ6IiwgMywgb2JqKQogICAgICAgIGNvbW1hbmQgPSAiMFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsaWYocHJvdG9jb2wgPT0gInNmdHAiKToKICAgICAgICBjb21tYW5kID0gInllcyBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbHNlOgogICAgICAgIHJldHVybiAiRXJyb3ItMTEwIgoKICAgICMgUGFzc3dvcmQgZW50cnkgaGFwcGVucyBoZXJlCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICBjb21tYW5kID0gcGFzc3dvcmQgKyAiXG4iCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBVdGlsaXR5IE1ldGhvZCB0byByZXN0b3JlIHRoZSBSdW5uaW5nIGNvbmZpZwojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgVEZUUCBvciBGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwoKCmRlZiBkb1J1bm5pbmdDb25maWdSb2xsYmFjaygKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgJiAoY29uZlBhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gY29uZlBhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgY29uZmlnIGJhY2t1cCBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgaWYocHJvdG9jb2wgPT0gImZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIHVzZXJuYW1lICsgXAogICAgICAgICAgICAiQCIgKyBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiBydW5uaW5nLWNvbmZpZyB2cmYgbWFuYWdlbWVudFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKHBhc3N3b3JkLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgIGVsaWYocHJvdG9jb2wgPT0gInRmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgIjovLyIgKyBcCiAgICAgICAgICAgIHNlcnZlciArICIvIiArIHBhdGggKyAiIHJ1bm5pbmctY29uZmlnIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBVdGlsaXR5IE1ldGhvZCB0byByZXN0b3JlIHRoZSBydW5uaW5nIGNvbmZpZwojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgU0NQIG9yIFNGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwoKCmRlZiBkb1NlY3VyZVJ1bm5pbmdDb25maWdSb2xsYmFjaygKICAgICAgICBwcm90b2NvbCwgdGltZW91dCwgY29uZlNlcnZlcklwLCBjb25mUGF0aCwgY29uZlNlcnZlclVzZXIsCiAgICAgICAgY29uZlNlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gY29uZlNlcnZlcklwCgogICAgIyB1c2VybmFtZSA9ICJwYmhvc2FsZSIKICAgIHVzZXJuYW1lID0gY29uZlNlcnZlclVzZXIKCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBjb25mU2VydmVyUHdkCgogICAgcGF0aCA9ICJjbm9zX2NvbmZpZyIKICAgIGlmKChjb25mUGF0aCBpcyBub3QgTm9uZSkgYW5kIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCgogICAgIyBjcCBzZnRwIHNmdHA6Ly9yb290QDEwLjI0MS4xMDYuMTE4L2Nub3NfY29uZmlnL3J1bm5pbmdfY29uZmlnLmNvbmYKICAgICMgcnVubmluZy1jb25maWcgdnJmIG1hbmFnZW1lbnQKICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIHVzZXJuYW1lICsgXAogICAgICAgICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHJ1bm5pbmctY29uZmlnIHZyZiBtYW5hZ2VtZW50IFxuIgoKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJlc3BvbnNlID0gd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoeWVzL25vKSIsIDMsIG9iaikKICAgIGlmKHJlc3BvbnNlLmxvd2VyKCkuZmluZCgiZXJyb3ItMTAxIikpOgogICAgICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgcmV0VmFsID0gcmV0VmFsICsgcmVzcG9uc2UKCiAgICBpZihwcm90b2NvbCA9PSAic2NwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAidGltZW91dDoiLCAzLCBvYmopCiAgICAgICAgY29tbWFuZCA9ICIwXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAic2Z0cCIpOgogICAgICAgIGNvbW1hbmQgPSAieWVzIFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgIyBQYXNzd29yZCBlbnRyeSBoYXBwZW5zIGhlcmUKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIGRvd25sb2FkIGFuIGltYWdlIGZyb20gRlRQL1RGVFAgc2VydmVyIHRvIGRldmljZS4KIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IEZUUCBvciBURlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9JbWFnZVRyYW5zZmVyKAogICAgcHJvdG9jb2wsIHRpbWVvdXQsIGltZ1NlcnZlcklwLCBpbWdQYXRoLCBpbWdUeXBlLCBpbWdTZXJ2ZXJVc2VyLAogICAgICAgIGltZ1NlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDYuMTE4IgogICAgc2VydmVyID0gaW1nU2VydmVySXAKICAgICMgdXNlcm5hbWUgPSAicm9vdCIKICAgIHVzZXJuYW1lID0gaW1nU2VydmVyVXNlcgogICAgIyBwYXNzd29yZCA9ICJyb290MTIzIgogICAgcGFzc3dvcmQgPSBpbWdTZXJ2ZXJQd2QKCiAgICB0eXBlID0gIm9zIgogICAgaWYoaW1nVHlwZSBpcyBub3QgTm9uZSk6CiAgICAgICAgdHlwZSA9IGltZ1R5cGUubG93ZXIoKQoKICAgIHBhdGggPSAiY25vc19pbWFnZXMiCiAgICBpZigoaW1nUGF0aCBpcyBub3QgTm9uZSkgYW5kIChpbWdQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGltZ1BhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgSW1hZ2UgdHJhbnNmZXIgY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGlmKHByb3RvY29sID09ICJmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgIjovLyIgKyB1c2VybmFtZSArIFwKICAgICAgICAgICAgIkAiICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgc3lzdGVtLWltYWdlICIgKyB0eXBlICsgXAogICAgICAgICAgICAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICBlbGlmKHByb3RvY29sID09ICJ0ZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgc2VydmVyICsgXAogICAgICAgICAgICAiLyIgKyBwYXRoICsgIiBzeXN0ZW0taW1hZ2UgIiArIHR5cGUgKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICBlbHNlOgogICAgICAgIHJldHVybiAiRXJyb3ItMTEwIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJbbl0iLCAzLCBvYmopCiAgICAjIENvbmZpcm1hdGlvbiBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgY29tbWFuZCA9ICJ5XG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAjIHJldFZhbCA9IHJldFZhbCsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoeWVzL25vKT8iLCAzLCBvYmopCiAgICAjIGNvbW1hbmQgPSAiWWVzIFxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgaWYocHJvdG9jb2wgPT0gImZ0cCIpOgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgICAgICMgUGFzc3dvcmQgZW50cnkgaGFwcGVucyBoZXJlIE9ubHkgZm9yIEZUUAogICAgICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICIgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgIyBDaGFuZ2UgdG8gc3RhbmRieSBpbWFnZSB5CiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIHRpbWVvdXQsIG9iaikKICAgIGNvbW1hbmQgPSAieVxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBVdGlsaXR5IE1ldGhvZCB0byBkb3dubG9hZCBhbiBpbWFnZSBmcm9tIFNGVFAvU0NQIHNlcnZlciB0byBkZXZpY2UuCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBTQ1Agb3IgU0ZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvU2VjdXJlSW1hZ2VUcmFuc2ZlcigKICAgIHByb3RvY29sLCB0aW1lb3V0LCBpbWdTZXJ2ZXJJcCwgaW1nUGF0aCwgaW1nVHlwZSwgaW1nU2VydmVyVXNlciwKICAgICAgICBpbWdTZXJ2ZXJQd2QsIG9iaik6CiAgICAjIHNlcnZlciA9ICIxMC4yNDEuMTA1LjIxNCIKICAgIHNlcnZlciA9IGltZ1NlcnZlcklwCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBpbWdTZXJ2ZXJVc2VyCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBpbWdTZXJ2ZXJQd2QKCiAgICB0eXBlID0gInNjcCIKICAgIGlmKGltZ1R5cGUgaXMgbm90IE5vbmUpOgogICAgICAgIHR5cGUgPSBpbWdUeXBlLmxvd2VyKCkKCiAgICBwYXRoID0gImNub3NfaW1hZ2VzIgogICAgaWYoKGltZ1BhdGggaXMgbm90IE5vbmUpIGFuZChpbWdQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGltZ1BhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgSW1hZ2UgdHJhbnNmZXIgY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIHVzZXJuYW1lICsgIkAiICsgXAogICAgICAgIHNlcnZlciArICIvIiArIHBhdGggKyAiIHN5c3RlbS1pbWFnZSAiICsgdHlwZSArICIgdnJmIG1hbmFnZW1lbnQgXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIDMsIG9iaikKICAgICMgQ29uZmlybWF0aW9uIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBpZihwcm90b2NvbCA9PSAic2NwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKHllcy9ubyk/IiwgMywgb2JqKQogICAgICAgIGNvbW1hbmQgPSAiWWVzXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAidGltZW91dDoiLCAzLCBvYmopCiAgICAgICAgY29tbWFuZCA9ICIwXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAic2Z0cCIpOgogICAgICAgIGNvbW1hbmQgPSAieVxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIih5ZXMvbm8pPyIsIDMsIG9iaikKICAgICAgICBjb21tYW5kID0gIlllc1xuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgIyBQYXNzd29yZCBlbnRyeSBoYXBwZW5zIGhlcmUKICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiW25dIiwgdGltZW91dCwgb2JqKQogICAgIyBDaGFuZ2UgdG8gc3RhbmRieSBpbWFnZSB5CiAgICBjb21tYW5kID0gInlcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgTWV0aG9kIHRvIGZpbmQgd2hldGhlciBpbWFnZSBpcyB0aGVyZSBpbiBzZXJ2ZXIgb3Igbm90CiMgVGhpcyBpcyBub3QgY29tcGxldGUuIE5lZWQgdG8gZmlndXJlIG91dCBIb3cgdG8gZG8gZm9yIFNDUCBhbmQgU0ZUUAoKCmRlZiBjaGVja1NlcnZlckZvckltYWdlKHByb3RvY29sLCBpcGFkZHJlc3MsIGZvbGRlciwgdXNlcm5hbWUsIHBhc3N3b3JkKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gaXBhZGRyZXNzCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSB1c2VybmFtZQogICAgIyBwYXNzd29yZCA9ICJMYWI0bWFuMSIKICAgIHBhc3N3b3JkID0gcGFzc3dvcmQKICAgIGltYWdlRGlyID0gImNub3NfaW1hZ2VzIgogICAgb3V0cHV0ID0gMAogICAgdHJ5OgogICAgICAgIGZ0cCA9IGZ0cGxpYi5GVFAoc2VydmVyKQogICAgICAgIGZ0cC5sb2dpbih1c2VybmFtZSwgcGFzc3dvcmQpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICMgZGVidWdPdXRwdXQgZQogICAgICAgIHJldHVybiAxCiAgICBlbHNlOgogICAgICAgIGZpbGVsaXN0ID0gW10gICMgdG8gc3RvcmUgYWxsIGZpbGVzCiAgICAgICAgZnRwLnJldHJsaW5lcygnTkxTVCcsIGZpbGVsaXN0LmFwcGVuZCkgICMgYXBwZW5kIHRvIGxpc3QKICAgICAgICBudW0gPSAwCiAgICAgICAgZm9yIGYgaW4gZmlsZWxpc3Q6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQgZgogICAgICAgICAgICBpZihmID09IGltYWdlRGlyKToKICAgICAgICAgICAgICAgIG51bSA9IDEKICAgICAgICBpZihudW0gPT0gMCk6CiAgICAgICAgICAgIHJlc3AgPSBmdHAubWtkKGltYWdlRGlyKQogICAgICAgIGlmKHJlc3AgIT0gaW1hZ2VEaXIpOgogICAgICAgICAgICByZXR1cm4gMQogICAgcmV0dXJuIG91dHB1dAojIEVPTQoKIyBNZXRob2QgZm9yIGRldmljZSByZXNwb25zZSB0aGFuIHRpbWUgZGVsYXkKIwoKCmRlZiBlbnRlckVuYWJsZU1vZGVGb3JEZXZpY2UoZW5hYmxlUGFzc3dvcmQsIHRpbWVvdXQsIG9iaik6CiAgICBjb21tYW5kID0gImVuYWJsZVxuIgogICAgcHdkUHJvbXB0ID0gInBhc3N3b3JkOiIKICAgICMgZGVidWdPdXRwdXQoZW5hYmxlUGFzc3dvcmQpCiAgICAjIGRlYnVnT3V0cHV0KCdcbicpCiAgICBvYmouc2V0dGltZW91dChpbnQodGltZW91dCkpCiAgICAjIEV4ZWN1dGluZyBlbmFibGUKICAgIG9iai5zZW5kKGNvbW1hbmQpCiAgICBmbGFnID0gRmFsc2UKICAgIHJldFZhbCA9ICIiCiAgICBjb3VudCA9IDUKICAgIHdoaWxlIG5vdCBmbGFnOgogICAgICAgICMgSWYgd2FpdCB0aW1lIGlzIGV4ZWNlZWRlZC4KICAgICAgICBpZihjb3VudCA9PSAwKToKICAgICAgICAgICAgZmxhZyA9IFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb3VudCA9IGNvdW50IC0gMQogICAgICAgICMgQSBkZWxheSBvZiBvbmUgc2Vjb25kCiAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgIHRyeToKICAgICAgICAgICAgYnVmZkJ5dGUgPSBvYmoucmVjdig5OTk5KQogICAgICAgICAgICBidWZmID0gYnVmZkJ5dGUuZGVjb2RlKCkKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgYnVmZgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGJ1ZmYpCiAgICAgICAgICAgIGdvdGl0ID0gYnVmZi5maW5kKHB3ZFByb21wdCkKICAgICAgICAgICAgaWYoZ290aXQgIT0gLTEpOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgaWYoZW5hYmxlUGFzc3dvcmQgaXMgTm9uZSBvciBlbmFibGVQYXNzd29yZCA9PSAiIik6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJcbiBFcnJvci0xMDYiCiAgICAgICAgICAgICAgICBvYmouc2VuZChlbmFibGVQYXNzd29yZCkKICAgICAgICAgICAgICAgIG9iai5zZW5kKCJcciIpCiAgICAgICAgICAgICAgICBvYmouc2VuZCgiXG4iKQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgICAgICAgICAgaW5uZXJCdWZmQnl0ZSA9IG9iai5yZWN2KDk5OTkpCiAgICAgICAgICAgICAgICBpbm5lckJ1ZmYgPSBpbm5lckJ1ZmZCeXRlLmRlY29kZSgpCiAgICAgICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBpbm5lckJ1ZmYKICAgICAgICAgICAgICAgICMgZGVidWdPdXRwdXQoaW5uZXJCdWZmKQogICAgICAgICAgICAgICAgaW5uZXJHb3RpdCA9IGlubmVyQnVmZi5maW5kKCIjIikKICAgICAgICAgICAgICAgIGlmKGlubmVyR290aXQgIT0gLTEpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGdvdGl0ID0gYnVmZi5maW5kKCIjIikKICAgICAgICAgICAgICAgIGlmKGdvdGl0ICE9IC0xKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyAiXG4gRXJyb3ItMTAxIgogICAgICAgICAgICBmbGFnID0gVHJ1ZQogICAgaWYocmV0VmFsID09ICIiKToKICAgICAgICByZXRWYWwgPSAiXG4gRXJyb3ItMTAxIgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBNZXRob2QgZm9yIGRldmljZSByZXNwb25zZSB0aGFuIHRpbWUgZGVsYXkKIwoKCmRlZiB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopOgogICAgb2JqLnNldHRpbWVvdXQoaW50KHRpbWVvdXQpKQogICAgb2JqLnNlbmQoY29tbWFuZCkKICAgIGZsYWcgPSBGYWxzZQogICAgcmV0VmFsID0gIiIKICAgIHdoaWxlIG5vdCBmbGFnOgogICAgICAgIHRpbWUuc2xlZXAoMSkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGJ1ZmZCeXRlID0gb2JqLnJlY3YoOTk5OSkKICAgICAgICAgICAgYnVmZiA9IGJ1ZmZCeXRlLmRlY29kZSgpCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIGJ1ZmYKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChyZXRWYWwpCiAgICAgICAgICAgIGdvdGl0ID0gYnVmZi5maW5kKHByb21wdCkKICAgICAgICAgICAgaWYoZ290aXQgIT0gLTEpOgogICAgICAgICAgICAgICAgZmxhZyA9IFRydWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGlmIHByb21wdCAhPSAiKHllcy9ubyk/IjoKICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArICJcbiBFcnJvci0xMDEiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSByZXRWYWwKICAgICAgICAgICAgZmxhZyA9IFRydWUKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgY2hlY2tPdXRwdXRGb3JFcnJvcihvdXRwdXQpOgogICAgcmV0VmFsID0gIiIKICAgIGluZGV4ID0gb3V0cHV0Lmxvd2VyKCkuZmluZCgiZXJyb3IiKQogICAgc3RhcnRJbmRleCA9IGluZGV4ICsgNgogICAgaWYoaW5kZXggPT0gLTEpOgogICAgICAgIGluZGV4ID0gb3V0cHV0Lmxvd2VyKCkuZmluZCgiaW52YWxpZCIpCiAgICAgICAgc3RhcnRJbmRleCA9IGluZGV4ICsgOAogICAgICAgIGlmKGluZGV4ID09IC0xKToKICAgICAgICAgICAgaW5kZXggPSBvdXRwdXQubG93ZXIoKS5maW5kKCJpbmNvcnJlY3QiKQogICAgICAgICAgICBzdGFydEluZGV4ID0gaW5kZXggKyA5CiAgICAgICAgICAgIGlmKGluZGV4ID09IC0xKToKICAgICAgICAgICAgICAgIGluZGV4ID0gb3V0cHV0Lmxvd2VyKCkuZmluZCgiZmFpbHVyZSIpCiAgICAgICAgICAgICAgICBzdGFydEluZGV4ID0gaW5kZXggKyA4CiAgICAgICAgICAgICAgICBpZihpbmRleCA9PSAtMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyAzCiAgICBlcnJvckNvZGUgPSBvdXRwdXRbc3RhcnRJbmRleDplbmRJbmRleF0KICAgIHJlc3VsdCA9IGVycm9yQ29kZS5pc2RpZ2l0KCkKICAgIGlmKHJlc3VsdCBpcyBub3QgVHJ1ZSk6CiAgICAgICAgcmV0dXJuICJEZXZpY2UgcmV0dXJuZWQgYW4gRXJyb3IuIFBsZWFzZSBjaGVjayBSZXN1bHRzIGZvciBtb3JlIFwKICAgICAgICBpbmZvcm1hdGlvbiIKCiAgICBlcnJvckZpbGUgPSAiZGljdGlvbmFyeS9FcnJvckNvZGVzLmx2byIKICAgIHRyeToKICAgICAgICAjIHdpdGggb3BlbihlcnJvckZpbGUsICdyJykgYXMgZjoKICAgICAgICBmID0gb3BlbihlcnJvckZpbGUsICdyJykKICAgICAgICBmb3IgbGluZSBpbiBmOgogICAgICAgICAgICBpZignPScgaW4gbGluZSk6CiAgICAgICAgICAgICAgICBkYXRhID0gbGluZS5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICBpZihkYXRhWzBdLnN0cmlwKCkgPT0gZXJyb3JDb2RlKToKICAgICAgICAgICAgICAgICAgICBlcnJvclN0cmluZyA9IGRhdGFbMV0uc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvclN0cmluZwogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBlcnJvclN0cmluZyA9IGNub3NfZXJyb3Jjb2Rlcy5nZXRFcnJvclN0cmluZyhlcnJvckNvZGUpCiAgICAgICAgZXJyb3JTdHJpbmcgPSBlcnJvclN0cmluZy5zdHJpcCgpCiAgICAgICAgcmV0dXJuIGVycm9yU3RyaW5nCiAgICByZXR1cm4gIkVycm9yIENvZGUgTm90IEZvdW5kIgojIEVPTQoKCmRlZiBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgdmFyaWFibGVJZCwgdmFyaWFibGVWYWx1ZSk6CiAgICByZXRWYWwgPSAiIgogICAgcnVsZUZpbGUgPSAiZGljdGlvbmFyeS8iICsgZGV2aWNlVHlwZSArICJfcnVsZXMubHZvIgogICAgcnVsZVN0cmluZyA9IGdldFJ1bGVTdHJpbmdGb3JWYXJpYWJsZShkZXZpY2VUeXBlLCBydWxlRmlsZSwgdmFyaWFibGVJZCkKICAgIHJldFZhbCA9IHZhbGlkYXRlVmFsdWVBZ2FpbnN0UnVsZShydWxlU3RyaW5nLCB2YXJpYWJsZVZhbHVlKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBnZXRSdWxlU3RyaW5nRm9yVmFyaWFibGUoZGV2aWNlVHlwZSwgcnVsZUZpbGUsIHZhcmlhYmxlSWQpOgogICAgcmV0VmFsID0gIiIKICAgIHRyeToKICAgICAgICAjIHdpdGggb3BlbihydWxlRmlsZSwgJ3InKSBhcyBmOgogICAgICAgIGYgPSBvcGVuKGVycm9yRmlsZSwgJ3InKQogICAgICAgIGZvciBsaW5lIGluIGY6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQobGluZSkKICAgICAgICAgICAgaWYoJzonIGluIGxpbmUpOgogICAgICAgICAgICAgICAgZGF0YSA9IGxpbmUuc3BsaXQoJzonKQogICAgICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChkYXRhWzBdKQogICAgICAgICAgICAgICAgaWYoZGF0YVswXS5zdHJpcCgpID09IHZhcmlhYmxlSWQpOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9IGxpbmUKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcnVsZVN0cmluZyA9IGNub3NfZGV2aWNlcnVsZXMuZ2V0UnVsZVN0cmluZyhkZXZpY2VUeXBlLCB2YXJpYWJsZUlkKQogICAgICAgIHJldFZhbCA9IHJ1bGVTdHJpbmcuc3RyaXAoKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiB2YWxpZGF0ZVZhbHVlQWdhaW5zdFJ1bGUocnVsZVN0cmluZywgdmFyaWFibGVWYWx1ZSk6CgogICAgcmV0VmFsID0gIiIKICAgIGlmKHJ1bGVTdHJpbmcgPT0gIiIpOgogICAgICAgIHJldHVybiAxCiAgICBydWxlcyA9IHJ1bGVTdHJpbmcuc3BsaXQoJzonKQogICAgdmFyaWFibGVUeXBlID0gcnVsZXNbMV0uc3RyaXAoKQogICAgdmFyUmFuZ2UgPSBydWxlc1syXS5zdHJpcCgpCiAgICBpZih2YXJpYWJsZVR5cGUgPT0gIklOVEVHRVIiKToKICAgICAgICByZXN1bHQgPSBjaGVja0ludGVnZXIodmFyaWFibGVWYWx1ZSkKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTEiCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiRkxPQVQiKToKICAgICAgICByZXN1bHQgPSBjaGVja0Zsb2F0KHZhcmlhYmxlVmFsdWUpCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTEyIgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJJTlRFR0VSX1ZBTFVFIik6CiAgICAgICAgaW50X3JhbmdlID0gdmFyUmFuZ2Uuc3BsaXQoJy0nKQogICAgICAgIHIgPSByYW5nZShpbnQoaW50X3JhbmdlWzBdLnN0cmlwKCkpLCBpbnQoaW50X3JhbmdlWzFdLnN0cmlwKCkpKQogICAgICAgIGlmKGNoZWNrSW50ZWdlcih2YXJpYWJsZVZhbHVlKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTExIgogICAgICAgIHJlc3VsdCA9IGludCh2YXJpYWJsZVZhbHVlKSBpbiByCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTEzIgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJJTlRFR0VSX1ZBTFVFX1JBTkdFIik6CiAgICAgICAgaW50X3JhbmdlID0gdmFyUmFuZ2Uuc3BsaXQoJy0nKQogICAgICAgIHZhckxvd2VyID0gaW50X3JhbmdlWzBdLnN0cmlwKCkKICAgICAgICB2YXJIaWdoZXIgPSBpbnRfcmFuZ2VbMV0uc3RyaXAoKQogICAgICAgIHIgPSByYW5nZShpbnQodmFyTG93ZXIpLCBpbnQodmFySGlnaGVyKSkKICAgICAgICB2YWxfcmFuZ2UgPSB2YXJpYWJsZVZhbHVlLnNwbGl0KCctJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZhbExvd2VyID0gdmFsX3JhbmdlWzBdLnN0cmlwKCkKICAgICAgICAgICAgdmFsSGlnaGVyID0gdmFsX3JhbmdlWzFdLnN0cmlwKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExMyIKICAgICAgICBpZigoY2hlY2tJbnRlZ2VyKHZhbExvd2VyKSBpcyBub3QgVHJ1ZSkgb3IKICAgICAgICAgICAgICAgIChjaGVja0ludGVnZXIodmFsSGlnaGVyKSBpcyBub3QgVHJ1ZSkpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJFcnJvci0xMTQiKQogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExNCIKICAgICAgICByZXN1bHQgPSAoaW50KHZhbExvd2VyKSBpbiByKSBhbmQgKGludCh2YWxIaWdoZXIpaW4gcikgXAogICAgICAgICAgICBhbmQgKGludCh2YWxMb3dlcikgPCBpbnQodmFsSGlnaGVyKSkKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgiRXJyb3ItMTEzIikKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTMiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIklOVEVHRVJfT1BUSU9OUyIpOgogICAgICAgIGludF9vcHRpb25zID0gdmFyUmFuZ2Uuc3BsaXQoJywnKQogICAgICAgIGlmKGNoZWNrSW50ZWdlcih2YXJpYWJsZVZhbHVlKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTExIgogICAgICAgIGZvciBvcHQgaW4gaW50X29wdGlvbnM6CiAgICAgICAgICAgIGlmKG9wdC5zdHJpcCgpIGlzIHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTUiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIkxPTkciKToKICAgICAgICByZXN1bHQgPSBjaGVja0xvbmcodmFyaWFibGVWYWx1ZSkKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTYiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIkxPTkdfVkFMVUUiKToKICAgICAgICBsb25nX3JhbmdlID0gdmFyUmFuZ2Uuc3BsaXQoJy0nKQogICAgICAgIHIgPSByYW5nZShsb25nKGxvbmdfcmFuZ2VbMF0uc3RyaXAoKSksIGxvbmcobG9uZ19yYW5nZVsxXS5zdHJpcCgpKSkKICAgICAgICBpZihjaGVja0xvbmcodmFyaWFibGVWYWx1ZSkgaXMgbm90IFRydWUpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KHZhcmlhYmxlVmFsdWUpCiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE2IgogICAgICAgIHJlc3VsdCA9IGxvbmcodmFyaWFibGVWYWx1ZSkgaW4gcgogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExMyIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiTE9OR19WQUxVRV9SQU5HRSIpOgogICAgICAgIGxvbmdfcmFuZ2UgPSB2YXJSYW5nZS5zcGxpdCgnLScpCiAgICAgICAgciA9IHJhbmdlKGxvbmcobG9uZ19yYW5nZVswXS5zdHJpcCgpKSwgbG9uZyhsb25nX3JhbmdlWzFdLnN0cmlwKCkpKQogICAgICAgIHZhbF9yYW5nZSA9IHZhcmlhYmxlVmFsdWUuc3BsaXQoJy0nKQogICAgICAgIGlmKChjaGVja0xvbmcodmFsX3JhbmdlWzBdKSBpcyBub3QgVHJ1ZSkgb3IKICAgICAgICAgICAgICAgIChjaGVja0xvbmcodmFsX3JhbmdlWzFdKSBpcyBub3QgVHJ1ZSkpOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExNyIKICAgICAgICByZXN1bHQgPSAodmFsX3JhbmdlWzBdIGluIHIpIGFuZCAoCiAgICAgICAgICAgIHZhbF9yYW5nZVsxXSBpbiByKSBhbmQgKHZhbF9yYW5nZVswXSA8IHZhbF9yYW5nZVsxXSkKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTMiCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiTE9OR19PUFRJT05TIik6CiAgICAgICAgbG9uZ19vcHRpb25zID0gdmFyUmFuZ2Uuc3BsaXQoJywnKQogICAgICAgIGlmKGNoZWNrTG9uZyh2YXJpYWJsZVZhbHVlKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE2IgogICAgICAgIGZvciBvcHQgaW4gbG9uZ19vcHRpb25zOgogICAgICAgICAgICBpZihvcHQuc3RyaXAoKSA9PSB2YXJpYWJsZVZhbHVlKToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE1IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJURVhUIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE4IgogICAgICAgIGlmKFRydWUgaXMgaXNpbnN0YW5jZSh2YXJpYWJsZVZhbHVlLCBzdHIpKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExOSIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiTk9fVkFMSURBVElPTiIpOgogICAgICAgIGlmKHZhcmlhYmxlVmFsdWUgPT0gIiIpOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExOCIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIm9rIgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJURVhUX09SX0VNUFRZIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSBpcyBOb25lIG9yIHZhcmlhYmxlVmFsdWUgPT0gIiIpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGlmKHJlc3VsdCA9PSBpc2luc3RhbmNlKHZhcmlhYmxlVmFsdWUsIHN0cikpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJNQVRDSF9URVhUIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE4IgogICAgICAgIGlmKGlzaW5zdGFuY2UodmFyaWFibGVWYWx1ZSwgc3RyKSk6CiAgICAgICAgICAgIGlmKHZhclJhbmdlID09IHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTIwIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJNQVRDSF9URVhUX09SX0VNUFRZIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSBpcyBOb25lIG9yIHZhcmlhYmxlVmFsdWUgPT0gIiIpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGlmKGlzaW5zdGFuY2UodmFyaWFibGVWYWx1ZSwgc3RyKSk6CiAgICAgICAgICAgIGlmKHZhclJhbmdlID09IHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTIwIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJURVhUX09QVElPTlMiKToKICAgICAgICBzdHJfb3B0aW9ucyA9IHZhclJhbmdlLnNwbGl0KCcsJykKICAgICAgICBpZihpc2luc3RhbmNlKHZhcmlhYmxlVmFsdWUsIHN0cikgaXMgbm90IFRydWUpOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExOSIKICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIGZvciBvcHQgaW4gc3RyX29wdGlvbnM6CiAgICAgICAgICAgIGlmKG9wdC5zdHJpcCgpID09IHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTUiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIlRFWFRfT1BUSU9OU19PUl9FTVBUWSIpOgogICAgICAgIGlmKHZhcmlhYmxlVmFsdWUgaXMgTm9uZSBvciB2YXJpYWJsZVZhbHVlID09ICIiKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBzdHJfb3B0aW9ucyA9IHZhclJhbmdlLnNwbGl0KCcsJykKICAgICAgICBpZihpc2luc3RhbmNlKHZhcmlhYmxlVmFsdWUsIHN0cikgaXMgbm90IFRydWUpOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExOSIKICAgICAgICBmb3Igb3B0IGluIHN0cl9vcHRpb25zOgogICAgICAgICAgICBpZihvcHQuc3RyaXAoKSA9PSB2YXJpYWJsZVZhbHVlKToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE1IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJJUFY0QWRkcmVzcyIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc29ja2V0LmluZXRfcHRvbihzb2NrZXQuQUZfSU5FVCwgdmFyaWFibGVWYWx1ZSkKICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgIGV4Y2VwdCBzb2NrZXQuRXJyb3I6CiAgICAgICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTIxIgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIklQVjRBZGRyZXNzV2l0aE1hc2siKToKICAgICAgICBpZih2YXJpYWJsZVZhbHVlIGlzIE5vbmUgb3IgdmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgogICAgICAgIHN0cl9vcHRpb25zID0gdmFyaWFibGVWYWx1ZS5zcGxpdCgnLycpCiAgICAgICAgaXBhZGRyID0gc3RyX29wdGlvbnNbMF0KICAgICAgICBtYXNrID0gc3RyX29wdGlvbnNbMV0KICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvY2tldC5pbmV0X3B0b24oc29ja2V0LkFGX0lORVQsIGlwYWRkcikKICAgICAgICAgICAgaWYoY2hlY2tJbnRlZ2VyKG1hc2spIGlzIFRydWUpOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICBleGNlcHQgc29ja2V0LkVycm9yOgogICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTEyMSIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiSVBWNkFkZHJlc3MiKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvY2tldC5pbmV0X3B0b24oc29ja2V0LkFGX0lORVQ2LCB2YXJpYWJsZVZhbHVlKQogICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgZXhjZXB0IHNvY2tldC5FcnJvcjoKICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMjIiCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBkaXNhYmxlUGFnaW5nKHJlbW90ZV9jb25uKToKICAgIHJlbW90ZV9jb25uLnNlbmQoInRlcm1pbmFsIGxlbmd0aCAwXG4iKQogICAgdGltZS5zbGVlcCgxKQogICAgIyBDbGVhciB0aGUgYnVmZmVyIG9uIHRoZSBzY3JlZW4KICAgIG91dHB1dEJ5dGUgPSByZW1vdGVfY29ubi5yZWN2KDEwMDApCiAgICBvdXRwdXQgPSBvdXRwdXRCeXRlLmRlY29kZSgpCiAgICByZXR1cm4gb3V0cHV0CiMgRU9NCgoKZGVmIGNoZWNrSW50ZWdlcihzKToKICAgIHRyeToKICAgICAgICBpbnQocykKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmV0dXJuIEZhbHNlCiMgRU9NCgoKZGVmIGNoZWNrRmxvYXQocyk6CiAgICB0cnk6CiAgICAgICAgZmxvYXQocykKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmV0dXJuIEZhbHNlCiMgRU9NCgoKZGVmIGNoZWNrTG9uZyhzKToKICAgIHRyeToKICAgICAgICBsb25nKHMpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiBkZWJ1Z091dHB1dChjb21tYW5kKToKICAgIGYgPSBvcGVuKCdkZWJ1Z091cHV0LnR4dCcsICdhJykKICAgIGYud3JpdGUoc3RyKGNvbW1hbmQpKSAgIyBweXRob24gd2lsbCBjb252ZXJ0IFxuIHRvIG9zLmxpbmVzZXAKICAgIGYuY2xvc2UoKSAgIyB5b3UgY2FuIG9taXQgaW4gbW9zdCBjYXNlcyBhcyB0aGUgZGVzdHJ1Y3RvciB3aWxsIGNhbGwgaXQKIyBFT00KUEsDBBQAAAAAAOC7K0u12AQGJTAAACUwAAAdAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvX3RleHQucHkjIFRoaXMgY29kZSBpcyBwYXJ0IG9mIEFuc2libGUsIGJ1dCBpcyBhbiBpbmRlcGVuZGVudCBjb21wb25lbnQuCiMgVGhpcyBwYXJ0aWN1bGFyIGZpbGUgc25pcHBldCwgYW5kIHRoaXMgZmlsZSBzbmlwcGV0IG9ubHksIGlzIEJTRCBsaWNlbnNlZC4KIyBNb2R1bGVzIHlvdSB3cml0ZSB1c2luZyB0aGlzIHNuaXBwZXQsIHdoaWNoIGlzIGVtYmVkZGVkIGR5bmFtaWNhbGx5IGJ5IEFuc2libGUKIyBzdGlsbCBiZWxvbmcgdG8gdGhlIGF1dGhvciBvZiB0aGUgbW9kdWxlLCBhbmQgbWF5IGFzc2lnbiB0aGVpciBvd24gbGljZW5zZQojIHRvIHRoZSBjb21wbGV0ZSB3b3JrLgojCiMgQ29weXJpZ2h0IChjKSwgVG9zaGlvIEt1cmF0b21pIDxhLmJhZGdlckBnbWFpbC5jb20+LCAyMDE2CiMKIyBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLAojIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKIwojICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKIyAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KIyAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKIyAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KIyAgICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgojCiMgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiIEFORAojIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVECiMgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELgojIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULAojIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKIyBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKIyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUCiMgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFCiMgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiMKCiIiIgouLiB3YXJuOjogVGhpcyBtb2R1bGVfdXRpbCBpcyBjdXJyZW50bHkgaW50ZXJuYWwgaW1wbGVtZW50YXRpb24uCiAgICBXZSB3YW50IHRvIGV2YWx1YXRlIHRoaXMgY29kZSBmb3Igc3RhYmlsaXR5IGFuZCBBUEkgc3VpdGFiaWxpdHkgYmVmb3JlCiAgICBtYWtpbmcgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZ3VhcmFudGVlcy4gIFRoZSBBUEkgbWF5IGNoYW5nZSBiZXR3ZWVuCiAgICByZWxlYXNlcy4gIERvIG5vdCB1c2UgdGhpcyB1bmxlc3MgeW91IGFyZSB3aWxsaW5nIHRvIHBvcnQgeW91ciBtb2R1bGUgY29kZS4KIiIiCmltcG9ydCBjb2RlY3MKCmZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4IGltcG9ydCBQWTMsIHRleHRfdHlwZSwgYmluYXJ5X3R5cGUKCgp0cnk6CiAgICBjb2RlY3MubG9va3VwX2Vycm9yKCdzdXJyb2dhdGVlc2NhcGUnKQogICAgSEFTX1NVUlJPR0FURUVTQ0FQRSA9IFRydWUKZXhjZXB0IExvb2t1cEVycm9yOgogICAgSEFTX1NVUlJPR0FURUVTQ0FQRSA9IEZhbHNlCgoKX0NPTVBPU0VEX0VSUk9SX0hBTkRMRVJTID0gZnJvemVuc2V0KChOb25lLCAnc3Vycm9nYXRlX29yX2VzY2FwZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3Vycm9nYXRlX29yX3N0cmljdCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3Vycm9nYXRlX3RoZW5fcmVwbGFjZScpKQoKCmRlZiB0b19ieXRlcyhvYmosIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz1Ob25lLCBub25zdHJpbmc9J3NpbXBsZXJlcHInKToKICAgICIiIk1ha2Ugc3VyZSB0aGF0IGEgc3RyaW5nIGlzIGEgYnl0ZSBzdHJpbmcKCiAgICA6YXJnIG9iajogQW4gb2JqZWN0IHRvIG1ha2Ugc3VyZSBpcyBhIGJ5dGUgc3RyaW5nLiAgSW4gbW9zdCBjYXNlcyB0aGlzCiAgICAgICAgd2lsbCBiZSBlaXRoZXIgYSB0ZXh0IHN0cmluZyBvciBhIGJ5dGUgc3RyaW5nLiAgSG93ZXZlciwgd2l0aAogICAgICAgIGBgbm9uc3RyaW5nPSdzaW1wbGVyZXByJ2BgLCB0aGlzIGNhbiBiZSB1c2VkIGFzIGEgdHJhY2ViYWNrLWZyZWUKICAgICAgICB2ZXJzaW9uIG9mIGBgc3RyKG9iailgYC4KICAgIDprd2FyZyBlbmNvZGluZzogVGhlIGVuY29kaW5nIHRvIHVzZSB0byB0cmFuc2Zvcm0gZnJvbSBhIHRleHQgc3RyaW5nIHRvCiAgICAgICAgYSBieXRlIHN0cmluZy4gIERlZmF1bHRzIHRvIHVzaW5nICd1dGYtOCcuCiAgICA6a3dhcmcgZXJyb3JzOiBUaGUgZXJyb3IgaGFuZGxlciB0byB1c2UgaWYgdGhlIHRleHQgc3RyaW5nIGlzIG5vdAogICAgICAgIGVuY29kYWJsZSB1c2luZyB0aGUgc3BlY2lmaWVkIGVuY29kaW5nLiAgQW55IHZhbGlkIGBjb2RlY3MgZXJyb3IKICAgICAgICBoYW5kbGVyIDxodHRwczovL2RvY3MucHl0aG9uLm9yZy8yL2xpYnJhcnkvY29kZWNzLmh0bWwjY29kZWMtYmFzZS1jbGFzc2VzPmBfCiAgICAgICAgbWF5IGJlIHNwZWNpZmllZC4gVGhlcmUgYXJlIHRocmVlIGFkZGl0aW9uYWwgZXJyb3Igc3RyYXRlZ2llcwogICAgICAgIHNwZWNpZmljYWxseSBhaW1lZCBhdCBoZWxwaW5nIHBlb3BsZSB0byBwb3J0IGNvZGUuICBUaGUgZmlyc3QgdHdvIGFyZToKCiAgICAgICAgICAgIDpzdXJyb2dhdGVfb3Jfc3RyaWN0OiBXaWxsIHVzZSBgYHN1cnJvZ2F0ZWVzY2FwZWBgIGlmIGl0IGlzIGEgdmFsaWQKICAgICAgICAgICAgICAgIGhhbmRsZXIsIG90aGVyd2lzZSBpdCB3aWxsIHVzZSBgYHN0cmljdGBgCiAgICAgICAgICAgIDpzdXJyb2dhdGVfb3JfcmVwbGFjZTogV2lsbCB1c2UgYGBzdXJyb2dhdGVlc2NhcGVgYCBpZiBpdCBpcyBhIHZhbGlkCiAgICAgICAgICAgICAgICBoYW5kbGVyLCBvdGhlcndpc2UgaXQgd2lsbCB1c2UgYGByZXBsYWNlYGAuCgogICAgICAgIEJlY2F1c2UgYGBzdXJyb2dhdGVlc2NhcGVgYCB3YXMgYWRkZWQgaW4gUHl0aG9uMyB0aGlzIHVzdWFsbHkgbWVhbnMgdGhhdAogICAgICAgIFB5dGhvbjMgd2lsbCB1c2UgYGBzdXJyb2dhdGVlc2NhcGVgYCBhbmQgUHl0aG9uMiB3aWxsIHVzZSB0aGUgZmFsbGJhY2sKICAgICAgICBlcnJvciBoYW5kbGVyLiBOb3RlIHRoYXQgdGhlIGNvZGUgY2hlY2tzIGZvciBgYHN1cnJvZ2F0ZWVzY2FwZWBgIHdoZW4gdGhlCiAgICAgICAgbW9kdWxlIGlzIGltcG9ydGVkLiAgSWYgeW91IGhhdmUgYSBiYWNrcG9ydCBvZiBgYHN1cnJvZ2F0ZWVzY2FwZWBgIGZvcgogICAgICAgIFB5dGhvbjIsIGJlIHN1cmUgdG8gcmVnaXN0ZXIgdGhlIGVycm9yIGhhbmRsZXIgcHJpb3IgdG8gaW1wb3J0aW5nIHRoaXMKICAgICAgICBtb2R1bGUuCgogICAgICAgIFRoZSBsYXN0IGVycm9yIGhhbmRsZXIgaXM6CgogICAgICAgICAgICA6c3Vycm9nYXRlX3RoZW5fcmVwbGFjZTogV2lsbCB1c2UgYGBzdXJyb2dhdGVlc2NhcGVgYCBpZiBpdCBpcyBhIHZhbGlkCiAgICAgICAgICAgICAgICBoYW5kbGVyLiAgSWYgZW5jb2Rpbmcgd2l0aCBgYHN1cnJvZ2F0ZWVzY2FwZWBgIHdvdWxkIHRyYWNlYmFjaywKICAgICAgICAgICAgICAgIHN1cnJvZ2F0ZXMgYXJlIGZpcnN0IHJlcGxhY2VkIHdpdGggYSByZXBsYWNlbWVudCBjaGFyYWN0ZXJzCiAgICAgICAgICAgICAgICBhbmQgdGhlbiB0aGUgc3RyaW5nIGlzIGVuY29kZWQgdXNpbmcgYGByZXBsYWNlYGAgKHdoaWNoIHJlcGxhY2VzCiAgICAgICAgICAgICAgICB0aGUgcmVzdCBvZiB0aGUgbm9uZW5jb2RhYmxlIGJ5dGVzKS4gIElmIGBgc3Vycm9nYXRlZXNjYXBlYGAgaXMKICAgICAgICAgICAgICAgIG5vdCBwcmVzZW50IGl0IHdpbGwgc2ltcGx5IHVzZSBgYHJlcGxhY2VgYC4gIChBZGRlZCBpbiBBbnNpYmxlIDIuMykKICAgICAgICAgICAgICAgIFRoaXMgc3RyYXRlZ3kgaXMgZGVzaWduZWQgdG8gbmV2ZXIgdHJhY2ViYWNrIHdoZW4gaXQgYXR0ZW1wdHMKICAgICAgICAgICAgICAgIHRvIGVuY29kZSBhIHN0cmluZy4KCiAgICAgICAgVGhlIGRlZmF1bHQgdW50aWwgQW5zaWJsZS0yLjIgd2FzIGBgc3Vycm9nYXRlX29yX3JlcGxhY2VgYAogICAgICAgIEZyb20gQW5zaWJsZS0yLjMgb253YXJkcywgdGhlIGRlZmF1bHQgaXMgYGBzdXJyb2dhdGVfdGhlbl9yZXBsYWNlYGAuCgogICAgOmt3YXJnIG5vbnN0cmluZzogVGhlIHN0cmF0ZWd5IHRvIHVzZSBpZiBhIG5vbnN0cmluZyBpcyBzcGVjaWZpZWQgaW4KICAgICAgICBgYG9iamBgLiAgRGVmYXVsdCBpcyAnc2ltcGxlcmVwcicuICBWYWxpZCB2YWx1ZXMgYXJlOgoKICAgICAgICA6c2ltcGxlcmVwcjogVGhlIGRlZmF1bHQuICBUaGlzIHRha2VzIHRoZSBgYHN0cmBgIG9mIHRoZSBvYmplY3QgYW5kCiAgICAgICAgICAgIHRoZW4gcmV0dXJucyB0aGUgYnl0ZXMgdmVyc2lvbiBvZiB0aGF0IHN0cmluZy4KICAgICAgICA6ZW1wdHk6IFJldHVybiBhbiBlbXB0eSBieXRlIHN0cmluZwogICAgICAgIDpwYXNzdGhydTogUmV0dXJuIHRoZSBvYmplY3QgcGFzc2VkIGluCiAgICAgICAgOnN0cmljdDogUmFpc2UgYSA6ZXhjOmBUeXBlRXJyb3JgCgogICAgOnJldHVybnM6IFR5cGljYWxseSB0aGlzIHJldHVybnMgYSBieXRlIHN0cmluZy4gIElmIGEgbm9uc3RyaW5nIG9iamVjdCBpcwogICAgICAgIHBhc3NlZCBpbiB0aGlzIG1heSBiZSBhIGRpZmZlcmVudCB0eXBlIGRlcGVuZGluZyBvbiB0aGUgc3RyYXRlZ3kKICAgICAgICBzcGVjaWZpZWQgYnkgbm9uc3RyaW5nLiAgVGhpcyB3aWxsIG5ldmVyIHJldHVybiBhIHRleHQgc3RyaW5nLgoKICAgIC4uIG5vdGU6OiBJZiBwYXNzZWQgYSBieXRlIHN0cmluZywgdGhpcyBmdW5jdGlvbiBkb2VzIG5vdCBjaGVjayB0aGF0IHRoZQogICAgICAgIHN0cmluZyBpcyB2YWxpZCBpbiB0aGUgc3BlY2lmaWVkIGVuY29kaW5nLiAgSWYgaXQncyBpbXBvcnRhbnQgdGhhdCB0aGUKICAgICAgICBieXRlIHN0cmluZyBpcyBpbiB0aGUgc3BlY2lmaWVkIGVuY29kaW5nIGRvOjoKCiAgICAgICAgICAgIGVuY29kZWRfc3RyaW5nID0gdG9fYnl0ZXModG9fdGV4dChpbnB1dF9zdHJpbmcsICdsYXRpbi0xJyksICd1dGYtOCcpCgogICAgLi4gdmVyc2lvbl9jaGFuZ2VkOjogMi4zCgogICAgICAgIEFkZGVkIHRoZSBgYHN1cnJvZ2F0ZV90aGVuX3JlcGxhY2VgYCBlcnJvciBoYW5kbGVyIGFuZCBtYWRlIGl0IHRoZSBkZWZhdWx0IGVycm9yIGhhbmRsZXIuCiAgICAiIiIKICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgcmV0dXJuIG9iagoKICAgICMgV2UncmUgZ2l2ZW4gYSB0ZXh0IHN0cmluZwogICAgIyBJZiBpdCBoYXMgc3Vycm9nYXRlcywgd2Uga25vdyBiZWNhdXNlIGl0IHdpbGwgZGVjb2RlCiAgICBvcmlnaW5hbF9lcnJvcnMgPSBlcnJvcnMKICAgIGlmIGVycm9ycyBpbiBfQ09NUE9TRURfRVJST1JfSEFORExFUlM6CiAgICAgICAgaWYgSEFTX1NVUlJPR0FURUVTQ0FQRToKICAgICAgICAgICAgZXJyb3JzID0gJ3N1cnJvZ2F0ZWVzY2FwZScKICAgICAgICBlbGlmIGVycm9ycyA9PSAnc3Vycm9nYXRlX29yX3N0cmljdCc6CiAgICAgICAgICAgIGVycm9ycyA9ICdzdHJpY3QnCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZXJyb3JzID0gJ3JlcGxhY2UnCgogICAgaWYgaXNpbnN0YW5jZShvYmosIHRleHRfdHlwZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFRyeSB0aGlzIGZpcnN0IGFzIGl0J3MgdGhlIGZhc3Rlc3QKICAgICAgICAgICAgcmV0dXJuIG9iai5lbmNvZGUoZW5jb2RpbmcsIGVycm9ycykKICAgICAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOgogICAgICAgICAgICBpZiBvcmlnaW5hbF9lcnJvcnMgaW4gKE5vbmUsICdzdXJyb2dhdGVfdGhlbl9yZXBsYWNlJyk6CiAgICAgICAgICAgICAgICAjIFNsb3cgYnV0IHdvcmtzCiAgICAgICAgICAgICAgICByZXR1cm5fc3RyaW5nID0gb2JqLmVuY29kZSgndXRmLTgnLCAnc3Vycm9nYXRlZXNjYXBlJykKICAgICAgICAgICAgICAgIHJldHVybl9zdHJpbmcgPSByZXR1cm5fc3RyaW5nLmRlY29kZSgndXRmLTgnLCAncmVwbGFjZScpCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuX3N0cmluZy5lbmNvZGUoZW5jb2RpbmcsICdyZXBsYWNlJykKICAgICAgICAgICAgcmFpc2UKCiAgICAjIE5vdGU6IFdlIGRvIHRoZXNlIGxhc3QgZXZlbiB0aG91Z2ggd2UgaGF2ZSB0byBjYWxsIHRvX2J5dGVzIGFnYWluIG9uIHRoZQogICAgIyB2YWx1ZSBiZWNhdXNlIHdlJ3JlIG9wdGltaXppbmcgdGhlIGNvbW1vbiBjYXNlCiAgICBpZiBub25zdHJpbmcgPT0gJ3NpbXBsZXJlcHInOgogICAgICAgIHRyeToKICAgICAgICAgICAgdmFsdWUgPSBzdHIob2JqKQogICAgICAgIGV4Y2VwdCBVbmljb2RlRXJyb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHZhbHVlID0gcmVwcihvYmopCiAgICAgICAgICAgIGV4Y2VwdCBVbmljb2RlRXJyb3I6CiAgICAgICAgICAgICAgICAjIEdpdmluZyB1cAogICAgICAgICAgICAgICAgcmV0dXJuIHRvX2J5dGVzKCcnKQogICAgZWxpZiBub25zdHJpbmcgPT0gJ3Bhc3N0aHJ1JzoKICAgICAgICByZXR1cm4gb2JqCiAgICBlbGlmIG5vbnN0cmluZyA9PSAnZW1wdHknOgogICAgICAgICMgcHl0aG9uMi40IGRvZXNuJ3QgaGF2ZSBiJycKICAgICAgICByZXR1cm4gdG9fYnl0ZXMoJycpCiAgICBlbGlmIG5vbnN0cmluZyA9PSAnc3RyaWN0JzoKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ29iaiBtdXN0IGJlIGEgc3RyaW5nIHR5cGUnKQogICAgZWxzZToKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJ0ludmFsaWQgdmFsdWUgJXMgZm9yIHRvX2J5dGVzXCcgbm9uc3RyaW5nIHBhcmFtZXRlcicgJSBub25zdHJpbmcpCgogICAgcmV0dXJuIHRvX2J5dGVzKHZhbHVlLCBlbmNvZGluZywgZXJyb3JzKQoKCmRlZiB0b190ZXh0KG9iaiwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPU5vbmUsIG5vbnN0cmluZz0nc2ltcGxlcmVwcicpOgogICAgIiIiTWFrZSBzdXJlIHRoYXQgYSBzdHJpbmcgaXMgYSB0ZXh0IHN0cmluZwoKICAgIDphcmcgb2JqOiBBbiBvYmplY3QgdG8gbWFrZSBzdXJlIGlzIGEgdGV4dCBzdHJpbmcuICBJbiBtb3N0IGNhc2VzIHRoaXMKICAgICAgICB3aWxsIGJlIGVpdGhlciBhIHRleHQgc3RyaW5nIG9yIGEgYnl0ZSBzdHJpbmcuICBIb3dldmVyLCB3aXRoCiAgICAgICAgYGBub25zdHJpbmc9J3NpbXBsZXJlcHInYGAsIHRoaXMgY2FuIGJlIHVzZWQgYXMgYSB0cmFjZWJhY2stZnJlZQogICAgICAgIHZlcnNpb24gb2YgYGBzdHIob2JqKWBgLgogICAgOmt3YXJnIGVuY29kaW5nOiBUaGUgZW5jb2RpbmcgdG8gdXNlIHRvIHRyYW5zZm9ybSBmcm9tIGEgYnl0ZSBzdHJpbmcgdG8KICAgICAgICBhIHRleHQgc3RyaW5nLiAgRGVmYXVsdHMgdG8gdXNpbmcgJ3V0Zi04Jy4KICAgIDprd2FyZyBlcnJvcnM6IFRoZSBlcnJvciBoYW5kbGVyIHRvIHVzZSBpZiB0aGUgYnl0ZSBzdHJpbmcgaXMgbm90CiAgICAgICAgZGVjb2RhYmxlIHVzaW5nIHRoZSBzcGVjaWZpZWQgZW5jb2RpbmcuICBBbnkgdmFsaWQgYGNvZGVjcyBlcnJvcgogICAgICAgIGhhbmRsZXIgPGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzIvbGlicmFyeS9jb2RlY3MuaHRtbCNjb2RlYy1iYXNlLWNsYXNzZXM+YF8KICAgICAgICBtYXkgYmUgc3BlY2lmaWVkLiAgIFdlIHN1cHBvcnQgdGhyZWUgYWRkaXRpb25hbCBlcnJvciBzdHJhdGVnaWVzCiAgICAgICAgc3BlY2lmaWNhbGx5IGFpbWVkIGF0IGhlbHBpbmcgcGVvcGxlIHRvIHBvcnQgY29kZToKCiAgICAgICAgICAgIDpzdXJyb2dhdGVfb3Jfc3RyaWN0OiBXaWxsIHVzZSBzdXJyb2dhdGVlc2NhcGUgaWYgaXQgaXMgYSB2YWxpZAogICAgICAgICAgICAgICAgaGFuZGxlciwgb3RoZXJ3aXNlIGl0IHdpbGwgdXNlIHN0cmljdAogICAgICAgICAgICA6c3Vycm9nYXRlX29yX3JlcGxhY2U6IFdpbGwgdXNlIHN1cnJvZ2F0ZWVzY2FwZSBpZiBpdCBpcyBhIHZhbGlkCiAgICAgICAgICAgICAgICBoYW5kbGVyLCBvdGhlcndpc2UgaXQgd2lsbCB1c2UgcmVwbGFjZS4KICAgICAgICAgICAgOnN1cnJvZ2F0ZV90aGVuX3JlcGxhY2U6IERvZXMgdGhlIHNhbWUgYXMgc3Vycm9nYXRlX29yX3JlcGxhY2UgYnV0CiAgICAgICAgICAgICAgICBgd2FzIGFkZGVkIGZvciBzeW1tZXRyeSB3aXRoIHRoZSBlcnJvciBoYW5kbGVycyBpbgogICAgICAgICAgICAgICAgOmZ1bmM6YGFuc2libGUubW9kdWxlX3V0aWxzLl90ZXh0LnRvX2J5dGVzYCAoQWRkZWQgaW4gQW5zaWJsZSAyLjMpCgogICAgICAgIEJlY2F1c2Ugc3Vycm9nYXRlZXNjYXBlIHdhcyBhZGRlZCBpbiBQeXRob24zIHRoaXMgdXN1YWxseSBtZWFucyB0aGF0CiAgICAgICAgUHl0aG9uMyB3aWxsIHVzZSBgc3Vycm9nYXRlZXNjYXBlYCBhbmQgUHl0aG9uMiB3aWxsIHVzZSB0aGUgZmFsbGJhY2sKICAgICAgICBlcnJvciBoYW5kbGVyLiBOb3RlIHRoYXQgdGhlIGNvZGUgY2hlY2tzIGZvciBzdXJyb2dhdGVlc2NhcGUgd2hlbiB0aGUKICAgICAgICBtb2R1bGUgaXMgaW1wb3J0ZWQuICBJZiB5b3UgaGF2ZSBhIGJhY2twb3J0IG9mIGBzdXJyb2dhdGVlc2NhcGVgIGZvcgogICAgICAgIHB5dGhvbjIsIGJlIHN1cmUgdG8gcmVnaXN0ZXIgdGhlIGVycm9yIGhhbmRsZXIgcHJpb3IgdG8gaW1wb3J0aW5nIHRoaXMKICAgICAgICBtb2R1bGUuCgogICAgICAgIFRoZSBkZWZhdWx0IHVudGlsIEFuc2libGUtMi4yIHdhcyBgc3Vycm9nYXRlX29yX3JlcGxhY2VgCiAgICAgICAgSW4gQW5zaWJsZS0yLjMgdGhpcyBkZWZhdWx0cyB0byBgc3Vycm9nYXRlX3RoZW5fcmVwbGFjZWAgZm9yIHN5bW1ldHJ5CiAgICAgICAgd2l0aCA6ZnVuYzpgYW5zaWJsZS5tb2R1bGVfdXRpbHMuX3RleHQudG9fYnl0ZXNgIC4KICAgIDprd2FyZyBub25zdHJpbmc6IFRoZSBzdHJhdGVneSB0byB1c2UgaWYgYSBub25zdHJpbmcgaXMgc3BlY2lmaWVkIGluCiAgICAgICAgYGBvYmpgYC4gIERlZmF1bHQgaXMgJ3NpbXBsZXJlcHInLiAgVmFsaWQgdmFsdWVzIGFyZToKCiAgICAgICAgOnNpbXBsZXJlcHI6IFRoZSBkZWZhdWx0LiAgVGhpcyB0YWtlcyB0aGUgYGBzdHJgYCBvZiB0aGUgb2JqZWN0IGFuZAogICAgICAgICAgICB0aGVuIHJldHVybnMgdGhlIHRleHQgdmVyc2lvbiBvZiB0aGF0IHN0cmluZy4KICAgICAgICA6ZW1wdHk6IFJldHVybiBhbiBlbXB0eSB0ZXh0IHN0cmluZwogICAgICAgIDpwYXNzdGhydTogUmV0dXJuIHRoZSBvYmplY3QgcGFzc2VkIGluCiAgICAgICAgOnN0cmljdDogUmFpc2UgYSA6ZXhjOmBUeXBlRXJyb3JgCgogICAgOnJldHVybnM6IFR5cGljYWxseSB0aGlzIHJldHVybnMgYSB0ZXh0IHN0cmluZy4gIElmIGEgbm9uc3RyaW5nIG9iamVjdCBpcwogICAgICAgIHBhc3NlZCBpbiB0aGlzIG1heSBiZSBhIGRpZmZlcmVudCB0eXBlIGRlcGVuZGluZyBvbiB0aGUgc3RyYXRlZ3kKICAgICAgICBzcGVjaWZpZWQgYnkgbm9uc3RyaW5nLiAgVGhpcyB3aWxsIG5ldmVyIHJldHVybiBhIGJ5dGUgc3RyaW5nLgogICAgICAgIEZyb20gQW5zaWJsZS0yLjMgb253YXJkcywgdGhlIGRlZmF1bHQgaXMgYHN1cnJvZ2F0ZV90aGVuX3JlcGxhY2VgLgoKICAgIC4uIHZlcnNpb25fY2hhbmdlZDo6IDIuMwoKICAgICAgICBBZGRlZCB0aGUgc3Vycm9nYXRlX3RoZW5fcmVwbGFjZSBlcnJvciBoYW5kbGVyIGFuZCBtYWRlIGl0IHRoZSBkZWZhdWx0IGVycm9yIGhhbmRsZXIuCiAgICAiIiIKICAgIGlmIGlzaW5zdGFuY2Uob2JqLCB0ZXh0X3R5cGUpOgogICAgICAgIHJldHVybiBvYmoKCiAgICBpZiBlcnJvcnMgaW4gX0NPTVBPU0VEX0VSUk9SX0hBTkRMRVJTOgogICAgICAgIGlmIEhBU19TVVJST0dBVEVFU0NBUEU6CiAgICAgICAgICAgIGVycm9ycyA9ICdzdXJyb2dhdGVlc2NhcGUnCiAgICAgICAgZWxpZiBlcnJvcnMgPT0gJ3N1cnJvZ2F0ZV9vcl9zdHJpY3QnOgogICAgICAgICAgICBlcnJvcnMgPSAnc3RyaWN0JwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGVycm9ycyA9ICdyZXBsYWNlJwoKICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgIyBOb3RlOiBXZSBkb24ndCBuZWVkIHNwZWNpYWwgaGFuZGxpbmcgZm9yIHN1cnJvZ2F0ZV90aGVuX3JlcGxhY2UKICAgICAgICAjIGJlY2F1c2UgYWxsIGJ5dGVzIHdpbGwgZWl0aGVyIGJlIG1hZGUgaW50byBzdXJyb2dhdGVzIG9yIGFyZSB2YWxpZAogICAgICAgICMgdG8gZGVjb2RlLgogICAgICAgIHJldHVybiBvYmouZGVjb2RlKGVuY29kaW5nLCBlcnJvcnMpCgogICAgIyBOb3RlOiBXZSBkbyB0aGVzZSBsYXN0IGV2ZW4gdGhvdWdoIHdlIGhhdmUgdG8gY2FsbCB0b190ZXh0IGFnYWluIG9uIHRoZQogICAgIyB2YWx1ZSBiZWNhdXNlIHdlJ3JlIG9wdGltaXppbmcgdGhlIGNvbW1vbiBjYXNlCiAgICBpZiBub25zdHJpbmcgPT0gJ3NpbXBsZXJlcHInOgogICAgICAgIHRyeToKICAgICAgICAgICAgdmFsdWUgPSBzdHIob2JqKQogICAgICAgIGV4Y2VwdCBVbmljb2RlRXJyb3I6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHZhbHVlID0gcmVwcihvYmopCiAgICAgICAgICAgIGV4Y2VwdCBVbmljb2RlRXJyb3I6CiAgICAgICAgICAgICAgICAjIEdpdmluZyB1cAogICAgICAgICAgICAgICAgcmV0dXJuIHUnJwogICAgZWxpZiBub25zdHJpbmcgPT0gJ3Bhc3N0aHJ1JzoKICAgICAgICByZXR1cm4gb2JqCiAgICBlbGlmIG5vbnN0cmluZyA9PSAnZW1wdHknOgogICAgICAgIHJldHVybiB1JycKICAgIGVsaWYgbm9uc3RyaW5nID09ICdzdHJpY3QnOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignb2JqIG11c3QgYmUgYSBzdHJpbmcgdHlwZScpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignSW52YWxpZCB2YWx1ZSAlcyBmb3IgdG9fdGV4dFwncyBub25zdHJpbmcgcGFyYW1ldGVyJyAlIG5vbnN0cmluZykKCiAgICByZXR1cm4gdG9fdGV4dCh2YWx1ZSwgZW5jb2RpbmcsIGVycm9ycykKCgojOiA6cHk6ZnVuYzpgdG9fbmF0aXZlYAojOiAgICAgIFRyYW5zZm9ybSBhIHZhcmlhYmxlIGludG8gdGhlIG5hdGl2ZSBzdHIgdHlwZSBmb3IgdGhlIHB5dGhvbiB2ZXJzaW9uCiM6CiM6ICAgICAgT24gUHl0aG9uMiwgdGhpcyBpcyBhbiBhbGlhcyBmb3IKIzogICAgICA6ZnVuYzpgfmFuc2libGUubW9kdWxlX3V0aWxzLnRvX2J5dGVzYC4gIE9uIFB5dGhvbjMgaXQgaXMgYW4gYWxpYXMgZm9yCiM6ICAgICAgOmZ1bmM6YH5hbnNpYmxlLm1vZHVsZV91dGlscy50b190ZXh0YC4gIEl0IG1ha2VzIGl0IGVhc2llciB0bwojOiAgICAgIHRyYW5zZm9ybSBhIHZhcmlhYmxlIGludG8gdGhlIG5hdGl2ZSBzdHIgdHlwZSBmb3IgdGhlIHB5dGhvbiB2ZXJzaW9uCiM6ICAgICAgdGhlIGNvZGUgaXMgcnVubmluZyBvbi4gIFVzZSB0aGlzIHdoZW4gY29uc3RydWN0aW5nIHRoZSBtZXNzYWdlIHRvCiM6ICAgICAgc2VuZCB0byBleGNlcHRpb25zIG9yIHdoZW4gZGVhbGluZyB3aXRoIGFuIEFQSSB0aGF0IG5lZWRzIHRvIHRha2UKIzogICAgICBhIG5hdGl2ZSBzdHJpbmcuICBFeGFtcGxlOjoKIzoKIzogICAgICAgICAgdHJ5OgojOiAgICAgICAgICAgICAgMS8vMAojOiAgICAgICAgICBleGNlcHQgWmVyb0RpdmlzaW9uRXJyb3IgYXMgZToKIzogICAgICAgICAgICAgIHJhaXNlIE15RXhjZXB0aW9uKCdFbmNvdW50ZXJlZCBhbmQgZXJyb3I6ICVzJyAlIHRvX25hdGl2ZShlKSkKaWYgUFkzOgogICAgdG9fbmF0aXZlID0gdG9fdGV4dAplbHNlOgogICAgdG9fbmF0aXZlID0gdG9fYnl0ZXMKUEsDBBQAAAAAAOC7K0sl3LR+ExAAABMQAAAiAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvcHljb21wYXQyNC5weSMgVGhpcyBjb2RlIGlzIHBhcnQgb2YgQW5zaWJsZSwgYnV0IGlzIGFuIGluZGVwZW5kZW50IGNvbXBvbmVudC4KIyBUaGlzIHBhcnRpY3VsYXIgZmlsZSBzbmlwcGV0LCBhbmQgdGhpcyBmaWxlIHNuaXBwZXQgb25seSwgaXMgQlNEIGxpY2Vuc2VkLgojIE1vZHVsZXMgeW91IHdyaXRlIHVzaW5nIHRoaXMgc25pcHBldCwgd2hpY2ggaXMgZW1iZWRkZWQgZHluYW1pY2FsbHkgYnkgQW5zaWJsZQojIHN0aWxsIGJlbG9uZyB0byB0aGUgYXV0aG9yIG9mIHRoZSBtb2R1bGUsIGFuZCBtYXkgYXNzaWduIHRoZWlyIG93biBsaWNlbnNlCiMgdG8gdGhlIGNvbXBsZXRlIHdvcmsuCiMKIyBDb3B5cmlnaHQgKGMpIDIwMTYsIFRvc2hpbyBLdXJhdG9taSA8dGt1cmF0b21pQGFuc2libGUuY29tPgojIENvcHlyaWdodCAoYykgMjAxNSwgTWFyaXVzIEdlZG1pbmFzCiMKIyBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLAojIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKIwojICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKIyAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KIyAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKIyAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KIyAgICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgojCiMgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiIEFORAojIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVECiMgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELgojIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULAojIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKIyBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKIyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUCiMgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFCiMgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiMKCmltcG9ydCBzeXMKCmRlZiBnZXRfZXhjZXB0aW9uKCk6CiAgICAiIiJHZXQgdGhlIGN1cnJlbnQgZXhjZXB0aW9uLgoKICAgIFRoaXMgY29kZSBuZWVkcyB0byB3b3JrIG9uIFB5dGhvbiAyLjQgdGhyb3VnaCAzLngsIHNvIHdlIGNhbm5vdCB1c2UKICAgICJleGNlcHQgRXhjZXB0aW9uLCBlOiIgKFN5bnRheEVycm9yIG9uIFB5dGhvbiAzLngpIG5vcgogICAgImV4Y2VwdCBFeGNlcHRpb24gYXMgZToiIChTeW50YXhFcnJvciBvbiBQeXRob24gMi40LTIuNSkuCiAgICBJbnN0ZWFkIHdlIG11c3QgdXNlIDo6CgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKCiAgICAiIiIKICAgIHJldHVybiBzeXMuZXhjX2luZm8oKVsxXQoKdHJ5OgogICAgIyBQeXRob24gMi42KwogICAgZnJvbSBhc3QgaW1wb3J0IGxpdGVyYWxfZXZhbApleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAjIGEgcmVwbGFjZW1lbnQgZm9yIGxpdGVyYWxfZXZhbCB0aGF0IHdvcmtzIHdpdGggcHl0aG9uIDIuNC4gZnJvbToKICAgICMgaHR0cHM6Ly9tYWlsLnB5dGhvbi5vcmcvcGlwZXJtYWlsL3B5dGhvbi1saXN0LzIwMDktU2VwdGVtYmVyLzU1MTg4MC5odG1sCiAgICAjIHdoaWNoIGlzIGVzc2VudGlhbGx5IGEgY3V0L3Bhc3RlIGZyb20gYW4gZWFybGllciAoMi42KSB2ZXJzaW9uIG9mIHB5dGhvbidzCiAgICAjIGFzdC5weQogICAgZnJvbSBjb21waWxlciBpbXBvcnQgYXN0LCBwYXJzZQogICAgZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5zaXggaW1wb3J0IGJpbmFyeV90eXBlLCBzdHJpbmdfdHlwZXMsIHRleHRfdHlwZQoKICAgIGRlZiBsaXRlcmFsX2V2YWwobm9kZV9vcl9zdHJpbmcpOgogICAgICAgICIiIgogICAgICAgIFNhZmVseSBldmFsdWF0ZSBhbiBleHByZXNzaW9uIG5vZGUgb3IgYSBzdHJpbmcgY29udGFpbmluZyBhIFB5dGhvbgogICAgICAgIGV4cHJlc3Npb24uICBUaGUgc3RyaW5nIG9yIG5vZGUgcHJvdmlkZWQgbWF5IG9ubHkgY29uc2lzdCBvZiB0aGUgIGZvbGxvd2luZwogICAgICAgIFB5dGhvbiBsaXRlcmFsIHN0cnVjdHVyZXM6IHN0cmluZ3MsIG51bWJlcnMsIHR1cGxlcywgbGlzdHMsIGRpY3RzLCAgYm9vbGVhbnMsCiAgICAgICAgYW5kIE5vbmUuCiAgICAgICAgIiIiCiAgICAgICAgX3NhZmVfbmFtZXMgPSB7J05vbmUnOiBOb25lLCAnVHJ1ZSc6IFRydWUsICdGYWxzZSc6IEZhbHNlfQogICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZV9vcl9zdHJpbmcsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIG5vZGVfb3Jfc3RyaW5nID0gcGFyc2Uobm9kZV9vcl9zdHJpbmcsIG1vZGU9J2V2YWwnKQogICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZV9vcl9zdHJpbmcsIGFzdC5FeHByZXNzaW9uKToKICAgICAgICAgICAgbm9kZV9vcl9zdHJpbmcgPSBub2RlX29yX3N0cmluZy5ub2RlCgogICAgICAgIGRlZiBfY29udmVydChub2RlKToKICAgICAgICAgICAgIyBPa2F5IHRvIHVzZSBsb25nIGhlcmUgYmVjYXVzZSB0aGlzIGlzIG9ubHkgZm9yIHB5dGhvbiAyLjQgYW5kIDIuNQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5Db25zdCkgYW5kIGlzaW5zdGFuY2Uobm9kZS52YWx1ZSwgKHRleHRfdHlwZSwgYmluYXJ5X3R5cGUsIGludCwgZmxvYXQsIGxvbmcsIGNvbXBsZXgpKToKICAgICAgICAgICAgICAgIHJldHVybiBub2RlLnZhbHVlCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCBhc3QuVHVwbGUpOgogICAgICAgICAgICAgICAgcmV0dXJuIHR1cGxlKG1hcChfY29udmVydCwgbm9kZS5ub2RlcykpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCBhc3QuTGlzdCk6CiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdChtYXAoX2NvbnZlcnQsIG5vZGUubm9kZXMpKQogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uobm9kZSwgYXN0LkRpY3QpOgogICAgICAgICAgICAgICAgcmV0dXJuIGRpY3QoKF9jb252ZXJ0KGspLCBfY29udmVydCh2KSkgZm9yIGssIHYgaW4gbm9kZS5pdGVtcygpKQogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uobm9kZSwgYXN0Lk5hbWUpOgogICAgICAgICAgICAgICAgaWYgbm9kZS5uYW1lIGluIF9zYWZlX25hbWVzOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfc2FmZV9uYW1lc1tub2RlLm5hbWVdCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCBhc3QuVW5hcnlTdWIpOgogICAgICAgICAgICAgICAgcmV0dXJuIC1fY29udmVydChub2RlLmV4cHIpCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ21hbGZvcm1lZCBzdHJpbmcnKQogICAgICAgIHJldHVybiBfY29udmVydChub2RlX29yX3N0cmluZykKCl9fYWxsX18gPSAoJ2dldF9leGNlcHRpb24nLCAnbGl0ZXJhbF9ldmFsJykKUEsDBBQAAAAAAOC7K0sYF3L1AREAAAERAAAkAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvc2l4L19faW5pdF9fLnB5IyBUaGlzIGNvZGUgaXMgcGFydCBvZiBBbnNpYmxlLCBidXQgaXMgYW4gaW5kZXBlbmRlbnQgY29tcG9uZW50LgojIFRoaXMgcGFydGljdWxhciBmaWxlIHNuaXBwZXQsIGFuZCB0aGlzIGZpbGUgc25pcHBldCBvbmx5LCBpcyBCU0QgbGljZW5zZWQuCiMgTW9kdWxlcyB5b3Ugd3JpdGUgdXNpbmcgdGhpcyBzbmlwcGV0LCB3aGljaCBpcyBlbWJlZGRlZCBkeW5hbWljYWxseSBieSBBbnNpYmxlCiMgc3RpbGwgYmVsb25nIHRvIHRoZSBhdXRob3Igb2YgdGhlIG1vZHVsZSwgYW5kIG1heSBhc3NpZ24gdGhlaXIgb3duIGxpY2Vuc2UKIyB0byB0aGUgY29tcGxldGUgd29yay4KIwojIENvcHlyaWdodCAoYykgMjAxNywgVG9zaGlvIEt1cmF0b21pIDx0a3VyYXRvbWlAYW5zaWJsZS5jb20+CiMKIyBUaGlzIGNvZGUgaXMgYmFzZWQgb24gY29kZSBmcm9tIEFzdHJvcHkgYW5kIHJldGFpbnMgdGhlaXIgMy1jbGF1c2UgQlNEIGxpY2Vuc2UKIyByZXByb2R1Y2VkIGJlbG93OgojCiMgQ29weXJpZ2h0IChjKSAyMDExLTIwMTYsIEFzdHJvcHkgRGV2ZWxvcGVycwojCiMgQWxsIHJpZ2h0cyByZXNlcnZlZC4KIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAojIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMKIyAgIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgojICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIHRoZSBBc3Ryb3B5IFRlYW0gbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heQojICAgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAojICAgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgojCiMgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiMgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQojIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRQojIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUKIyBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTAojIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SCiMgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIKIyBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLAojIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFCiMgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KIwojIEFzdHJvcHkgTGljZW5zZTogaHR0cHM6Ly9naXRodWIuY29tL2FzdHJvcHkvYXN0cm9weS9ibG9iL2NmMzI2NWU0MmEwZGI4ZTAwYmI5MDY0NGRiMzdjODE1MGY1YWMwMGMvbGljZW5zZXMvTElDRU5TRS5yc3QKIyBBc3Ryb3B5IENvZGU6IGh0dHBzOi8vZ2l0aHViLmNvbS9hc3Ryb3B5L2FzdHJvcHkvYmxvYi9jZjMyNjVlNDJhMGRiOGUwMGJiOTA2NDRkYjM3YzgxNTBmNWFjMDBjL2FzdHJvcHkvZXh0ZXJuL3NpeC5weQoKIiIiCkhhbmRsZSBsb2FkaW5nIHNpeCBwYWNrYWdlIGZyb20gc3lzdGVtIG9yIGZyb20gdGhlIGJ1bmRsZWQgY29weQoiIiIKZnJvbSBfX2Z1dHVyZV9fIGltcG9ydCBhYnNvbHV0ZV9pbXBvcnQKCmltcG9ydCBpbXAgYXMgX2ltcAppbXBvcnQgc3lzIGFzIF9zeXMKCnRyeToKICAgIGZyb20gZGlzdHV0aWxzLnZlcnNpb24gaW1wb3J0IExvb3NlVmVyc2lvbiBhcyBfTG9vc2VWZXJzaW9uCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgU29tZSBwbGF0Zm9ybXMgKmNvdWdoKlNvbGFyaXMqY291Z2gqIGRvbid0IHNoaXAgdGhlIHdob2xlIHN0ZGxpYgogICAgX0xvb3NlVmVyc2lvbiA9IE5vbmUKCnRyeToKICAgIGltcG9ydCBzaXggYXMgX3N5c3RlbV9zaXgKZXhjZXB0IEltcG9ydEVycm9yOgogICAgX3N5c3RlbV9zaXggPSBOb25lCgpmcm9tIC4gaW1wb3J0IF9zaXggYXMgX2J1bmRsZWRfc2l4CgoKZGVmIF9maW5kX21vZHVsZShuYW1lLCBwYXRoPU5vbmUpOgogICAgIiIiQWx0ZXJuYXRpdmUgdG8gYGltcC5maW5kX21vZHVsZWAgdGhhdCBjYW4gYWxzbyBzZWFyY2ggaW4gc3VicGFja2FnZXMiIiIKICAgIHBhcnRzID0gbmFtZS5zcGxpdCgnLicpCgogICAgZm9yIHBhcnQgaW4gcGFydHM6CiAgICAgICAgaWYgcGF0aCBpcyBub3QgTm9uZToKICAgICAgICAgICAgcGF0aCA9IFtwYXRoXQogICAgICAgIGZoLCBwYXRoLCBkZXNjciA9IF9pbXAuZmluZF9tb2R1bGUocGFydCwgcGF0aCkKICAgIHJldHVybiBmaCwgcGF0aCwgZGVzY3IKCgpkZWYgX2dldF9idW5kbGVkX3NpeF9zb3VyY2UoKToKICAgICMgU3BlY2lhbCBpbXBvcnQgbG9hZGVyICh6aXBpbXBvcnQgZm9yIGluc3RhbmNlKQogICAgZm91bmQgPSBGYWxzZQogICAgZm9yIHBhdGggaW4gX3N5cy5wYXRoOgogICAgICAgIGltcG9ydGVyID0gX3N5cy5wYXRoX2ltcG9ydGVyX2NhY2hlLmdldChwYXRoKQogICAgICAgIGlmIGltcG9ydGVyOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmb3VuZCA9IGltcG9ydGVyLmZpbmRfbW9kdWxlKCdhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX3NpeCcpCiAgICAgICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIGZvdW5kOgogICAgICAgICAgICAgICAgYnJlYWsKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IoIkNvdWxkIG5vdCBmaW5kIGFuc2libGUubW9kdWxlX3V0aWxzLnNpeC5fc2l4IikKCiAgICBtb2R1bGVfc291cmNlID0gaW1wb3J0ZXIuZ2V0X3NvdXJjZSgnYW5zaWJsZS9tb2R1bGVfdXRpbHMvc2l4L19zaXgnKQogICAgcmV0dXJuIG1vZHVsZV9zb3VyY2UKCgpkZWYgX2dldF9zaXhfc291cmNlKCk6CiAgICAiIiJJbXBvcnQgdGhlIG5ld2VzdCB2ZXJzaW9uIG9mIHRoZSBzaXggbGlicmFyeSB0aGF0J3MgYXZhaWxhYmxlIiIiCiAgICBtb2RfaW5mbyA9IE5vbmUKICAgIHRyeToKICAgICAgICBpZiBfc3lzdGVtX3NpeCBhbmQgX0xvb3NlVmVyc2lvbiBhbmQgXAogICAgICAgICAgICAgICAgX0xvb3NlVmVyc2lvbihfc3lzdGVtX3NpeC5fX3ZlcnNpb25fXykgPj0gX0xvb3NlVmVyc2lvbihfYnVuZGxlZF9zaXguX192ZXJzaW9uX18pOgogICAgICAgICAgICBtb2RfaW5mbyA9IF9maW5kX21vZHVsZSgnc2l4JykKICAgIGV4Y2VwdDoKICAgICAgICAjIEFueSBlcnJvcnMgZmluZGluZyB0aGUgc3lzdGVtIGxpYnJhcnksIHVzZSBvdXIgYnVuZGxlZCBsaWIgaW5zdGVhZAogICAgICAgIHBhc3MKCiAgICBpZiBub3QgbW9kX2luZm86CiAgICAgICAgdHJ5OgogICAgICAgICAgICBtb2RfaW5mbyA9IF9maW5kX21vZHVsZSgnYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4Ll9zaXgnKQogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgIyB6aXBpbXBvcnQKICAgICAgICAgICAgbW9kdWxlX3NvdXJjZSA9IF9nZXRfYnVuZGxlZF9zaXhfc291cmNlKCkKICAgICAgICAgICAgcmV0dXJuIG1vZHVsZV9zb3VyY2UKCiAgICByZXR1cm4gbW9kX2luZm9bMF0ucmVhZCgpCgpzb3VyY2UgPSBfZ2V0X3NpeF9zb3VyY2UoKQpleGVjKHNvdXJjZSkKUEsDBBQAAAAAAOC7K0s44sfRkXUAAJF1AAAgAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvc2l4L19zaXgucHkiIiJVdGlsaXRpZXMgZm9yIHdyaXRpbmcgY29kZSB0aGF0IHJ1bnMgb24gUHl0aG9uIDIgYW5kIDMiIiIKCiMgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTUgQmVuamFtaW4gUGV0ZXJzb24KIwojIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKIyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAojIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKIyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiMgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKIwojIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbAojIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiMKIyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgojIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAojIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQojIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKIyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAojIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFCiMgU09GVFdBUkUuCgpmcm9tIF9fZnV0dXJlX18gaW1wb3J0IGFic29sdXRlX2ltcG9ydAoKaW1wb3J0IGZ1bmN0b29scwppbXBvcnQgaXRlcnRvb2xzCmltcG9ydCBvcGVyYXRvcgppbXBvcnQgc3lzCmltcG9ydCB0eXBlcwoKX19hdXRob3JfXyA9ICJCZW5qYW1pbiBQZXRlcnNvbiA8YmVuamFtaW5AcHl0aG9uLm9yZz4iCl9fdmVyc2lvbl9fID0gIjEuMTAuMCIKCgojIFVzZWZ1bCBmb3IgdmVyeSBjb2Fyc2UgdmVyc2lvbiBkaWZmZXJlbnRpYXRpb24uClBZMiA9IHN5cy52ZXJzaW9uX2luZm9bMF0gPT0gMgpQWTMgPSBzeXMudmVyc2lvbl9pbmZvWzBdID09IDMKUFkzNCA9IHN5cy52ZXJzaW9uX2luZm9bMDoyXSA+PSAoMywgNCkKCmlmIFBZMzoKICAgIHN0cmluZ190eXBlcyA9IHN0ciwKICAgIGludGVnZXJfdHlwZXMgPSBpbnQsCiAgICBjbGFzc190eXBlcyA9IHR5cGUsCiAgICB0ZXh0X3R5cGUgPSBzdHIKICAgIGJpbmFyeV90eXBlID0gYnl0ZXMKICAgIE1BWFNJWkUgPSBzeXMubWF4c2l6ZQplbHNlOgogICAgc3RyaW5nX3R5cGVzID0gYmFzZXN0cmluZywKICAgIGludGVnZXJfdHlwZXMgPSAoaW50LCBsb25nKQogICAgY2xhc3NfdHlwZXMgPSAodHlwZSwgdHlwZXMuQ2xhc3NUeXBlKQogICAgdGV4dF90eXBlID0gdW5pY29kZQogICAgYmluYXJ5X3R5cGUgPSBzdHIKCiAgICBpZiBzeXMucGxhdGZvcm0uc3RhcnRzd2l0aCgiamF2YSIpOgogICAgICAgICMgSnl0aG9uIGFsd2F5cyB1c2VzIDMyIGJpdHMuCiAgICAgICAgTUFYU0laRSA9IGludCgoMSA8PCAzMSkgLSAxKQogICAgZWxzZToKICAgICAgICAjIEl0J3MgcG9zc2libGUgdG8gaGF2ZSBzaXplb2YobG9uZykgIT0gc2l6ZW9mKFB5X3NzaXplX3QpLgogICAgICAgIGNsYXNzIFgob2JqZWN0KToKCiAgICAgICAgICAgIGRlZiBfX2xlbl9fKHNlbGYpOgogICAgICAgICAgICAgICAgcmV0dXJuIDEgPDwgMzEKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxlbihYKCkpCiAgICAgICAgZXhjZXB0IE92ZXJmbG93RXJyb3I6CiAgICAgICAgICAgICMgMzItYml0CiAgICAgICAgICAgIE1BWFNJWkUgPSBpbnQoKDEgPDwgMzEpIC0gMSkKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIDY0LWJpdAogICAgICAgICAgICBNQVhTSVpFID0gaW50KCgxIDw8IDYzKSAtIDEpCiAgICAgICAgZGVsIFgKCgpkZWYgX2FkZF9kb2MoZnVuYywgZG9jKToKICAgICIiIkFkZCBkb2N1bWVudGF0aW9uIHRvIGEgZnVuY3Rpb24uIiIiCiAgICBmdW5jLl9fZG9jX18gPSBkb2MKCgpkZWYgX2ltcG9ydF9tb2R1bGUobmFtZSk6CiAgICAiIiJJbXBvcnQgbW9kdWxlLCByZXR1cm5pbmcgdGhlIG1vZHVsZSBhZnRlciB0aGUgbGFzdCBkb3QuIiIiCiAgICBfX2ltcG9ydF9fKG5hbWUpCiAgICByZXR1cm4gc3lzLm1vZHVsZXNbbmFtZV0KCgpjbGFzcyBfTGF6eURlc2NyKG9iamVjdCk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUpOgogICAgICAgIHNlbGYubmFtZSA9IG5hbWUKCiAgICBkZWYgX19nZXRfXyhzZWxmLCBvYmosIHRwKToKICAgICAgICByZXN1bHQgPSBzZWxmLl9yZXNvbHZlKCkKICAgICAgICBzZXRhdHRyKG9iaiwgc2VsZi5uYW1lLCByZXN1bHQpICAjIEludm9rZXMgX19zZXRfXy4KICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVGhpcyBpcyBhIGJpdCB1Z2x5LCBidXQgaXQgYXZvaWRzIHJ1bm5pbmcgdGhpcyBhZ2FpbiBieQogICAgICAgICAgICAjIHJlbW92aW5nIHRoaXMgZGVzY3JpcHRvci4KICAgICAgICAgICAgZGVsYXR0cihvYmouX19jbGFzc19fLCBzZWxmLm5hbWUpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKCmNsYXNzIE1vdmVkTW9kdWxlKF9MYXp5RGVzY3IpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuYW1lLCBvbGQsIG5ldz1Ob25lKToKICAgICAgICBzdXBlcihNb3ZlZE1vZHVsZSwgc2VsZikuX19pbml0X18obmFtZSkKICAgICAgICBpZiBQWTM6CiAgICAgICAgICAgIGlmIG5ldyBpcyBOb25lOgogICAgICAgICAgICAgICAgbmV3ID0gbmFtZQogICAgICAgICAgICBzZWxmLm1vZCA9IG5ldwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYubW9kID0gb2xkCgogICAgZGVmIF9yZXNvbHZlKHNlbGYpOgogICAgICAgIHJldHVybiBfaW1wb3J0X21vZHVsZShzZWxmLm1vZCkKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgYXR0cik6CiAgICAgICAgX21vZHVsZSA9IHNlbGYuX3Jlc29sdmUoKQogICAgICAgIHZhbHVlID0gZ2V0YXR0cihfbW9kdWxlLCBhdHRyKQogICAgICAgIHNldGF0dHIoc2VsZiwgYXR0ciwgdmFsdWUpCiAgICAgICAgcmV0dXJuIHZhbHVlCgoKY2xhc3MgX0xhenlNb2R1bGUodHlwZXMuTW9kdWxlVHlwZSk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUpOgogICAgICAgIHN1cGVyKF9MYXp5TW9kdWxlLCBzZWxmKS5fX2luaXRfXyhuYW1lKQogICAgICAgIHNlbGYuX19kb2NfXyA9IHNlbGYuX19jbGFzc19fLl9fZG9jX18KCiAgICBkZWYgX19kaXJfXyhzZWxmKToKICAgICAgICBhdHRycyA9IFsiX19kb2NfXyIsICJfX25hbWVfXyJdCiAgICAgICAgYXR0cnMgKz0gW2F0dHIubmFtZSBmb3IgYXR0ciBpbiBzZWxmLl9tb3ZlZF9hdHRyaWJ1dGVzXQogICAgICAgIHJldHVybiBhdHRycwoKICAgICMgU3ViY2xhc3NlcyBzaG91bGQgb3ZlcnJpZGUgdGhpcwogICAgX21vdmVkX2F0dHJpYnV0ZXMgPSBbXQoKCmNsYXNzIE1vdmVkQXR0cmlidXRlKF9MYXp5RGVzY3IpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBuYW1lLCBvbGRfbW9kLCBuZXdfbW9kLCBvbGRfYXR0cj1Ob25lLCBuZXdfYXR0cj1Ob25lKToKICAgICAgICBzdXBlcihNb3ZlZEF0dHJpYnV0ZSwgc2VsZikuX19pbml0X18obmFtZSkKICAgICAgICBpZiBQWTM6CiAgICAgICAgICAgIGlmIG5ld19tb2QgaXMgTm9uZToKICAgICAgICAgICAgICAgIG5ld19tb2QgPSBuYW1lCiAgICAgICAgICAgIHNlbGYubW9kID0gbmV3X21vZAogICAgICAgICAgICBpZiBuZXdfYXR0ciBpcyBOb25lOgogICAgICAgICAgICAgICAgaWYgb2xkX2F0dHIgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBuZXdfYXR0ciA9IG5hbWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbmV3X2F0dHIgPSBvbGRfYXR0cgogICAgICAgICAgICBzZWxmLmF0dHIgPSBuZXdfYXR0cgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYubW9kID0gb2xkX21vZAogICAgICAgICAgICBpZiBvbGRfYXR0ciBpcyBOb25lOgogICAgICAgICAgICAgICAgb2xkX2F0dHIgPSBuYW1lCiAgICAgICAgICAgIHNlbGYuYXR0ciA9IG9sZF9hdHRyCgogICAgZGVmIF9yZXNvbHZlKHNlbGYpOgogICAgICAgIG1vZHVsZSA9IF9pbXBvcnRfbW9kdWxlKHNlbGYubW9kKQogICAgICAgIHJldHVybiBnZXRhdHRyKG1vZHVsZSwgc2VsZi5hdHRyKQoKCmNsYXNzIF9TaXhNZXRhUGF0aEltcG9ydGVyKG9iamVjdCk6CgogICAgIiIiCiAgICBBIG1ldGEgcGF0aCBpbXBvcnRlciB0byBpbXBvcnQgc2l4Lm1vdmVzIGFuZCBpdHMgc3VibW9kdWxlcy4KCiAgICBUaGlzIGNsYXNzIGltcGxlbWVudHMgYSBQRVAzMDIgZmluZGVyIGFuZCBsb2FkZXIuIEl0IHNob3VsZCBiZSBjb21wYXRpYmxlCiAgICB3aXRoIFB5dGhvbiAyLjUgYW5kIGFsbCBleGlzdGluZyB2ZXJzaW9ucyBvZiBQeXRob24zCiAgICAiIiIKCiAgICBkZWYgX19pbml0X18oc2VsZiwgc2l4X21vZHVsZV9uYW1lKToKICAgICAgICBzZWxmLm5hbWUgPSBzaXhfbW9kdWxlX25hbWUKICAgICAgICBzZWxmLmtub3duX21vZHVsZXMgPSB7fQoKICAgIGRlZiBfYWRkX21vZHVsZShzZWxmLCBtb2QsICpmdWxsbmFtZXMpOgogICAgICAgIGZvciBmdWxsbmFtZSBpbiBmdWxsbmFtZXM6CiAgICAgICAgICAgIHNlbGYua25vd25fbW9kdWxlc1tzZWxmLm5hbWUgKyAiLiIgKyBmdWxsbmFtZV0gPSBtb2QKCiAgICBkZWYgX2dldF9tb2R1bGUoc2VsZiwgZnVsbG5hbWUpOgogICAgICAgIHJldHVybiBzZWxmLmtub3duX21vZHVsZXNbc2VsZi5uYW1lICsgIi4iICsgZnVsbG5hbWVdCgogICAgZGVmIGZpbmRfbW9kdWxlKHNlbGYsIGZ1bGxuYW1lLCBwYXRoPU5vbmUpOgogICAgICAgIGlmIGZ1bGxuYW1lIGluIHNlbGYua25vd25fbW9kdWxlczoKICAgICAgICAgICAgcmV0dXJuIHNlbGYKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfX2dldF9tb2R1bGUoc2VsZiwgZnVsbG5hbWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0dXJuIHNlbGYua25vd25fbW9kdWxlc1tmdWxsbmFtZV0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEltcG9ydEVycm9yKCJUaGlzIGxvYWRlciBkb2VzIG5vdCBrbm93IG1vZHVsZSAiICsgZnVsbG5hbWUpCgogICAgZGVmIGxvYWRfbW9kdWxlKHNlbGYsIGZ1bGxuYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgaW4gY2FzZSBvZiBhIHJlbG9hZAogICAgICAgICAgICByZXR1cm4gc3lzLm1vZHVsZXNbZnVsbG5hbWVdCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICBwYXNzCiAgICAgICAgbW9kID0gc2VsZi5fX2dldF9tb2R1bGUoZnVsbG5hbWUpCiAgICAgICAgaWYgaXNpbnN0YW5jZShtb2QsIE1vdmVkTW9kdWxlKToKICAgICAgICAgICAgbW9kID0gbW9kLl9yZXNvbHZlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBtb2QuX19sb2FkZXJfXyA9IHNlbGYKICAgICAgICBzeXMubW9kdWxlc1tmdWxsbmFtZV0gPSBtb2QKICAgICAgICByZXR1cm4gbW9kCgogICAgZGVmIGlzX3BhY2thZ2Uoc2VsZiwgZnVsbG5hbWUpOgogICAgICAgICIiIgogICAgICAgIFJldHVybiB0cnVlLCBpZiB0aGUgbmFtZWQgbW9kdWxlIGlzIGEgcGFja2FnZS4KCiAgICAgICAgV2UgbmVlZCB0aGlzIG1ldGhvZCB0byBnZXQgY29ycmVjdCBzcGVjIG9iamVjdHMgd2l0aAogICAgICAgIFB5dGhvbiAzLjQgKHNlZSBQRVA0NTEpCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIGhhc2F0dHIoc2VsZi5fX2dldF9tb2R1bGUoZnVsbG5hbWUpLCAiX19wYXRoX18iKQoKICAgIGRlZiBnZXRfY29kZShzZWxmLCBmdWxsbmFtZSk6CiAgICAgICAgIiIiUmV0dXJuIE5vbmUKCiAgICAgICAgUmVxdWlyZWQsIGlmIGlzX3BhY2thZ2UgaXMgaW1wbGVtZW50ZWQiIiIKICAgICAgICBzZWxmLl9fZ2V0X21vZHVsZShmdWxsbmFtZSkgICMgZXZlbnR1YWxseSByYWlzZXMgSW1wb3J0RXJyb3IKICAgICAgICByZXR1cm4gTm9uZQogICAgZ2V0X3NvdXJjZSA9IGdldF9jb2RlICAjIHNhbWUgYXMgZ2V0X2NvZGUKCl9pbXBvcnRlciA9IF9TaXhNZXRhUGF0aEltcG9ydGVyKF9fbmFtZV9fKQoKCmNsYXNzIF9Nb3ZlZEl0ZW1zKF9MYXp5TW9kdWxlKToKCiAgICAiIiJMYXp5IGxvYWRpbmcgb2YgbW92ZWQgb2JqZWN0cyIiIgogICAgX19wYXRoX18gPSBbXSAgIyBtYXJrIGFzIHBhY2thZ2UKCgpfbW92ZWRfYXR0cmlidXRlcyA9IFsKICAgIE1vdmVkQXR0cmlidXRlKCJjU3RyaW5nSU8iLCAiY1N0cmluZ0lPIiwgImlvIiwgIlN0cmluZ0lPIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiZmlsdGVyIiwgIml0ZXJ0b29scyIsICJidWlsdGlucyIsICJpZmlsdGVyIiwgImZpbHRlciIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImZpbHRlcmZhbHNlIiwgIml0ZXJ0b29scyIsICJpdGVydG9vbHMiLCAiaWZpbHRlcmZhbHNlIiwgImZpbHRlcmZhbHNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiaW5wdXQiLCAiX19idWlsdGluX18iLCAiYnVpbHRpbnMiLCAicmF3X2lucHV0IiwgImlucHV0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiaW50ZXJuIiwgIl9fYnVpbHRpbl9fIiwgInN5cyIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIm1hcCIsICJpdGVydG9vbHMiLCAiYnVpbHRpbnMiLCAiaW1hcCIsICJtYXAiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJnZXRjd2QiLCAib3MiLCAib3MiLCAiZ2V0Y3dkdSIsICJnZXRjd2QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJnZXRjd2RiIiwgIm9zIiwgIm9zIiwgImdldGN3ZCIsICJnZXRjd2RiIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicmFuZ2UiLCAiX19idWlsdGluX18iLCAiYnVpbHRpbnMiLCAieHJhbmdlIiwgInJhbmdlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicmVsb2FkX21vZHVsZSIsICJfX2J1aWx0aW5fXyIsICJpbXBvcnRsaWIiIGlmIFBZMzQgZWxzZSAiaW1wIiwgInJlbG9hZCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInJlZHVjZSIsICJfX2J1aWx0aW5fXyIsICJmdW5jdG9vbHMiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJzaGxleF9xdW90ZSIsICJwaXBlcyIsICJzaGxleCIsICJxdW90ZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlN0cmluZ0lPIiwgIlN0cmluZ0lPIiwgImlvIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiVXNlckRpY3QiLCAiVXNlckRpY3QiLCAiY29sbGVjdGlvbnMiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJVc2VyTGlzdCIsICJVc2VyTGlzdCIsICJjb2xsZWN0aW9ucyIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlVzZXJTdHJpbmciLCAiVXNlclN0cmluZyIsICJjb2xsZWN0aW9ucyIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInhyYW5nZSIsICJfX2J1aWx0aW5fXyIsICJidWlsdGlucyIsICJ4cmFuZ2UiLCAicmFuZ2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ6aXAiLCAiaXRlcnRvb2xzIiwgImJ1aWx0aW5zIiwgIml6aXAiLCAiemlwIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiemlwX2xvbmdlc3QiLCAiaXRlcnRvb2xzIiwgIml0ZXJ0b29scyIsICJpemlwX2xvbmdlc3QiLCAiemlwX2xvbmdlc3QiKSwKICAgIE1vdmVkTW9kdWxlKCJidWlsdGlucyIsICJfX2J1aWx0aW5fXyIpLAogICAgTW92ZWRNb2R1bGUoImNvbmZpZ3BhcnNlciIsICJDb25maWdQYXJzZXIiKSwKICAgIE1vdmVkTW9kdWxlKCJjb3B5cmVnIiwgImNvcHlfcmVnIiksCiAgICBNb3ZlZE1vZHVsZSgiZGJtX2dudSIsICJnZGJtIiwgImRibS5nbnUiKSwKICAgIE1vdmVkTW9kdWxlKCJfZHVtbXlfdGhyZWFkIiwgImR1bW15X3RocmVhZCIsICJfZHVtbXlfdGhyZWFkIiksCiAgICBNb3ZlZE1vZHVsZSgiaHR0cF9jb29raWVqYXIiLCAiY29va2llbGliIiwgImh0dHAuY29va2llamFyIiksCiAgICBNb3ZlZE1vZHVsZSgiaHR0cF9jb29raWVzIiwgIkNvb2tpZSIsICJodHRwLmNvb2tpZXMiKSwKICAgIE1vdmVkTW9kdWxlKCJodG1sX2VudGl0aWVzIiwgImh0bWxlbnRpdHlkZWZzIiwgImh0bWwuZW50aXRpZXMiKSwKICAgIE1vdmVkTW9kdWxlKCJodG1sX3BhcnNlciIsICJIVE1MUGFyc2VyIiwgImh0bWwucGFyc2VyIiksCiAgICBNb3ZlZE1vZHVsZSgiaHR0cF9jbGllbnQiLCAiaHR0cGxpYiIsICJodHRwLmNsaWVudCIpLAogICAgTW92ZWRNb2R1bGUoImVtYWlsX21pbWVfbXVsdGlwYXJ0IiwgImVtYWlsLk1JTUVNdWx0aXBhcnQiLCAiZW1haWwubWltZS5tdWx0aXBhcnQiKSwKICAgIE1vdmVkTW9kdWxlKCJlbWFpbF9taW1lX25vbm11bHRpcGFydCIsICJlbWFpbC5NSU1FTm9uTXVsdGlwYXJ0IiwgImVtYWlsLm1pbWUubm9ubXVsdGlwYXJ0IiksCiAgICBNb3ZlZE1vZHVsZSgiZW1haWxfbWltZV90ZXh0IiwgImVtYWlsLk1JTUVUZXh0IiwgImVtYWlsLm1pbWUudGV4dCIpLAogICAgTW92ZWRNb2R1bGUoImVtYWlsX21pbWVfYmFzZSIsICJlbWFpbC5NSU1FQmFzZSIsICJlbWFpbC5taW1lLmJhc2UiKSwKICAgIE1vdmVkTW9kdWxlKCJCYXNlSFRUUFNlcnZlciIsICJCYXNlSFRUUFNlcnZlciIsICJodHRwLnNlcnZlciIpLAogICAgTW92ZWRNb2R1bGUoIkNHSUhUVFBTZXJ2ZXIiLCAiQ0dJSFRUUFNlcnZlciIsICJodHRwLnNlcnZlciIpLAogICAgTW92ZWRNb2R1bGUoIlNpbXBsZUhUVFBTZXJ2ZXIiLCAiU2ltcGxlSFRUUFNlcnZlciIsICJodHRwLnNlcnZlciIpLAogICAgTW92ZWRNb2R1bGUoImNQaWNrbGUiLCAiY1BpY2tsZSIsICJwaWNrbGUiKSwKICAgIE1vdmVkTW9kdWxlKCJxdWV1ZSIsICJRdWV1ZSIpLAogICAgTW92ZWRNb2R1bGUoInJlcHJsaWIiLCAicmVwciIpLAogICAgTW92ZWRNb2R1bGUoInNvY2tldHNlcnZlciIsICJTb2NrZXRTZXJ2ZXIiKSwKICAgIE1vdmVkTW9kdWxlKCJfdGhyZWFkIiwgInRocmVhZCIsICJfdGhyZWFkIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlciIsICJUa2ludGVyIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9kaWFsb2ciLCAiRGlhbG9nIiwgInRraW50ZXIuZGlhbG9nIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9maWxlZGlhbG9nIiwgIkZpbGVEaWFsb2ciLCAidGtpbnRlci5maWxlZGlhbG9nIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9zY3JvbGxlZHRleHQiLCAiU2Nyb2xsZWRUZXh0IiwgInRraW50ZXIuc2Nyb2xsZWR0ZXh0IiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9zaW1wbGVkaWFsb2ciLCAiU2ltcGxlRGlhbG9nIiwgInRraW50ZXIuc2ltcGxlZGlhbG9nIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl90aXgiLCAiVGl4IiwgInRraW50ZXIudGl4IiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl90dGsiLCAidHRrIiwgInRraW50ZXIudHRrIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9jb25zdGFudHMiLCAiVGtjb25zdGFudHMiLCAidGtpbnRlci5jb25zdGFudHMiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX2RuZCIsICJUa2RuZCIsICJ0a2ludGVyLmRuZCIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfY29sb3JjaG9vc2VyIiwgInRrQ29sb3JDaG9vc2VyIiwKICAgICAgICAgICAgICAgICJ0a2ludGVyLmNvbG9yY2hvb3NlciIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfY29tbW9uZGlhbG9nIiwgInRrQ29tbW9uRGlhbG9nIiwKICAgICAgICAgICAgICAgICJ0a2ludGVyLmNvbW1vbmRpYWxvZyIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfdGtmaWxlZGlhbG9nIiwgInRrRmlsZURpYWxvZyIsICJ0a2ludGVyLmZpbGVkaWFsb2ciKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX2ZvbnQiLCAidGtGb250IiwgInRraW50ZXIuZm9udCIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfbWVzc2FnZWJveCIsICJ0a01lc3NhZ2VCb3giLCAidGtpbnRlci5tZXNzYWdlYm94IiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl90a3NpbXBsZWRpYWxvZyIsICJ0a1NpbXBsZURpYWxvZyIsCiAgICAgICAgICAgICAgICAidGtpbnRlci5zaW1wbGVkaWFsb2ciKSwKICAgIE1vdmVkTW9kdWxlKCJ1cmxsaWJfcGFyc2UiLCBfX25hbWVfXyArICIubW92ZXMudXJsbGliX3BhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRNb2R1bGUoInVybGxpYl9lcnJvciIsIF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWJfZXJyb3IiLCAidXJsbGliLmVycm9yIiksCiAgICBNb3ZlZE1vZHVsZSgidXJsbGliIiwgX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYiIsIF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWIiKSwKICAgIE1vdmVkTW9kdWxlKCJ1cmxsaWJfcm9ib3RwYXJzZXIiLCAicm9ib3RwYXJzZXIiLCAidXJsbGliLnJvYm90cGFyc2VyIiksCiAgICBNb3ZlZE1vZHVsZSgieG1scnBjX2NsaWVudCIsICJ4bWxycGNsaWIiLCAieG1scnBjLmNsaWVudCIpLAogICAgTW92ZWRNb2R1bGUoInhtbHJwY19zZXJ2ZXIiLCAiU2ltcGxlWE1MUlBDU2VydmVyIiwgInhtbHJwYy5zZXJ2ZXIiKSwKXQojIEFkZCB3aW5kb3dzIHNwZWNpZmljIG1vZHVsZXMuCmlmIHN5cy5wbGF0Zm9ybSA9PSAid2luMzIiOgogICAgX21vdmVkX2F0dHJpYnV0ZXMgKz0gWwogICAgICAgIE1vdmVkTW9kdWxlKCJ3aW5yZWciLCAiX3dpbnJlZyIpLAogICAgXQoKZm9yIGF0dHIgaW4gX21vdmVkX2F0dHJpYnV0ZXM6CiAgICBzZXRhdHRyKF9Nb3ZlZEl0ZW1zLCBhdHRyLm5hbWUsIGF0dHIpCiAgICBpZiBpc2luc3RhbmNlKGF0dHIsIE1vdmVkTW9kdWxlKToKICAgICAgICBfaW1wb3J0ZXIuX2FkZF9tb2R1bGUoYXR0ciwgIm1vdmVzLiIgKyBhdHRyLm5hbWUpCmRlbCBhdHRyCgpfTW92ZWRJdGVtcy5fbW92ZWRfYXR0cmlidXRlcyA9IF9tb3ZlZF9hdHRyaWJ1dGVzCgptb3ZlcyA9IF9Nb3ZlZEl0ZW1zKF9fbmFtZV9fICsgIi5tb3ZlcyIpCl9pbXBvcnRlci5fYWRkX21vZHVsZShtb3ZlcywgIm1vdmVzIikKCgpjbGFzcyBNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9wYXJzZShfTGF6eU1vZHVsZSk6CgogICAgIiIiTGF6eSBsb2FkaW5nIG9mIG1vdmVkIG9iamVjdHMgaW4gc2l4Lm1vdmVzLnVybGxpYl9wYXJzZSIiIgoKCl91cmxsaWJfcGFyc2VfbW92ZWRfYXR0cmlidXRlcyA9IFsKICAgIE1vdmVkQXR0cmlidXRlKCJQYXJzZVJlc3VsdCIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJTcGxpdFJlc3VsdCIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJwYXJzZV9xcyIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJwYXJzZV9xc2wiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsZGVmcmFnIiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVybGpvaW4iLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJscGFyc2UiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsc3BsaXQiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsdW5wYXJzZSIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmx1bnNwbGl0IiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInF1b3RlIiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJxdW90ZV9wbHVzIiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1bnF1b3RlIiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1bnF1b3RlX3BsdXMiLCAidXJsbGliIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVybGVuY29kZSIsICJ1cmxsaWIiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgic3BsaXRxdWVyeSIsICJ1cmxsaWIiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgic3BsaXR0YWciLCAidXJsbGliIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInNwbGl0dXNlciIsICJ1cmxsaWIiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXNlc19mcmFnbWVudCIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1c2VzX25ldGxvYyIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1c2VzX3BhcmFtcyIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1c2VzX3F1ZXJ5IiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVzZXNfcmVsYXRpdmUiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCl0KZm9yIGF0dHIgaW4gX3VybGxpYl9wYXJzZV9tb3ZlZF9hdHRyaWJ1dGVzOgogICAgc2V0YXR0cihNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9wYXJzZSwgYXR0ci5uYW1lLCBhdHRyKQpkZWwgYXR0cgoKTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcGFyc2UuX21vdmVkX2F0dHJpYnV0ZXMgPSBfdXJsbGliX3BhcnNlX21vdmVkX2F0dHJpYnV0ZXMKCl9pbXBvcnRlci5fYWRkX21vZHVsZShNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9wYXJzZShfX25hbWVfXyArICIubW92ZXMudXJsbGliX3BhcnNlIiksCiAgICAgICAgICAgICAgICAgICAgICAibW92ZXMudXJsbGliX3BhcnNlIiwgIm1vdmVzLnVybGxpYi5wYXJzZSIpCgoKY2xhc3MgTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfZXJyb3IoX0xhenlNb2R1bGUpOgoKICAgICIiIkxhenkgbG9hZGluZyBvZiBtb3ZlZCBvYmplY3RzIGluIHNpeC5tb3Zlcy51cmxsaWJfZXJyb3IiIiIKCgpfdXJsbGliX2Vycm9yX21vdmVkX2F0dHJpYnV0ZXMgPSBbCiAgICBNb3ZlZEF0dHJpYnV0ZSgiVVJMRXJyb3IiLCAidXJsbGliMiIsICJ1cmxsaWIuZXJyb3IiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQRXJyb3IiLCAidXJsbGliMiIsICJ1cmxsaWIuZXJyb3IiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJDb250ZW50VG9vU2hvcnRFcnJvciIsICJ1cmxsaWIiLCAidXJsbGliLmVycm9yIiksCl0KZm9yIGF0dHIgaW4gX3VybGxpYl9lcnJvcl9tb3ZlZF9hdHRyaWJ1dGVzOgogICAgc2V0YXR0cihNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9lcnJvciwgYXR0ci5uYW1lLCBhdHRyKQpkZWwgYXR0cgoKTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfZXJyb3IuX21vdmVkX2F0dHJpYnV0ZXMgPSBfdXJsbGliX2Vycm9yX21vdmVkX2F0dHJpYnV0ZXMKCl9pbXBvcnRlci5fYWRkX21vZHVsZShNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9lcnJvcihfX25hbWVfXyArICIubW92ZXMudXJsbGliLmVycm9yIiksCiAgICAgICAgICAgICAgICAgICAgICAibW92ZXMudXJsbGliX2Vycm9yIiwgIm1vdmVzLnVybGxpYi5lcnJvciIpCgoKY2xhc3MgTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcmVxdWVzdChfTGF6eU1vZHVsZSk6CgogICAgIiIiTGF6eSBsb2FkaW5nIG9mIG1vdmVkIG9iamVjdHMgaW4gc2l4Lm1vdmVzLnVybGxpYl9yZXF1ZXN0IiIiCgoKX3VybGxpYl9yZXF1ZXN0X21vdmVkX2F0dHJpYnV0ZXMgPSBbCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsb3BlbiIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiaW5zdGFsbF9vcGVuZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImJ1aWxkX29wZW5lciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicGF0aG5hbWUydXJsIiwgInVybGxpYiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVybDJwYXRobmFtZSIsICJ1cmxsaWIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJnZXRwcm94aWVzIiwgInVybGxpYiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlJlcXVlc3QiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIk9wZW5lckRpcmVjdG9yIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQRGVmYXVsdEVycm9ySGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUFJlZGlyZWN0SGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUENvb2tpZVByb2Nlc3NvciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiUHJveHlIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJCYXNlSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUFBhc3N3b3JkTWdyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQUGFzc3dvcmRNZ3JXaXRoRGVmYXVsdFJlYWxtIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJBYnN0cmFjdEJhc2ljQXV0aEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBCYXNpY0F1dGhIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJQcm94eUJhc2ljQXV0aEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkFic3RyYWN0RGlnZXN0QXV0aEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBEaWdlc3RBdXRoSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiUHJveHlEaWdlc3RBdXRoSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBTSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiRmlsZUhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkZUUEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkNhY2hlRlRQSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiVW5rbm93bkhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBFcnJvclByb2Nlc3NvciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJscmV0cmlldmUiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsY2xlYW51cCIsICJ1cmxsaWIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJVUkxvcGVuZXIiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiRmFuY3lVUkxvcGVuZXIiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicHJveHlfYnlwYXNzIiwgInVybGxpYiIsICJ1cmxsaWIucmVxdWVzdCIpLApdCmZvciBhdHRyIGluIF91cmxsaWJfcmVxdWVzdF9tb3ZlZF9hdHRyaWJ1dGVzOgogICAgc2V0YXR0cihNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXF1ZXN0LCBhdHRyLm5hbWUsIGF0dHIpCmRlbCBhdHRyCgpNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXF1ZXN0Ll9tb3ZlZF9hdHRyaWJ1dGVzID0gX3VybGxpYl9yZXF1ZXN0X21vdmVkX2F0dHJpYnV0ZXMKCl9pbXBvcnRlci5fYWRkX21vZHVsZShNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXF1ZXN0KF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWIucmVxdWVzdCIpLAogICAgICAgICAgICAgICAgICAgICAgIm1vdmVzLnVybGxpYl9yZXF1ZXN0IiwgIm1vdmVzLnVybGxpYi5yZXF1ZXN0IikKCgpjbGFzcyBNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXNwb25zZShfTGF6eU1vZHVsZSk6CgogICAgIiIiTGF6eSBsb2FkaW5nIG9mIG1vdmVkIG9iamVjdHMgaW4gc2l4Lm1vdmVzLnVybGxpYl9yZXNwb25zZSIiIgoKCl91cmxsaWJfcmVzcG9uc2VfbW92ZWRfYXR0cmlidXRlcyA9IFsKICAgIE1vdmVkQXR0cmlidXRlKCJhZGRiYXNlIiwgInVybGxpYiIsICJ1cmxsaWIucmVzcG9uc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJhZGRjbG9zZWhvb2siLCAidXJsbGliIiwgInVybGxpYi5yZXNwb25zZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImFkZGluZm8iLCAidXJsbGliIiwgInVybGxpYi5yZXNwb25zZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImFkZGluZm91cmwiLCAidXJsbGliIiwgInVybGxpYi5yZXNwb25zZSIpLApdCmZvciBhdHRyIGluIF91cmxsaWJfcmVzcG9uc2VfbW92ZWRfYXR0cmlidXRlczoKICAgIHNldGF0dHIoTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcmVzcG9uc2UsIGF0dHIubmFtZSwgYXR0cikKZGVsIGF0dHIKCk1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3Jlc3BvbnNlLl9tb3ZlZF9hdHRyaWJ1dGVzID0gX3VybGxpYl9yZXNwb25zZV9tb3ZlZF9hdHRyaWJ1dGVzCgpfaW1wb3J0ZXIuX2FkZF9tb2R1bGUoTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcmVzcG9uc2UoX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYi5yZXNwb25zZSIpLAogICAgICAgICAgICAgICAgICAgICAgIm1vdmVzLnVybGxpYl9yZXNwb25zZSIsICJtb3Zlcy51cmxsaWIucmVzcG9uc2UiKQoKCmNsYXNzIE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JvYm90cGFyc2VyKF9MYXp5TW9kdWxlKToKCiAgICAiIiJMYXp5IGxvYWRpbmcgb2YgbW92ZWQgb2JqZWN0cyBpbiBzaXgubW92ZXMudXJsbGliX3JvYm90cGFyc2VyIiIiCgoKX3VybGxpYl9yb2JvdHBhcnNlcl9tb3ZlZF9hdHRyaWJ1dGVzID0gWwogICAgTW92ZWRBdHRyaWJ1dGUoIlJvYm90RmlsZVBhcnNlciIsICJyb2JvdHBhcnNlciIsICJ1cmxsaWIucm9ib3RwYXJzZXIiKSwKXQpmb3IgYXR0ciBpbiBfdXJsbGliX3JvYm90cGFyc2VyX21vdmVkX2F0dHJpYnV0ZXM6CiAgICBzZXRhdHRyKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JvYm90cGFyc2VyLCBhdHRyLm5hbWUsIGF0dHIpCmRlbCBhdHRyCgpNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yb2JvdHBhcnNlci5fbW92ZWRfYXR0cmlidXRlcyA9IF91cmxsaWJfcm9ib3RwYXJzZXJfbW92ZWRfYXR0cmlidXRlcwoKX2ltcG9ydGVyLl9hZGRfbW9kdWxlKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JvYm90cGFyc2VyKF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWIucm9ib3RwYXJzZXIiKSwKICAgICAgICAgICAgICAgICAgICAgICJtb3Zlcy51cmxsaWJfcm9ib3RwYXJzZXIiLCAibW92ZXMudXJsbGliLnJvYm90cGFyc2VyIikKCgpjbGFzcyBNb2R1bGVfc2l4X21vdmVzX3VybGxpYih0eXBlcy5Nb2R1bGVUeXBlKToKCiAgICAiIiJDcmVhdGUgYSBzaXgubW92ZXMudXJsbGliIG5hbWVzcGFjZSB0aGF0IHJlc2VtYmxlcyB0aGUgUHl0aG9uIDMgbmFtZXNwYWNlIiIiCiAgICBfX3BhdGhfXyA9IFtdICAjIG1hcmsgYXMgcGFja2FnZQogICAgcGFyc2UgPSBfaW1wb3J0ZXIuX2dldF9tb2R1bGUoIm1vdmVzLnVybGxpYl9wYXJzZSIpCiAgICBlcnJvciA9IF9pbXBvcnRlci5fZ2V0X21vZHVsZSgibW92ZXMudXJsbGliX2Vycm9yIikKICAgIHJlcXVlc3QgPSBfaW1wb3J0ZXIuX2dldF9tb2R1bGUoIm1vdmVzLnVybGxpYl9yZXF1ZXN0IikKICAgIHJlc3BvbnNlID0gX2ltcG9ydGVyLl9nZXRfbW9kdWxlKCJtb3Zlcy51cmxsaWJfcmVzcG9uc2UiKQogICAgcm9ib3RwYXJzZXIgPSBfaW1wb3J0ZXIuX2dldF9tb2R1bGUoIm1vdmVzLnVybGxpYl9yb2JvdHBhcnNlciIpCgogICAgZGVmIF9fZGlyX18oc2VsZik6CiAgICAgICAgcmV0dXJuIFsncGFyc2UnLCAnZXJyb3InLCAncmVxdWVzdCcsICdyZXNwb25zZScsICdyb2JvdHBhcnNlciddCgpfaW1wb3J0ZXIuX2FkZF9tb2R1bGUoTW9kdWxlX3NpeF9tb3Zlc191cmxsaWIoX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYiIpLAogICAgICAgICAgICAgICAgICAgICAgIm1vdmVzLnVybGxpYiIpCgoKZGVmIGFkZF9tb3ZlKG1vdmUpOgogICAgIiIiQWRkIGFuIGl0ZW0gdG8gc2l4Lm1vdmVzLiIiIgogICAgc2V0YXR0cihfTW92ZWRJdGVtcywgbW92ZS5uYW1lLCBtb3ZlKQoKCmRlZiByZW1vdmVfbW92ZShuYW1lKToKICAgICIiIlJlbW92ZSBpdGVtIGZyb20gc2l4Lm1vdmVzLiIiIgogICAgdHJ5OgogICAgICAgIGRlbGF0dHIoX01vdmVkSXRlbXMsIG5hbWUpCiAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkZWwgbW92ZXMuX19kaWN0X19bbmFtZV0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKCJubyBzdWNoIG1vdmUsICVyIiAlIChuYW1lLCkpCgoKaWYgUFkzOgogICAgX21ldGhfZnVuYyA9ICJfX2Z1bmNfXyIKICAgIF9tZXRoX3NlbGYgPSAiX19zZWxmX18iCgogICAgX2Z1bmNfY2xvc3VyZSA9ICJfX2Nsb3N1cmVfXyIKICAgIF9mdW5jX2NvZGUgPSAiX19jb2RlX18iCiAgICBfZnVuY19kZWZhdWx0cyA9ICJfX2RlZmF1bHRzX18iCiAgICBfZnVuY19nbG9iYWxzID0gIl9fZ2xvYmFsc19fIgplbHNlOgogICAgX21ldGhfZnVuYyA9ICJpbV9mdW5jIgogICAgX21ldGhfc2VsZiA9ICJpbV9zZWxmIgoKICAgIF9mdW5jX2Nsb3N1cmUgPSAiZnVuY19jbG9zdXJlIgogICAgX2Z1bmNfY29kZSA9ICJmdW5jX2NvZGUiCiAgICBfZnVuY19kZWZhdWx0cyA9ICJmdW5jX2RlZmF1bHRzIgogICAgX2Z1bmNfZ2xvYmFscyA9ICJmdW5jX2dsb2JhbHMiCgoKdHJ5OgogICAgYWR2YW5jZV9pdGVyYXRvciA9IG5leHQKZXhjZXB0IE5hbWVFcnJvcjoKICAgIGRlZiBhZHZhbmNlX2l0ZXJhdG9yKGl0KToKICAgICAgICByZXR1cm4gaXQubmV4dCgpCm5leHQgPSBhZHZhbmNlX2l0ZXJhdG9yCgoKdHJ5OgogICAgY2FsbGFibGUgPSBjYWxsYWJsZQpleGNlcHQgTmFtZUVycm9yOgogICAgZGVmIGNhbGxhYmxlKG9iaik6CiAgICAgICAgcmV0dXJuIGFueSgiX19jYWxsX18iIGluIGtsYXNzLl9fZGljdF9fIGZvciBrbGFzcyBpbiB0eXBlKG9iaikuX19tcm9fXykKCgppZiBQWTM6CiAgICBkZWYgZ2V0X3VuYm91bmRfZnVuY3Rpb24odW5ib3VuZCk6CiAgICAgICAgcmV0dXJuIHVuYm91bmQKCiAgICBjcmVhdGVfYm91bmRfbWV0aG9kID0gdHlwZXMuTWV0aG9kVHlwZQoKICAgIGRlZiBjcmVhdGVfdW5ib3VuZF9tZXRob2QoZnVuYywgY2xzKToKICAgICAgICByZXR1cm4gZnVuYwoKICAgIEl0ZXJhdG9yID0gb2JqZWN0CmVsc2U6CiAgICBkZWYgZ2V0X3VuYm91bmRfZnVuY3Rpb24odW5ib3VuZCk6CiAgICAgICAgcmV0dXJuIHVuYm91bmQuaW1fZnVuYwoKICAgIGRlZiBjcmVhdGVfYm91bmRfbWV0aG9kKGZ1bmMsIG9iaik6CiAgICAgICAgcmV0dXJuIHR5cGVzLk1ldGhvZFR5cGUoZnVuYywgb2JqLCBvYmouX19jbGFzc19fKQoKICAgIGRlZiBjcmVhdGVfdW5ib3VuZF9tZXRob2QoZnVuYywgY2xzKToKICAgICAgICByZXR1cm4gdHlwZXMuTWV0aG9kVHlwZShmdW5jLCBOb25lLCBjbHMpCgogICAgY2xhc3MgSXRlcmF0b3Iob2JqZWN0KToKCiAgICAgICAgZGVmIG5leHQoc2VsZik6CiAgICAgICAgICAgIHJldHVybiB0eXBlKHNlbGYpLl9fbmV4dF9fKHNlbGYpCgogICAgY2FsbGFibGUgPSBjYWxsYWJsZQpfYWRkX2RvYyhnZXRfdW5ib3VuZF9mdW5jdGlvbiwKICAgICAgICAgIiIiR2V0IHRoZSBmdW5jdGlvbiBvdXQgb2YgYSBwb3NzaWJseSB1bmJvdW5kIGZ1bmN0aW9uIiIiKQoKCmdldF9tZXRob2RfZnVuY3Rpb24gPSBvcGVyYXRvci5hdHRyZ2V0dGVyKF9tZXRoX2Z1bmMpCmdldF9tZXRob2Rfc2VsZiA9IG9wZXJhdG9yLmF0dHJnZXR0ZXIoX21ldGhfc2VsZikKZ2V0X2Z1bmN0aW9uX2Nsb3N1cmUgPSBvcGVyYXRvci5hdHRyZ2V0dGVyKF9mdW5jX2Nsb3N1cmUpCmdldF9mdW5jdGlvbl9jb2RlID0gb3BlcmF0b3IuYXR0cmdldHRlcihfZnVuY19jb2RlKQpnZXRfZnVuY3Rpb25fZGVmYXVsdHMgPSBvcGVyYXRvci5hdHRyZ2V0dGVyKF9mdW5jX2RlZmF1bHRzKQpnZXRfZnVuY3Rpb25fZ2xvYmFscyA9IG9wZXJhdG9yLmF0dHJnZXR0ZXIoX2Z1bmNfZ2xvYmFscykKCgppZiBQWTM6CiAgICBkZWYgaXRlcmtleXMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGl0ZXIoZC5rZXlzKCoqa3cpKQoKICAgIGRlZiBpdGVydmFsdWVzKGQsICoqa3cpOgogICAgICAgIHJldHVybiBpdGVyKGQudmFsdWVzKCoqa3cpKQoKICAgIGRlZiBpdGVyaXRlbXMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGl0ZXIoZC5pdGVtcygqKmt3KSkKCiAgICBkZWYgaXRlcmxpc3RzKGQsICoqa3cpOgogICAgICAgIHJldHVybiBpdGVyKGQubGlzdHMoKiprdykpCgogICAgdmlld2tleXMgPSBvcGVyYXRvci5tZXRob2RjYWxsZXIoImtleXMiKQoKICAgIHZpZXd2YWx1ZXMgPSBvcGVyYXRvci5tZXRob2RjYWxsZXIoInZhbHVlcyIpCgogICAgdmlld2l0ZW1zID0gb3BlcmF0b3IubWV0aG9kY2FsbGVyKCJpdGVtcyIpCmVsc2U6CiAgICBkZWYgaXRlcmtleXMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGQuaXRlcmtleXMoKiprdykKCiAgICBkZWYgaXRlcnZhbHVlcyhkLCAqKmt3KToKICAgICAgICByZXR1cm4gZC5pdGVydmFsdWVzKCoqa3cpCgogICAgZGVmIGl0ZXJpdGVtcyhkLCAqKmt3KToKICAgICAgICByZXR1cm4gZC5pdGVyaXRlbXMoKiprdykKCiAgICBkZWYgaXRlcmxpc3RzKGQsICoqa3cpOgogICAgICAgIHJldHVybiBkLml0ZXJsaXN0cygqKmt3KQoKICAgIHZpZXdrZXlzID0gb3BlcmF0b3IubWV0aG9kY2FsbGVyKCJ2aWV3a2V5cyIpCgogICAgdmlld3ZhbHVlcyA9IG9wZXJhdG9yLm1ldGhvZGNhbGxlcigidmlld3ZhbHVlcyIpCgogICAgdmlld2l0ZW1zID0gb3BlcmF0b3IubWV0aG9kY2FsbGVyKCJ2aWV3aXRlbXMiKQoKX2FkZF9kb2MoaXRlcmtleXMsICJSZXR1cm4gYW4gaXRlcmF0b3Igb3ZlciB0aGUga2V5cyBvZiBhIGRpY3Rpb25hcnkuIikKX2FkZF9kb2MoaXRlcnZhbHVlcywgIlJldHVybiBhbiBpdGVyYXRvciBvdmVyIHRoZSB2YWx1ZXMgb2YgYSBkaWN0aW9uYXJ5LiIpCl9hZGRfZG9jKGl0ZXJpdGVtcywKICAgICAgICAgIlJldHVybiBhbiBpdGVyYXRvciBvdmVyIHRoZSAoa2V5LCB2YWx1ZSkgcGFpcnMgb2YgYSBkaWN0aW9uYXJ5LiIpCl9hZGRfZG9jKGl0ZXJsaXN0cywKICAgICAgICAgIlJldHVybiBhbiBpdGVyYXRvciBvdmVyIHRoZSAoa2V5LCBbdmFsdWVzXSkgcGFpcnMgb2YgYSBkaWN0aW9uYXJ5LiIpCgoKaWYgUFkzOgogICAgZGVmIGIocyk6CiAgICAgICAgcmV0dXJuIHMuZW5jb2RlKCJsYXRpbi0xIikKCiAgICBkZWYgdShzKToKICAgICAgICByZXR1cm4gcwogICAgdW5pY2hyID0gY2hyCiAgICBpbXBvcnQgc3RydWN0CiAgICBpbnQyYnl0ZSA9IHN0cnVjdC5TdHJ1Y3QoIj5CIikucGFjawogICAgZGVsIHN0cnVjdAogICAgYnl0ZTJpbnQgPSBvcGVyYXRvci5pdGVtZ2V0dGVyKDApCiAgICBpbmRleGJ5dGVzID0gb3BlcmF0b3IuZ2V0aXRlbQogICAgaXRlcmJ5dGVzID0gaXRlcgogICAgaW1wb3J0IGlvCiAgICBTdHJpbmdJTyA9IGlvLlN0cmluZ0lPCiAgICBCeXRlc0lPID0gaW8uQnl0ZXNJTwogICAgX2Fzc2VydENvdW50RXF1YWwgPSAiYXNzZXJ0Q291bnRFcXVhbCIKICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMV0gPD0gMToKICAgICAgICBfYXNzZXJ0UmFpc2VzUmVnZXggPSAiYXNzZXJ0UmFpc2VzUmVnZXhwIgogICAgICAgIF9hc3NlcnRSZWdleCA9ICJhc3NlcnRSZWdleHBNYXRjaGVzIgogICAgZWxzZToKICAgICAgICBfYXNzZXJ0UmFpc2VzUmVnZXggPSAiYXNzZXJ0UmFpc2VzUmVnZXgiCiAgICAgICAgX2Fzc2VydFJlZ2V4ID0gImFzc2VydFJlZ2V4IgplbHNlOgogICAgZGVmIGIocyk6CiAgICAgICAgcmV0dXJuIHMKICAgICMgV29ya2Fyb3VuZCBmb3Igc3RhbmRhbG9uZSBiYWNrc2xhc2gKCiAgICBkZWYgdShzKToKICAgICAgICByZXR1cm4gdW5pY29kZShzLnJlcGxhY2UocidcXCcsIHInXFxcXCcpLCAidW5pY29kZV9lc2NhcGUiKQogICAgdW5pY2hyID0gdW5pY2hyCiAgICBpbnQyYnl0ZSA9IGNocgoKICAgIGRlZiBieXRlMmludChicyk6CiAgICAgICAgcmV0dXJuIG9yZChic1swXSkKCiAgICBkZWYgaW5kZXhieXRlcyhidWYsIGkpOgogICAgICAgIHJldHVybiBvcmQoYnVmW2ldKQogICAgaXRlcmJ5dGVzID0gZnVuY3Rvb2xzLnBhcnRpYWwoaXRlcnRvb2xzLmltYXAsIG9yZCkKICAgIGltcG9ydCBTdHJpbmdJTwogICAgU3RyaW5nSU8gPSBCeXRlc0lPID0gU3RyaW5nSU8uU3RyaW5nSU8KICAgIF9hc3NlcnRDb3VudEVxdWFsID0gImFzc2VydEl0ZW1zRXF1YWwiCiAgICBfYXNzZXJ0UmFpc2VzUmVnZXggPSAiYXNzZXJ0UmFpc2VzUmVnZXhwIgogICAgX2Fzc2VydFJlZ2V4ID0gImFzc2VydFJlZ2V4cE1hdGNoZXMiCl9hZGRfZG9jKGIsICIiIkJ5dGUgbGl0ZXJhbCIiIikKX2FkZF9kb2ModSwgIiIiVGV4dCBsaXRlcmFsIiIiKQoKCmRlZiBhc3NlcnRDb3VudEVxdWFsKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICByZXR1cm4gZ2V0YXR0cihzZWxmLCBfYXNzZXJ0Q291bnRFcXVhbCkoKmFyZ3MsICoqa3dhcmdzKQoKCmRlZiBhc3NlcnRSYWlzZXNSZWdleChzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgcmV0dXJuIGdldGF0dHIoc2VsZiwgX2Fzc2VydFJhaXNlc1JlZ2V4KSgqYXJncywgKiprd2FyZ3MpCgoKZGVmIGFzc2VydFJlZ2V4KHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICByZXR1cm4gZ2V0YXR0cihzZWxmLCBfYXNzZXJ0UmVnZXgpKCphcmdzLCAqKmt3YXJncykKCgppZiBQWTM6CiAgICBleGVjXyA9IGdldGF0dHIobW92ZXMuYnVpbHRpbnMsICJleGVjIikKCiAgICBkZWYgcmVyYWlzZSh0cCwgdmFsdWUsIHRiPU5vbmUpOgogICAgICAgIGlmIHZhbHVlIGlzIE5vbmU6CiAgICAgICAgICAgIHZhbHVlID0gdHAoKQogICAgICAgIGlmIHZhbHVlLl9fdHJhY2ViYWNrX18gaXMgbm90IHRiOgogICAgICAgICAgICByYWlzZSB2YWx1ZS53aXRoX3RyYWNlYmFjayh0YikKICAgICAgICByYWlzZSB2YWx1ZQoKZWxzZToKICAgIGRlZiBleGVjXyhfY29kZV8sIF9nbG9ic189Tm9uZSwgX2xvY3NfPU5vbmUpOgogICAgICAgICIiIkV4ZWN1dGUgY29kZSBpbiBhIG5hbWVzcGFjZS4iIiIKICAgICAgICBpZiBfZ2xvYnNfIGlzIE5vbmU6CiAgICAgICAgICAgIGZyYW1lID0gc3lzLl9nZXRmcmFtZSgxKQogICAgICAgICAgICBfZ2xvYnNfID0gZnJhbWUuZl9nbG9iYWxzCiAgICAgICAgICAgIGlmIF9sb2NzXyBpcyBOb25lOgogICAgICAgICAgICAgICAgX2xvY3NfID0gZnJhbWUuZl9sb2NhbHMKICAgICAgICAgICAgZGVsIGZyYW1lCiAgICAgICAgZWxpZiBfbG9jc18gaXMgTm9uZToKICAgICAgICAgICAgX2xvY3NfID0gX2dsb2JzXwogICAgICAgIGV4ZWMoIiIiZXhlYyBfY29kZV8gaW4gX2dsb2JzXywgX2xvY3NfIiIiKQoKICAgIGV4ZWNfKCIiImRlZiByZXJhaXNlKHRwLCB2YWx1ZSwgdGI9Tm9uZSk6CiAgICByYWlzZSB0cCwgdmFsdWUsIHRiCiIiIikKCgppZiBzeXMudmVyc2lvbl9pbmZvWzoyXSA9PSAoMywgMik6CiAgICBleGVjXygiIiJkZWYgcmFpc2VfZnJvbSh2YWx1ZSwgZnJvbV92YWx1ZSk6CiAgICBpZiBmcm9tX3ZhbHVlIGlzIE5vbmU6CiAgICAgICAgcmFpc2UgdmFsdWUKICAgIHJhaXNlIHZhbHVlIGZyb20gZnJvbV92YWx1ZQoiIiIpCmVsaWYgc3lzLnZlcnNpb25faW5mb1s6Ml0gPiAoMywgMik6CiAgICBleGVjXygiIiJkZWYgcmFpc2VfZnJvbSh2YWx1ZSwgZnJvbV92YWx1ZSk6CiAgICByYWlzZSB2YWx1ZSBmcm9tIGZyb21fdmFsdWUKIiIiKQplbHNlOgogICAgZGVmIHJhaXNlX2Zyb20odmFsdWUsIGZyb21fdmFsdWUpOgogICAgICAgIHJhaXNlIHZhbHVlCgoKcHJpbnRfID0gZ2V0YXR0cihtb3Zlcy5idWlsdGlucywgInByaW50IiwgTm9uZSkKaWYgcHJpbnRfIGlzIE5vbmU6CiAgICBkZWYgcHJpbnRfKCphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgIiIiVGhlIG5ldy1zdHlsZSBwcmludCBmdW5jdGlvbiBmb3IgUHl0aG9uIDIuNCBhbmQgMi41LiIiIgogICAgICAgIGZwID0ga3dhcmdzLnBvcCgiZmlsZSIsIHN5cy5zdGRvdXQpCiAgICAgICAgaWYgZnAgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGRlZiB3cml0ZShkYXRhKToKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoZGF0YSwgYmFzZXN0cmluZyk6CiAgICAgICAgICAgICAgICBkYXRhID0gc3RyKGRhdGEpCiAgICAgICAgICAgICMgSWYgdGhlIGZpbGUgaGFzIGFuIGVuY29kaW5nLCBlbmNvZGUgdW5pY29kZSB3aXRoIGl0LgogICAgICAgICAgICBpZiAoaXNpbnN0YW5jZShmcCwgZmlsZSkgYW5kCiAgICAgICAgICAgICAgICAgICAgaXNpbnN0YW5jZShkYXRhLCB1bmljb2RlKSBhbmQKICAgICAgICAgICAgICAgICAgICBmcC5lbmNvZGluZyBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICBlcnJvcnMgPSBnZXRhdHRyKGZwLCAiZXJyb3JzIiwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIGVycm9ycyBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGVycm9ycyA9ICJzdHJpY3QiCiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YS5lbmNvZGUoZnAuZW5jb2RpbmcsIGVycm9ycykKICAgICAgICAgICAgZnAud3JpdGUoZGF0YSkKICAgICAgICB3YW50X3VuaWNvZGUgPSBGYWxzZQogICAgICAgIHNlcCA9IGt3YXJncy5wb3AoInNlcCIsIE5vbmUpCiAgICAgICAgaWYgc2VwIGlzIG5vdCBOb25lOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNlcCwgdW5pY29kZSk6CiAgICAgICAgICAgICAgICB3YW50X3VuaWNvZGUgPSBUcnVlCiAgICAgICAgICAgIGVsaWYgbm90IGlzaW5zdGFuY2Uoc2VwLCBzdHIpOgogICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJzZXAgbXVzdCBiZSBOb25lIG9yIGEgc3RyaW5nIikKICAgICAgICBlbmQgPSBrd2FyZ3MucG9wKCJlbmQiLCBOb25lKQogICAgICAgIGlmIGVuZCBpcyBub3QgTm9uZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlbmQsIHVuaWNvZGUpOgogICAgICAgICAgICAgICAgd2FudF91bmljb2RlID0gVHJ1ZQogICAgICAgICAgICBlbGlmIG5vdCBpc2luc3RhbmNlKGVuZCwgc3RyKToKICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiZW5kIG11c3QgYmUgTm9uZSBvciBhIHN0cmluZyIpCiAgICAgICAgaWYga3dhcmdzOgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoImludmFsaWQga2V5d29yZCBhcmd1bWVudHMgdG8gcHJpbnQoKSIpCiAgICAgICAgaWYgbm90IHdhbnRfdW5pY29kZToKICAgICAgICAgICAgZm9yIGFyZyBpbiBhcmdzOgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShhcmcsIHVuaWNvZGUpOgogICAgICAgICAgICAgICAgICAgIHdhbnRfdW5pY29kZSA9IFRydWUKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmIHdhbnRfdW5pY29kZToKICAgICAgICAgICAgbmV3bGluZSA9IHVuaWNvZGUoIlxuIikKICAgICAgICAgICAgc3BhY2UgPSB1bmljb2RlKCIgIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBuZXdsaW5lID0gIlxuIgogICAgICAgICAgICBzcGFjZSA9ICIgIgogICAgICAgIGlmIHNlcCBpcyBOb25lOgogICAgICAgICAgICBzZXAgPSBzcGFjZQogICAgICAgIGlmIGVuZCBpcyBOb25lOgogICAgICAgICAgICBlbmQgPSBuZXdsaW5lCiAgICAgICAgZm9yIGksIGFyZyBpbiBlbnVtZXJhdGUoYXJncyk6CiAgICAgICAgICAgIGlmIGk6CiAgICAgICAgICAgICAgICB3cml0ZShzZXApCiAgICAgICAgICAgIHdyaXRlKGFyZykKICAgICAgICB3cml0ZShlbmQpCmlmIHN5cy52ZXJzaW9uX2luZm9bOjJdIDwgKDMsIDMpOgogICAgX3ByaW50ID0gcHJpbnRfCgogICAgZGVmIHByaW50XygqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGZwID0ga3dhcmdzLmdldCgiZmlsZSIsIHN5cy5zdGRvdXQpCiAgICAgICAgZmx1c2ggPSBrd2FyZ3MucG9wKCJmbHVzaCIsIEZhbHNlKQogICAgICAgIF9wcmludCgqYXJncywgKiprd2FyZ3MpCiAgICAgICAgaWYgZmx1c2ggYW5kIGZwIGlzIG5vdCBOb25lOgogICAgICAgICAgICBmcC5mbHVzaCgpCgpfYWRkX2RvYyhyZXJhaXNlLCAiIiJSZXJhaXNlIGFuIGV4Y2VwdGlvbi4iIiIpCgppZiBzeXMudmVyc2lvbl9pbmZvWzA6Ml0gPCAoMywgNCk6CiAgICBkZWYgd3JhcHMod3JhcHBlZCwgYXNzaWduZWQ9ZnVuY3Rvb2xzLldSQVBQRVJfQVNTSUdOTUVOVFMsCiAgICAgICAgICAgICAgdXBkYXRlZD1mdW5jdG9vbHMuV1JBUFBFUl9VUERBVEVTKToKICAgICAgICBkZWYgd3JhcHBlcihmKToKICAgICAgICAgICAgZiA9IGZ1bmN0b29scy53cmFwcyh3cmFwcGVkLCBhc3NpZ25lZCwgdXBkYXRlZCkoZikKICAgICAgICAgICAgZi5fX3dyYXBwZWRfXyA9IHdyYXBwZWQKICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICByZXR1cm4gd3JhcHBlcgplbHNlOgogICAgd3JhcHMgPSBmdW5jdG9vbHMud3JhcHMKCgpkZWYgd2l0aF9tZXRhY2xhc3MobWV0YSwgKmJhc2VzKToKICAgICIiIkNyZWF0ZSBhIGJhc2UgY2xhc3Mgd2l0aCBhIG1ldGFjbGFzcy4iIiIKICAgICMgVGhpcyByZXF1aXJlcyBhIGJpdCBvZiBleHBsYW5hdGlvbjogdGhlIGJhc2ljIGlkZWEgaXMgdG8gbWFrZSBhIGR1bW15CiAgICAjIG1ldGFjbGFzcyBmb3Igb25lIGxldmVsIG9mIGNsYXNzIGluc3RhbnRpYXRpb24gdGhhdCByZXBsYWNlcyBpdHNlbGYgd2l0aAogICAgIyB0aGUgYWN0dWFsIG1ldGFjbGFzcy4KICAgIGNsYXNzIG1ldGFjbGFzcyhtZXRhKToKCiAgICAgICAgZGVmIF9fbmV3X18oY2xzLCBuYW1lLCB0aGlzX2Jhc2VzLCBkKToKICAgICAgICAgICAgcmV0dXJuIG1ldGEobmFtZSwgYmFzZXMsIGQpCiAgICByZXR1cm4gdHlwZS5fX25ld19fKG1ldGFjbGFzcywgJ3RlbXBvcmFyeV9jbGFzcycsICgpLCB7fSkKCgpkZWYgYWRkX21ldGFjbGFzcyhtZXRhY2xhc3MpOgogICAgIiIiQ2xhc3MgZGVjb3JhdG9yIGZvciBjcmVhdGluZyBhIGNsYXNzIHdpdGggYSBtZXRhY2xhc3MuIiIiCiAgICBkZWYgd3JhcHBlcihjbHMpOgogICAgICAgIG9yaWdfdmFycyA9IGNscy5fX2RpY3RfXy5jb3B5KCkKICAgICAgICBzbG90cyA9IG9yaWdfdmFycy5nZXQoJ19fc2xvdHNfXycpCiAgICAgICAgaWYgc2xvdHMgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2xvdHMsIHN0cik6CiAgICAgICAgICAgICAgICBzbG90cyA9IFtzbG90c10KICAgICAgICAgICAgZm9yIHNsb3RzX3ZhciBpbiBzbG90czoKICAgICAgICAgICAgICAgIG9yaWdfdmFycy5wb3Aoc2xvdHNfdmFyKQogICAgICAgIG9yaWdfdmFycy5wb3AoJ19fZGljdF9fJywgTm9uZSkKICAgICAgICBvcmlnX3ZhcnMucG9wKCdfX3dlYWtyZWZfXycsIE5vbmUpCiAgICAgICAgcmV0dXJuIG1ldGFjbGFzcyhjbHMuX19uYW1lX18sIGNscy5fX2Jhc2VzX18sIG9yaWdfdmFycykKICAgIHJldHVybiB3cmFwcGVyCgoKZGVmIHB5dGhvbl8yX3VuaWNvZGVfY29tcGF0aWJsZShrbGFzcyk6CiAgICAiIiIKICAgIEEgZGVjb3JhdG9yIHRoYXQgZGVmaW5lcyBfX3VuaWNvZGVfXyBhbmQgX19zdHJfXyBtZXRob2RzIHVuZGVyIFB5dGhvbiAyLgogICAgVW5kZXIgUHl0aG9uIDMgaXQgZG9lcyBub3RoaW5nLgoKICAgIFRvIHN1cHBvcnQgUHl0aG9uIDIgYW5kIDMgd2l0aCBhIHNpbmdsZSBjb2RlIGJhc2UsIGRlZmluZSBhIF9fc3RyX18gbWV0aG9kCiAgICByZXR1cm5pbmcgdGV4dCBhbmQgYXBwbHkgdGhpcyBkZWNvcmF0b3IgdG8gdGhlIGNsYXNzLgogICAgIiIiCiAgICBpZiBQWTI6CiAgICAgICAgaWYgJ19fc3RyX18nIG5vdCBpbiBrbGFzcy5fX2RpY3RfXzoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiQHB5dGhvbl8yX3VuaWNvZGVfY29tcGF0aWJsZSBjYW5ub3QgYmUgYXBwbGllZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRvICVzIGJlY2F1c2UgaXQgZG9lc24ndCBkZWZpbmUgX19zdHJfXygpLiIgJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtsYXNzLl9fbmFtZV9fKQogICAgICAgIGtsYXNzLl9fdW5pY29kZV9fID0ga2xhc3MuX19zdHJfXwogICAgICAgIGtsYXNzLl9fc3RyX18gPSBsYW1iZGEgc2VsZjogc2VsZi5fX3VuaWNvZGVfXygpLmVuY29kZSgndXRmLTgnKQogICAgcmV0dXJuIGtsYXNzCgoKIyBDb21wbGV0ZSB0aGUgbW92ZXMgaW1wbGVtZW50YXRpb24uCiMgVGhpcyBjb2RlIGlzIGF0IHRoZSBlbmQgb2YgdGhpcyBtb2R1bGUgdG8gc3BlZWQgdXAgbW9kdWxlIGxvYWRpbmcuCiMgVHVybiB0aGlzIG1vZHVsZSBpbnRvIGEgcGFja2FnZS4KX19wYXRoX18gPSBbXSAgIyByZXF1aXJlZCBmb3IgUEVQIDMwMiBhbmQgUEVQIDQ1MQpfX3BhY2thZ2VfXyA9IF9fbmFtZV9fICAjIHNlZSBQRVAgMzY2IEBSZXNlcnZlZEFzc2lnbm1lbnQKaWYgZ2xvYmFscygpLmdldCgiX19zcGVjX18iKSBpcyBub3QgTm9uZToKICAgIF9fc3BlY19fLnN1Ym1vZHVsZV9zZWFyY2hfbG9jYXRpb25zID0gW10gICMgUEVQIDQ1MSBAVW5kZWZpbmVkVmFyaWFibGUKIyBSZW1vdmUgb3RoZXIgc2l4IG1ldGEgcGF0aCBpbXBvcnRlcnMsIHNpbmNlIHRoZXkgY2F1c2UgcHJvYmxlbXMuIFRoaXMgY2FuCiMgaGFwcGVuIGlmIHNpeCBpcyByZW1vdmVkIGZyb20gc3lzLm1vZHVsZXMgYW5kIHRoZW4gcmVsb2FkZWQuIChTZXR1cHRvb2xzIGRvZXMKIyB0aGlzIGZvciBzb21lIHJlYXNvbi4pCmlmIHN5cy5tZXRhX3BhdGg6CiAgICBmb3IgaSwgaW1wb3J0ZXIgaW4gZW51bWVyYXRlKHN5cy5tZXRhX3BhdGgpOgogICAgICAgICMgSGVyZSdzIHNvbWUgcmVhbCBuYXN0aW5lc3M6IEFub3RoZXIgImluc3RhbmNlIiBvZiB0aGUgc2l4IG1vZHVsZSBtaWdodAogICAgICAgICMgYmUgZmxvYXRpbmcgYXJvdW5kLiBUaGVyZWZvcmUsIHdlIGNhbid0IHVzZSBpc2luc3RhbmNlKCkgdG8gY2hlY2sgZm9yCiAgICAgICAgIyB0aGUgc2l4IG1ldGEgcGF0aCBpbXBvcnRlciwgc2luY2UgdGhlIG90aGVyIHNpeCBpbnN0YW5jZSB3aWxsIGhhdmUKICAgICAgICAjIGluc2VydGVkIGFuIGltcG9ydGVyIHdpdGggZGlmZmVyZW50IGNsYXNzLgogICAgICAgIGlmICh0eXBlKGltcG9ydGVyKS5fX25hbWVfXyA9PSAiX1NpeE1ldGFQYXRoSW1wb3J0ZXIiIGFuZAogICAgICAgICAgICAgICAgaW1wb3J0ZXIubmFtZSA9PSBfX25hbWVfXyk6CiAgICAgICAgICAgIGRlbCBzeXMubWV0YV9wYXRoW2ldCiAgICAgICAgICAgIGJyZWFrCiAgICBkZWwgaSwgaW1wb3J0ZXIKIyBGaW5hbGx5LCBhZGQgdGhlIGltcG9ydGVyIHRvIHRoZSBtZXRhIHBhdGggaW1wb3J0IGhvb2suCnN5cy5tZXRhX3BhdGguYXBwZW5kKF9pbXBvcnRlcikKUEsBAhQDFAAAAAAA4LsrS4+n8VJ3AAAAdwAAABMAAAAAAAAAAAAAAIABAAAAAGFuc2libGUvX19pbml0X18ucHlQSwECFAMUAAAAAADguytLncXxa0gAAABIAAAAIAAAAAAAAAAAAAAAgAGoAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvX19pbml0X18ucHlQSwECFAMUAAAAAADguytLjpGoVktpAABLaQAAIAAAAAAAAAAAAAAAgAEuAQAAYW5zaWJsZV9tb2R1bGVfY25vc19pbnRlcmZhY2UucHlQSwECFAMUAAAAAADguytLO985lTCKAQAwigEAHQAAAAAAAAAAAAAAgAG3agAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvYmFzaWMucHlQSwECFAMUAAAAAADguytLXozuKdgLAgDYCwIAHAAAAAAAAAAAAAAAgAEi9QEAYW5zaWJsZS9tb2R1bGVfdXRpbHMvY25vcy5weVBLAQIUAxQAAAAAAOC7K0u12AQGJTAAACUwAAAdAAAAAAAAAAAAAACAATQBBABhbnNpYmxlL21vZHVsZV91dGlscy9fdGV4dC5weVBLAQIUAxQAAAAAAOC7K0sl3LR+ExAAABMQAAAiAAAAAAAAAAAAAACAAZQxBABhbnNpYmxlL21vZHVsZV91dGlscy9weWNvbXBhdDI0LnB5UEsBAhQDFAAAAAAA4LsrSxgXcvUBEQAAAREAACQAAAAAAAAAAAAAAIAB50EEAGFuc2libGUvbW9kdWxlX3V0aWxzL3NpeC9fX2luaXRfXy5weVBLAQIUAxQAAAAAAOC7K0s44sfRkXUAAJF1AAAgAAAAAAAAAAAAAACAASpTBABhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX3NpeC5weVBLBQYAAAAACQAJAK0CAAD5yAQAAAA="""
def invoke_module(module, modlib_path, json_params):
    pythonpath = os.environ.get('PYTHONPATH')
    if pythonpath:
        os.environ['PYTHONPATH'] = ':'.join((modlib_path, pythonpath))
    else:
        os.environ['PYTHONPATH'] = modlib_path
    p = subprocess.Popen(['/usr/bin/python', module], env=os.environ, shell=False, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
    (stdout, stderr) = p.communicate(json_params)
    if not isinstance(stderr, (bytes, unicode)):
        stderr = stderr.read()
    if not isinstance(stdout, (bytes, unicode)):
        stdout = stdout.read()
    if PY3:
        sys.stderr.buffer.write(stderr)
        sys.stdout.buffer.write(stdout)
    else:
        sys.stderr.write(stderr)
        sys.stdout.write(stdout)
    return p.returncode
def debug(command, zipped_mod, json_params):
    basedir = os.path.join(os.path.abspath(os.path.dirname(__file__)), 'debug_dir')
    args_path = os.path.join(basedir, 'args')
    script_path = os.path.join(basedir, 'ansible_module_cnos_interface.py')
    if command == 'explode':
        z = zipfile.ZipFile(zipped_mod)
        for filename in z.namelist():
            if filename.startswith('/'):
                raise Exception('Something wrong with this module zip file: should not contain absolute paths')
            dest_filename = os.path.join(basedir, filename)
            if dest_filename.endswith(os.path.sep) and not os.path.exists(dest_filename):
                os.makedirs(dest_filename)
            else:
                directory = os.path.dirname(dest_filename)
                if not os.path.exists(directory):
                    os.makedirs(directory)
                f = open(dest_filename, 'wb')
                f.write(z.read(filename))
                f.close()
        f = open(args_path, 'wb')
        f.write(json_params)
        f.close()
        print('Module expanded into:')
        print('%s' % basedir)
        exitcode = 0
    elif command == 'execute':
        pythonpath = os.environ.get('PYTHONPATH')
        if pythonpath:
            os.environ['PYTHONPATH'] = ':'.join((basedir, pythonpath))
        else:
            os.environ['PYTHONPATH'] = basedir
        p = subprocess.Popen(['/usr/bin/python', script_path, args_path],
                env=os.environ, shell=False, stdout=subprocess.PIPE,
                stderr=subprocess.PIPE, stdin=subprocess.PIPE)
        (stdout, stderr) = p.communicate()
        if not isinstance(stderr, (bytes, unicode)):
            stderr = stderr.read()
        if not isinstance(stdout, (bytes, unicode)):
            stdout = stdout.read()
        if PY3:
            sys.stderr.buffer.write(stderr)
            sys.stdout.buffer.write(stdout)
        else:
            sys.stderr.write(stderr)
            sys.stdout.write(stdout)
        return p.returncode
    elif command == 'excommunicate':
        sys.argv = ['cnos_interface', args_path]
        sys.path.insert(0, basedir)
        from ansible_module_cnos_interface import main
        main()
        print('WARNING: Module returned to wrapper instead of exiting')
        sys.exit(1)
    else:
        print('WARNING: Unknown debug command.  Doing nothing.')
        exitcode = 0
    return exitcode
if __name__ == '__main__':
    ANSIBALLZ_PARAMS = json.dumps({"ANSIBLE_MODULE_ARGS": json.load(sys.stdin)})
    if PY3:
        ANSIBALLZ_PARAMS = ANSIBALLZ_PARAMS.encode('utf-8')
    try:
        temp_path = tempfile.mkdtemp(prefix='ansible_')
        zipped_mod = os.path.join(temp_path, 'ansible_modlib.zip')
        modlib = open(zipped_mod, 'wb')
        modlib.write(base64.b64decode(ZIPDATA))
        modlib.close()
        if len(sys.argv) == 2:
            exitcode = debug(sys.argv[1], zipped_mod, ANSIBALLZ_PARAMS)
        else:
            z = zipfile.ZipFile(zipped_mod, mode='r')
            module = os.path.join(temp_path, 'ansible_module_cnos_interface.py')
            f = open(module, 'wb')
            f.write(z.read('ansible_module_cnos_interface.py'))
            f.close()
            z = zipfile.ZipFile(zipped_mod, mode='a')
            sitecustomize = u'import sys\nsys.path.insert(0,"%s")\n' %  zipped_mod
            sitecustomize = sitecustomize.encode('utf-8')
            zinfo = zipfile.ZipInfo()
            zinfo.filename = 'sitecustomize.py'
            zinfo.date_time = ( 2017, 9, 11, 23, 31, 0)
            z.writestr(zinfo, sitecustomize)
            z.close()
            exitcode = invoke_module(module, zipped_mod, ANSIBALLZ_PARAMS)
    finally:
        try:
            shutil.rmtree(temp_path)
        except OSError:
            pass
    sys.exit(exitcode)