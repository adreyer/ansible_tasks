#!/usr/bin/python
# -*- coding: utf-8 -*-
ANSIBALLZ_WRAPPER = True # For test-module script to tell this is a ANSIBALLZ_WRAPPER
import os
import os.path
import sys
import __main__
scriptdir = None
try:
    scriptdir = os.path.dirname(os.path.abspath(__main__.__file__))
except (AttributeError, OSError):
    pass
if scriptdir is not None:
    sys.path = [p for p in sys.path if p != scriptdir]
import base64
import json
import shutil
import zipfile
import tempfile
import subprocess
if sys.version_info < (3,):
    bytes = str
    PY3 = False
else:
    unicode = str
    PY3 = True
try:
    from io import BytesIO as IOStream
except ImportError:
    from StringIO import StringIO as IOStream
ZIPDATA = """UEsDBBQAAAAAAOG7K0uPp/FSdwAAAHcAAAATAAAAYW5zaWJsZS9fX2luaXRfXy5weWZyb20gcGtndXRpbCBpbXBvcnQgZXh0ZW5kX3BhdGgKX19wYXRoX189ZXh0ZW5kX3BhdGgoX19wYXRoX18sX19uYW1lX18pCl9fdmVyc2lvbl9fPSIyLjQuMCIKX19hdXRob3JfXz0iQW5zaWJsZSwgSW5jLiIKUEsDBBQAAAAAAOG7K0udxfFrSAAAAEgAAAAgAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvX19pbml0X18ucHlmcm9tIHBrZ3V0aWwgaW1wb3J0IGV4dGVuZF9wYXRoCl9fcGF0aF9fPWV4dGVuZF9wYXRoKF9fcGF0aF9fLF9fbmFtZV9fKQpQSwMEFAAAAAAA4bsrS9Fbjz1uLAAAbiwAABsAAABhbnNpYmxlX21vZHVsZV9jbm9zX3ZsYW4ucHkjIS91c3IvYmluL3B5dGhvbgojIC0qLSBjb2Rpbmc6IHV0Zi04IC0qLQojCiMgQ29weXJpZ2h0IChDKSAyMDE3IExlbm92bywgSW5jLgojCiMgVGhpcyBmaWxlIGlzIHBhcnQgb2YgQW5zaWJsZQojCiMgQW5zaWJsZSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CiMgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKIyB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uLCBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvcgojIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiMKIyBBbnNpYmxlIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCiMgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKIyBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiMgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KIwojIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiMgYWxvbmcgd2l0aCBBbnNpYmxlLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgojCiMgTW9kdWxlIHRvIHNlbmQgVkxBTiBjb21tYW5kcyB0byBMZW5vdm8gU3dpdGNoZXMKIyBPdmVybG9hZGluZyBhc3BlY3Qgb2YgdmxhbiBjcmVhdGlvbiBpbiBhIHJhbmdlIGlzIHBlbmRpbmcKIyBMZW5vdm8gTmV0d29ya2luZwojCgpBTlNJQkxFX01FVEFEQVRBID0geydtZXRhZGF0YV92ZXJzaW9uJzogJzEuMCcsCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cyc6IFsncHJldmlldyddLAogICAgICAgICAgICAgICAgICAgICdzdXBwb3J0ZWRfYnknOiAnY29tbXVuaXR5J30KCgpET0NVTUVOVEFUSU9OID0gJycnCi0tLQptb2R1bGU6IGNub3NfdmxhbgphdXRob3I6ICJEYXZlIEthc2JlcmcgKEBka2FzYmVyZykiCnNob3J0X2Rlc2NyaXB0aW9uOiBNYW5hZ2UgVkxBTiByZXNvdXJjZXMgYW5kIGF0dHJpYnV0ZXMgb24gZGV2aWNlcyBydW5uaW5nIExlbm92byBDTk9TCmRlc2NyaXB0aW9uOgogICAgLSBUaGlzIG1vZHVsZSBhbGxvd3MgeW91IHRvIHdvcmsgd2l0aCBWTEFOIHJlbGF0ZWQgY29uZmlndXJhdGlvbnMuIFRoZQogICAgIG9wZXJhdG9ycyB1c2VkIGFyZSBvdmVybG9hZGVkIHRvIGVuc3VyZSBjb250cm9sIG92ZXIgc3dpdGNoIFZMQU4KICAgICBjb25maWd1cmF0aW9ucy4gVGhlIGZpcnN0IGxldmVsIG9mIFZMQU4gY29uZmlndXJhdGlvbiBhbGxvd3MgdG8gc2V0IHVwIHRoZQogICAgIFZMQU4gcmFuZ2UsIHRoZSBWTEFOIHRhZyBwZXJzaXN0ZW5jZSwgYSBWTEFOIGFjY2VzcyBtYXAgYW5kIGFjY2VzcyBtYXAKICAgICBmaWx0ZXIuIEFmdGVyIHBhc3NpbmcgdGhpcyBsZXZlbCwgdGhlcmUgYXJlIGZpdmUgVkxBTiBhcmd1bWVudHMgdGhhdCB3aWxsCiAgICAgcGVyZm9ybSBmdXJ0aGVyIGNvbmZpZ3VyYXRpb25zLiBUaGV5IGFyZSB2bGFuQXJnMSwgdmxhbkFyZzIsIHZsYW5BcmczLAogICAgIHZsYW5Bcmc0LCBhbmQgdmxhbkFyZzUuIFRoZSB2YWx1ZSBvZiB2bGFuQXJnMSB3aWxsIGRldGVybWluZSB0aGUgd2F5CiAgICAgZm9sbG93aW5nIGFyZ3VtZW50cyB3aWxsIGJlIGV2YWx1YXRlZC4gRm9yIG1vcmUgZGV0YWlscyBvbiBob3cgdG8gdXNlIHRoZXNlCiAgICAgYXJndW1lbnRzLCBzZWUgW092ZXJsb2FkZWQgVmFyaWFibGVzXS4KICAgICBUaGlzIG1vZHVsZSB1c2VzIFNTSCB0byBtYW5hZ2UgbmV0d29yayBkZXZpY2UgY29uZmlndXJhdGlvbi4KICAgICBUaGUgcmVzdWx0cyBvZiB0aGUgb3BlcmF0aW9uIHdpbGwgYmUgcGxhY2VkIGluIGEgZGlyZWN0b3J5IG5hbWVkICdyZXN1bHRzJwogICAgIHRoYXQgbXVzdCBiZSBjcmVhdGVkIGJ5IHRoZSB1c2VyIGluIHRoZWlyIGxvY2FsIGRpcmVjdG9yeSB0byB3aGVyZSB0aGUgcGxheWJvb2sgaXMgcnVuLgogICAgIEZvciBtb3JlIGluZm9ybWF0aW9uIGFib3V0IHRoaXMgbW9kdWxlIGZyb20gTGVub3ZvIGFuZCBjdXN0b21pemluZyBpdCB1c2FnZSBmb3IgeW91cgogICAgIHVzZSBjYXNlcywgcGxlYXNlIHZpc2l0IFUoaHR0cDovL3N5c3RlbXgubGVub3ZvZmlsZXMuY29tL2hlbHAvaW5kZXguanNwP3RvcGljPSUyRmNvbS5sZW5vdm8uc3dpdGNobWd0LmFuc2libGUuZG9jJTJGY25vc192bGFuLmh0bWwpCnZlcnNpb25fYWRkZWQ6ICIyLjMiCmV4dGVuZHNfZG9jdW1lbnRhdGlvbl9mcmFnbWVudDogY25vcwpvcHRpb25zOgogIHZsYW5BcmcxOgogICAgZGVzY3JpcHRpb246CiAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIHZsYW4gZmlyc3QgYXJndW1lbnQuIFVzYWdlIG9mIHRoaXMgYXJndW1lbnQgY2FuIGJlIGZvdW5kIGlzIHRoZSBVc2VyIEd1aWRlIHJlZmVyZW5jZWQgYWJvdmUuCiAgICByZXF1aXJlZDogdHJ1ZQogICAgZGVmYXVsdDogbnVsbAogICAgY2hvaWNlczogW2FjY2Vzcy1tYXAsIGRvdDFxLCBmaWx0ZXIsIDwxLTM5OTk+IFZMQU4gSUQgMS0zOTk5IG9yIHJhbmdlXQogIHZsYW5BcmcyOgogICAgZGVzY3JpcHRpb246CiAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIHZsYW4gc2Vjb25kIGFyZ3VtZW50LiBVc2FnZSBvZiB0aGlzIGFyZ3VtZW50IGNhbiBiZSBmb3VuZCBpcyB0aGUgVXNlciBHdWlkZSByZWZlcmVuY2VkIGFib3ZlLgogICAgcmVxdWlyZWQ6IGZhbHNlCiAgICBkZWZhdWx0OiBudWxsCiAgICBjaG9pY2VzOiBbVkxBTiBBY2Nlc3MgTWFwIG5hbWUsZWdyZXNzLW9ubHksbmFtZSwgZmxvb2Qsc3RhdGUsIGlwXQogIHZsYW5BcmczOgogICAgZGVzY3JpcHRpb246CiAgICAgIC0gVGhpcyBpcyBhbiBvdmVybG9hZGVkIHZsYW4gdGhpcmQgYXJndW1lbnQuIFVzYWdlIG9mIHRoaXMgYXJndW1lbnQgY2FuIGJlIGZvdW5kIGlzIHRoZSBVc2VyIEd1aWRlIHJlZmVyZW5jZWQgYWJvdmUuCiAgICByZXF1aXJlZDogZmFsc2UKICAgIGRlZmF1bHQ6IG51bGwKICAgIGNob2ljZXM6IFthY3Rpb24sIG1hdGNoLCBzdGF0aXN0aWNzLCBlbnRlciBWTEFOIGlkIG9yIHJhbmdlIG9mIHZsYW4sIGFzY2lpIG5hbWUgZm9yIHRoZSBWTEFOLCBpcHY0IG9yIGlwdjYsIGFjdGl2ZSBvciBzdXNwZW5kLCBmYXN0LWxlYXZlLAogICAgbGFzdC1tZW1iZXItcXVlcnktaW50ZXJ2YWwsIG1yb3V0ZXIsIHF1ZXJpZXIsIHF1ZXJpZXItdGltZW91dCwgcXVlcnktaW50ZXJ2YWwsIHF1ZXJ5LW1heC1yZXNwb25zZS10aW1lLCByZXBvcnQtc3VwcHJlc3Npb24sCiAgICByb2J1c3RuZXNzLXZhcmlhYmxlLCBzdGFydHVwLXF1ZXJ5LWNvdW50LCBzdGFydHVwLXF1ZXJ5LWludGVydmFsLCBzdGF0aWMtZ3JvdXBdCiAgdmxhbkFyZzQ6CiAgICBkZXNjcmlwdGlvbjoKICAgICAgLSBUaGlzIGlzIGFuIG92ZXJsb2FkZWQgdmxhbiBmb3VydGggYXJndW1lbnQuIFVzYWdlIG9mIHRoaXMgYXJndW1lbnQgY2FuIGJlIGZvdW5kIGlzIHRoZSBVc2VyIEd1aWRlIHJlZmVyZW5jZWQgYWJvdmUuCiAgICByZXF1aXJlZDogZmFsc2UKICAgIGRlZmF1bHQ6IG51bGwKICAgIGNob2ljZXM6IFtkcm9wIG9yIGZvcndhcmQgb3IgcmVkaXJlY3QsIGlwIG9yIG1hYyxJbnRlcnZhbCBpbiBzZWNvbmRzLGV0aGVybmV0LCBwb3J0LWFnZ3JlZ2F0aW9uLCBRdWVyaWVyIElQIGFkZHJlc3MsCiAgICBRdWVyaWVyIFRpbWVvdXQgaW4gc2Vjb25kcywgUXVlcnkgSW50ZXJ2YWwgaW4gc2Vjb25kcywgUXVlcnkgTWF4IFJlc3BvbnNlIFRpbWUgaW4gc2Vjb25kcywgIFJvYnVzdG5lc3MgVmFyaWFibGUgdmFsdWUsCiAgICBOdW1iZXIgb2YgcXVlcmllcyBzZW50IGF0IHN0YXJ0dXAsIFF1ZXJ5IEludGVydmFsIGF0IHN0YXJ0dXBdCiAgdmxhbkFyZzU6CiAgICBkZXNjcmlwdGlvbjoKICAgICAgLSBUaGlzIGlzIGFuIG92ZXJsb2FkZWQgdmxhbiBmaWZ0aCBhcmd1bWVudC4gVXNhZ2Ugb2YgdGhpcyBhcmd1bWVudCBjYW4gYmUgZm91bmQgaXMgdGhlIFVzZXIgR3VpZGUgcmVmZXJlbmNlZCBhYm92ZS4KICAgIHJlcXVpcmVkOiBmYWxzZQogICAgZGVmYXVsdDogbnVsbAogICAgY2hvaWNlczogW2FjY2Vzcy1saXN0IG5hbWUsIFNsb3QvY2hhc3NpcyBudW1iZXIsIFBvcnQgQWdncmVnYXRpb24gTnVtYmVyXQoKJycnCkVYQU1QTEVTID0gJycnCgpUYXNrczogVGhlIGZvbGxvd2luZyBhcmUgZXhhbXBsZXMgb2YgdXNpbmcgdGhlIG1vZHVsZSBjbm9zX3ZsYW4uIFRoZXNlIGFyZSB3cml0dGVuIGluIHRoZSBtYWluLnltbCBmaWxlIG9mIHRoZSB0YXNrcyBkaXJlY3RvcnkuCi0tLQotIG5hbWU6IFRlc3QgVmxhbiAtIENyZWF0ZSBhIHZsYW4sIG5hbWUgaXQKICBjbm9zX3ZsYW46CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF92bGFuX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICB2bGFuQXJnMTogMTMKICAgICAgdmxhbkFyZzI6ICJuYW1lIgogICAgICB2bGFuQXJnMzogIkFuaWwiCgotIG5hbWU6IFRlc3QgVmxhbiAtIENyZWF0ZSBhIHZsYW4sIEZsb29kIGNvbmZpZ3VyYXRpb24KICBjbm9zX3ZsYW46CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF92bGFuX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICB2bGFuQXJnMTogMTMKICAgICAgdmxhbkFyZzI6ICJmbG9vZCIKICAgICAgdmxhbkFyZzM6ICJpcHY0IgoKLSBuYW1lOiBUZXN0IFZsYW4gLSBDcmVhdGUgYSB2bGFuLCBTdGF0ZSBjb25maWd1cmF0aW9uCiAgY25vc192bGFuOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3Rfdmxhbl97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgdmxhbkFyZzE6IDEzCiAgICAgIHZsYW5BcmcyOiAic3RhdGUiCiAgICAgIHZsYW5BcmczOiAiYWN0aXZlIgoKLSBuYW1lOiBUZXN0IFZsYW4gLSBWTEFOIEFjY2VzcyBtYXAxCiAgY25vc192bGFuOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3Rfdmxhbl97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgdmxhbkFyZzE6ICJhY2Nlc3MtbWFwIgogICAgICB2bGFuQXJnMjogIkFuaWwiCiAgICAgIHZsYW5BcmczOiAic3RhdGlzdGljcyIKCi0gbmFtZTogVGVzdCBWbGFuIC0gVkxBTiBBY2NlcCBNYXAyCiAgY25vc192bGFuOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3Rfdmxhbl97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgdmxhbkFyZzE6ICJhY2Nlc3MtbWFwIgogICAgICB2bGFuQXJnMjogIkFuaWwiCiAgICAgIHZsYW5BcmczOiAiYWN0aW9uIgogICAgICB2bGFuQXJnNDogImZvcndhcmQiCgotIG5hbWU6IFRlc3QgVmxhbiAtIGlwIGlnbXAgc25vb3BpbmcgcXVlcnkgaW50ZXJ2YWwKICBjbm9zX3ZsYW46CiAgICAgIGhvc3Q6ICJ7eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX0iCiAgICAgIHVzZXJuYW1lOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsndXNlcm5hbWUnXSB9fSIKICAgICAgcGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydwYXNzd29yZCddIH19IgogICAgICBkZXZpY2VUeXBlOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsnZGV2aWNlVHlwZSddIH19IgogICAgICBlbmFibGVQYXNzd29yZDogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2VuYWJsZVBhc3N3b3JkJ10gfX0iCiAgICAgIG91dHB1dGZpbGU6ICIuL3Jlc3VsdHMvdGVzdF92bGFuX3t7IGludmVudG9yeV9ob3N0bmFtZSB9fV9vdXRwdXQudHh0IgogICAgICB2bGFuQXJnMTogMTMKICAgICAgdmxhbkFyZzI6ICJpcCIKICAgICAgdmxhbkFyZzM6ICJxdWVyeS1pbnRlcnZhbCIKICAgICAgdmxhbkFyZzQ6IDEzMTMKCi0gbmFtZTogVGVzdCBWbGFuIC0gaXAgaWdtcCBzbm9vcGluZyBtcm91dGVyIGludGVyZmFjZSBwb3J0LWFnZ3JlZ2F0aW9uIDIzCiAgY25vc192bGFuOgogICAgICBob3N0OiAie3sgaW52ZW50b3J5X2hvc3RuYW1lIH19IgogICAgICB1c2VybmFtZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ3VzZXJuYW1lJ10gfX0iCiAgICAgIHBhc3N3b3JkOiAie3sgaG9zdHZhcnNbaW52ZW50b3J5X2hvc3RuYW1lXVsncGFzc3dvcmQnXSB9fSIKICAgICAgZGV2aWNlVHlwZTogInt7IGhvc3R2YXJzW2ludmVudG9yeV9ob3N0bmFtZV1bJ2RldmljZVR5cGUnXSB9fSIKICAgICAgZW5hYmxlUGFzc3dvcmQ6ICJ7eyBob3N0dmFyc1tpbnZlbnRvcnlfaG9zdG5hbWVdWydlbmFibGVQYXNzd29yZCddIH19IgogICAgICBvdXRwdXRmaWxlOiAiLi9yZXN1bHRzL3Rlc3Rfdmxhbl97eyBpbnZlbnRvcnlfaG9zdG5hbWUgfX1fb3V0cHV0LnR4dCIKICAgICAgdmxhbkFyZzE6IDEzCiAgICAgIHZsYW5BcmcyOiAiaXAiCiAgICAgIHZsYW5BcmczOiAibXJvdXRlciIKICAgICAgdmxhbkFyZzQ6ICJwb3J0LWFnZ3JlZ2F0aW9uIgogICAgICB2bGFuQXJnNTogMjMKCicnJwpSRVRVUk4gPSAnJycKbXNnOgogIGRlc2NyaXB0aW9uOiBTdWNjZXNzIG9yIGZhaWx1cmUgbWVzc2FnZQogIHJldHVybmVkOiBhbHdheXMKICB0eXBlOiBzdHJpbmcKICBzYW1wbGU6ICJWTEFOIGNvbmZpZ3VyYXRpb24gaXMgYWNjb21wbGlzaGVkIgonJycKCmltcG9ydCBzeXMKaW1wb3J0IHBhcmFtaWtvCmltcG9ydCB0aW1lCmltcG9ydCBhcmdwYXJzZQppbXBvcnQgc29ja2V0CmltcG9ydCBhcnJheQppbXBvcnQganNvbgppbXBvcnQgdGltZQppbXBvcnQgcmUKCnRyeToKICAgIGZyb20gYW5zaWJsZS5tb2R1bGVfdXRpbHMgaW1wb3J0IGNub3MKICAgIEhBU19MSUIgPSBUcnVlCmV4Y2VwdDoKICAgIEhBU19MSUIgPSBGYWxzZQoKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5iYXNpYyBpbXBvcnQgQW5zaWJsZU1vZHVsZQpmcm9tIGNvbGxlY3Rpb25zIGltcG9ydCBkZWZhdWx0ZGljdAoKZGVmIG1haW4oKToKICAgICMKICAgICMgRGVmaW5lIHBhcmFtZXRlcnMgZm9yIHZsYW4gY3JlYXRpb24gZW50cnkKICAgICMKICAgIG1vZHVsZSA9IEFuc2libGVNb2R1bGUoCiAgICAgICAgYXJndW1lbnRfc3BlYz1kaWN0KAogICAgICAgICAgICBvdXRwdXRmaWxlPWRpY3QocmVxdWlyZWQ9VHJ1ZSksCiAgICAgICAgICAgIGhvc3Q9ZGljdChyZXF1aXJlZD1UcnVlKSwKICAgICAgICAgICAgdXNlcm5hbWU9ZGljdChyZXF1aXJlZD1UcnVlKSwKICAgICAgICAgICAgcGFzc3dvcmQ9ZGljdChyZXF1aXJlZD1UcnVlLCBub19sb2c9VHJ1ZSksCiAgICAgICAgICAgIGVuYWJsZVBhc3N3b3JkPWRpY3QocmVxdWlyZWQ9RmFsc2UsIG5vX2xvZz1UcnVlKSwKICAgICAgICAgICAgZGV2aWNlVHlwZT1kaWN0KHJlcXVpcmVkPVRydWUpLAogICAgICAgICAgICB2bGFuQXJnMT1kaWN0KHJlcXVpcmVkPVRydWUpLAogICAgICAgICAgICB2bGFuQXJnMj1kaWN0KHJlcXVpcmVkPUZhbHNlKSwKICAgICAgICAgICAgdmxhbkFyZzM9ZGljdChyZXF1aXJlZD1GYWxzZSksCiAgICAgICAgICAgIHZsYW5Bcmc0PWRpY3QocmVxdWlyZWQ9RmFsc2UpLAogICAgICAgICAgICB2bGFuQXJnNT1kaWN0KHJlcXVpcmVkPUZhbHNlKSwpLAogICAgICAgIHN1cHBvcnRzX2NoZWNrX21vZGU9RmFsc2UpCgogICAgdXNlcm5hbWUgPSBtb2R1bGUucGFyYW1zWyd1c2VybmFtZSddCiAgICBwYXNzd29yZCA9IG1vZHVsZS5wYXJhbXNbJ3Bhc3N3b3JkJ10KICAgIGVuYWJsZVBhc3N3b3JkID0gbW9kdWxlLnBhcmFtc1snZW5hYmxlUGFzc3dvcmQnXQogICAgdmxhbkFyZzEgPSBtb2R1bGUucGFyYW1zWyd2bGFuQXJnMSddCiAgICB2bGFuQXJnMiA9IG1vZHVsZS5wYXJhbXNbJ3ZsYW5BcmcyJ10KICAgIHZsYW5BcmczID0gbW9kdWxlLnBhcmFtc1sndmxhbkFyZzMnXQogICAgdmxhbkFyZzQgPSBtb2R1bGUucGFyYW1zWyd2bGFuQXJnNCddCiAgICB2bGFuQXJnNSA9IG1vZHVsZS5wYXJhbXNbJ3ZsYW5Bcmc1J10KICAgIG91dHB1dGZpbGUgPSBtb2R1bGUucGFyYW1zWydvdXRwdXRmaWxlJ10KICAgIGhvc3RJUCA9IG1vZHVsZS5wYXJhbXNbJ2hvc3QnXQogICAgZGV2aWNlVHlwZSA9IG1vZHVsZS5wYXJhbXNbJ2RldmljZVR5cGUnXQoKICAgIG91dHB1dCA9ICIiCgogICAgIyBDcmVhdGUgaW5zdGFuY2Ugb2YgU1NIQ2xpZW50IG9iamVjdAogICAgcmVtb3RlX2Nvbm5fcHJlID0gcGFyYW1pa28uU1NIQ2xpZW50KCkKCiAgICAjIEF1dG9tYXRpY2FsbHkgYWRkIHVudHJ1c3RlZCBob3N0cyAobWFrZSBzdXJlIG9rYXkgZm9yIHNlY3VyaXR5IHBvbGljeSBpbgogICAgIyB5b3VyIGVudmlyb25tZW50KQogICAgcmVtb3RlX2Nvbm5fcHJlLnNldF9taXNzaW5nX2hvc3Rfa2V5X3BvbGljeShwYXJhbWlrby5BdXRvQWRkUG9saWN5KCkpCgogICAgIyBpbml0aWF0ZSBTU0ggY29ubmVjdGlvbiB3aXRoIHRoZSBzd2l0Y2gKICAgIHJlbW90ZV9jb25uX3ByZS5jb25uZWN0KGhvc3RJUCwgdXNlcm5hbWU9dXNlcm5hbWUsIHBhc3N3b3JkPXBhc3N3b3JkKQogICAgdGltZS5zbGVlcCgyKQoKICAgICMgVXNlIGludm9rZV9zaGVsbCB0byBlc3RhYmxpc2ggYW4gJ2ludGVyYWN0aXZlIHNlc3Npb24nCiAgICByZW1vdGVfY29ubiA9IHJlbW90ZV9jb25uX3ByZS5pbnZva2Vfc2hlbGwoKQogICAgdGltZS5zbGVlcCgyKQoKICAgICMgRW5hYmxlIGFuZCBlbnRlciBjb25maWd1cmUgdGVybWluYWwgdGhlbiBzZW5kIGNvbW1hbmQKICAgIG91dHB1dCA9IG91dHB1dCArIGNub3Mud2FpdEZvckRldmljZVJlc3BvbnNlKCJcbiIsICI+IiwgMiwgcmVtb3RlX2Nvbm4pCgogICAgb3V0cHV0ID0gb3V0cHV0ICsgXAogICAgICAgIGNub3MuZW50ZXJFbmFibGVNb2RlRm9yRGV2aWNlKGVuYWJsZVBhc3N3b3JkLCAzLCByZW1vdGVfY29ubikKCiAgICAjIE1ha2UgdGVybWluYWwgbGVuZ3RoID0gMAogICAgb3V0cHV0ID0gb3V0cHV0ICsgXAogICAgICAgIGNub3Mud2FpdEZvckRldmljZVJlc3BvbnNlKCJ0ZXJtaW5hbCBsZW5ndGggMFxuIiwgIiMiLCAyLCByZW1vdGVfY29ubikKCiAgICAjIEdvIHRvIGNvbmZpZyBtb2RlCiAgICBvdXRwdXQgPSBvdXRwdXQgKyBcCiAgICAgICAgY25vcy53YWl0Rm9yRGV2aWNlUmVzcG9uc2UoImNvbmYgZFxuIiwgIihjb25maWcpIyIsIDIsIHJlbW90ZV9jb25uKQoKICAgICMgU2VuZCB0aGUgQ0xpIGNvbW1hbmQKICAgIG91dHB1dCA9IG91dHB1dCArIFwKICAgICAgICBjbm9zLnZsYW5Db25maWcoCiAgICAgICAgICAgIHJlbW90ZV9jb25uLCBkZXZpY2VUeXBlLCAiKGNvbmZpZykjIiwgMiwgdmxhbkFyZzEsIHZsYW5BcmcyLAogICAgICAgICAgICB2bGFuQXJnMywgdmxhbkFyZzQsIHZsYW5Bcmc1KQoKICAgICMgU2F2ZSBpdCBpbnRvIHRoZSBmaWxlCiAgICBmaWxlID0gb3BlbihvdXRwdXRmaWxlLCAiYSIpCiAgICBmaWxlLndyaXRlKG91dHB1dCkKICAgIGZpbGUuY2xvc2UoKQoKICAgICMgbmVlZCB0byBhZGQgbG9naWMgdG8gY2hlY2sgd2hlbiBjaGFuZ2VzIG9jY3VyIG9yIG5vdAogICAgZXJyb3JNc2cgPSBjbm9zLmNoZWNrT3V0cHV0Rm9yRXJyb3Iob3V0cHV0KQogICAgaWYoZXJyb3JNc2cgaXMgTm9uZSk6CiAgICAgICAgbW9kdWxlLmV4aXRfanNvbihjaGFuZ2VkPVRydWUsIG1zZz0iVkxBTiBjb25maWd1cmF0aW9uIGlzIGFjY29tcGxpc2hlZCIpCiAgICBlbHNlOgogICAgICAgIG1vZHVsZS5mYWlsX2pzb24obXNnPWVycm9yTXNnKQoKaWYgX19uYW1lX18gPT0gJ19fbWFpbl9fJzoKICAgICAgICBtYWluKCkKUEsDBBQAAAAAAOG7K0s73zmVMIoBADCKAQAdAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvYmFzaWMucHkjIFRoaXMgY29kZSBpcyBwYXJ0IG9mIEFuc2libGUsIGJ1dCBpcyBhbiBpbmRlcGVuZGVudCBjb21wb25lbnQuCiMgVGhpcyBwYXJ0aWN1bGFyIGZpbGUgc25pcHBldCwgYW5kIHRoaXMgZmlsZSBzbmlwcGV0IG9ubHksIGlzIEJTRCBsaWNlbnNlZC4KIyBNb2R1bGVzIHlvdSB3cml0ZSB1c2luZyB0aGlzIHNuaXBwZXQsIHdoaWNoIGlzIGVtYmVkZGVkIGR5bmFtaWNhbGx5IGJ5IEFuc2libGUKIyBzdGlsbCBiZWxvbmcgdG8gdGhlIGF1dGhvciBvZiB0aGUgbW9kdWxlLCBhbmQgbWF5IGFzc2lnbiB0aGVpciBvd24gbGljZW5zZQojIHRvIHRoZSBjb21wbGV0ZSB3b3JrLgojCiMgQ29weXJpZ2h0IChjKSwgTWljaGFlbCBEZUhhYW4gPG1pY2hhZWwuZGVoYWFuQGdtYWlsLmNvbT4sIDIwMTItMjAxMwojIENvcHlyaWdodCAoYyksIFRvc2hpbyBLdXJhdG9taSA8dGt1cmF0b21pQGFuc2libGUuY29tPiAyMDE2CiMgQWxsIHJpZ2h0cyByZXNlcnZlZC4KIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sCiMgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAojICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgojICAgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5ECiMgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQKIyBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuCiMgSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCiMgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLAojIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUwojIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QKIyBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUKIyBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KIwoKQk9PTEVBTlNfVFJVRSA9IFsneScsICd5ZXMnLCAnb24nLCAnMScsICd0cnVlJywgMSwgVHJ1ZV0KQk9PTEVBTlNfRkFMU0UgPSBbJ24nLCAnbm8nLCAnb2ZmJywgJzAnLCAnZmFsc2UnLCAwLCBGYWxzZV0KQk9PTEVBTlMgPSBCT09MRUFOU19UUlVFICsgQk9PTEVBTlNfRkFMU0UKClNJWkVfUkFOR0VTID0geyAnWSc6IDE8PDgwLCAnWic6IDE8PDcwLCAnRSc6IDE8PDYwLCAnUCc6IDE8PDUwLCAnVCc6IDE8PDQwLCAnRyc6IDE8PDMwLCAnTSc6IDE8PDIwLCAnSyc6IDE8PDEwLCAnQic6IDEgfQoKRklMRV9BVFRSSUJVVEVTID0gewogICAgJ0EnOiAnbm9hdGltZScsCiAgICAnYSc6ICdhcHBlbmQnLAogICAgJ2MnOiAnY29tcHJlc3NlZCcsCiAgICAnQyc6ICdub2NvdycsCiAgICAnZCc6ICdub2R1bXAnLAogICAgJ0QnOiAnZGlyc3luYycsCiAgICAnZSc6ICdleHRlbnRzJywKICAgICdFJzogJ2VuY3J5cHRlZCcsCiAgICAnaCc6ICdibG9ja3NpemUnLAogICAgJ2knOiAnaW1tdXRhYmxlJywKICAgICdJJzogJ2luZGV4ZWQnLAogICAgJ2onOiAnam91cm5hbGxlZCcsCiAgICAnTic6ICdpbmxpbmUnLAogICAgJ3MnOiAnemVybycsCiAgICAnUyc6ICdzeW5jaHJvbm91cycsCiAgICAndCc6ICdub3RhaWwnLAogICAgJ1QnOiAnYmxvY2tyb290JywKICAgICd1JzogJ3VuZGVsZXRlJywKICAgICdYJzogJ2NvbXByZXNzZWRyYXcnLAogICAgJ1onOiAnY29tcHJlc3NlZGRpcnR5JywKfQoKIyBhbnNpYmxlIG1vZHVsZXMgY2FuIGJlIHdyaXR0ZW4gaW4gYW55IGxhbmd1YWdlLiAgVG8gc2ltcGxpZnkKIyBkZXZlbG9wbWVudCBvZiBQeXRob24gbW9kdWxlcywgdGhlIGZ1bmN0aW9ucyBhdmFpbGFibGUgaGVyZSBjYW4KIyBiZSB1c2VkIHRvIGRvIG1hbnkgY29tbW9uIHRhc2tzCgppbXBvcnQgbG9jYWxlCmltcG9ydCBvcwppbXBvcnQgcmUKaW1wb3J0IHNobGV4CmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBzeXMKaW1wb3J0IHR5cGVzCmltcG9ydCB0aW1lCmltcG9ydCBzZWxlY3QKaW1wb3J0IHNodXRpbAppbXBvcnQgc3RhdAppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgZ3JwCmltcG9ydCBwd2QKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCBlcnJubwppbXBvcnQgZGF0ZXRpbWUKZnJvbSBpdGVydG9vbHMgaW1wb3J0IHJlcGVhdCwgY2hhaW4KCnRyeToKICAgIGltcG9ydCBzeXNsb2cKICAgIEhBU19TWVNMT0c9VHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBIQVNfU1lTTE9HPUZhbHNlCgp0cnk6CiAgICBmcm9tIHN5c3RlbWQgaW1wb3J0IGpvdXJuYWwKICAgIGhhc19qb3VybmFsID0gVHJ1ZQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBoYXNfam91cm5hbCA9IEZhbHNlCgpIQVZFX1NFTElOVVg9RmFsc2UKdHJ5OgogICAgaW1wb3J0IHNlbGludXgKICAgIEhBVkVfU0VMSU5VWD1UcnVlCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHBhc3MKCiMgUHl0aG9uMiAmIDMgd2F5IHRvIGdldCBOb25lVHlwZQpOb25lVHlwZSA9IHR5cGUoTm9uZSkKCnRyeToKICAgIGZyb20gY29sbGVjdGlvbnMgaW1wb3J0IFNlcXVlbmNlLCBNYXBwaW5nCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgcHl0aG9uMi41CiAgICBTZXF1ZW5jZSA9IChsaXN0LCB0dXBsZSkKICAgIE1hcHBpbmcgPSAoZGljdCwpCgojIE5vdGU6IFdoZW4gZ2V0dGluZyBTZXF1ZW5jZSBmcm9tIGNvbGxlY3Rpb25zLCBpdCBtYXRjaGVzIHdpdGggc3RyaW5ncy4gIElmCiMgdGhpcyBtYXR0ZXJzLCBtYWtlIHN1cmUgdG8gY2hlY2sgZm9yIHN0cmluZ3MgYmVmb3JlIGNoZWNraW5nIGZvciBzZXF1ZW5jZXR5cGUKdHJ5OgogICAgZnJvbSBjb2xsZWN0aW9ucy5hYmMgaW1wb3J0IEtleXNWaWV3CiAgICBTRVFVRU5DRVRZUEUgPSAoU2VxdWVuY2UsIEtleXNWaWV3KQpleGNlcHQ6CiAgICBTRVFVRU5DRVRZUEUgPSBTZXF1ZW5jZQoKdHJ5OgogICAgaW1wb3J0IGpzb24KICAgICMgRGV0ZWN0IHRoZSBweXRob24tanNvbiBsaWJyYXJ5IHdoaWNoIGlzIGluY29tcGF0aWJsZQogICAgIyBMb29rIGZvciBzaW1wbGVqc29uIGlmIHRoYXQncyB0aGUgY2FzZQogICAgdHJ5OgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGpzb24ubG9hZHMsIHR5cGVzLkZ1bmN0aW9uVHlwZSkgb3Igbm90IGlzaW5zdGFuY2UoanNvbi5kdW1wcywgdHlwZXMuRnVuY3Rpb25UeXBlKToKICAgICAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IKICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICByYWlzZSBJbXBvcnRFcnJvcgpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICB0cnk6CiAgICAgICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbgogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHByaW50KCdcbnsibXNnIjogIkVycm9yOiBhbnNpYmxlIHJlcXVpcmVzIHRoZSBzdGRsaWIganNvbiBvciBzaW1wbGVqc29uIG1vZHVsZSwgbmVpdGhlciB3YXMgZm91bmQhIiwgImZhaWxlZCI6IHRydWV9JykKICAgICAgICBzeXMuZXhpdCgxKQogICAgZXhjZXB0IFN5bnRheEVycm9yOgogICAgICAgIHByaW50KCdcbnsibXNnIjogIlN5bnRheEVycm9yOiBwcm9iYWJseSBkdWUgdG8gaW5zdGFsbGVkIHNpbXBsZWpzb24gYmVpbmcgZm9yIGEgZGlmZmVyZW50IHB5dGhvbiB2ZXJzaW9uIiwgImZhaWxlZCI6IHRydWV9JykKICAgICAgICBzeXMuZXhpdCgxKQoKQVZBSUxBQkxFX0hBU0hfQUxHT1JJVEhNUyA9IGRpY3QoKQp0cnk6CiAgICBpbXBvcnQgaGFzaGxpYgoKICAgICMgcHl0aG9uIDIuNy45KyBhbmQgMi43LjArCiAgICBmb3IgYXR0cmlidXRlIGluICgnYXZhaWxhYmxlX2FsZ29yaXRobXMnLCAnYWxnb3JpdGhtcycpOgogICAgICAgIGFsZ29yaXRobXMgPSBnZXRhdHRyKGhhc2hsaWIsIGF0dHJpYnV0ZSwgTm9uZSkKICAgICAgICBpZiBhbGdvcml0aG1zOgogICAgICAgICAgICBicmVhawogICAgaWYgYWxnb3JpdGhtcyBpcyBOb25lOgogICAgICAgICMgcHl0aG9uIDIuNSsKICAgICAgICBhbGdvcml0aG1zID0gKCdtZDUnLCAnc2hhMScsICdzaGEyMjQnLCAnc2hhMjU2JywgJ3NoYTM4NCcsICdzaGE1MTInKQogICAgZm9yIGFsZ29yaXRobSBpbiBhbGdvcml0aG1zOgogICAgICAgIEFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVNbYWxnb3JpdGhtXSA9IGdldGF0dHIoaGFzaGxpYiwgYWxnb3JpdGhtKQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBpbXBvcnQgc2hhCiAgICBBVkFJTEFCTEVfSEFTSF9BTEdPUklUSE1TID0geydzaGExJzogc2hhLnNoYX0KICAgIHRyeToKICAgICAgICBpbXBvcnQgbWQ1CiAgICAgICAgQVZBSUxBQkxFX0hBU0hfQUxHT1JJVEhNU1snbWQ1J10gPSBtZDUubWQ1CiAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgcGFzcwoKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5weWNvbXBhdDI0IGltcG9ydCBnZXRfZXhjZXB0aW9uLCBsaXRlcmFsX2V2YWwKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5zaXggaW1wb3J0IChQWTIsIFBZMywgYiwgYmluYXJ5X3R5cGUsIGludGVnZXJfdHlwZXMsCiAgICAgICAgaXRlcml0ZW1zLCB0ZXh0X3R5cGUsIHN0cmluZ190eXBlcykKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5zaXgubW92ZXMgaW1wb3J0IG1hcCwgcmVkdWNlLCBzaGxleF9xdW90ZQpmcm9tIGFuc2libGUubW9kdWxlX3V0aWxzLl90ZXh0IGltcG9ydCB0b19uYXRpdmUsIHRvX2J5dGVzLCB0b190ZXh0CgpQQVNTV09SRF9NQVRDSCA9IHJlLmNvbXBpbGUocideKD86LitbLV9cc10pP3Bhc3MoPzpbLV9cc10/KD86d29yZHxwaHJhc2V8d3JkfHdkKT8pKD86Wy1fXHNdLispPyQnLCByZS5JKQoKX05VTUJFUlRZUEVTID0gdHVwbGUobGlzdChpbnRlZ2VyX3R5cGVzKSArIFtmbG9hdF0pCgojIERlcHJlY2F0ZWQgY29tcGF0LiAgT25seSBrZXB0IGluIGNhc2UgYW5vdGhlciBtb2R1bGUgdXNlZCB0aGVzZSBuYW1lcyAgVXNpbmcKIyBhbnNpYmxlLm1vZHVsZV91dGlscy5zaXggaXMgcHJlZmVycmVkCgpOVU1CRVJUWVBFUyA9IF9OVU1CRVJUWVBFUwoKaW1hcCA9IG1hcAoKdHJ5OgogICAgIyBQeXRob24gMgogICAgdW5pY29kZQpleGNlcHQgTmFtZUVycm9yOgogICAgIyBQeXRob24gMwogICAgdW5pY29kZSA9IHRleHRfdHlwZQoKdHJ5OgogICAgIyBQeXRob24gMi42KwogICAgYnl0ZXMKZXhjZXB0IE5hbWVFcnJvcjoKICAgICMgUHl0aG9uIDIuNAogICAgYnl0ZXMgPSBiaW5hcnlfdHlwZQoKdHJ5OgogICAgIyBQeXRob24gMgogICAgYmFzZXN0cmluZwpleGNlcHQgTmFtZUVycm9yOgogICAgIyBQeXRob24gMwogICAgYmFzZXN0cmluZyA9IHN0cmluZ190eXBlcwoKX2xpdGVyYWxfZXZhbCA9IGxpdGVyYWxfZXZhbAoKIyBFbmQgb2YgZGVwcmVjYXRlZCBuYW1lcwoKIyBJbnRlcm5hbCBnbG9iYWwgaG9sZGluZyBwYXNzZWQgaW4gcGFyYW1zLiAgVGhpcyBpcyBjb25zdWx0ZWQgaW4gY2FzZQojIG11bHRpcGxlIEFuc2libGVNb2R1bGVzIGFyZSBjcmVhdGVkLiAgT3RoZXJ3aXNlIGVhY2ggQW5zaWJsZU1vZHVsZSB3b3VsZAojIGF0dGVtcHQgdG8gcmVhZCBmcm9tIHN0ZGluLiAgT3RoZXIgY29kZSBzaG91bGQgbm90IHVzZSB0aGlzIGRpcmVjdGx5IGFzIGl0CiMgaXMgYW4gaW50ZXJuYWwgaW1wbGVtZW50YXRpb24gZGV0YWlsCl9BTlNJQkxFX0FSR1MgPSBOb25lCgpGSUxFX0NPTU1PTl9BUkdVTUVOVFM9ZGljdCgKICAgIHNyYyA9IGRpY3QoKSwKICAgIG1vZGUgPSBkaWN0KHR5cGU9J3JhdycpLAogICAgb3duZXIgPSBkaWN0KCksCiAgICBncm91cCA9IGRpY3QoKSwKICAgIHNldXNlciA9IGRpY3QoKSwKICAgIHNlcm9sZSA9IGRpY3QoKSwKICAgIHNlbGV2ZWwgPSBkaWN0KCksCiAgICBzZXR5cGUgPSBkaWN0KCksCiAgICBmb2xsb3cgPSBkaWN0KHR5cGU9J2Jvb2wnLCBkZWZhdWx0PUZhbHNlKSwKICAgICMgbm90IHRha2VuIGJ5IHRoZSBmaWxlIG1vZHVsZSwgYnV0IG90aGVyIG1vZHVsZXMgY2FsbCBmaWxlIHNvIGl0IG11c3QgaWdub3JlIHRoZW0uCiAgICBjb250ZW50ID0gZGljdChub19sb2c9VHJ1ZSksCiAgICBiYWNrdXAgPSBkaWN0KCksCiAgICBmb3JjZSA9IGRpY3QoKSwKICAgIHJlbW90ZV9zcmMgPSBkaWN0KCksICMgdXNlZCBieSBhc3NlbWJsZQogICAgcmVnZXhwID0gZGljdCgpLCAjIHVzZWQgYnkgYXNzZW1ibGUKICAgIGRlbGltaXRlciA9IGRpY3QoKSwgIyB1c2VkIGJ5IGFzc2VtYmxlCiAgICBkaXJlY3RvcnlfbW9kZSA9IGRpY3QoKSwgIyB1c2VkIGJ5IGNvcHkKICAgIHVuc2FmZV93cml0ZXMgID0gZGljdCh0eXBlPSdib29sJyksICMgc2hvdWxkIGJlIGF2YWlsYWJsZSB0byBhbnkgbW9kdWxlIHVzaW5nIGF0b21pY19tb3ZlCiAgICBhdHRyaWJ1dGVzID0gZGljdChhbGlhc2VzPVsnYXR0ciddKSwKKQoKUEFTU1dEX0FSR19SRSA9IHJlLmNvbXBpbGUocideWy1dezAsMn1wYXNzWy1dPyh3b3JkfHdkKT8nKQoKIyBDYW4ndCB1c2UgMDc3Nzcgb24gUHl0aG9uIDMsIGNhbid0IHVzZSAwbzc3Nzcgb24gUHl0aG9uIDIuNApQRVJNX0JJVFMgPSBpbnQoJzA3Nzc3JywgOCkgICAgICAjIGZpbGUgbW9kZSBwZXJtaXNzaW9uIGJpdHMKRVhFQ19QRVJNX0JJVFMgPSBpbnQoJzAwMTExJywgOCkgIyBleGVjdXRlIHBlcm1pc3Npb24gYml0cwpERUZBVUxUX1BFUk0gPSBpbnQoJzA2NjYnLCA4KSAgICAjIGRlZmF1bHQgZmlsZSBwZXJtaXNzaW9uIGJpdHMKCgpkZWYgZ2V0X3BsYXRmb3JtKCk6CiAgICAnJycgd2hhdCdzIHRoZSBwbGF0Zm9ybT8gIGV4YW1wbGU6IExpbnV4IGlzIGEgcGxhdGZvcm0uICcnJwogICAgcmV0dXJuIHBsYXRmb3JtLnN5c3RlbSgpCgpkZWYgZ2V0X2Rpc3RyaWJ1dGlvbigpOgogICAgJycnIHJldHVybiB0aGUgZGlzdHJpYnV0aW9uIG5hbWUgJycnCiAgICBpZiBwbGF0Zm9ybS5zeXN0ZW0oKSA9PSAnTGludXgnOgogICAgICAgIHRyeToKICAgICAgICAgICAgc3VwcG9ydGVkX2Rpc3RzID0gcGxhdGZvcm0uX3N1cHBvcnRlZF9kaXN0cyArICgnYXJjaCcsJ2FscGluZScpCiAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9IHBsYXRmb3JtLmxpbnV4X2Rpc3RyaWJ1dGlvbihzdXBwb3J0ZWRfZGlzdHM9c3VwcG9ydGVkX2Rpc3RzKVswXS5jYXBpdGFsaXplKCkKICAgICAgICAgICAgaWYgbm90IGRpc3RyaWJ1dGlvbiBhbmQgb3MucGF0aC5pc2ZpbGUoJy9ldGMvc3lzdGVtLXJlbGVhc2UnKToKICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbiA9IHBsYXRmb3JtLmxpbnV4X2Rpc3RyaWJ1dGlvbihzdXBwb3J0ZWRfZGlzdHM9WydzeXN0ZW0nXSlbMF0uY2FwaXRhbGl6ZSgpCiAgICAgICAgICAgICAgICBpZiAnQW1hem9uJyBpbiBkaXN0cmlidXRpb246CiAgICAgICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uID0gJ0FtYXpvbicKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uID0gJ090aGVyTGludXgnCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAjIEZJWE1FOiBNZXRob2RNaXNzaW5nLCBJIGFzc3VtZT8KICAgICAgICAgICAgZGlzdHJpYnV0aW9uID0gcGxhdGZvcm0uZGlzdCgpWzBdLmNhcGl0YWxpemUoKQogICAgZWxzZToKICAgICAgICBkaXN0cmlidXRpb24gPSBOb25lCiAgICByZXR1cm4gZGlzdHJpYnV0aW9uCgpkZWYgZ2V0X2Rpc3RyaWJ1dGlvbl92ZXJzaW9uKCk6CiAgICAnJycgcmV0dXJuIHRoZSBkaXN0cmlidXRpb24gdmVyc2lvbiAnJycKICAgIGlmIHBsYXRmb3JtLnN5c3RlbSgpID09ICdMaW51eCc6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkaXN0cmlidXRpb25fdmVyc2lvbiA9IHBsYXRmb3JtLmxpbnV4X2Rpc3RyaWJ1dGlvbigpWzFdCiAgICAgICAgICAgIGlmIG5vdCBkaXN0cmlidXRpb25fdmVyc2lvbiBhbmQgb3MucGF0aC5pc2ZpbGUoJy9ldGMvc3lzdGVtLXJlbGVhc2UnKToKICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbl92ZXJzaW9uID0gcGxhdGZvcm0ubGludXhfZGlzdHJpYnV0aW9uKHN1cHBvcnRlZF9kaXN0cz1bJ3N5c3RlbSddKVsxXQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgIyBGSVhNRTogTWV0aG9kTWlzc2luZywgSSBhc3N1bWU/CiAgICAgICAgICAgIGRpc3RyaWJ1dGlvbl92ZXJzaW9uID0gcGxhdGZvcm0uZGlzdCgpWzFdCiAgICBlbHNlOgogICAgICAgIGRpc3RyaWJ1dGlvbl92ZXJzaW9uID0gTm9uZQogICAgcmV0dXJuIGRpc3RyaWJ1dGlvbl92ZXJzaW9uCgpkZWYgZ2V0X2FsbF9zdWJjbGFzc2VzKGNscyk6CiAgICAnJycKICAgIHVzZWQgYnkgbW9kdWxlcyBsaWtlIEhhcmR3YXJlIG9yIE5ldHdvcmsgZmFjdCBjbGFzc2VzIHRvIHJldHJpZXZlIGFsbCBzdWJjbGFzc2VzIG9mIGEgZ2l2ZW4gY2xhc3MuCiAgICBfX3N1YmNsYXNzZXNfXyByZXR1cm4gb25seSBkaXJlY3Qgc3ViIGNsYXNzZXMuIFRoaXMgb25lIGdvIGRvd24gaW50byB0aGUgY2xhc3MgdHJlZS4KICAgICcnJwogICAgIyBSZXRyaWV2ZSBkaXJlY3Qgc3ViY2xhc3NlcwogICAgc3ViY2xhc3NlcyA9IGNscy5fX3N1YmNsYXNzZXNfXygpCiAgICB0b192aXNpdCA9IGxpc3Qoc3ViY2xhc3NlcykKICAgICMgVGhlbiB2aXNpdCBhbGwgc3ViY2xhc3NlcwogICAgd2hpbGUgdG9fdmlzaXQ6CiAgICAgICAgZm9yIHNjIGluIHRvX3Zpc2l0OgogICAgICAgICAgICAjIFRoZSBjdXJyZW50IGNsYXNzIGlzIG5vdyB2aXNpdGVkLCBzbyByZW1vdmUgaXQgZnJvbSBsaXN0CiAgICAgICAgICAgIHRvX3Zpc2l0LnJlbW92ZShzYykKICAgICAgICAgICAgIyBBcHBlbmRpbmcgYWxsIHN1YmNsYXNzZXMgdG8gdmlzaXQgYW5kIGtlZXAgYSByZWZlcmVuY2Ugb2YgYXZhaWxhYmxlIGNsYXNzCiAgICAgICAgICAgIGZvciBzc2MgaW4gc2MuX19zdWJjbGFzc2VzX18oKToKICAgICAgICAgICAgICAgIHN1YmNsYXNzZXMuYXBwZW5kKHNzYykKICAgICAgICAgICAgICAgIHRvX3Zpc2l0LmFwcGVuZChzc2MpCiAgICByZXR1cm4gc3ViY2xhc3NlcwoKCmRlZiBsb2FkX3BsYXRmb3JtX3N1YmNsYXNzKGNscywgKmFyZ3MsICoqa3dhcmdzKToKICAgICcnJwogICAgdXNlZCBieSBtb2R1bGVzIGxpa2UgVXNlciB0byBoYXZlIGRpZmZlcmVudCBpbXBsZW1lbnRhdGlvbnMgYmFzZWQgb24gZGV0ZWN0ZWQgcGxhdGZvcm0uICBTZWUgVXNlcgogICAgbW9kdWxlIGZvciBhbiBleGFtcGxlLgogICAgJycnCgogICAgdGhpc19wbGF0Zm9ybSA9IGdldF9wbGF0Zm9ybSgpCiAgICBkaXN0cmlidXRpb24gPSBnZXRfZGlzdHJpYnV0aW9uKCkKICAgIHN1YmNsYXNzID0gTm9uZQoKICAgICMgZ2V0IHRoZSBtb3N0IHNwZWNpZmljIHN1cGVyY2xhc3MgZm9yIHRoaXMgcGxhdGZvcm0KICAgIGlmIGRpc3RyaWJ1dGlvbiBpcyBub3QgTm9uZToKICAgICAgICBmb3Igc2MgaW4gZ2V0X2FsbF9zdWJjbGFzc2VzKGNscyk6CiAgICAgICAgICAgIGlmIHNjLmRpc3RyaWJ1dGlvbiBpcyBub3QgTm9uZSBhbmQgc2MuZGlzdHJpYnV0aW9uID09IGRpc3RyaWJ1dGlvbiBhbmQgc2MucGxhdGZvcm0gPT0gdGhpc19wbGF0Zm9ybToKICAgICAgICAgICAgICAgIHN1YmNsYXNzID0gc2MKICAgIGlmIHN1YmNsYXNzIGlzIE5vbmU6CiAgICAgICAgZm9yIHNjIGluIGdldF9hbGxfc3ViY2xhc3NlcyhjbHMpOgogICAgICAgICAgICBpZiBzYy5wbGF0Zm9ybSA9PSB0aGlzX3BsYXRmb3JtIGFuZCBzYy5kaXN0cmlidXRpb24gaXMgTm9uZToKICAgICAgICAgICAgICAgIHN1YmNsYXNzID0gc2MKICAgIGlmIHN1YmNsYXNzIGlzIE5vbmU6CiAgICAgICAgc3ViY2xhc3MgPSBjbHMKCiAgICByZXR1cm4gc3VwZXIoY2xzLCBzdWJjbGFzcykuX19uZXdfXyhzdWJjbGFzcykKCgpkZWYganNvbl9kaWN0X3VuaWNvZGVfdG9fYnl0ZXMoZCwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0Jyk6CiAgICAnJycgUmVjdXJzaXZlbHkgY29udmVydCBkaWN0IGtleXMgYW5kIHZhbHVlcyB0byBieXRlIHN0cgoKICAgICAgICBTcGVjaWFsaXplZCBmb3IganNvbiByZXR1cm4gYmVjYXVzZSB0aGlzIG9ubHkgaGFuZGxlcywgbGlzdHMsIHR1cGxlcywKICAgICAgICBhbmQgZGljdCBjb250YWluZXIgdHlwZXMgKHRoZSBjb250YWluZXJzIHRoYXQgdGhlIGpzb24gbW9kdWxlIHJldHVybnMpCiAgICAnJycKCiAgICBpZiBpc2luc3RhbmNlKGQsIHRleHRfdHlwZSk6CiAgICAgICAgcmV0dXJuIHRvX2J5dGVzKGQsIGVuY29kaW5nPWVuY29kaW5nLCBlcnJvcnM9ZXJyb3JzKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIGRpY3QpOgogICAgICAgIHJldHVybiBkaWN0KG1hcChqc29uX2RpY3RfdW5pY29kZV90b19ieXRlcywgaXRlcml0ZW1zKGQpLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbGlmIGlzaW5zdGFuY2UoZCwgbGlzdCk6CiAgICAgICAgcmV0dXJuIGxpc3QobWFwKGpzb25fZGljdF91bmljb2RlX3RvX2J5dGVzLCBkLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbGlmIGlzaW5zdGFuY2UoZCwgdHVwbGUpOgogICAgICAgIHJldHVybiB0dXBsZShtYXAoanNvbl9kaWN0X3VuaWNvZGVfdG9fYnl0ZXMsIGQsIHJlcGVhdChlbmNvZGluZyksIHJlcGVhdChlcnJvcnMpKSkKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIGQKCmRlZiBqc29uX2RpY3RfYnl0ZXNfdG9fdW5pY29kZShkLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKToKICAgICcnJyBSZWN1cnNpdmVseSBjb252ZXJ0IGRpY3Qga2V5cyBhbmQgdmFsdWVzIHRvIGJ5dGUgc3RyCgogICAgICAgIFNwZWNpYWxpemVkIGZvciBqc29uIHJldHVybiBiZWNhdXNlIHRoaXMgb25seSBoYW5kbGVzLCBsaXN0cywgdHVwbGVzLAogICAgICAgIGFuZCBkaWN0IGNvbnRhaW5lciB0eXBlcyAodGhlIGNvbnRhaW5lcnMgdGhhdCB0aGUganNvbiBtb2R1bGUgcmV0dXJucykKICAgICcnJwoKICAgIGlmIGlzaW5zdGFuY2UoZCwgYmluYXJ5X3R5cGUpOgogICAgICAgICMgV2FybmluZywgY2FuIHRyYWNlYmFjawogICAgICAgIHJldHVybiB0b190ZXh0KGQsIGVuY29kaW5nPWVuY29kaW5nLCBlcnJvcnM9ZXJyb3JzKQogICAgZWxpZiBpc2luc3RhbmNlKGQsIGRpY3QpOgogICAgICAgIHJldHVybiBkaWN0KG1hcChqc29uX2RpY3RfYnl0ZXNfdG9fdW5pY29kZSwgaXRlcml0ZW1zKGQpLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbGlmIGlzaW5zdGFuY2UoZCwgbGlzdCk6CiAgICAgICAgcmV0dXJuIGxpc3QobWFwKGpzb25fZGljdF9ieXRlc190b191bmljb2RlLCBkLCByZXBlYXQoZW5jb2RpbmcpLCByZXBlYXQoZXJyb3JzKSkpCiAgICBlbGlmIGlzaW5zdGFuY2UoZCwgdHVwbGUpOgogICAgICAgIHJldHVybiB0dXBsZShtYXAoanNvbl9kaWN0X2J5dGVzX3RvX3VuaWNvZGUsIGQsIHJlcGVhdChlbmNvZGluZyksIHJlcGVhdChlcnJvcnMpKSkKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIGQKCmRlZiByZXR1cm5fdmFsdWVzKG9iaik6CiAgICAiIiIgUmV0dXJuIG5hdGl2ZSBzdHJpbmdpZmllZCB2YWx1ZXMgZnJvbSBkYXRhc3RydWN0dXJlcy4KCiAgICBGb3IgdXNlIHdpdGggcmVtb3Zpbmcgc2Vuc2l0aXZlIHZhbHVlcyBwcmUtanNvbmlmaWNhdGlvbi4iIiIKICAgIGlmIGlzaW5zdGFuY2Uob2JqLCAodGV4dF90eXBlLCBiaW5hcnlfdHlwZSkpOgogICAgICAgIGlmIG9iajoKICAgICAgICAgICAgeWllbGQgdG9fbmF0aXZlKG9iaiwgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICByZXR1cm4KICAgIGVsaWYgaXNpbnN0YW5jZShvYmosIFNFUVVFTkNFVFlQRSk6CiAgICAgICAgZm9yIGVsZW1lbnQgaW4gb2JqOgogICAgICAgICAgICBmb3Igc3ViZWxlbWVudCBpbiByZXR1cm5fdmFsdWVzKGVsZW1lbnQpOgogICAgICAgICAgICAgICAgeWllbGQgc3ViZWxlbWVudAogICAgZWxpZiBpc2luc3RhbmNlKG9iaiwgTWFwcGluZyk6CiAgICAgICAgZm9yIGVsZW1lbnQgaW4gb2JqLml0ZW1zKCk6CiAgICAgICAgICAgIGZvciBzdWJlbGVtZW50IGluIHJldHVybl92YWx1ZXMoZWxlbWVudFsxXSk6CiAgICAgICAgICAgICAgICB5aWVsZCBzdWJlbGVtZW50CiAgICBlbGlmIGlzaW5zdGFuY2Uob2JqLCAoYm9vbCwgTm9uZVR5cGUpKToKICAgICAgICAjIFRoaXMgbXVzdCBjb21lIGJlZm9yZSBpbnQgYmVjYXVzZSBib29scyBhcmUgYWxzbyBpbnRzCiAgICAgICAgcmV0dXJuCiAgICBlbGlmIGlzaW5zdGFuY2Uob2JqLCBOVU1CRVJUWVBFUyk6CiAgICAgICAgeWllbGQgdG9fbmF0aXZlKG9iaiwgbm9uc3RyaW5nPSdzaW1wbGVyZXByJykKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCdVbmtub3duIHBhcmFtZXRlciB0eXBlOiAlcywgJXMnICUgKHR5cGUob2JqKSwgb2JqKSkKCmRlZiByZW1vdmVfdmFsdWVzKHZhbHVlLCBub19sb2dfc3RyaW5ncyk6CiAgICAiIiIgUmVtb3ZlIHN0cmluZ3MgaW4gbm9fbG9nX3N0cmluZ3MgZnJvbSB2YWx1ZS4gIElmIHZhbHVlIGlzIGEgY29udGFpbmVyCiAgICB0eXBlLCB0aGVuIHJlbW92ZSBhIGxvdCBtb3JlIiIiCiAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAodGV4dF90eXBlLCBiaW5hcnlfdHlwZSkpOgogICAgICAgICMgTmVlZCBuYXRpdmUgc3RyIHR5cGUKICAgICAgICBuYXRpdmVfc3RyX3ZhbHVlID0gdmFsdWUKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCB0ZXh0X3R5cGUpOgogICAgICAgICAgICB2YWx1ZV9pc190ZXh0ID0gVHJ1ZQogICAgICAgICAgICBpZiBQWTI6CiAgICAgICAgICAgICAgICBuYXRpdmVfc3RyX3ZhbHVlID0gdG9fYnl0ZXModmFsdWUsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgICAgIHZhbHVlX2lzX3RleHQgPSBGYWxzZQogICAgICAgICAgICBpZiBQWTM6CiAgICAgICAgICAgICAgICBuYXRpdmVfc3RyX3ZhbHVlID0gdG9fdGV4dCh2YWx1ZSwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKCiAgICAgICAgaWYgbmF0aXZlX3N0cl92YWx1ZSBpbiBub19sb2dfc3RyaW5nczoKICAgICAgICAgICAgcmV0dXJuICdWQUxVRV9TUEVDSUZJRURfSU5fTk9fTE9HX1BBUkFNRVRFUicKICAgICAgICBmb3Igb21pdF9tZSBpbiBub19sb2dfc3RyaW5nczoKICAgICAgICAgICAgbmF0aXZlX3N0cl92YWx1ZSA9IG5hdGl2ZV9zdHJfdmFsdWUucmVwbGFjZShvbWl0X21lLCAnKicgKiA4KQoKICAgICAgICBpZiB2YWx1ZV9pc190ZXh0IGFuZCBpc2luc3RhbmNlKG5hdGl2ZV9zdHJfdmFsdWUsIGJpbmFyeV90eXBlKToKICAgICAgICAgICAgdmFsdWUgPSB0b190ZXh0KG5hdGl2ZV9zdHJfdmFsdWUsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fcmVwbGFjZScpCiAgICAgICAgZWxpZiBub3QgdmFsdWVfaXNfdGV4dCBhbmQgaXNpbnN0YW5jZShuYXRpdmVfc3RyX3ZhbHVlLCB0ZXh0X3R5cGUpOgogICAgICAgICAgICB2YWx1ZSA9IHRvX2J5dGVzKG5hdGl2ZV9zdHJfdmFsdWUsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fcmVwbGFjZScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWUgPSBuYXRpdmVfc3RyX3ZhbHVlCiAgICBlbGlmIGlzaW5zdGFuY2UodmFsdWUsIFNFUVVFTkNFVFlQRSk6CiAgICAgICAgcmV0dXJuIFtyZW1vdmVfdmFsdWVzKGVsZW0sIG5vX2xvZ19zdHJpbmdzKSBmb3IgZWxlbSBpbiB2YWx1ZV0KICAgIGVsaWYgaXNpbnN0YW5jZSh2YWx1ZSwgTWFwcGluZyk6CiAgICAgICAgcmV0dXJuIGRpY3QoKGssIHJlbW92ZV92YWx1ZXModiwgbm9fbG9nX3N0cmluZ3MpKSBmb3IgaywgdiBpbiB2YWx1ZS5pdGVtcygpKQogICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCB0dXBsZShjaGFpbihOVU1CRVJUWVBFUywgKGJvb2wsIE5vbmVUeXBlKSkpKToKICAgICAgICBzdHJpbmd5X3ZhbHVlID0gdG9fbmF0aXZlKHZhbHVlLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgIGlmIHN0cmluZ3lfdmFsdWUgaW4gbm9fbG9nX3N0cmluZ3M6CiAgICAgICAgICAgIHJldHVybiAnVkFMVUVfU1BFQ0lGSUVEX0lOX05PX0xPR19QQVJBTUVURVInCiAgICAgICAgZm9yIG9taXRfbWUgaW4gbm9fbG9nX3N0cmluZ3M6CiAgICAgICAgICAgIGlmIG9taXRfbWUgaW4gc3RyaW5neV92YWx1ZToKICAgICAgICAgICAgICAgIHJldHVybiAnVkFMVUVfU1BFQ0lGSUVEX0lOX05PX0xPR19QQVJBTUVURVInCiAgICBlbGlmIGlzaW5zdGFuY2UodmFsdWUsIGRhdGV0aW1lLmRhdGV0aW1lKToKICAgICAgICB2YWx1ZSA9IHZhbHVlLmlzb2Zvcm1hdCgpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignVmFsdWUgb2YgdW5rbm93biB0eXBlOiAlcywgJXMnICUgKHR5cGUodmFsdWUpLCB2YWx1ZSkpCiAgICByZXR1cm4gdmFsdWUKCgpkZWYgaGV1cmlzdGljX2xvZ19zYW5pdGl6ZShkYXRhLCBub19sb2dfdmFsdWVzPU5vbmUpOgogICAgJycnIFJlbW92ZSBzdHJpbmdzIHRoYXQgbG9vayBsaWtlIHBhc3N3b3JkcyBmcm9tIGxvZyBtZXNzYWdlcyAnJycKICAgICMgQ3VycmVudGx5IGZpbHRlcnM6CiAgICAjIHVzZXI6cGFzc0Bmb28vd2hhdGV2ZXIgYW5kIGh0dHA6Ly91c2VybmFtZTpwYXNzQHdoZXJldmVyL2ZvbwogICAgIyBUaGlzIGNvZGUgaGFzIGZhbHNlIHBvc2l0aXZlcyBhbmQgY29uc3VtZXMgcGFydHMgb2YgbG9ncyB0aGF0IGFyZQogICAgIyBub3QgcGFzc3dkcwoKICAgICMgYmVnaW46IHN0YXJ0IG9mIGEgcGFzc3dkIGNvbnRhaW5pbmcgc3RyaW5nCiAgICAjIGVuZDogZW5kIG9mIGEgcGFzc3dkIGNvbnRhaW5pbmcgc3RyaW5nCiAgICAjIHNlcDogY2hhciBiZXR3ZWVuIHVzZXIgYW5kIHBhc3N3ZAogICAgIyBwcmV2X2JlZ2luOiB3aGVyZSBpbiB0aGUgb3ZlcmFsbCBzdHJpbmcgdG8gc3RhcnQgYSBzZWFyY2ggZm9yCiAgICAjICAgYSBwYXNzd2QKICAgICMgc2VwX3NlYXJjaF9lbmQ6IHdoZXJlIGluIHRoZSBzdHJpbmcgdG8gZW5kIGEgc2VhcmNoIGZvciB0aGUgc2VwCiAgICBkYXRhID0gdG9fbmF0aXZlKGRhdGEpCgogICAgb3V0cHV0ID0gW10KICAgIGJlZ2luID0gbGVuKGRhdGEpCiAgICBwcmV2X2JlZ2luID0gYmVnaW4KICAgIHNlcCA9IDEKICAgIHdoaWxlIHNlcDoKICAgICAgICAjIEZpbmQgdGhlIHBvdGVudGlhbCBlbmQgb2YgYSBwYXNzd2QKICAgICAgICB0cnk6CiAgICAgICAgICAgIGVuZCA9IGRhdGEucmluZGV4KCdAJywgMCwgYmVnaW4pCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICMgTm8gcGFzc3dkIGluIHRoZSByZXN0IG9mIHRoZSBkYXRhCiAgICAgICAgICAgIG91dHB1dC5pbnNlcnQoMCwgZGF0YVswOmJlZ2luXSkKICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgIyBTZWFyY2ggZm9yIHRoZSBiZWdpbm5pbmcgb2YgYSBwYXNzd2QKICAgICAgICBzZXAgPSBOb25lCiAgICAgICAgc2VwX3NlYXJjaF9lbmQgPSBlbmQKICAgICAgICB3aGlsZSBub3Qgc2VwOgogICAgICAgICAgICAjIFVSTC1zdHlsZSB1c2VybmFtZStwYXNzd29yZAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBiZWdpbiA9IGRhdGEucmluZGV4KCc6Ly8nLCAwLCBzZXBfc2VhcmNoX2VuZCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAjIE5vIHVybCBzdHlsZSBpbiB0aGUgZGF0YSwgY2hlY2sgZm9yIHNzaCBzdHlsZSBpbiB0aGUKICAgICAgICAgICAgICAgICMgcmVzdCBvZiB0aGUgc3RyaW5nCiAgICAgICAgICAgICAgICBiZWdpbiA9IDAKICAgICAgICAgICAgIyBTZWFyY2ggZm9yIHNlcGFyYXRvcgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZXAgPSBkYXRhLmluZGV4KCc6JywgYmVnaW4gKyAzLCBlbmQpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgIyBObyBzZXBhcmF0b3I7IGNob2ljZXM6CiAgICAgICAgICAgICAgICBpZiBiZWdpbiA9PSAwOgogICAgICAgICAgICAgICAgICAgICMgU2VhcmNoZWQgdGhlIHdob2xlIHN0cmluZyBzbyB0aGVyZSdzIG5vIHBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgIyBoZXJlLiAgUmV0dXJuIHRoZSByZW1haW5pbmcgZGF0YQogICAgICAgICAgICAgICAgICAgIG91dHB1dC5pbnNlcnQoMCwgZGF0YVswOmJlZ2luXSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgIyBTZWFyY2ggZm9yIGEgZGlmZmVyZW50IGJlZ2lubmluZyBvZiB0aGUgcGFzc3dvcmQgZmllbGQuCiAgICAgICAgICAgICAgICBzZXBfc2VhcmNoX2VuZCA9IGJlZ2luCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIGlmIHNlcDoKICAgICAgICAgICAgIyBQYXNzd29yZCB3YXMgZm91bmQ7IHJlbW92ZSBpdC4KICAgICAgICAgICAgb3V0cHV0Lmluc2VydCgwLCBkYXRhW2VuZDpwcmV2X2JlZ2luXSkKICAgICAgICAgICAgb3V0cHV0Lmluc2VydCgwLCAnKioqKioqKionKQogICAgICAgICAgICBvdXRwdXQuaW5zZXJ0KDAsIGRhdGFbYmVnaW46c2VwICsgMV0pCiAgICAgICAgICAgIHByZXZfYmVnaW4gPSBiZWdpbgoKICAgIG91dHB1dCA9ICcnLmpvaW4ob3V0cHV0KQogICAgaWYgbm9fbG9nX3ZhbHVlczoKICAgICAgICBvdXRwdXQgPSByZW1vdmVfdmFsdWVzKG91dHB1dCwgbm9fbG9nX3ZhbHVlcykKICAgIHJldHVybiBvdXRwdXQKCmRlZiBieXRlc190b19odW1hbihzaXplLCBpc2JpdHM9RmFsc2UsIHVuaXQ9Tm9uZSk6CgogICAgYmFzZSA9ICdCeXRlcycKICAgIGlmIGlzYml0czoKICAgICAgICBiYXNlID0gJ2JpdHMnCiAgICBzdWZmaXggPSAnJwoKICAgIGZvciBzdWZmaXgsIGxpbWl0IGluIHNvcnRlZChpdGVyaXRlbXMoU0laRV9SQU5HRVMpLCBrZXk9bGFtYmRhIGl0ZW06IC1pdGVtWzFdKToKICAgICAgICBpZiAodW5pdCBpcyBOb25lIGFuZCBzaXplID49IGxpbWl0KSBvciB1bml0IGlzIG5vdCBOb25lIGFuZCB1bml0LnVwcGVyKCkgPT0gc3VmZml4WzBdOgogICAgICAgICAgICBicmVhawoKICAgIGlmIGxpbWl0ICE9IDE6CiAgICAgICAgc3VmZml4ICs9IGJhc2VbMF0KICAgIGVsc2U6CiAgICAgICAgc3VmZml4ID0gYmFzZQoKICAgIHJldHVybiAnJS4yZiAlcycgJSAoZmxvYXQoc2l6ZSkvIGxpbWl0LCBzdWZmaXgpCgpkZWYgaHVtYW5fdG9fYnl0ZXMobnVtYmVyLCBkZWZhdWx0X3VuaXQ9Tm9uZSwgaXNiaXRzPUZhbHNlKToKCiAgICAnJycKICAgIENvbnZlcnQgbnVtYmVyIGluIHN0cmluZyBmb3JtYXQgaW50byBieXRlcyAoZXg6ICcySycgPT4gMjA0OCkgb3IgdXNpbmcgdW5pdCBhcmd1bWVudAogICAgZXg6CiAgICAgIGh1bWFuX3RvX2J5dGVzKCcxME0nKSA8PT4gaHVtYW5fdG9fYnl0ZXMoMTAsICdNJykKICAgICcnJwogICAgbSA9IHJlLnNlYXJjaCgnXlxzKihcZCpcLj9cZCopXHMqKFtBLVphLXpdKyk/Jywgc3RyKG51bWJlciksIGZsYWdzPXJlLklHTk9SRUNBU0UpCiAgICBpZiBtIGlzIE5vbmU6CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiaHVtYW5fdG9fYnl0ZXMoKSBjYW4ndCBpbnRlcnByZXQgZm9sbG93aW5nIHN0cmluZzogJXMiICUgc3RyKG51bWJlcikpCiAgICB0cnk6CiAgICAgICAgbnVtID0gZmxvYXQobS5ncm91cCgxKSkKICAgIGV4Y2VwdDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJodW1hbl90b19ieXRlcygpIGNhbid0IGludGVycHJldCBmb2xsb3dpbmcgbnVtYmVyOiAlcyAob3JpZ2luYWwgaW5wdXQgc3RyaW5nOiAlcykiICUgKG0uZ3JvdXAoMSksIG51bWJlcikpCgogICAgdW5pdCA9IG0uZ3JvdXAoMikKICAgIGlmIHVuaXQgaXMgTm9uZToKICAgICAgICB1bml0ID0gZGVmYXVsdF91bml0CgogICAgaWYgdW5pdCBpcyBOb25lOgogICAgICAgICcnJyBObyB1bml0IGdpdmVuLCByZXR1cm5pbmcgcmF3IG51bWJlciAnJycKICAgICAgICByZXR1cm4gaW50KHJvdW5kKG51bSkpCiAgICByYW5nZV9rZXkgPSB1bml0WzBdLnVwcGVyKCkKICAgIHRyeToKICAgICAgICBsaW1pdCA9IFNJWkVfUkFOR0VTW3JhbmdlX2tleV0KICAgIGV4Y2VwdDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJodW1hbl90b19ieXRlcygpIGZhaWxlZCB0byBjb252ZXJ0ICVzICh1bml0ID0gJXMpLiBUaGUgc3VmZml4IG11c3QgYmUgb25lIG9mICVzIiAlIChudW1iZXIsIHVuaXQsICIsICIuam9pbihTSVpFX1JBTkdFUy5rZXlzKCkpKSkKCiAgICAjIGRlZmF1bHQgdmFsdWUKICAgIHVuaXRfY2xhc3MgPSAnQicKICAgIHVuaXRfY2xhc3NfbmFtZSA9ICdieXRlJwogICAgIyBoYW5kbGluZyBiaXRzIGNhc2UKICAgIGlmIGlzYml0czoKICAgICAgICB1bml0X2NsYXNzID0gJ2InCiAgICAgICAgdW5pdF9jbGFzc19uYW1lID0gJ2JpdCcKICAgICMgY2hlY2sgdW5pdCB2YWx1ZSBpZiBtb3JlIHRoYW4gb25lIGNoYXJhY3RlciAoS0IsIE1CKQogICAgaWYgbGVuKHVuaXQpID4gMToKICAgICAgICBleHBlY3RfbWVzc2FnZSA9ICdleHBlY3QgJXMlcyBvciAlcycgJSAocmFuZ2Vfa2V5LCB1bml0X2NsYXNzLCByYW5nZV9rZXkpCiAgICAgICAgaWYgcmFuZ2Vfa2V5ID09ICdCJzoKICAgICAgICAgICAgZXhwZWN0X21lc3NhZ2UgPSAnZXhwZWN0ICVzIG9yICVzJyAlICh1bml0X2NsYXNzLCB1bml0X2NsYXNzX25hbWUpCgogICAgICAgIGlmIHVuaXRfY2xhc3NfbmFtZSBpbiB1bml0Lmxvd2VyKCk6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbGlmIHVuaXRbMV0gIT0gdW5pdF9jbGFzczoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigiaHVtYW5fdG9fYnl0ZXMoKSBmYWlsZWQgdG8gY29udmVydCAlcy4gVmFsdWUgaXMgbm90IGEgdmFsaWQgc3RyaW5nICglcykiICUgKG51bWJlciwgZXhwZWN0X21lc3NhZ2UpKQoKICAgIHJldHVybiBpbnQocm91bmQobnVtICogbGltaXQpKQoKZGVmIGlzX2V4ZWN1dGFibGUocGF0aCk6CiAgICAnJydpcyB0aGUgZ2l2ZW4gcGF0aCBleGVjdXRhYmxlPwoKICAgIExpbWl0YXRpb25zOgogICAgKiBEb2VzIG5vdCBhY2NvdW50IGZvciBGU0FDTHMuCiAgICAqIE1vc3QgdGltZXMgd2UgcmVhbGx5IHdhbnQgdG8ga25vdyAiQ2FuIHRoZSBjdXJyZW50IHVzZXIgZXhlY3V0ZSB0aGlzCiAgICAgIGZpbGUiICBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IHRlbGwgdXMgdGhhdCwgb25seSBpZiBhbiBleGVjdXRlIGJpdCBpcyBzZXQuCiAgICAnJycKICAgICMgVGhlc2UgYXJlIGFsbCBiaXRmaWVsZHMgc28gZmlyc3QgYml0d2lzZS1vciBhbGwgdGhlIHBlcm1pc3Npb25zIHdlJ3JlCiAgICAjIGxvb2tpbmcgZm9yLCB0aGVuIGJpdHdpc2UtYW5kIHdpdGggdGhlIGZpbGUncyBtb2RlIHRvIGRldGVybWluZSBpZiBhbnkKICAgICMgZXhlY3V0ZSBiaXRzIGFyZSBzZXQuCiAgICByZXR1cm4gKChzdGF0LlNfSVhVU1IgfCBzdGF0LlNfSVhHUlAgfCBzdGF0LlNfSVhPVEgpICYgb3Muc3RhdChwYXRoKVtzdGF0LlNUX01PREVdKQoKZGVmIF9sb2FkX3BhcmFtcygpOgogICAgJycnIHJlYWQgdGhlIG1vZHVsZXMgcGFyYW1ldGVycyBhbmQgc3RvcmUgdGhlbSBnbG9iYWxseS4KCiAgICBUaGlzIGZ1bmN0aW9uIG1heSBiZSBuZWVkZWQgZm9yIGNlcnRhaW4gdmVyeSBkeW5hbWljIGN1c3RvbSBtb2R1bGVzIHdoaWNoCiAgICB3YW50IHRvIHByb2Nlc3MgdGhlIHBhcmFtZXRlcnMgdGhhdCBhcmUgYmVpbmcgaGFuZGVkIHRoZSBtb2R1bGUuICBTaW5jZQogICAgdGhpcyBpcyBzbyBjbG9zZWx5IHRpZWQgdG8gdGhlIGltcGxlbWVudGF0aW9uIG9mIG1vZHVsZXMgd2UgY2Fubm90CiAgICBndWFyYW50ZWUgQVBJIHN0YWJpbGl0eSBmb3IgaXQgKGl0IG1heSBjaGFuZ2UgYmV0d2VlbiB2ZXJzaW9ucykgaG93ZXZlciB3ZQogICAgd2lsbCB0cnkgbm90IHRvIGJyZWFrIGl0IGdyYXR1aXRvdXNseS4gIEl0IGlzIGNlcnRhaW5seSBtb3JlIGZ1dHVyZS1wcm9vZgogICAgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIGFuZCBjb25zdW1lIGl0cyBvdXRwdXRzIHRoYW4gdG8gaW1wbGVtZW50IHRoZSBsb2dpYwogICAgaW5zaWRlIGl0IGFzIGEgY29weSBpbiB5b3VyIG93biBjb2RlLgogICAgJycnCiAgICBnbG9iYWwgX0FOU0lCTEVfQVJHUwogICAgaWYgX0FOU0lCTEVfQVJHUyBpcyBub3QgTm9uZToKICAgICAgICBidWZmZXIgPSBfQU5TSUJMRV9BUkdTCiAgICBlbHNlOgogICAgICAgICMgZGVidWcgb3ZlcnJpZGVzIHRvIHJlYWQgYXJncyBmcm9tIGZpbGUgb3IgY21kbGluZQoKICAgICAgICAjIEF2b2lkIHRyYWNlYmFja3Mgd2hlbiBsb2NhbGUgaXMgbm9uLXV0ZjgKICAgICAgICAjIFdlIGNvbnRyb2wgdGhlIGFyZ3MgYW5kIHdlIHBhc3MgdGhlbSBhcyB1dGY4CiAgICAgICAgaWYgbGVuKHN5cy5hcmd2KSA+IDE6CiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKHN5cy5hcmd2WzFdKToKICAgICAgICAgICAgICAgIGZkID0gb3BlbihzeXMuYXJndlsxXSwgJ3JiJykKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IGZkLnJlYWQoKQogICAgICAgICAgICAgICAgZmQuY2xvc2UoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYnVmZmVyID0gc3lzLmFyZ3ZbMV0KICAgICAgICAgICAgICAgIGlmIFBZMzoKICAgICAgICAgICAgICAgICAgICBidWZmZXIgPSBidWZmZXIuZW5jb2RlKCd1dGYtOCcsIGVycm9ycz0nc3Vycm9nYXRlZXNjYXBlJykKICAgICAgICAjIGRlZmF1bHQgY2FzZSwgcmVhZCBmcm9tIHN0ZGluCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgUFkyOgogICAgICAgICAgICAgICAgYnVmZmVyID0gc3lzLnN0ZGluLnJlYWQoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYnVmZmVyID0gc3lzLnN0ZGluLmJ1ZmZlci5yZWFkKCkKICAgICAgICBfQU5TSUJMRV9BUkdTID0gYnVmZmVyCgogICAgdHJ5OgogICAgICAgIHBhcmFtcyA9IGpzb24ubG9hZHMoYnVmZmVyLmRlY29kZSgndXRmLTgnKSkKICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICMgVGhpcyBoZWxwZXIgdXNlZCB0b28gZWFybHkgZm9yIGZhaWxfanNvbiB0byB3b3JrLgogICAgICAgIHByaW50KCdcbnsibXNnIjogIkVycm9yOiBNb2R1bGUgdW5hYmxlIHRvIGRlY29kZSB2YWxpZCBKU09OIG9uIHN0ZGluLiAgVW5hYmxlIHRvIGZpZ3VyZSBvdXQgd2hhdCBwYXJhbWV0ZXJzIHdlcmUgcGFzc2VkIiwgImZhaWxlZCI6IHRydWV9JykKICAgICAgICBzeXMuZXhpdCgxKQoKICAgIGlmIFBZMjoKICAgICAgICBwYXJhbXMgPSBqc29uX2RpY3RfdW5pY29kZV90b19ieXRlcyhwYXJhbXMpCgogICAgdHJ5OgogICAgICAgIHJldHVybiBwYXJhbXNbJ0FOU0lCTEVfTU9EVUxFX0FSR1MnXQogICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICMgVGhpcyBoZWxwZXIgZG9lcyBub3QgaGF2ZSBhY2Nlc3MgdG8gZmFpbF9qc29uIHNvIHdlIGhhdmUgdG8gcHJpbnQKICAgICAgICAjIGpzb24gb3V0cHV0IG9uIG91ciBvd24uCiAgICAgICAgcHJpbnQoJ1xueyJtc2ciOiAiRXJyb3I6IE1vZHVsZSB1bmFibGUgdG8gbG9jYXRlIEFOU0lCTEVfTU9EVUxFX0FSR1MgaW4ganNvbiBkYXRhIGZyb20gc3RkaW4uICBVbmFibGUgdG8gZmlndXJlIG91dCB3aGF0IHBhcmFtZXRlcnMgd2VyZSBwYXNzZWQiLCAnCiAgICAgICAgICAgICAgJyJmYWlsZWQiOiB0cnVlfScpCiAgICAgICAgc3lzLmV4aXQoMSkKCmRlZiBlbnZfZmFsbGJhY2soKmFyZ3MsICoqa3dhcmdzKToKICAgICcnJyBMb2FkIHZhbHVlIGZyb20gZW52aXJvbm1lbnQgJycnCiAgICBmb3IgYXJnIGluIGFyZ3M6CiAgICAgICAgaWYgYXJnIGluIG9zLmVudmlyb246CiAgICAgICAgICAgIHJldHVybiBvcy5lbnZpcm9uW2FyZ10KICAgIGVsc2U6CiAgICAgICAgcmFpc2UgQW5zaWJsZUZhbGxiYWNrTm90Rm91bmQKCmRlZiBfbGVuaWVudF9sb3dlcmNhc2UobHN0KToKICAgICIiIkxvd2VyY2FzZSBlbGVtZW50cyBvZiBhIGxpc3QuCgogICAgSWYgYW4gZWxlbWVudCBpcyBub3QgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCB1bnRvdWNoZWQuCiAgICAiIiIKICAgIGxvd2VyZWQgPSBbXQogICAgZm9yIHZhbHVlIGluIGxzdDoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvd2VyZWQuYXBwZW5kKHZhbHVlLmxvd2VyKCkpCiAgICAgICAgZXhjZXB0IEF0dHJpYnV0ZUVycm9yOgogICAgICAgICAgICBsb3dlcmVkLmFwcGVuZCh2YWx1ZSkKICAgIHJldHVybiBsb3dlcmVkCgpkZWYgZm9ybWF0X2F0dHJpYnV0ZXMoYXR0cmlidXRlcyk6CiAgICBhdHRyaWJ1dGVfbGlzdCA9IFtdCiAgICBmb3IgYXR0ciBpbiBhdHRyaWJ1dGVzOgogICAgICAgIGlmIGF0dHIgaW4gRklMRV9BVFRSSUJVVEVTOgogICAgICAgICAgICBhdHRyaWJ1dGVfbGlzdC5hcHBlbmQoRklMRV9BVFRSSUJVVEVTW2F0dHJdKQogICAgcmV0dXJuIGF0dHJpYnV0ZV9saXN0CgpkZWYgZ2V0X2ZsYWdzX2Zyb21fYXR0cmlidXRlcyhhdHRyaWJ1dGVzKToKICAgIGZsYWdzID0gW10KICAgIGZvciBrZXksYXR0ciBpbiBGSUxFX0FUVFJJQlVURVMuaXRlbXMoKToKICAgICAgICBpZiBhdHRyIGluIGF0dHJpYnV0ZXM6CiAgICAgICAgICAgIGZsYWdzLmFwcGVuZChrZXkpCiAgICByZXR1cm4gJycuam9pbihmbGFncykKCmNsYXNzIEFuc2libGVGYWxsYmFja05vdEZvdW5kKEV4Y2VwdGlvbik6CiAgICBwYXNzCgoKY2xhc3MgQW5zaWJsZU1vZHVsZShvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFyZ3VtZW50X3NwZWMsIGJ5cGFzc19jaGVja3M9RmFsc2UsIG5vX2xvZz1GYWxzZSwKICAgICAgICAgICAgICAgICBjaGVja19pbnZhbGlkX2FyZ3VtZW50cz1UcnVlLCBtdXR1YWxseV9leGNsdXNpdmU9Tm9uZSwgcmVxdWlyZWRfdG9nZXRoZXI9Tm9uZSwKICAgICAgICAgICAgICAgICByZXF1aXJlZF9vbmVfb2Y9Tm9uZSwgYWRkX2ZpbGVfY29tbW9uX2FyZ3M9RmFsc2UsIHN1cHBvcnRzX2NoZWNrX21vZGU9RmFsc2UsCiAgICAgICAgICAgICAgICAgcmVxdWlyZWRfaWY9Tm9uZSk6CgogICAgICAgICcnJwogICAgICAgIGNvbW1vbiBjb2RlIGZvciBxdWlja2x5IGJ1aWxkaW5nIGFuIGFuc2libGUgbW9kdWxlIGluIFB5dGhvbgogICAgICAgIChhbHRob3VnaCB5b3UgY2FuIHdyaXRlIG1vZHVsZXMgaW4gYW55dGhpbmcgdGhhdCBjYW4gcmV0dXJuIEpTT04pCiAgICAgICAgc2VlIGxpYnJhcnkvKiBmb3IgZXhhbXBsZXMKICAgICAgICAnJycKCiAgICAgICAgc2VsZi5fbmFtZSA9IG9zLnBhdGguYmFzZW5hbWUoX19maWxlX18pICNpbml0aWFsaXplIG5hbWUgdW50aWwgd2UgY2FuIHBhcnNlIGZyb20gb3B0aW9ucwogICAgICAgIHNlbGYuYXJndW1lbnRfc3BlYyA9IGFyZ3VtZW50X3NwZWMKICAgICAgICBzZWxmLnN1cHBvcnRzX2NoZWNrX21vZGUgPSBzdXBwb3J0c19jaGVja19tb2RlCiAgICAgICAgc2VsZi5jaGVja19tb2RlID0gRmFsc2UKICAgICAgICBzZWxmLm5vX2xvZyA9IG5vX2xvZwogICAgICAgIHNlbGYuY2xlYW51cF9maWxlcyA9IFtdCiAgICAgICAgc2VsZi5fZGVidWcgPSBGYWxzZQogICAgICAgIHNlbGYuX2RpZmYgPSBGYWxzZQogICAgICAgIHNlbGYuX3NvY2tldF9wYXRoID0gTm9uZQogICAgICAgIHNlbGYuX3ZlcmJvc2l0eSA9IDAKICAgICAgICAjIE1heSBiZSB1c2VkIHRvIHNldCBtb2RpZmljYXRpb25zIHRvIHRoZSBlbnZpcm9ubWVudCBmb3IgYW55CiAgICAgICAgIyBydW5fY29tbWFuZCBpbnZvY2F0aW9uCiAgICAgICAgc2VsZi5ydW5fY29tbWFuZF9lbnZpcm9uX3VwZGF0ZSA9IHt9CiAgICAgICAgc2VsZi5fd2FybmluZ3MgPSBbXQogICAgICAgIHNlbGYuX2RlcHJlY2F0aW9ucyA9IFtdCgogICAgICAgIHNlbGYuYWxpYXNlcyA9IHt9CiAgICAgICAgc2VsZi5fbGVnYWxfaW5wdXRzID0gWydfYW5zaWJsZV9jaGVja19tb2RlJywgJ19hbnNpYmxlX25vX2xvZycsICdfYW5zaWJsZV9kZWJ1ZycsICdfYW5zaWJsZV9kaWZmJywgJ19hbnNpYmxlX3ZlcmJvc2l0eScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdfYW5zaWJsZV9zZWxpbnV4X3NwZWNpYWxfZnMnLCAnX2Fuc2libGVfbW9kdWxlX25hbWUnLCAnX2Fuc2libGVfdmVyc2lvbicsICdfYW5zaWJsZV9zeXNsb2dfZmFjaWxpdHknLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnX2Fuc2libGVfc29ja2V0J10KCiAgICAgICAgaWYgYWRkX2ZpbGVfY29tbW9uX2FyZ3M6CiAgICAgICAgICAgIGZvciBrLCB2IGluIEZJTEVfQ09NTU9OX0FSR1VNRU5UUy5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYgayBub3QgaW4gc2VsZi5hcmd1bWVudF9zcGVjOgogICAgICAgICAgICAgICAgICAgIHNlbGYuYXJndW1lbnRfc3BlY1trXSA9IHYKCiAgICAgICAgc2VsZi5fbG9hZF9wYXJhbXMoKQogICAgICAgIHNlbGYuX3NldF9mYWxsYmFja3MoKQoKICAgICAgICAjIGFwcGVuZCB0byBsZWdhbF9pbnB1dHMgYW5kIHRoZW4gcG9zc2libHkgY2hlY2sgYWdhaW5zdCB0aGVtCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmFsaWFzZXMgPSBzZWxmLl9oYW5kbGVfYWxpYXNlcygpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAjIFVzZSBleGNlcHRpb25zIGhlcmUgYmVjYXVzZSBpdCBpc24ndCBzYWZlIHRvIGNhbGwgZmFpbF9qc29uIHVudGlsIG5vX2xvZyBpcyBwcm9jZXNzZWQKICAgICAgICAgICAgcHJpbnQoJ1xueyJmYWlsZWQiOiB0cnVlLCAibXNnIjogIk1vZHVsZSBhbGlhcyBlcnJvcjogJXMifScgJSBzdHIoZSkpCiAgICAgICAgICAgIHN5cy5leGl0KDEpCgogICAgICAgICMgU2F2ZSBwYXJhbWV0ZXIgdmFsdWVzIHRoYXQgc2hvdWxkIG5ldmVyIGJlIGxvZ2dlZAogICAgICAgIHNlbGYubm9fbG9nX3ZhbHVlcyA9IHNldCgpCiAgICAgICAgIyBVc2UgdGhlIGFyZ3NwZWMgdG8gZGV0ZXJtaW5lIHdoaWNoIGFyZ3MgYXJlIG5vX2xvZwogICAgICAgIGZvciBhcmdfbmFtZSwgYXJnX29wdHMgaW4gc2VsZi5hcmd1bWVudF9zcGVjLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIGFyZ19vcHRzLmdldCgnbm9fbG9nJywgRmFsc2UpOgogICAgICAgICAgICAgICAgIyBGaW5kIHRoZSB2YWx1ZSBmb3IgdGhlIG5vX2xvZydkIHBhcmFtCiAgICAgICAgICAgICAgICBub19sb2dfb2JqZWN0ID0gc2VsZi5wYXJhbXMuZ2V0KGFyZ19uYW1lLCBOb25lKQogICAgICAgICAgICAgICAgaWYgbm9fbG9nX29iamVjdDoKICAgICAgICAgICAgICAgICAgICBzZWxmLm5vX2xvZ192YWx1ZXMudXBkYXRlKHJldHVybl92YWx1ZXMobm9fbG9nX29iamVjdCkpCgogICAgICAgICAgICBpZiBhcmdfb3B0cy5nZXQoJ3JlbW92ZWRfaW5fdmVyc2lvbicpIGlzIG5vdCBOb25lIGFuZCBhcmdfbmFtZSBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgICAgIHNlbGYuX2RlcHJlY2F0aW9ucy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICdtc2cnOiAiUGFyYW0gJyVzJyBpcyBkZXByZWNhdGVkLiBTZWUgdGhlIG1vZHVsZSBkb2NzIGZvciBtb3JlIGluZm9ybWF0aW9uIiAlIGFyZ19uYW1lLAogICAgICAgICAgICAgICAgICAgICd2ZXJzaW9uJzogYXJnX29wdHMuZ2V0KCdyZW1vdmVkX2luX3ZlcnNpb24nKQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgIyBjaGVjayB0aGUgbG9jYWxlIGFzIHNldCBieSB0aGUgY3VycmVudCBlbnZpcm9ubWVudCwgYW5kIHJlc2V0IHRvCiAgICAgICAgIyBhIGtub3duIHZhbGlkIChMQU5HPUMpIGlmIGl0J3MgYW4gaW52YWxpZC91bmF2YWlsYWJsZSBsb2NhbGUKICAgICAgICBzZWxmLl9jaGVja19sb2NhbGUoKQoKICAgICAgICBzZWxmLl9jaGVja19hcmd1bWVudHMoY2hlY2tfaW52YWxpZF9hcmd1bWVudHMpCgogICAgICAgICMgY2hlY2sgZXhjbHVzaXZlIGVhcmx5CiAgICAgICAgaWYgbm90IGJ5cGFzc19jaGVja3M6CiAgICAgICAgICAgIHNlbGYuX2NoZWNrX211dHVhbGx5X2V4Y2x1c2l2ZShtdXR1YWxseV9leGNsdXNpdmUpCgogICAgICAgIHNlbGYuX3NldF9kZWZhdWx0cyhwcmU9VHJ1ZSkKCiAgICAgICAgc2VsZi5fQ0hFQ0tfQVJHVU1FTlRfVFlQRVNfRElTUEFUQ0hFUiA9IHsKICAgICAgICAgICAgJ3N0cic6IHNlbGYuX2NoZWNrX3R5cGVfc3RyLAogICAgICAgICAgICAnbGlzdCc6IHNlbGYuX2NoZWNrX3R5cGVfbGlzdCwKICAgICAgICAgICAgJ2RpY3QnOiBzZWxmLl9jaGVja190eXBlX2RpY3QsCiAgICAgICAgICAgICdib29sJzogc2VsZi5fY2hlY2tfdHlwZV9ib29sLAogICAgICAgICAgICAnaW50Jzogc2VsZi5fY2hlY2tfdHlwZV9pbnQsCiAgICAgICAgICAgICdmbG9hdCc6IHNlbGYuX2NoZWNrX3R5cGVfZmxvYXQsCiAgICAgICAgICAgICdwYXRoJzogc2VsZi5fY2hlY2tfdHlwZV9wYXRoLAogICAgICAgICAgICAncmF3Jzogc2VsZi5fY2hlY2tfdHlwZV9yYXcsCiAgICAgICAgICAgICdqc29uYXJnJzogc2VsZi5fY2hlY2tfdHlwZV9qc29uYXJnLAogICAgICAgICAgICAnanNvbic6IHNlbGYuX2NoZWNrX3R5cGVfanNvbmFyZywKICAgICAgICAgICAgJ2J5dGVzJzogc2VsZi5fY2hlY2tfdHlwZV9ieXRlcywKICAgICAgICAgICAgJ2JpdHMnOiBzZWxmLl9jaGVja190eXBlX2JpdHMsCiAgICAgICAgfQogICAgICAgIGlmIG5vdCBieXBhc3NfY2hlY2tzOgogICAgICAgICAgICBzZWxmLl9jaGVja19yZXF1aXJlZF9hcmd1bWVudHMoKQogICAgICAgICAgICBzZWxmLl9jaGVja19hcmd1bWVudF90eXBlcygpCiAgICAgICAgICAgIHNlbGYuX2NoZWNrX2FyZ3VtZW50X3ZhbHVlcygpCiAgICAgICAgICAgIHNlbGYuX2NoZWNrX3JlcXVpcmVkX3RvZ2V0aGVyKHJlcXVpcmVkX3RvZ2V0aGVyKQogICAgICAgICAgICBzZWxmLl9jaGVja19yZXF1aXJlZF9vbmVfb2YocmVxdWlyZWRfb25lX29mKQogICAgICAgICAgICBzZWxmLl9jaGVja19yZXF1aXJlZF9pZihyZXF1aXJlZF9pZikKCiAgICAgICAgc2VsZi5fc2V0X2RlZmF1bHRzKHByZT1GYWxzZSkKCiAgICAgICAgaWYgbm90IHNlbGYubm9fbG9nOgogICAgICAgICAgICBzZWxmLl9sb2dfaW52b2NhdGlvbigpCgogICAgICAgICMgZmluYWxseSwgbWFrZSBzdXJlIHdlJ3JlIGluIGEgc2FuZSB3b3JraW5nIGRpcgogICAgICAgIHNlbGYuX3NldF9jd2QoKQoKICAgIGRlZiB3YXJuKHNlbGYsIHdhcm5pbmcpOgoKICAgICAgICBpZiBpc2luc3RhbmNlKHdhcm5pbmcsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIHNlbGYuX3dhcm5pbmdzLmFwcGVuZCh3YXJuaW5nKQogICAgICAgICAgICBzZWxmLmxvZygnW1dBUk5JTkddICVzJyAlIHdhcm5pbmcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJ3YXJuIHJlcXVpcmVzIGEgc3RyaW5nIG5vdCBhICVzIiAlIHR5cGUod2FybmluZykpCgogICAgZGVmIGRlcHJlY2F0ZShzZWxmLCBtc2csIHZlcnNpb249Tm9uZSk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShtc2csIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIHNlbGYuX2RlcHJlY2F0aW9ucy5hcHBlbmQoewogICAgICAgICAgICAgICAgJ21zZyc6IG1zZywKICAgICAgICAgICAgICAgICd2ZXJzaW9uJzogdmVyc2lvbgogICAgICAgICAgICB9KQogICAgICAgICAgICBzZWxmLmxvZygnW0RFUFJFQ0FUSU9OIFdBUk5JTkddICVzICVzJyAlIChtc2csIHZlcnNpb24pKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiZGVwcmVjYXRlIHJlcXVpcmVzIGEgc3RyaW5nIG5vdCBhICVzIiAlIHR5cGUobXNnKSkKCiAgICBkZWYgbG9hZF9maWxlX2NvbW1vbl9hcmd1bWVudHMoc2VsZiwgcGFyYW1zKToKICAgICAgICAnJycKICAgICAgICBtYW55IG1vZHVsZXMgZGVhbCB3aXRoIGZpbGVzLCB0aGlzIGVuY2Fwc3VsYXRlcyBjb21tb24KICAgICAgICBvcHRpb25zIHRoYXQgdGhlIGZpbGUgbW9kdWxlIGFjY2VwdHMgc3VjaCB0aGF0IGl0IGlzIGRpcmVjdGx5CiAgICAgICAgYXZhaWxhYmxlIHRvIGFsbCBtb2R1bGVzIGFuZCB0aGV5IGNhbiBzaGFyZSBjb2RlLgogICAgICAgICcnJwoKICAgICAgICBwYXRoID0gcGFyYW1zLmdldCgncGF0aCcsIHBhcmFtcy5nZXQoJ2Rlc3QnLCBOb25lKSkKICAgICAgICBpZiBwYXRoIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiB7fQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHBhdGggPSBvcy5wYXRoLmV4cGFuZHVzZXIob3MucGF0aC5leHBhbmR2YXJzKHBhdGgpKQoKICAgICAgICBiX3BhdGggPSB0b19ieXRlcyhwYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgICMgaWYgdGhlIHBhdGggaXMgYSBzeW1saW5rLCBhbmQgd2UncmUgZm9sbG93aW5nIGxpbmtzLCBnZXQKICAgICAgICAjIHRoZSB0YXJnZXQgb2YgdGhlIGxpbmsgaW5zdGVhZCBmb3IgdGVzdGluZwogICAgICAgIGlmIHBhcmFtcy5nZXQoJ2ZvbGxvdycsIEZhbHNlKSBhbmQgb3MucGF0aC5pc2xpbmsoYl9wYXRoKToKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5yZWFscGF0aChiX3BhdGgpCiAgICAgICAgICAgIHBhdGggPSB0b19uYXRpdmUoYl9wYXRoKQoKICAgICAgICBtb2RlICAgPSBwYXJhbXMuZ2V0KCdtb2RlJywgTm9uZSkKICAgICAgICBvd25lciAgPSBwYXJhbXMuZ2V0KCdvd25lcicsIE5vbmUpCiAgICAgICAgZ3JvdXAgID0gcGFyYW1zLmdldCgnZ3JvdXAnLCBOb25lKQoKICAgICAgICAjIHNlbGludXggcmVsYXRlZCBvcHRpb25zCiAgICAgICAgc2V1c2VyICAgID0gcGFyYW1zLmdldCgnc2V1c2VyJywgTm9uZSkKICAgICAgICBzZXJvbGUgICAgPSBwYXJhbXMuZ2V0KCdzZXJvbGUnLCBOb25lKQogICAgICAgIHNldHlwZSAgICA9IHBhcmFtcy5nZXQoJ3NldHlwZScsIE5vbmUpCiAgICAgICAgc2VsZXZlbCAgID0gcGFyYW1zLmdldCgnc2VsZXZlbCcsIE5vbmUpCiAgICAgICAgc2Vjb250ZXh0ID0gW3NldXNlciwgc2Vyb2xlLCBzZXR5cGVdCgogICAgICAgIGlmIHNlbGYuc2VsaW51eF9tbHNfZW5hYmxlZCgpOgogICAgICAgICAgICBzZWNvbnRleHQuYXBwZW5kKHNlbGV2ZWwpCgogICAgICAgIGRlZmF1bHRfc2Vjb250ZXh0ID0gc2VsZi5zZWxpbnV4X2RlZmF1bHRfY29udGV4dChwYXRoKQogICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihkZWZhdWx0X3NlY29udGV4dCkpOgogICAgICAgICAgICBpZiBpIGlzIG5vdCBOb25lIGFuZCBzZWNvbnRleHRbaV0gPT0gJ19kZWZhdWx0JzoKICAgICAgICAgICAgICAgIHNlY29udGV4dFtpXSA9IGRlZmF1bHRfc2Vjb250ZXh0W2ldCgogICAgICAgIGF0dHJpYnV0ZXMgPSBwYXJhbXMuZ2V0KCdhdHRyaWJ1dGVzJywgTm9uZSkKICAgICAgICByZXR1cm4gZGljdCgKICAgICAgICAgICAgcGF0aD1wYXRoLCBtb2RlPW1vZGUsIG93bmVyPW93bmVyLCBncm91cD1ncm91cCwKICAgICAgICAgICAgc2V1c2VyPXNldXNlciwgc2Vyb2xlPXNlcm9sZSwgc2V0eXBlPXNldHlwZSwKICAgICAgICAgICAgc2VsZXZlbD1zZWxldmVsLCBzZWNvbnRleHQ9c2Vjb250ZXh0LCBhdHRyaWJ1dGVzPWF0dHJpYnV0ZXMsCiAgICAgICAgKQoKCiAgICAjIERldGVjdCB3aGV0aGVyIHVzaW5nIHNlbGludXggdGhhdCBpcyBNTFMtYXdhcmUuCiAgICAjIFdoaWxlIHRoaXMgbWVhbnMgeW91IGNhbiBzZXQgdGhlIGxldmVsL3JhbmdlIHdpdGgKICAgICMgc2VsaW51eC5sc2V0ZmlsZWNvbigpLCBpdCBtYXkgb3IgbWF5IG5vdCBtZWFuIHRoYXQgeW91CiAgICAjIHdpbGwgZ2V0IHRoZSBzZWxldmVsIGFzIHBhcnQgb2YgdGhlIGNvbnRleHQgcmV0dXJuZWQKICAgICMgYnkgc2VsaW51eC5sZ2V0ZmlsZWNvbigpLgoKICAgIGRlZiBzZWxpbnV4X21sc19lbmFibGVkKHNlbGYpOgogICAgICAgIGlmIG5vdCBIQVZFX1NFTElOVVg6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGlmIHNlbGludXguaXNfc2VsaW51eF9tbHNfZW5hYmxlZCgpID09IDE6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIHNlbGludXhfZW5hYmxlZChzZWxmKToKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYOgogICAgICAgICAgICBzZWVuYWJsZWQgPSBzZWxmLmdldF9iaW5fcGF0aCgnc2VsaW51eGVuYWJsZWQnKQogICAgICAgICAgICBpZiBzZWVuYWJsZWQgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAocmMsb3V0LGVycikgPSBzZWxmLnJ1bl9jb21tYW5kKHNlZW5hYmxlZCkKICAgICAgICAgICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJBYm9ydGluZywgdGFyZ2V0IHVzZXMgc2VsaW51eCBidXQgcHl0aG9uIGJpbmRpbmdzIChsaWJzZWxpbnV4LXB5dGhvbikgYXJlbid0IGluc3RhbGxlZCEiKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBpZiBzZWxpbnV4LmlzX3NlbGludXhfZW5hYmxlZCgpID09IDE6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgIyBEZXRlcm1pbmUgd2hldGhlciB3ZSBuZWVkIGEgcGxhY2Vob2xkZXIgZm9yIHNlbGV2ZWwvbWxzCiAgICBkZWYgc2VsaW51eF9pbml0aWFsX2NvbnRleHQoc2VsZik6CiAgICAgICAgY29udGV4dCA9IFtOb25lLCBOb25lLCBOb25lXQogICAgICAgIGlmIHNlbGYuc2VsaW51eF9tbHNfZW5hYmxlZCgpOgogICAgICAgICAgICBjb250ZXh0LmFwcGVuZChOb25lKQogICAgICAgIHJldHVybiBjb250ZXh0CgogICAgIyBJZiBzZWxpbnV4IGZhaWxzIHRvIGZpbmQgYSBkZWZhdWx0LCByZXR1cm4gYW4gYXJyYXkgb2YgTm9uZQogICAgZGVmIHNlbGludXhfZGVmYXVsdF9jb250ZXh0KHNlbGYsIHBhdGgsIG1vZGU9MCk6CiAgICAgICAgY29udGV4dCA9IHNlbGYuc2VsaW51eF9pbml0aWFsX2NvbnRleHQoKQogICAgICAgIGlmIG5vdCBIQVZFX1NFTElOVVggb3Igbm90IHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgIHJldHVybiBjb250ZXh0CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXQgPSBzZWxpbnV4Lm1hdGNocGF0aGNvbih0b19uYXRpdmUocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JyksIG1vZGUpCiAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgIHJldHVybiBjb250ZXh0CiAgICAgICAgaWYgcmV0WzBdID09IC0xOgogICAgICAgICAgICByZXR1cm4gY29udGV4dAogICAgICAgICMgTGltaXQgc3BsaXQgdG8gNCBiZWNhdXNlIHRoZSBzZWxldmVsLCB0aGUgbGFzdCBpbiB0aGUgbGlzdCwKICAgICAgICAjIG1heSBjb250YWluICc6JyBjaGFyYWN0ZXJzCiAgICAgICAgY29udGV4dCA9IHJldFsxXS5zcGxpdCgnOicsIDMpCiAgICAgICAgcmV0dXJuIGNvbnRleHQKCiAgICBkZWYgc2VsaW51eF9jb250ZXh0KHNlbGYsIHBhdGgpOgogICAgICAgIGNvbnRleHQgPSBzZWxmLnNlbGludXhfaW5pdGlhbF9jb250ZXh0KCkKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYIG9yIG5vdCBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICByZXR1cm4gY29udGV4dAogICAgICAgIHRyeToKICAgICAgICAgICAgcmV0ID0gc2VsaW51eC5sZ2V0ZmlsZWNvbl9yYXcodG9fbmF0aXZlKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpKQogICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgIGlmIGUuZXJybm8gPT0gZXJybm8uRU5PRU5UOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J3BhdGggJXMgZG9lcyBub3QgZXhpc3QnICUgcGF0aCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdmYWlsZWQgdG8gcmV0cmlldmUgc2VsaW51eCBjb250ZXh0JykKICAgICAgICBpZiByZXRbMF0gPT0gLTE6CiAgICAgICAgICAgIHJldHVybiBjb250ZXh0CiAgICAgICAgIyBMaW1pdCBzcGxpdCB0byA0IGJlY2F1c2UgdGhlIHNlbGV2ZWwsIHRoZSBsYXN0IGluIHRoZSBsaXN0LAogICAgICAgICMgbWF5IGNvbnRhaW4gJzonIGNoYXJhY3RlcnMKICAgICAgICBjb250ZXh0ID0gcmV0WzFdLnNwbGl0KCc6JywgMykKICAgICAgICByZXR1cm4gY29udGV4dAoKICAgIGRlZiB1c2VyX2FuZF9ncm91cChzZWxmLCBwYXRoLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIGV4cGFuZDoKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhiX3BhdGgpKQogICAgICAgIHN0ID0gb3MubHN0YXQoYl9wYXRoKQogICAgICAgIHVpZCA9IHN0LnN0X3VpZAogICAgICAgIGdpZCA9IHN0LnN0X2dpZAogICAgICAgIHJldHVybiAodWlkLCBnaWQpCgogICAgZGVmIGZpbmRfbW91bnRfcG9pbnQoc2VsZiwgcGF0aCk6CiAgICAgICAgcGF0aF9pc19ieXRlcyA9IEZhbHNlCiAgICAgICAgaWYgaXNpbnN0YW5jZShwYXRoLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgICAgIHBhdGhfaXNfYnl0ZXMgPSBUcnVlCgogICAgICAgIGJfcGF0aCA9IG9zLnBhdGgucmVhbHBhdGgodG9fYnl0ZXMob3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhwYXRoKSksIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpKQogICAgICAgIHdoaWxlIG5vdCBvcy5wYXRoLmlzbW91bnQoYl9wYXRoKToKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5kaXJuYW1lKGJfcGF0aCkKCiAgICAgICAgaWYgcGF0aF9pc19ieXRlczoKICAgICAgICAgICAgcmV0dXJuIGJfcGF0aAoKICAgICAgICByZXR1cm4gdG9fdGV4dChiX3BhdGgsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCgogICAgZGVmIGlzX3NwZWNpYWxfc2VsaW51eF9wYXRoKHNlbGYsIHBhdGgpOgogICAgICAgICIiIgogICAgICAgIFJldHVybnMgYSB0dXBsZSBjb250YWluaW5nIChUcnVlLCBzZWxpbnV4X2NvbnRleHQpIGlmIHRoZSBnaXZlbiBwYXRoIGlzIG9uIGEKICAgICAgICBORlMgb3Igb3RoZXIgJ3NwZWNpYWwnIGZzICBtb3VudCBwb2ludCwgb3RoZXJ3aXNlIHRoZSByZXR1cm4gd2lsbCBiZSAoRmFsc2UsIE5vbmUpLgogICAgICAgICIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgZiA9IG9wZW4oJy9wcm9jL21vdW50cycsICdyJykKICAgICAgICAgICAgbW91bnRfZGF0YSA9IGYucmVhZGxpbmVzKCkKICAgICAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gKEZhbHNlLCBOb25lKQogICAgICAgIHBhdGhfbW91bnRfcG9pbnQgPSBzZWxmLmZpbmRfbW91bnRfcG9pbnQocGF0aCkKICAgICAgICBmb3IgbGluZSBpbiBtb3VudF9kYXRhOgogICAgICAgICAgICAoZGV2aWNlLCBtb3VudF9wb2ludCwgZnN0eXBlLCBvcHRpb25zLCByZXN0KSA9IGxpbmUuc3BsaXQoJyAnLCA0KQoKICAgICAgICAgICAgaWYgcGF0aF9tb3VudF9wb2ludCA9PSBtb3VudF9wb2ludDoKICAgICAgICAgICAgICAgIGZvciBmcyBpbiBzZWxmLl9zZWxpbnV4X3NwZWNpYWxfZnM6CiAgICAgICAgICAgICAgICAgICAgaWYgZnMgaW4gZnN0eXBlOgogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWFsX2NvbnRleHQgPSBzZWxmLnNlbGludXhfY29udGV4dChwYXRoX21vdW50X3BvaW50KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFRydWUsIHNwZWNpYWxfY29udGV4dCkKCiAgICAgICAgcmV0dXJuIChGYWxzZSwgTm9uZSkKCiAgICBkZWYgc2V0X2RlZmF1bHRfc2VsaW51eF9jb250ZXh0KHNlbGYsIHBhdGgsIGNoYW5nZWQpOgogICAgICAgIGlmIG5vdCBIQVZFX1NFTElOVVggb3Igbm90IHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkCiAgICAgICAgY29udGV4dCA9IHNlbGYuc2VsaW51eF9kZWZhdWx0X2NvbnRleHQocGF0aCkKICAgICAgICByZXR1cm4gc2VsZi5zZXRfY29udGV4dF9pZl9kaWZmZXJlbnQocGF0aCwgY29udGV4dCwgRmFsc2UpCgogICAgZGVmIHNldF9jb250ZXh0X2lmX2RpZmZlcmVudChzZWxmLCBwYXRoLCBjb250ZXh0LCBjaGFuZ2VkLCBkaWZmPU5vbmUpOgoKICAgICAgICBpZiBub3QgSEFWRV9TRUxJTlVYIG9yIG5vdCBzZWxmLnNlbGludXhfZW5hYmxlZCgpOgogICAgICAgICAgICByZXR1cm4gY2hhbmdlZAogICAgICAgIGN1cl9jb250ZXh0ID0gc2VsZi5zZWxpbnV4X2NvbnRleHQocGF0aCkKICAgICAgICBuZXdfY29udGV4dCA9IGxpc3QoY3VyX2NvbnRleHQpCiAgICAgICAgIyBJdGVyYXRlIG92ZXIgdGhlIGN1cnJlbnQgY29udGV4dCBpbnN0ZWFkIG9mIHRoZQogICAgICAgICMgYXJndW1lbnQgY29udGV4dCwgd2hpY2ggbWF5IGhhdmUgc2VsZXZlbC4KCiAgICAgICAgKGlzX3NwZWNpYWxfc2UsIHNwX2NvbnRleHQpID0gc2VsZi5pc19zcGVjaWFsX3NlbGludXhfcGF0aChwYXRoKQogICAgICAgIGlmIGlzX3NwZWNpYWxfc2U6CiAgICAgICAgICAgIG5ld19jb250ZXh0ID0gc3BfY29udGV4dAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihjdXJfY29udGV4dCkpOgogICAgICAgICAgICAgICAgaWYgbGVuKGNvbnRleHQpID4gaToKICAgICAgICAgICAgICAgICAgICBpZiBjb250ZXh0W2ldIGlzIG5vdCBOb25lIGFuZCBjb250ZXh0W2ldICE9IGN1cl9jb250ZXh0W2ldOgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfY29udGV4dFtpXSA9IGNvbnRleHRbaV0KICAgICAgICAgICAgICAgICAgICBlbGlmIGNvbnRleHRbaV0gaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2NvbnRleHRbaV0gPSBjdXJfY29udGV4dFtpXQoKICAgICAgICBpZiBjdXJfY29udGV4dCAhPSBuZXdfY29udGV4dDoKICAgICAgICAgICAgaWYgZGlmZiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmICdiZWZvcmUnIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddWydzZWNvbnRleHQnXSA9IGN1cl9jb250ZXh0CiAgICAgICAgICAgICAgICBpZiAnYWZ0ZXInIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ10gPSB7fQogICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXVsnc2Vjb250ZXh0J10gPSBuZXdfY29udGV4dAoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgc2VsZi5jaGVja19tb2RlOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICByYyA9IHNlbGludXgubHNldGZpbGVjb24odG9fbmF0aXZlKHBhdGgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cignOicuam9pbihuZXdfY29udGV4dCkpKQogICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdpbnZhbGlkIHNlbGludXggY29udGV4dDogJXMnICUgc3RyKGUpLCBuZXdfY29udGV4dD1uZXdfY29udGV4dCwgY3VyX2NvbnRleHQ9Y3VyX2NvbnRleHQsIGlucHV0X3dhcz1jb250ZXh0KQogICAgICAgICAgICBpZiByYyAhPSAwOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J3NldCBzZWxpbnV4IGNvbnRleHQgZmFpbGVkJykKICAgICAgICAgICAgY2hhbmdlZCA9IFRydWUKICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgIGRlZiBzZXRfb3duZXJfaWZfZGlmZmVyZW50KHNlbGYsIHBhdGgsIG93bmVyLCBjaGFuZ2VkLCBkaWZmPU5vbmUsIGV4cGFuZD1UcnVlKToKICAgICAgICBiX3BhdGggPSB0b19ieXRlcyhwYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCiAgICAgICAgaWYgZXhwYW5kOgogICAgICAgICAgICBiX3BhdGggPSBvcy5wYXRoLmV4cGFuZHVzZXIob3MucGF0aC5leHBhbmR2YXJzKGJfcGF0aCkpCiAgICAgICAgcGF0aCA9IHRvX3RleHQoYl9wYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCiAgICAgICAgaWYgb3duZXIgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIGNoYW5nZWQKICAgICAgICBvcmlnX3VpZCwgb3JpZ19naWQgPSBzZWxmLnVzZXJfYW5kX2dyb3VwKHBhdGgsIGV4cGFuZCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVpZCA9IGludChvd25lcikKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdWlkID0gcHdkLmdldHB3bmFtKG93bmVyKS5wd191aWQKICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J2Nob3duIGZhaWxlZDogZmFpbGVkIHRvIGxvb2sgdXAgdXNlciAlcycgJSBvd25lcikKICAgICAgICBpZiBvcmlnX3VpZCAhPSB1aWQ6CgogICAgICAgICAgICBpZiBkaWZmIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgaWYgJ2JlZm9yZScgbm90IGluIGRpZmY6CiAgICAgICAgICAgICAgICAgICAgZGlmZlsnYmVmb3JlJ10gPSB7fQogICAgICAgICAgICAgICAgZGlmZlsnYmVmb3JlJ11bJ293bmVyJ10gPSBvcmlnX3VpZAogICAgICAgICAgICAgICAgaWYgJ2FmdGVyJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICBkaWZmWydhZnRlciddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ11bJ293bmVyJ10gPSB1aWQKCiAgICAgICAgICAgIGlmIHNlbGYuY2hlY2tfbW9kZToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLmxjaG93bihiX3BhdGgsIHVpZCwgLTEpCiAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J2Nob3duIGZhaWxlZCcpCiAgICAgICAgICAgIGNoYW5nZWQgPSBUcnVlCiAgICAgICAgcmV0dXJuIGNoYW5nZWQKCiAgICBkZWYgc2V0X2dyb3VwX2lmX2RpZmZlcmVudChzZWxmLCBwYXRoLCBncm91cCwgY2hhbmdlZCwgZGlmZj1Ob25lLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIGV4cGFuZDoKICAgICAgICAgICAgYl9wYXRoID0gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyhiX3BhdGgpKQogICAgICAgIHBhdGggPSB0b190ZXh0KGJfcGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfdGhlbl9zdHJpY3QnKQogICAgICAgIGlmIGdyb3VwIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkCiAgICAgICAgb3JpZ191aWQsIG9yaWdfZ2lkID0gc2VsZi51c2VyX2FuZF9ncm91cChiX3BhdGgsIGV4cGFuZCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGdpZCA9IGludChncm91cCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2lkID0gZ3JwLmdldGdybmFtKGdyb3VwKS5ncl9naWQKICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J2NoZ3JwIGZhaWxlZDogZmFpbGVkIHRvIGxvb2sgdXAgZ3JvdXAgJXMnICUgZ3JvdXApCiAgICAgICAgaWYgb3JpZ19naWQgIT0gZ2lkOgoKICAgICAgICAgICAgaWYgZGlmZiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmICdiZWZvcmUnIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddWydncm91cCddID0gb3JpZ19naWQKICAgICAgICAgICAgICAgIGlmICdhZnRlcicgbm90IGluIGRpZmY6CiAgICAgICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXSA9IHt9CiAgICAgICAgICAgICAgICBkaWZmWydhZnRlciddWydncm91cCddID0gZ2lkCgogICAgICAgICAgICBpZiBzZWxmLmNoZWNrX21vZGU6CiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy5sY2hvd24oYl9wYXRoLCAtMSwgZ2lkKQogICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKHBhdGg9cGF0aCwgbXNnPSdjaGdycCBmYWlsZWQnKQogICAgICAgICAgICBjaGFuZ2VkID0gVHJ1ZQogICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgZGVmIHNldF9tb2RlX2lmX2RpZmZlcmVudChzZWxmLCBwYXRoLCBtb2RlLCBjaGFuZ2VkLCBkaWZmPU5vbmUsIGV4cGFuZD1UcnVlKToKICAgICAgICBiX3BhdGggPSB0b19ieXRlcyhwYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCiAgICAgICAgaWYgZXhwYW5kOgogICAgICAgICAgICBiX3BhdGggPSBvcy5wYXRoLmV4cGFuZHVzZXIob3MucGF0aC5leHBhbmR2YXJzKGJfcGF0aCkpCiAgICAgICAgcGF0aCA9IHRvX3RleHQoYl9wYXRoLCBlcnJvcnM9J3N1cnJvZ2F0ZV90aGVuX3N0cmljdCcpCiAgICAgICAgcGF0aF9zdGF0ID0gb3MubHN0YXQoYl9wYXRoKQoKICAgICAgICBpZiBtb2RlIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG1vZGUsIGludCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG1vZGUgPSBpbnQobW9kZSwgOCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBtb2RlID0gc2VsZi5fc3ltYm9saWNfbW9kZV90b19vY3RhbChwYXRoX3N0YXQsIG1vZGUpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnPSJtb2RlIG11c3QgYmUgaW4gb2N0YWwgb3Igc3ltYm9saWMgZm9ybSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlscz1zdHIoZSkpCgogICAgICAgICAgICAgICAgaWYgbW9kZSAhPSBzdGF0LlNfSU1PREUobW9kZSk6CiAgICAgICAgICAgICAgICAgICAgIyBwcmV2ZW50IG1vZGUgZnJvbSBoYXZpbmcgZXh0cmEgaW5mbyBvcmJlaW5nIGludmFsaWQgbG9uZyBudW1iZXIKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsIG1zZz0iSW52YWxpZCBtb2RlIHN1cHBsaWVkLCBvbmx5IHBlcm1pc3Npb24gaW5mbyBpcyBhbGxvd2VkIiwgZGV0YWlscz1tb2RlKQoKICAgICAgICBwcmV2X21vZGUgPSBzdGF0LlNfSU1PREUocGF0aF9zdGF0LnN0X21vZGUpCgogICAgICAgIGlmIHByZXZfbW9kZSAhPSBtb2RlOgoKICAgICAgICAgICAgaWYgZGlmZiBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGlmICdiZWZvcmUnIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddID0ge30KICAgICAgICAgICAgICAgIGRpZmZbJ2JlZm9yZSddWydtb2RlJ10gPSAnMCUwM28nICUgcHJldl9tb2RlCiAgICAgICAgICAgICAgICBpZiAnYWZ0ZXInIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgIGRpZmZbJ2FmdGVyJ10gPSB7fQogICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXVsnbW9kZSddID0gJzAlMDNvJyAlIG1vZGUKCiAgICAgICAgICAgIGlmIHNlbGYuY2hlY2tfbW9kZToKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICMgRklYTUU6IGNvbXBhcmlzb24gYWdhaW5zdCBzdHJpbmcgYWJvdmUgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGV4ZWN1dGVkCiAgICAgICAgICAgICMgZXZlcnkgdGltZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKG9zLCAnbGNobW9kJyk6CiAgICAgICAgICAgICAgICAgICAgb3MubGNobW9kKGJfcGF0aCwgbW9kZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguaXNsaW5rKGJfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLmNobW9kKGJfcGF0aCwgbW9kZSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIEF0dGVtcHQgdG8gc2V0IHRoZSBwZXJtcyBvZiB0aGUgc3ltbGluayBidXQgYmUKICAgICAgICAgICAgICAgICAgICAgICAgIyBjYXJlZnVsIG5vdCB0byBjaGFuZ2UgdGhlIHBlcm1zIG9mIHRoZSB1bmRlcmx5aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICMgZmlsZSB3aGlsZSB0cnlpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXJseWluZ19zdGF0ID0gb3Muc3RhdChiX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgIG9zLmNobW9kKGJfcGF0aCwgbW9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X3VuZGVybHlpbmdfc3RhdCA9IG9zLnN0YXQoYl9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1bmRlcmx5aW5nX3N0YXQuc3RfbW9kZSAhPSBuZXdfdW5kZXJseWluZ19zdGF0LnN0X21vZGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5jaG1vZChiX3BhdGgsIHN0YXQuU19JTU9ERSh1bmRlcmx5aW5nX3N0YXQuc3RfbW9kZSkpCiAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2xpbmsoYl9wYXRoKSBhbmQgZS5lcnJubyA9PSBlcnJuby5FUEVSTTogICMgQ2FuJ3Qgc2V0IG1vZGUgb24gc3ltYm9saWMgbGlua3MKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgICAgICBlbGlmIGUuZXJybm8gaW4gKGVycm5vLkVOT0VOVCwgZXJybm8uRUxPT1ApOiAjIENhbid0IHNldCBtb2RlIG9uIGJyb2tlbiBzeW1ib2xpYyBsaW5rcwogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgZQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocGF0aD1wYXRoLCBtc2c9J2NobW9kIGZhaWxlZCcsIGRldGFpbHM9c3RyKGUpKQoKICAgICAgICAgICAgcGF0aF9zdGF0ID0gb3MubHN0YXQoYl9wYXRoKQogICAgICAgICAgICBuZXdfbW9kZSA9IHN0YXQuU19JTU9ERShwYXRoX3N0YXQuc3RfbW9kZSkKCiAgICAgICAgICAgIGlmIG5ld19tb2RlICE9IHByZXZfbW9kZToKICAgICAgICAgICAgICAgIGNoYW5nZWQgPSBUcnVlCiAgICAgICAgcmV0dXJuIGNoYW5nZWQKCiAgICBkZWYgc2V0X2F0dHJpYnV0ZXNfaWZfZGlmZmVyZW50KHNlbGYsIHBhdGgsIGF0dHJpYnV0ZXMsIGNoYW5nZWQsIGRpZmY9Tm9uZSwgZXhwYW5kPVRydWUpOgoKICAgICAgICBpZiBhdHRyaWJ1dGVzIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgICAgIGJfcGF0aCA9IHRvX2J5dGVzKHBhdGgsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fc3RyaWN0JykKICAgICAgICBpZiBleHBhbmQ6CiAgICAgICAgICAgIGJfcGF0aCA9IG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnMoYl9wYXRoKSkKICAgICAgICBwYXRoID0gdG9fdGV4dChiX3BhdGgsIGVycm9ycz0nc3Vycm9nYXRlX3RoZW5fc3RyaWN0JykKCiAgICAgICAgZXhpc3RpbmcgPSBzZWxmLmdldF9maWxlX2F0dHJpYnV0ZXMoYl9wYXRoKQoKICAgICAgICBpZiBleGlzdGluZy5nZXQoJ2F0dHJfZmxhZ3MnLCcnKSAhPSBhdHRyaWJ1dGVzOgogICAgICAgICAgICBhdHRyY21kID0gc2VsZi5nZXRfYmluX3BhdGgoJ2NoYXR0cicpCiAgICAgICAgICAgIGlmIGF0dHJjbWQ6CiAgICAgICAgICAgICAgICBhdHRyY21kID0gW2F0dHJjbWQsICc9JXMnICUgYXR0cmlidXRlcywgYl9wYXRoXQogICAgICAgICAgICAgICAgY2hhbmdlZCA9IFRydWUKCiAgICAgICAgICAgICAgICBpZiBkaWZmIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGlmICdiZWZvcmUnIG5vdCBpbiBkaWZmOgogICAgICAgICAgICAgICAgICAgICAgICBkaWZmWydiZWZvcmUnXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgZGlmZlsnYmVmb3JlJ11bJ2F0dHJpYnV0ZXMnXSA9IGV4aXN0aW5nLmdldCgnYXR0cl9mbGFncycpCiAgICAgICAgICAgICAgICAgICAgaWYgJ2FmdGVyJyBub3QgaW4gZGlmZjoKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgZGlmZlsnYWZ0ZXInXVsnYXR0cmlidXRlcyddID0gYXR0cmlidXRlcwoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLmNoZWNrX21vZGU6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICByYywgb3V0LCBlcnIgPSBzZWxmLnJ1bl9jb21tYW5kKGF0dHJjbWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJjICE9IDAgb3IgZXJyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCJFcnJvciB3aGlsZSBzZXR0aW5nIGF0dHJpYnV0ZXM6ICVzIiAlIChvdXQgKyBlcnIpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihwYXRoPXBhdGgsIG1zZz0nY2hhdHRyIGZhaWxlZCcsIGRldGFpbHM9c3RyKGUpKQogICAgICAgIHJldHVybiBjaGFuZ2VkCgogICAgZGVmIGdldF9maWxlX2F0dHJpYnV0ZXMoc2VsZiwgcGF0aCk6CiAgICAgICAgb3V0cHV0ID0ge30KICAgICAgICBhdHRyY21kID0gc2VsZi5nZXRfYmluX3BhdGgoJ2xzYXR0cicsIEZhbHNlKQogICAgICAgIGlmIGF0dHJjbWQ6CiAgICAgICAgICAgIGF0dHJjbWQgPSBbYXR0cmNtZCwgJy12ZCcsIHBhdGhdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJjLCBvdXQsIGVyciA9IHNlbGYucnVuX2NvbW1hbmQoYXR0cmNtZCkKICAgICAgICAgICAgICAgIGlmIHJjID09IDA6CiAgICAgICAgICAgICAgICAgICAgcmVzID0gb3V0LnNwbGl0KCcgJylbMDoyXQogICAgICAgICAgICAgICAgICAgIG91dHB1dFsnYXR0cl9mbGFncyddID0gIHJlc1sxXS5yZXBsYWNlKCctJywnJykuc3RyaXAoKQogICAgICAgICAgICAgICAgICAgIG91dHB1dFsndmVyc2lvbiddID0gcmVzWzBdLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbJ2F0dHJpYnV0ZXMnXSA9IGZvcm1hdF9hdHRyaWJ1dGVzKG91dHB1dFsnYXR0cl9mbGFncyddKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgcmV0dXJuIG91dHB1dAoKCiAgICBkZWYgX3N5bWJvbGljX21vZGVfdG9fb2N0YWwoc2VsZiwgcGF0aF9zdGF0LCBzeW1ib2xpY19tb2RlKToKICAgICAgICBuZXdfbW9kZSA9IHN0YXQuU19JTU9ERShwYXRoX3N0YXQuc3RfbW9kZSkKCiAgICAgICAgbW9kZV9yZSA9IHJlLmNvbXBpbGUocideKD9QPHVzZXJzPlt1Z29hXSspKD9QPG9wZXJhdG9yPlstKz1dKSg/UDxwZXJtcz5bcnd4WHN0LV0qfFt1Z29dKSQnKQogICAgICAgIGZvciBtb2RlIGluIHN5bWJvbGljX21vZGUuc3BsaXQoJywnKToKICAgICAgICAgICAgbWF0Y2ggPSBtb2RlX3JlLm1hdGNoKG1vZGUpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgdXNlcnMgPSBtYXRjaC5ncm91cCgndXNlcnMnKQogICAgICAgICAgICAgICAgb3BlcmF0b3IgPSBtYXRjaC5ncm91cCgnb3BlcmF0b3InKQogICAgICAgICAgICAgICAgcGVybXMgPSBtYXRjaC5ncm91cCgncGVybXMnKQoKICAgICAgICAgICAgICAgIGlmIHVzZXJzID09ICdhJzoKICAgICAgICAgICAgICAgICAgICB1c2VycyA9ICd1Z28nCgogICAgICAgICAgICAgICAgZm9yIHVzZXIgaW4gdXNlcnM6CiAgICAgICAgICAgICAgICAgICAgbW9kZV90b19hcHBseSA9IHNlbGYuX2dldF9vY3RhbF9tb2RlX2Zyb21fc3ltYm9saWNfcGVybXMocGF0aF9zdGF0LCB1c2VyLCBwZXJtcykKICAgICAgICAgICAgICAgICAgICBuZXdfbW9kZSA9IHNlbGYuX2FwcGx5X29wZXJhdGlvbl90b19tb2RlKHVzZXIsIG9wZXJhdG9yLCBtb2RlX3RvX2FwcGx5LCBuZXdfbW9kZSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoImJhZCBzeW1ib2xpYyBwZXJtaXNzaW9uIGZvciBtb2RlOiAlcyIgJSBtb2RlKQogICAgICAgIHJldHVybiBuZXdfbW9kZQoKICAgIGRlZiBfYXBwbHlfb3BlcmF0aW9uX3RvX21vZGUoc2VsZiwgdXNlciwgb3BlcmF0b3IsIG1vZGVfdG9fYXBwbHksIGN1cnJlbnRfbW9kZSk6CiAgICAgICAgaWYgb3BlcmF0b3IgID09ICAnPSc6CiAgICAgICAgICAgIGlmIHVzZXIgPT0gJ3UnOgogICAgICAgICAgICAgICAgbWFzayA9IHN0YXQuU19JUldYVSB8IHN0YXQuU19JU1VJRAogICAgICAgICAgICBlbGlmIHVzZXIgPT0gJ2cnOgogICAgICAgICAgICAgICAgbWFzayA9IHN0YXQuU19JUldYRyB8IHN0YXQuU19JU0dJRAogICAgICAgICAgICBlbGlmIHVzZXIgPT0gJ28nOgogICAgICAgICAgICAgICAgbWFzayA9IHN0YXQuU19JUldYTyB8IHN0YXQuU19JU1ZUWAoKICAgICAgICAgICAgIyBtYXNrIG91dCB1LCBnLCBvciBvIHBlcm1pc3Npb25zIGZyb20gY3VycmVudF9tb2RlIGFuZCBhcHBseSBuZXcgcGVybWlzc2lvbnMKICAgICAgICAgICAgaW52ZXJzZV9tYXNrID0gbWFzayBeIFBFUk1fQklUUwogICAgICAgICAgICBuZXdfbW9kZSA9IChjdXJyZW50X21vZGUgJiBpbnZlcnNlX21hc2spIHwgbW9kZV90b19hcHBseQogICAgICAgIGVsaWYgb3BlcmF0b3IgPT0gJysnOgogICAgICAgICAgICBuZXdfbW9kZSA9IGN1cnJlbnRfbW9kZSB8IG1vZGVfdG9fYXBwbHkKICAgICAgICBlbGlmIG9wZXJhdG9yID09ICctJzoKICAgICAgICAgICAgbmV3X21vZGUgPSBjdXJyZW50X21vZGUgLSAoY3VycmVudF9tb2RlICYgbW9kZV90b19hcHBseSkKICAgICAgICByZXR1cm4gbmV3X21vZGUKCiAgICBkZWYgX2dldF9vY3RhbF9tb2RlX2Zyb21fc3ltYm9saWNfcGVybXMoc2VsZiwgcGF0aF9zdGF0LCB1c2VyLCBwZXJtcyk6CiAgICAgICAgcHJldl9tb2RlID0gc3RhdC5TX0lNT0RFKHBhdGhfc3RhdC5zdF9tb2RlKQoKICAgICAgICBpc19kaXJlY3RvcnkgPSBzdGF0LlNfSVNESVIocGF0aF9zdGF0LnN0X21vZGUpCiAgICAgICAgaGFzX3hfcGVybWlzc2lvbnMgPSAocHJldl9tb2RlICYgRVhFQ19QRVJNX0JJVFMpID4gMAogICAgICAgIGFwcGx5X1hfcGVybWlzc2lvbiA9IGlzX2RpcmVjdG9yeSBvciBoYXNfeF9wZXJtaXNzaW9ucwoKICAgICAgICAjIFBlcm1pc3Npb24gYml0cyBjb25zdGFudHMgZG9jdW1lbnRlZCBhdDoKICAgICAgICAjIGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L3N0YXQuaHRtbCNzdGF0LlNfSVNVSUQKICAgICAgICBpZiBhcHBseV9YX3Blcm1pc3Npb246CiAgICAgICAgICAgIFhfcGVybXMgPSB7CiAgICAgICAgICAgICAgICAndSc6IHsnWCc6IHN0YXQuU19JWFVTUn0sCiAgICAgICAgICAgICAgICAnZyc6IHsnWCc6IHN0YXQuU19JWEdSUH0sCiAgICAgICAgICAgICAgICAnbyc6IHsnWCc6IHN0YXQuU19JWE9USH0KICAgICAgICAgICAgfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIFhfcGVybXMgPSB7CiAgICAgICAgICAgICAgICAndSc6IHsnWCc6IDB9LAogICAgICAgICAgICAgICAgJ2cnOiB7J1gnOiAwfSwKICAgICAgICAgICAgICAgICdvJzogeydYJzogMH0KICAgICAgICAgICAgfQoKICAgICAgICB1c2VyX3Blcm1zX3RvX21vZGVzID0gewogICAgICAgICAgICAndSc6IHsKICAgICAgICAgICAgICAgICdyJzogc3RhdC5TX0lSVVNSLAogICAgICAgICAgICAgICAgJ3cnOiBzdGF0LlNfSVdVU1IsCiAgICAgICAgICAgICAgICAneCc6IHN0YXQuU19JWFVTUiwKICAgICAgICAgICAgICAgICdzJzogc3RhdC5TX0lTVUlELAogICAgICAgICAgICAgICAgJ3QnOiAwLAogICAgICAgICAgICAgICAgJ3UnOiBwcmV2X21vZGUgJiBzdGF0LlNfSVJXWFUsCiAgICAgICAgICAgICAgICAnZyc6IChwcmV2X21vZGUgJiBzdGF0LlNfSVJXWEcpIDw8IDMsCiAgICAgICAgICAgICAgICAnbyc6IChwcmV2X21vZGUgJiBzdGF0LlNfSVJXWE8pIDw8IDYgfSwKICAgICAgICAgICAgJ2cnOiB7CiAgICAgICAgICAgICAgICAncic6IHN0YXQuU19JUkdSUCwKICAgICAgICAgICAgICAgICd3Jzogc3RhdC5TX0lXR1JQLAogICAgICAgICAgICAgICAgJ3gnOiBzdGF0LlNfSVhHUlAsCiAgICAgICAgICAgICAgICAncyc6IHN0YXQuU19JU0dJRCwKICAgICAgICAgICAgICAgICd0JzogMCwKICAgICAgICAgICAgICAgICd1JzogKHByZXZfbW9kZSAmIHN0YXQuU19JUldYVSkgPj4gMywKICAgICAgICAgICAgICAgICdnJzogcHJldl9tb2RlICYgc3RhdC5TX0lSV1hHLAogICAgICAgICAgICAgICAgJ28nOiAocHJldl9tb2RlICYgc3RhdC5TX0lSV1hPKSA8PCAzIH0sCiAgICAgICAgICAgICdvJzogewogICAgICAgICAgICAgICAgJ3InOiBzdGF0LlNfSVJPVEgsCiAgICAgICAgICAgICAgICAndyc6IHN0YXQuU19JV09USCwKICAgICAgICAgICAgICAgICd4Jzogc3RhdC5TX0lYT1RILAogICAgICAgICAgICAgICAgJ3MnOiAwLAogICAgICAgICAgICAgICAgJ3QnOiBzdGF0LlNfSVNWVFgsCiAgICAgICAgICAgICAgICAndSc6IChwcmV2X21vZGUgJiBzdGF0LlNfSVJXWFUpID4+IDYsCiAgICAgICAgICAgICAgICAnZyc6IChwcmV2X21vZGUgJiBzdGF0LlNfSVJXWEcpID4+IDMsCiAgICAgICAgICAgICAgICAnbyc6IHByZXZfbW9kZSAmIHN0YXQuU19JUldYTyB9CiAgICAgICAgfQoKICAgICAgICAjIEluc2VydCBYX3Blcm1zIGludG8gdXNlcl9wZXJtc190b19tb2RlcwogICAgICAgIGZvciBrZXksIHZhbHVlIGluIFhfcGVybXMuaXRlbXMoKToKICAgICAgICAgICAgdXNlcl9wZXJtc190b19tb2Rlc1trZXldLnVwZGF0ZSh2YWx1ZSkKCiAgICAgICAgb3JfcmVkdWNlID0gbGFtYmRhIG1vZGUsIHBlcm06IG1vZGUgfCB1c2VyX3Blcm1zX3RvX21vZGVzW3VzZXJdW3Blcm1dCiAgICAgICAgcmV0dXJuIHJlZHVjZShvcl9yZWR1Y2UsIHBlcm1zLCAwKQoKICAgIGRlZiBzZXRfZnNfYXR0cmlidXRlc19pZl9kaWZmZXJlbnQoc2VsZiwgZmlsZV9hcmdzLCBjaGFuZ2VkLCBkaWZmPU5vbmUsIGV4cGFuZD1UcnVlKToKICAgICAgICAjIHNldCBtb2RlcyBvd25lcnMgYW5kIGNvbnRleHQgYXMgbmVlZGVkCiAgICAgICAgY2hhbmdlZCA9IHNlbGYuc2V0X2NvbnRleHRfaWZfZGlmZmVyZW50KAogICAgICAgICAgICBmaWxlX2FyZ3NbJ3BhdGgnXSwgZmlsZV9hcmdzWydzZWNvbnRleHQnXSwgY2hhbmdlZCwgZGlmZgogICAgICAgICkKICAgICAgICBjaGFuZ2VkID0gc2VsZi5zZXRfb3duZXJfaWZfZGlmZmVyZW50KAogICAgICAgICAgICBmaWxlX2FyZ3NbJ3BhdGgnXSwgZmlsZV9hcmdzWydvd25lciddLCBjaGFuZ2VkLCBkaWZmLCBleHBhbmQKICAgICAgICApCiAgICAgICAgY2hhbmdlZCA9IHNlbGYuc2V0X2dyb3VwX2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgZmlsZV9hcmdzWydwYXRoJ10sIGZpbGVfYXJnc1snZ3JvdXAnXSwgY2hhbmdlZCwgZGlmZiwgZXhwYW5kCiAgICAgICAgKQogICAgICAgIGNoYW5nZWQgPSBzZWxmLnNldF9tb2RlX2lmX2RpZmZlcmVudCgKICAgICAgICAgICAgZmlsZV9hcmdzWydwYXRoJ10sIGZpbGVfYXJnc1snbW9kZSddLCBjaGFuZ2VkLCBkaWZmLCBleHBhbmQKICAgICAgICApCiAgICAgICAgY2hhbmdlZCA9IHNlbGYuc2V0X2F0dHJpYnV0ZXNfaWZfZGlmZmVyZW50KAogICAgICAgICAgICBmaWxlX2FyZ3NbJ3BhdGgnXSwgZmlsZV9hcmdzWydhdHRyaWJ1dGVzJ10sIGNoYW5nZWQsIGRpZmYsIGV4cGFuZAogICAgICAgICkKICAgICAgICByZXR1cm4gY2hhbmdlZAoKICAgIGRlZiBzZXRfZGlyZWN0b3J5X2F0dHJpYnV0ZXNfaWZfZGlmZmVyZW50KHNlbGYsIGZpbGVfYXJncywgY2hhbmdlZCwgZGlmZj1Ob25lLCBleHBhbmQ9VHJ1ZSk6CiAgICAgICAgcmV0dXJuIHNlbGYuc2V0X2ZzX2F0dHJpYnV0ZXNfaWZfZGlmZmVyZW50KGZpbGVfYXJncywgY2hhbmdlZCwgZGlmZiwgZXhwYW5kKQoKICAgIGRlZiBzZXRfZmlsZV9hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudChzZWxmLCBmaWxlX2FyZ3MsIGNoYW5nZWQsIGRpZmY9Tm9uZSwgZXhwYW5kPVRydWUpOgogICAgICAgIHJldHVybiBzZWxmLnNldF9mc19hdHRyaWJ1dGVzX2lmX2RpZmZlcmVudChmaWxlX2FyZ3MsIGNoYW5nZWQsIGRpZmYsIGV4cGFuZCkKCiAgICBkZWYgYWRkX3BhdGhfaW5mbyhzZWxmLCBrd2FyZ3MpOgogICAgICAgICcnJwogICAgICAgIGZvciByZXN1bHRzIHRoYXQgYXJlIGZpbGVzLCBzdXBwbGVtZW50IHRoZSBpbmZvIGFib3V0IHRoZSBmaWxlCiAgICAgICAgaW4gdGhlIHJldHVybiBwYXRoIHdpdGggc3RhdHMgYWJvdXQgdGhlIGZpbGUgcGF0aC4KICAgICAgICAnJycKCiAgICAgICAgcGF0aCA9IGt3YXJncy5nZXQoJ3BhdGgnLCBrd2FyZ3MuZ2V0KCdkZXN0JywgTm9uZSkpCiAgICAgICAgaWYgcGF0aCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4ga3dhcmdzCiAgICAgICAgYl9wYXRoID0gdG9fYnl0ZXMocGF0aCwgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhiX3BhdGgpOgogICAgICAgICAgICAodWlkLCBnaWQpID0gc2VsZi51c2VyX2FuZF9ncm91cChwYXRoKQogICAgICAgICAgICBrd2FyZ3NbJ3VpZCddID0gdWlkCiAgICAgICAgICAgIGt3YXJnc1snZ2lkJ10gPSBnaWQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXNlciA9IHB3ZC5nZXRwd3VpZCh1aWQpWzBdCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIHVzZXIgPSBzdHIodWlkKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBncm91cCA9IGdycC5nZXRncmdpZChnaWQpWzBdCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIGdyb3VwID0gc3RyKGdpZCkKICAgICAgICAgICAga3dhcmdzWydvd25lciddID0gdXNlcgogICAgICAgICAgICBrd2FyZ3NbJ2dyb3VwJ10gPSBncm91cAogICAgICAgICAgICBzdCA9IG9zLmxzdGF0KGJfcGF0aCkKICAgICAgICAgICAga3dhcmdzWydtb2RlJ10gPSAnMCUwM28nICUgc3RhdC5TX0lNT0RFKHN0W3N0YXQuU1RfTU9ERV0pCiAgICAgICAgICAgICMgc2Vjb250ZXh0IG5vdCB5ZXQgc3VwcG9ydGVkCiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNsaW5rKGJfcGF0aCk6CiAgICAgICAgICAgICAgICBrd2FyZ3NbJ3N0YXRlJ10gPSAnbGluaycKICAgICAgICAgICAgZWxpZiBvcy5wYXRoLmlzZGlyKGJfcGF0aCk6CiAgICAgICAgICAgICAgICBrd2FyZ3NbJ3N0YXRlJ10gPSAnZGlyZWN0b3J5JwogICAgICAgICAgICBlbGlmIG9zLnN0YXQoYl9wYXRoKS5zdF9ubGluayA+IDE6CiAgICAgICAgICAgICAgICBrd2FyZ3NbJ3N0YXRlJ10gPSAnaGFyZCcKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGt3YXJnc1snc3RhdGUnXSA9ICdmaWxlJwogICAgICAgICAgICBpZiBIQVZFX1NFTElOVVggYW5kIHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgICAgICBrd2FyZ3NbJ3NlY29udGV4dCddID0gJzonLmpvaW4oc2VsZi5zZWxpbnV4X2NvbnRleHQocGF0aCkpCiAgICAgICAgICAgIGt3YXJnc1snc2l6ZSddID0gc3Rbc3RhdC5TVF9TSVpFXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGt3YXJnc1snc3RhdGUnXSA9ICdhYnNlbnQnCiAgICAgICAgcmV0dXJuIGt3YXJncwoKICAgIGRlZiBfY2hlY2tfbG9jYWxlKHNlbGYpOgogICAgICAgICcnJwogICAgICAgIFVzZXMgdGhlIGxvY2FsZSBtb2R1bGUgdG8gdGVzdCB0aGUgY3VycmVudGx5IHNldCBsb2NhbGUKICAgICAgICAocGVyIHRoZSBMQU5HIGFuZCBMQ19DVFlQRSBlbnZpcm9ubWVudCBzZXR0aW5ncykKICAgICAgICAnJycKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgc2V0dGluZyB0aGUgbG9jYWxlIHRvICcnIHVzZXMgdGhlIGRlZmF1bHQgbG9jYWxlCiAgICAgICAgICAgICMgYXMgaXQgd291bGQgYmUgcmV0dXJuZWQgYnkgbG9jYWxlLmdldGRlZmF1bHRsb2NhbGUoKQogICAgICAgICAgICBsb2NhbGUuc2V0bG9jYWxlKGxvY2FsZS5MQ19BTEwsICcnKQogICAgICAgIGV4Y2VwdCBsb2NhbGUuRXJyb3I6CiAgICAgICAgICAgICMgZmFsbGJhY2sgdG8gdGhlICdDJyBsb2NhbGUsIHdoaWNoIG1heSBjYXVzZSB1bmljb2RlCiAgICAgICAgICAgICMgaXNzdWVzIGJ1dCBpcyBwcmVmZXJhYmxlIHRvIHNpbXBseSBmYWlsaW5nIGJlY2F1c2UKICAgICAgICAgICAgIyBvZiBhbiB1bmtub3duIGxvY2FsZQogICAgICAgICAgICBsb2NhbGUuc2V0bG9jYWxlKGxvY2FsZS5MQ19BTEwsICdDJykKICAgICAgICAgICAgb3MuZW52aXJvblsnTEFORyddID0gJ0MnCiAgICAgICAgICAgIG9zLmVudmlyb25bJ0xDX0FMTCddID0gJ0MnCiAgICAgICAgICAgIG9zLmVudmlyb25bJ0xDX01FU1NBR0VTJ10gPSAnQycKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iQW4gdW5rbm93biBlcnJvciB3YXMgZW5jb3VudGVyZWQgd2hpbGUgYXR0ZW1wdGluZyB0byB2YWxpZGF0ZSB0aGUgbG9jYWxlOiAlcyIgJSBlKQoKICAgIGRlZiBfaGFuZGxlX2FsaWFzZXMoc2VsZiwgc3BlYz1Ob25lKToKICAgICAgICAjIHRoaXMgdXNlcyBleGNlcHRpb25zIGFzIGl0IGhhcHBlbnMgYmVmb3JlIHdlIGNhbiBzYWZlbHkgY2FsbCBmYWlsX2pzb24KICAgICAgICBhbGlhc2VzX3Jlc3VsdHMgPSB7fSAjYWxpYXM6Y2Fub24KICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHNwZWMgPSBzZWxmLmFyZ3VtZW50X3NwZWMKICAgICAgICBmb3IgKGssdikgaW4gc3BlYy5pdGVtcygpOgogICAgICAgICAgICBzZWxmLl9sZWdhbF9pbnB1dHMuYXBwZW5kKGspCiAgICAgICAgICAgIGFsaWFzZXMgPSB2LmdldCgnYWxpYXNlcycsIE5vbmUpCiAgICAgICAgICAgIGRlZmF1bHQgPSB2LmdldCgnZGVmYXVsdCcsIE5vbmUpCiAgICAgICAgICAgIHJlcXVpcmVkID0gdi5nZXQoJ3JlcXVpcmVkJywgRmFsc2UpCiAgICAgICAgICAgIGlmIGRlZmF1bHQgaXMgbm90IE5vbmUgYW5kIHJlcXVpcmVkOgogICAgICAgICAgICAgICAgIyBub3QgYWxpYXMgc3BlY2lmaWMgYnV0IHRoaXMgaXMgYSBnb29kIHBsYWNlIHRvIGNoZWNrIHRoaXMKICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigiaW50ZXJuYWwgZXJyb3I6IHJlcXVpcmVkIGFuZCBkZWZhdWx0IGFyZSBtdXR1YWxseSBleGNsdXNpdmUgZm9yICVzIiAlIGspCiAgICAgICAgICAgIGlmIGFsaWFzZXMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKGFsaWFzZXMsIFNFUVVFTkNFVFlQRSkgb3IgaXNpbnN0YW5jZShhbGlhc2VzLCAoYmluYXJ5X3R5cGUsIHRleHRfdHlwZSkpOgogICAgICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCdpbnRlcm5hbCBlcnJvcjogYWxpYXNlcyBtdXN0IGJlIGEgbGlzdCBvciB0dXBsZScpCiAgICAgICAgICAgIGZvciBhbGlhcyBpbiBhbGlhc2VzOgogICAgICAgICAgICAgICAgc2VsZi5fbGVnYWxfaW5wdXRzLmFwcGVuZChhbGlhcykKICAgICAgICAgICAgICAgIGFsaWFzZXNfcmVzdWx0c1thbGlhc10gPSBrCiAgICAgICAgICAgICAgICBpZiBhbGlhcyBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgICAgICAgICBzZWxmLnBhcmFtc1trXSA9IHNlbGYucGFyYW1zW2FsaWFzXQoKICAgICAgICByZXR1cm4gYWxpYXNlc19yZXN1bHRzCgogICAgZGVmIF9jaGVja19hcmd1bWVudHMoc2VsZiwgY2hlY2tfaW52YWxpZF9hcmd1bWVudHMpOgogICAgICAgIHNlbGYuX3N5c2xvZ19mYWNpbGl0eSA9ICdMT0dfVVNFUicKICAgICAgICB1bnN1cHBvcnRlZF9wYXJhbWV0ZXJzID0gc2V0KCkKICAgICAgICBmb3IgKGssdikgaW4gbGlzdChzZWxmLnBhcmFtcy5pdGVtcygpKToKCiAgICAgICAgICAgIGlmIGsgPT0gJ19hbnNpYmxlX2NoZWNrX21vZGUnIGFuZCB2OgogICAgICAgICAgICAgICAgc2VsZi5jaGVja19tb2RlID0gVHJ1ZQoKICAgICAgICAgICAgZWxpZiBrID09ICdfYW5zaWJsZV9ub19sb2cnOgogICAgICAgICAgICAgICAgc2VsZi5ub19sb2cgPSBzZWxmLmJvb2xlYW4odikKCiAgICAgICAgICAgIGVsaWYgayA9PSAnX2Fuc2libGVfZGVidWcnOgogICAgICAgICAgICAgICAgc2VsZi5fZGVidWcgPSBzZWxmLmJvb2xlYW4odikKCiAgICAgICAgICAgIGVsaWYgayA9PSAnX2Fuc2libGVfZGlmZic6CiAgICAgICAgICAgICAgICBzZWxmLl9kaWZmID0gc2VsZi5ib29sZWFuKHYpCgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX3ZlcmJvc2l0eSc6CiAgICAgICAgICAgICAgICBzZWxmLl92ZXJib3NpdHkgPSB2CgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX3NlbGludXhfc3BlY2lhbF9mcyc6CiAgICAgICAgICAgICAgICBzZWxmLl9zZWxpbnV4X3NwZWNpYWxfZnMgPSB2CgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX3N5c2xvZ19mYWNpbGl0eSc6CiAgICAgICAgICAgICAgICBzZWxmLl9zeXNsb2dfZmFjaWxpdHkgPSB2CgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX3ZlcnNpb24nOgogICAgICAgICAgICAgICAgc2VsZi5hbnNpYmxlX3ZlcnNpb24gPSB2CgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX21vZHVsZV9uYW1lJzoKICAgICAgICAgICAgICAgIHNlbGYuX25hbWUgPSB2CgogICAgICAgICAgICBlbGlmIGsgPT0gJ19hbnNpYmxlX3NvY2tldCc6CiAgICAgICAgICAgICAgICBzZWxmLl9zb2NrZXRfcGF0aCA9IHYKCiAgICAgICAgICAgIGVsaWYgY2hlY2tfaW52YWxpZF9hcmd1bWVudHMgYW5kIGsgbm90IGluIHNlbGYuX2xlZ2FsX2lucHV0czoKICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkX3BhcmFtZXRlcnMuYWRkKGspCgogICAgICAgICAgICAjY2xlYW4gdXAgaW50ZXJuYWwgcGFyYW1zOgogICAgICAgICAgICBpZiBrLnN0YXJ0c3dpdGgoJ19hbnNpYmxlXycpOgogICAgICAgICAgICAgICAgZGVsIHNlbGYucGFyYW1zW2tdCgogICAgICAgIGlmIHVuc3VwcG9ydGVkX3BhcmFtZXRlcnM6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iVW5zdXBwb3J0ZWQgcGFyYW1ldGVycyBmb3IgKCVzKSBtb2R1bGU6ICVzLiBTdXBwb3J0ZWQgcGFyYW1ldGVycyBpbmNsdWRlOiAlcyIgJSAoc2VsZi5fbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLCcuam9pbihzb3J0ZWQobGlzdCh1bnN1cHBvcnRlZF9wYXJhbWV0ZXJzKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcsJy5qb2luKHNvcnRlZChzZWxmLmFyZ3VtZW50X3NwZWMua2V5cygpKSkpKQogICAgICAgIGlmIHNlbGYuY2hlY2tfbW9kZSBhbmQgbm90IHNlbGYuc3VwcG9ydHNfY2hlY2tfbW9kZToKICAgICAgICAgICAgc2VsZi5leGl0X2pzb24oc2tpcHBlZD1UcnVlLCBtc2c9InJlbW90ZSBtb2R1bGUgKCVzKSBkb2VzIG5vdCBzdXBwb3J0IGNoZWNrIG1vZGUiICUgc2VsZi5fbmFtZSkKCiAgICBkZWYgX2NvdW50X3Rlcm1zKHNlbGYsIGNoZWNrKToKICAgICAgICBjb3VudCA9IDAKICAgICAgICBmb3IgdGVybSBpbiBjaGVjazoKICAgICAgICAgICAgaWYgdGVybSBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgICAgIGNvdW50ICs9IDEKICAgICAgICByZXR1cm4gY291bnQKCiAgICBkZWYgX2NoZWNrX211dHVhbGx5X2V4Y2x1c2l2ZShzZWxmLCBzcGVjKToKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGZvciBjaGVjayBpbiBzcGVjOgogICAgICAgICAgICBjb3VudCA9IHNlbGYuX2NvdW50X3Rlcm1zKGNoZWNrKQogICAgICAgICAgICBpZiBjb3VudCA+IDE6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9InBhcmFtZXRlcnMgYXJlIG11dHVhbGx5IGV4Y2x1c2l2ZTogJXMiICUgKGNoZWNrLCkpCgogICAgZGVmIF9jaGVja19yZXF1aXJlZF9vbmVfb2Yoc2VsZiwgc3BlYyk6CiAgICAgICAgaWYgc3BlYyBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBmb3IgY2hlY2sgaW4gc3BlYzoKICAgICAgICAgICAgY291bnQgPSBzZWxmLl9jb3VudF90ZXJtcyhjaGVjaykKICAgICAgICAgICAgaWYgY291bnQgPT0gMDoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0ib25lIG9mIHRoZSBmb2xsb3dpbmcgaXMgcmVxdWlyZWQ6ICVzIiAlICcsJy5qb2luKGNoZWNrKSkKCiAgICBkZWYgX2NoZWNrX3JlcXVpcmVkX3RvZ2V0aGVyKHNlbGYsIHNwZWMpOgogICAgICAgIGlmIHNwZWMgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZm9yIGNoZWNrIGluIHNwZWM6CiAgICAgICAgICAgIGNvdW50cyA9IFsgc2VsZi5fY291bnRfdGVybXMoW2ZpZWxkXSkgZm9yIGZpZWxkIGluIGNoZWNrIF0KICAgICAgICAgICAgbm9uX3plcm8gPSBbIGMgZm9yIGMgaW4gY291bnRzIGlmIGMgPiAwIF0KICAgICAgICAgICAgaWYgbGVuKG5vbl96ZXJvKSA+IDA6CiAgICAgICAgICAgICAgICBpZiAwIGluIGNvdW50czoKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9InBhcmFtZXRlcnMgYXJlIHJlcXVpcmVkIHRvZ2V0aGVyOiAlcyIgJSAoY2hlY2ssKSkKCiAgICBkZWYgX2NoZWNrX3JlcXVpcmVkX2FyZ3VtZW50cyhzZWxmLCBzcGVjPU5vbmUsIHBhcmFtPU5vbmUgKToKICAgICAgICAnJycgZW5zdXJlIGFsbCByZXF1aXJlZCBhcmd1bWVudHMgYXJlIHByZXNlbnQgJycnCiAgICAgICAgbWlzc2luZyA9IFtdCiAgICAgICAgaWYgc3BlYyBpcyBOb25lOgogICAgICAgICAgICBzcGVjID0gc2VsZi5hcmd1bWVudF9zcGVjCiAgICAgICAgaWYgcGFyYW0gaXMgTm9uZToKICAgICAgICAgICAgcGFyYW0gPSBzZWxmLnBhcmFtcwogICAgICAgIGZvciAoayx2KSBpbiBzcGVjLml0ZW1zKCk6CiAgICAgICAgICAgIHJlcXVpcmVkID0gdi5nZXQoJ3JlcXVpcmVkJywgRmFsc2UpCiAgICAgICAgICAgIGlmIHJlcXVpcmVkIGFuZCBrIG5vdCBpbiBwYXJhbToKICAgICAgICAgICAgICAgIG1pc3NpbmcuYXBwZW5kKGspCiAgICAgICAgaWYgbGVuKG1pc3NpbmcpID4gMDoKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJtaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50czogJXMiICUgIiwiLmpvaW4obWlzc2luZykpCgogICAgZGVmIF9jaGVja19yZXF1aXJlZF9pZihzZWxmLCBzcGVjKToKICAgICAgICAnJycgZW5zdXJlIHRoYXQgcGFyYW1ldGVycyB3aGljaCBjb25kaXRpb25hbGx5IHJlcXVpcmVkIGFyZSBwcmVzZW50ICcnJwogICAgICAgIGlmIHNwZWMgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZm9yIHNwIGluIHNwZWM6CiAgICAgICAgICAgIG1pc3NpbmcgPSBbXQogICAgICAgICAgICBtYXhfbWlzc2luZ19jb3VudCA9IDAKICAgICAgICAgICAgaXNfb25lX29mID0gRmFsc2UKICAgICAgICAgICAgaWYgbGVuKHNwKSA9PSA0OgogICAgICAgICAgICAgICAga2V5LCB2YWwsIHJlcXVpcmVtZW50cywgaXNfb25lX29mID0gc3AKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGtleSwgdmFsLCByZXF1aXJlbWVudHMgPSBzcAoKICAgICAgICAgICAgIyBpc19vbmVfb2YgaXMgVHJ1ZSBhdCBsZWFzdCBvbmUgcmVxdWlyZW1lbnQgc2hvdWxkIGJlCiAgICAgICAgICAgICMgcHJlc2VudCwgZWxzZSBhbGwgcmVxdWlyZW1lbnRzIHNob3VsZCBiZSBwcmVzZW50LgogICAgICAgICAgICBpZiBpc19vbmVfb2Y6CiAgICAgICAgICAgICAgICBtYXhfbWlzc2luZ19jb3VudCA9IGxlbihyZXF1aXJlbWVudHMpCgogICAgICAgICAgICBpZiBrZXkgaW4gc2VsZi5wYXJhbXMgYW5kIHNlbGYucGFyYW1zW2tleV0gPT0gdmFsOgogICAgICAgICAgICAgICAgZm9yIGNoZWNrIGluIHJlcXVpcmVtZW50czoKICAgICAgICAgICAgICAgICAgICBjb3VudCA9IHNlbGYuX2NvdW50X3Rlcm1zKChjaGVjaywpKQogICAgICAgICAgICAgICAgICAgIGlmIGNvdW50ID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIG1pc3NpbmcuYXBwZW5kKGNoZWNrKQogICAgICAgICAgICBpZiBsZW4obWlzc2luZykgYW5kIGxlbihtaXNzaW5nKSA+PSBtYXhfbWlzc2luZ19jb3VudDoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iJXMgaXMgJXMgYnV0IHRoZSBmb2xsb3dpbmcgYXJlIG1pc3Npbmc6ICVzIiAlIChrZXksIHZhbCwgJywnLmpvaW4obWlzc2luZykpKQoKICAgIGRlZiBfY2hlY2tfYXJndW1lbnRfdmFsdWVzKHNlbGYsIHNwZWM9Tm9uZSwgcGFyYW09Tm9uZSk6CiAgICAgICAgJycnIGVuc3VyZSBhbGwgYXJndW1lbnRzIGhhdmUgdGhlIHJlcXVlc3RlZCB2YWx1ZXMsIGFuZCB0aGVyZSBhcmUgbm8gc3RyYXkgYXJndW1lbnRzICcnJwogICAgICAgIGlmIHNwZWMgaXMgTm9uZToKICAgICAgICAgICAgc3BlYyA9IHNlbGYuYXJndW1lbnRfc3BlYwogICAgICAgIGlmIHBhcmFtIGlzIE5vbmU6CiAgICAgICAgICAgIHBhcmFtID0gc2VsZi5wYXJhbXMKICAgICAgICBmb3IgKGssdikgaW4gc3BlYy5pdGVtcygpOgogICAgICAgICAgICBjaG9pY2VzID0gdi5nZXQoJ2Nob2ljZXMnLE5vbmUpCiAgICAgICAgICAgIGlmIGNob2ljZXMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoY2hvaWNlcywgU0VRVUVOQ0VUWVBFKSBhbmQgbm90IGlzaW5zdGFuY2UoY2hvaWNlcywgKGJpbmFyeV90eXBlLCB0ZXh0X3R5cGUpKToKICAgICAgICAgICAgICAgIGlmIGsgaW4gcGFyYW06CiAgICAgICAgICAgICAgICAgICAgaWYgcGFyYW1ba10gbm90IGluIGNob2ljZXM6CiAgICAgICAgICAgICAgICAgICAgICAgICMgUHlZYW1sIGNvbnZlcnRzIGNlcnRhaW4gc3RyaW5ncyB0byBib29scy4gIElmIHdlIGNhbiB1bmFtYmlndW91c2x5IGNvbnZlcnQgYmFjaywgZG8gc28gYmVmb3JlIGNoZWNraW5nCiAgICAgICAgICAgICAgICAgICAgICAgICMgdGhlIHZhbHVlLiAgSWYgd2UgY2FuJ3QgZmlndXJlIHRoaXMgb3V0LCBtb2R1bGUgYXV0aG9yIGlzIHJlc3BvbnNpYmxlLgogICAgICAgICAgICAgICAgICAgICAgICBsb3dlcmVkX2Nob2ljZXMgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcmFtW2tdID09ICdGYWxzZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb3dlcmVkX2Nob2ljZXMgPSBfbGVuaWVudF9sb3dlcmNhc2UoY2hvaWNlcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZBTFNFWSA9IGZyb3plbnNldChCT09MRUFOU19GQUxTRSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXAgPSBGQUxTRVkuaW50ZXJzZWN0aW9uKGNob2ljZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ob3ZlcmxhcCkgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEV4dHJhY3QgZnJvbSBhIHNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYXJhbVtrXSwpID0gb3ZlcmxhcAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFyYW1ba10gPT0gJ1RydWUnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbG93ZXJlZF9jaG9pY2VzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG93ZXJlZF9jaG9pY2VzID0gX2xlbmllbnRfbG93ZXJjYXNlKGNob2ljZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVUSFkgPSBmcm96ZW5zZXQoQk9PTEVBTlNfVFJVRSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJsYXAgPSBUUlVUSFkuaW50ZXJzZWN0aW9uKGNob2ljZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ob3ZlcmxhcCkgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocGFyYW1ba10sKSA9IG92ZXJsYXAKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcmFtW2tdIG5vdCBpbiBjaG9pY2VzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hvaWNlc19zdHI9IiwiLmpvaW4oW3RvX25hdGl2ZShjKSBmb3IgYyBpbiBjaG9pY2VzXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZz0idmFsdWUgb2YgJXMgbXVzdCBiZSBvbmUgb2Y6ICVzLCBnb3Q6ICVzIiAlIChrLCBjaG9pY2VzX3N0ciwgcGFyYW1ba10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9bXNnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJpbnRlcm5hbCBlcnJvcjogY2hvaWNlcyBmb3IgYXJndW1lbnQgJXMgYXJlIG5vdCBpdGVyYWJsZTogJXMiICUgKGssIGNob2ljZXMpKQoKICAgIGRlZiBzYWZlX2V2YWwoc2VsZiwgdmFsdWUsIGxvY2Fscz1Ob25lLCBpbmNsdWRlX2V4Y2VwdGlvbnM9RmFsc2UpOgoKICAgICAgICAjIGRvIG5vdCBhbGxvdyBtZXRob2QgY2FsbHMgdG8gbW9kdWxlcwogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHZhbHVlLCBzdHJpbmdfdHlwZXMpOgogICAgICAgICAgICAjIGFscmVhZHkgdGVtcGxhdGVkIHRvIGEgZGF0YXZhbHVlc3RydWN0dXJlLCBwZXJoYXBzPwogICAgICAgICAgICBpZiBpbmNsdWRlX2V4Y2VwdGlvbnM6CiAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlLCBOb25lKQogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICBpZiByZS5zZWFyY2gocidcd1wuXHcrXCgnLCB2YWx1ZSk6CiAgICAgICAgICAgIGlmIGluY2x1ZGVfZXhjZXB0aW9uczoKICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUsIE5vbmUpCiAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgICMgZG8gbm90IGFsbG93IGltcG9ydHMKICAgICAgICBpZiByZS5zZWFyY2gocidpbXBvcnQgXHcrJywgdmFsdWUpOgogICAgICAgICAgICBpZiBpbmNsdWRlX2V4Y2VwdGlvbnM6CiAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlLCBOb25lKQogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGxpdGVyYWxfZXZhbCh2YWx1ZSkKICAgICAgICAgICAgaWYgaW5jbHVkZV9leGNlcHRpb25zOgogICAgICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQsIE5vbmUpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBpZiBpbmNsdWRlX2V4Y2VwdGlvbnM6CiAgICAgICAgICAgICAgICByZXR1cm4gKHZhbHVlLCBlKQogICAgICAgICAgICByZXR1cm4gdmFsdWUKCiAgICBkZWYgX2NoZWNrX3R5cGVfc3RyKHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBzdHJpbmdfdHlwZXMpOgogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICAjIE5vdGU6IFRoaXMgY291bGQgdGhyb3cgYSB1bmljb2RlIGVycm9yIGlmIHZhbHVlJ3MgX19zdHJfXygpIG1ldGhvZAogICAgICAgICMgcmV0dXJucyBub24tYXNjaWkuICBIYXZlIHRvIHBvcnQgdXRpbHMudG9fYnl0ZXMoKSBpZiB0aGF0IGhhcHBlbnMKICAgICAgICByZXR1cm4gc3RyKHZhbHVlKQoKICAgIGRlZiBfY2hlY2tfdHlwZV9saXN0KHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBsaXN0KToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIHN0cmluZ190eXBlcyk6CiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5zcGxpdCgiLCIpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKHZhbHVlLCBpbnQpIG9yIGlzaW5zdGFuY2UodmFsdWUsIGZsb2F0KToKICAgICAgICAgICAgcmV0dXJuIFsgc3RyKHZhbHVlKSBdCgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhIGxpc3QnICUgdHlwZSh2YWx1ZSkpCgogICAgZGVmIF9jaGVja190eXBlX2RpY3Qoc2VsZiwgdmFsdWUpOgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIGRpY3QpOgogICAgICAgICAgICByZXR1cm4gdmFsdWUKCiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgaWYgdmFsdWUuc3RhcnRzd2l0aCgieyIpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWRzKHZhbHVlKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIChyZXN1bHQsIGV4YykgPSBzZWxmLnNhZmVfZXZhbCh2YWx1ZSwgZGljdCgpLCBpbmNsdWRlX2V4Y2VwdGlvbnM9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBpZiBleGMgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigndW5hYmxlIHRvIGV2YWx1YXRlIHN0cmluZyBhcyBkaWN0aW9uYXJ5JykKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgICAgICAgIGVsaWYgJz0nIGluIHZhbHVlOgogICAgICAgICAgICAgICAgZmllbGRzID0gW10KICAgICAgICAgICAgICAgIGZpZWxkX2J1ZmZlciA9IFtdCiAgICAgICAgICAgICAgICBpbl9xdW90ZSA9IEZhbHNlCiAgICAgICAgICAgICAgICBpbl9lc2NhcGUgPSBGYWxzZQogICAgICAgICAgICAgICAgZm9yIGMgaW4gdmFsdWUuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICBpZiBpbl9lc2NhcGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkX2J1ZmZlci5hcHBlbmQoYykKICAgICAgICAgICAgICAgICAgICAgICAgaW5fZXNjYXBlID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICBlbGlmIGMgPT0gJ1xcJzoKICAgICAgICAgICAgICAgICAgICAgICAgaW5fZXNjYXBlID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IGluX3F1b3RlIGFuZCBjIGluICgnXCcnLCAnIicpOgogICAgICAgICAgICAgICAgICAgICAgICBpbl9xdW90ZSA9IGMKICAgICAgICAgICAgICAgICAgICBlbGlmIGluX3F1b3RlIGFuZCBpbl9xdW90ZSA9PSBjOgogICAgICAgICAgICAgICAgICAgICAgICBpbl9xdW90ZSA9IEZhbHNlCiAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgaW5fcXVvdGUgYW5kIGMgaW4gKCcsJywgJyAnKToKICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQgPSAnJy5qb2luKGZpZWxkX2J1ZmZlcikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmllbGQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHMuYXBwZW5kKGZpZWxkKQogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZF9idWZmZXIgPSBbXQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkX2J1ZmZlci5hcHBlbmQoYykKCiAgICAgICAgICAgICAgICBmaWVsZCA9ICcnLmpvaW4oZmllbGRfYnVmZmVyKQogICAgICAgICAgICAgICAgaWYgZmllbGQ6CiAgICAgICAgICAgICAgICAgICAgZmllbGRzLmFwcGVuZChmaWVsZCkKICAgICAgICAgICAgICAgIHJldHVybiBkaWN0KHguc3BsaXQoIj0iLCAxKSBmb3IgeCBpbiBmaWVsZHMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoImRpY3Rpb25hcnkgcmVxdWVzdGVkLCBjb3VsZCBub3QgcGFyc2UgSlNPTiBvciBrZXk9dmFsdWUiKQoKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJyVzIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gYSBkaWN0JyAlIHR5cGUodmFsdWUpKQoKICAgIGRlZiBfY2hlY2tfdHlwZV9ib29sKHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBib29sKToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIHN0cmluZ190eXBlcykgb3IgaXNpbnN0YW5jZSh2YWx1ZSwgaW50KToKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYm9vbGVhbih2YWx1ZSkKCiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCclcyBjYW5ub3QgYmUgY29udmVydGVkIHRvIGEgYm9vbCcgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfaW50KHNlbGYsIHZhbHVlKToKICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCBpbnQpOgogICAgICAgICAgICByZXR1cm4gdmFsdWUKCiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgcmV0dXJuIGludCh2YWx1ZSkKCiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCclcyBjYW5ub3QgYmUgY29udmVydGVkIHRvIGFuIGludCcgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfZmxvYXQoc2VsZiwgdmFsdWUpOgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIGZsb2F0KToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlCgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIChiaW5hcnlfdHlwZSwgdGV4dF90eXBlLCBpbnQpKToKICAgICAgICAgICAgcmV0dXJuIGZsb2F0KHZhbHVlKQoKICAgICAgICByYWlzZSBUeXBlRXJyb3IoJyVzIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gYSBmbG9hdCcgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX3R5cGVfcGF0aChzZWxmLCB2YWx1ZSk6CiAgICAgICAgdmFsdWUgPSBzZWxmLl9jaGVja190eXBlX3N0cih2YWx1ZSkKICAgICAgICByZXR1cm4gb3MucGF0aC5leHBhbmR1c2VyKG9zLnBhdGguZXhwYW5kdmFycyh2YWx1ZSkpCgogICAgZGVmIF9jaGVja190eXBlX2pzb25hcmcoc2VsZiwgdmFsdWUpOgogICAgICAgICMgUmV0dXJuIGEganNvbmlmaWVkIHN0cmluZy4gIFNvbWV0aW1lcyB0aGUgY29udHJvbGxlciB0dXJucyBhIGpzb24KICAgICAgICAjIHN0cmluZyBpbnRvIGEgZGljdC9saXN0IHNvIHRyYW5zZm9ybSBpdCBiYWNrIGludG8ganNvbiBoZXJlCiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgKHRleHRfdHlwZSwgYmluYXJ5X3R5cGUpKToKICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnN0cmlwKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHZhbHVlLCAobGlzdCwgdHVwbGUsIGRpY3QpKToKICAgICAgICAgICAgICAgIHJldHVybiBqc29uLmR1bXBzKHZhbHVlKQogICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhIGpzb24gc3RyaW5nJyAlIHR5cGUodmFsdWUpKQoKICAgIGRlZiBfY2hlY2tfdHlwZV9yYXcoc2VsZiwgdmFsdWUpOgogICAgICAgIHJldHVybiB2YWx1ZQoKCiAgICBkZWYgX2NoZWNrX3R5cGVfYnl0ZXMoc2VsZiwgdmFsdWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5odW1hbl90b19ieXRlcyh2YWx1ZSkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCclcyBjYW5ub3QgYmUgY29udmVydGVkIHRvIGEgQnl0ZSB2YWx1ZScgJSB0eXBlKHZhbHVlKSkKCgogICAgZGVmIF9jaGVja190eXBlX2JpdHMoc2VsZiwgdmFsdWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5odW1hbl90b19ieXRlcyh2YWx1ZSwgaXNiaXRzPVRydWUpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcignJXMgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhIEJpdCB2YWx1ZScgJSB0eXBlKHZhbHVlKSkKCiAgICBkZWYgX2NoZWNrX2FyZ3VtZW50X3R5cGVzKHNlbGYsIHNwZWM9Tm9uZSwgcGFyYW09Tm9uZSk6CiAgICAgICAgJycnIGVuc3VyZSBhbGwgYXJndW1lbnRzIGhhdmUgdGhlIHJlcXVlc3RlZCB0eXBlICcnJwoKICAgICAgICBpZiBzcGVjIGlzIE5vbmU6CiAgICAgICAgICAgIHNwZWMgPSBzZWxmLmFyZ3VtZW50X3NwZWMKICAgICAgICBpZiBwYXJhbSBpcyBOb25lOgogICAgICAgICAgICBwYXJhbSA9IHNlbGYucGFyYW1zCgogICAgICAgIGZvciAoaywgdikgaW4gc3BlYy5pdGVtcygpOgogICAgICAgICAgICB3YW50ZWQgPSB2LmdldCgndHlwZScsIE5vbmUpCiAgICAgICAgICAgIGlmIGsgbm90IGluIHBhcmFtOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgd2FudGVkIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAjIE1vc3RseSB3ZSB3YW50IHRvIGRlZmF1bHQgdG8gc3RyLgogICAgICAgICAgICAgICAgIyBGb3IgdmFsdWVzIHNldCB0byBOb25lIGV4cGxpY2l0bHksIHJldHVybiBOb25lIGluc3RlYWQgYXMKICAgICAgICAgICAgICAgICMgdGhhdCBhbGxvd3MgYSB1c2VyIHRvIHVuc2V0IGEgcGFyYW1ldGVyCiAgICAgICAgICAgICAgICBpZiBwYXJhbVtrXSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICB3YW50ZWQgPSAnc3RyJwoKICAgICAgICAgICAgdmFsdWUgPSBwYXJhbVtrXQogICAgICAgICAgICBpZiB2YWx1ZSBpcyBOb25lOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHR5cGVfY2hlY2tlciA9IHNlbGYuX0NIRUNLX0FSR1VNRU5UX1RZUEVTX0RJU1BBVENIRVJbd2FudGVkXQogICAgICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9ImltcGxlbWVudGF0aW9uIGVycm9yOiB1bmtub3duIHR5cGUgJXMgcmVxdWVzdGVkIGZvciAlcyIgJSAod2FudGVkLCBrKSkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcGFyYW1ba10gPSB0eXBlX2NoZWNrZXIodmFsdWUpCiAgICAgICAgICAgIGV4Y2VwdCAoVHlwZUVycm9yLCBWYWx1ZUVycm9yKToKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iYXJndW1lbnQgJXMgaXMgb2YgdHlwZSAlcyBhbmQgd2Ugd2VyZSB1bmFibGUgdG8gY29udmVydCB0byAlczogJXMiICUgKGssIHR5cGUodmFsdWUpLCB3YW50ZWQsIGUpKQoKICAgICAgICAgICAgIyBkZWFsIHdpdGggc3ViIG9wdGlvbnMgdG8gY3JlYXRlIHN1YiBzcGVjCiAgICAgICAgICAgIHNwZWMgPSBOb25lCiAgICAgICAgICAgIGlmIHdhbnRlZCA9PSAnZGljdCcgb3IgKHdhbnRlZCA9PSAnbGlzdCcgYW5kIHYuZ2V0KCdlbGVtZW50cycsICcnKSA9PSAnZGljdCcpOgogICAgICAgICAgICAgICAgc3BlYyA9IHYuZ2V0KCdvcHRpb25zJywgTm9uZSkKICAgICAgICAgICAgICAgIGlmIHNwZWM6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fY2hlY2tfcmVxdWlyZWRfYXJndW1lbnRzKHNwZWMsIHBhcmFtW2tdKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX2NoZWNrX2FyZ3VtZW50X3R5cGVzKHNwZWMsIHBhcmFtW2tdKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX2NoZWNrX2FyZ3VtZW50X3ZhbHVlcyhzcGVjLCBwYXJhbVtrXSkKCiAgICBkZWYgX3NldF9kZWZhdWx0cyhzZWxmLCBwcmU9VHJ1ZSk6CiAgICAgICAgZm9yIChrLHYpIGluIHNlbGYuYXJndW1lbnRfc3BlYy5pdGVtcygpOgogICAgICAgICAgICBkZWZhdWx0ID0gdi5nZXQoJ2RlZmF1bHQnLCBOb25lKQogICAgICAgICAgICBpZiBwcmUgaXMgVHJ1ZToKICAgICAgICAgICAgICAgICMgdGhpcyBwcmV2ZW50cyBzZXR0aW5nIGRlZmF1bHRzIG9uIHJlcXVpcmVkIGl0ZW1zCiAgICAgICAgICAgICAgICBpZiBkZWZhdWx0IGlzIG5vdCBOb25lIGFuZCBrIG5vdCBpbiBzZWxmLnBhcmFtczoKICAgICAgICAgICAgICAgICAgICBzZWxmLnBhcmFtc1trXSA9IGRlZmF1bHQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICMgbWFrZSBzdXJlIHRoaW5ncyB3aXRob3V0IGEgZGVmYXVsdCBzdGlsbCBnZXQgc2V0IE5vbmUKICAgICAgICAgICAgICAgIGlmIGsgbm90IGluIHNlbGYucGFyYW1zOgogICAgICAgICAgICAgICAgICAgIHNlbGYucGFyYW1zW2tdID0gZGVmYXVsdAoKICAgIGRlZiBfc2V0X2ZhbGxiYWNrcyhzZWxmKToKICAgICAgICBmb3Igayx2IGluIHNlbGYuYXJndW1lbnRfc3BlYy5pdGVtcygpOgogICAgICAgICAgICBmYWxsYmFjayA9IHYuZ2V0KCdmYWxsYmFjaycsIChOb25lLCkpCiAgICAgICAgICAgIGZhbGxiYWNrX3N0cmF0ZWd5ID0gZmFsbGJhY2tbMF0KICAgICAgICAgICAgZmFsbGJhY2tfYXJncyA9IFtdCiAgICAgICAgICAgIGZhbGxiYWNrX2t3YXJncyA9IHt9CiAgICAgICAgICAgIGlmIGsgbm90IGluIHNlbGYucGFyYW1zIGFuZCBmYWxsYmFja19zdHJhdGVneSBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIGZhbGxiYWNrWzE6XToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGl0ZW0sIGRpY3QpOgogICAgICAgICAgICAgICAgICAgICAgICBmYWxsYmFja19rd2FyZ3MgPSBpdGVtCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tfYXJncyA9IGl0ZW0KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLnBhcmFtc1trXSA9IGZhbGxiYWNrX3N0cmF0ZWd5KCpmYWxsYmFja19hcmdzLCAqKmZhbGxiYWNrX2t3YXJncykKICAgICAgICAgICAgICAgIGV4Y2VwdCBBbnNpYmxlRmFsbGJhY2tOb3RGb3VuZDoKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgIGRlZiBfbG9hZF9wYXJhbXMoc2VsZik6CiAgICAgICAgJycnIHJlYWQgdGhlIGlucHV0IGFuZCBzZXQgdGhlIHBhcmFtcyBhdHRyaWJ1dGUuCgogICAgICAgIFRoaXMgbWV0aG9kIGlzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4gIFRoZSBndXRzIG9mIHRoZSBmdW5jdGlvbgogICAgICAgIHdlcmUgbW92ZWQgb3V0IGluIDIuMSBzbyB0aGF0IGN1c3RvbSBtb2R1bGVzIGNvdWxkIHJlYWQgdGhlIHBhcmFtZXRlcnMuCiAgICAgICAgJycnCiAgICAgICAgIyBkZWJ1ZyBvdmVycmlkZXMgdG8gcmVhZCBhcmdzIGZyb20gZmlsZSBvciBjbWRsaW5lCiAgICAgICAgc2VsZi5wYXJhbXMgPSBfbG9hZF9wYXJhbXMoKQoKICAgIGRlZiBfbG9nX3RvX3N5c2xvZyhzZWxmLCBtc2cpOgogICAgICAgIGlmIEhBU19TWVNMT0c6CiAgICAgICAgICAgIG1vZHVsZSA9ICdhbnNpYmxlLSVzJyAlIHNlbGYuX25hbWUKICAgICAgICAgICAgZmFjaWxpdHkgPSBnZXRhdHRyKHN5c2xvZywgc2VsZi5fc3lzbG9nX2ZhY2lsaXR5LCBzeXNsb2cuTE9HX1VTRVIpCiAgICAgICAgICAgIHN5c2xvZy5vcGVubG9nKHN0cihtb2R1bGUpLCAwLCBmYWNpbGl0eSkKICAgICAgICAgICAgc3lzbG9nLnN5c2xvZyhzeXNsb2cuTE9HX0lORk8sIG1zZykKCiAgICBkZWYgZGVidWcoc2VsZiwgbXNnKToKICAgICAgICBpZiBzZWxmLl9kZWJ1ZzoKICAgICAgICAgICAgc2VsZi5sb2coJ1tkZWJ1Z10gJXMnICUgbXNnKQoKICAgIGRlZiBsb2coc2VsZiwgbXNnLCBsb2dfYXJncz1Ob25lKToKCiAgICAgICAgaWYgbm90IHNlbGYubm9fbG9nOgoKICAgICAgICAgICAgaWYgbG9nX2FyZ3MgaXMgTm9uZToKICAgICAgICAgICAgICAgIGxvZ19hcmdzID0gZGljdCgpCgogICAgICAgICAgICBtb2R1bGUgPSAnYW5zaWJsZS0lcycgJSBzZWxmLl9uYW1lCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobW9kdWxlLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgICAgICAgICBtb2R1bGUgPSBtb2R1bGUuZGVjb2RlKCd1dGYtOCcsICdyZXBsYWNlJykKCiAgICAgICAgICAgICMgNjY1NSAtIGFsbG93IGZvciBhY2NlbnRlZCBjaGFyYWN0ZXJzCiAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG1zZywgKGJpbmFyeV90eXBlLCB0ZXh0X3R5cGUpKToKICAgICAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigibXNnIHNob3VsZCBiZSBhIHN0cmluZyAoZ290ICVzKSIgJSB0eXBlKG1zZykpCgogICAgICAgICAgICAjIFdlIHdhbnQgam91cm5hbCB0byBhbHdheXMgdGFrZSB0ZXh0IHR5cGUKICAgICAgICAgICAgIyBzeXNsb2cgdGFrZXMgYnl0ZXMgb24gcHkyLCB0ZXh0IHR5cGUgb24gcHkzCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UobXNnLCBiaW5hcnlfdHlwZSk6CiAgICAgICAgICAgICAgICBqb3VybmFsX21zZyA9IHJlbW92ZV92YWx1ZXMobXNnLmRlY29kZSgndXRmLTgnLCAncmVwbGFjZScpLCBzZWxmLm5vX2xvZ192YWx1ZXMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIFRPRE86IHN1cnJvZ2F0ZWVzY2FwZSBpcyBhIGRhbmdlciBoZXJlIG9uIFB5MwogICAgICAgICAgICAgICAgam91cm5hbF9tc2cgPSByZW1vdmVfdmFsdWVzKG1zZywgc2VsZi5ub19sb2dfdmFsdWVzKQoKICAgICAgICAgICAgaWYgUFkzOgogICAgICAgICAgICAgICAgc3lzbG9nX21zZyA9IGpvdXJuYWxfbXNnCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzeXNsb2dfbXNnID0gam91cm5hbF9tc2cuZW5jb2RlKCd1dGYtOCcsICdyZXBsYWNlJykKCiAgICAgICAgICAgIGlmIGhhc19qb3VybmFsOgogICAgICAgICAgICAgICAgam91cm5hbF9hcmdzID0gWygiTU9EVUxFIiwgb3MucGF0aC5iYXNlbmFtZShfX2ZpbGVfXykpXQogICAgICAgICAgICAgICAgZm9yIGFyZyBpbiBsb2dfYXJnczoKICAgICAgICAgICAgICAgICAgICBqb3VybmFsX2FyZ3MuYXBwZW5kKChhcmcudXBwZXIoKSwgc3RyKGxvZ19hcmdzW2FyZ10pKSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLnNlbmQodSIlcyAlcyIgJSAobW9kdWxlLCBqb3VybmFsX21zZyksICoqZGljdChqb3VybmFsX2FyZ3MpKQogICAgICAgICAgICAgICAgZXhjZXB0IElPRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgIyBmYWxsIGJhY2sgdG8gc3lzbG9nIHNpbmNlIGxvZ2dpbmcgdG8gam91cm5hbCBmYWlsZWQKICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2dfdG9fc3lzbG9nKHN5c2xvZ19tc2cpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLl9sb2dfdG9fc3lzbG9nKHN5c2xvZ19tc2cpCgogICAgZGVmIF9sb2dfaW52b2NhdGlvbihzZWxmKToKICAgICAgICAnJycgbG9nIHRoYXQgYW5zaWJsZSByYW4gdGhlIG1vZHVsZSAnJycKICAgICAgICAjIFRPRE86IGdlbmVyYWxpemUgYSBzZXBhcmF0ZSBsb2cgZnVuY3Rpb24gYW5kIG1ha2UgbG9nX2ludm9jYXRpb24gdXNlIGl0CiAgICAgICAgIyBTYW5pdGl6ZSBwb3NzaWJsZSBwYXNzd29yZCBhcmd1bWVudCB3aGVuIGxvZ2dpbmcuCiAgICAgICAgbG9nX2FyZ3MgPSBkaWN0KCkKCiAgICAgICAgZm9yIHBhcmFtIGluIHNlbGYucGFyYW1zOgogICAgICAgICAgICBjYW5vbiAgPSBzZWxmLmFsaWFzZXMuZ2V0KHBhcmFtLCBwYXJhbSkKICAgICAgICAgICAgYXJnX29wdHMgPSBzZWxmLmFyZ3VtZW50X3NwZWMuZ2V0KGNhbm9uLCB7fSkKICAgICAgICAgICAgbm9fbG9nID0gYXJnX29wdHMuZ2V0KCdub19sb2cnLCBGYWxzZSkKCiAgICAgICAgICAgIGlmIHNlbGYuYm9vbGVhbihub19sb2cpOgogICAgICAgICAgICAgICAgbG9nX2FyZ3NbcGFyYW1dID0gJ05PVF9MT0dHSU5HX1BBUkFNRVRFUicKICAgICAgICAgICAgIyB0cnkgdG8gY2FwdHVyZSBhbGwgcGFzc3dvcmRzL3Bhc3NwaHJhc2UgbmFtZWQgZmllbGRzIG1pc3NlZCBieSBub19sb2cKICAgICAgICAgICAgZWxpZiBQQVNTV09SRF9NQVRDSC5zZWFyY2gocGFyYW0pIGFuZCBcCiAgICAgICAgICAgICAgYXJnX29wdHMuZ2V0KCd0eXBlJywgJ3N0cicpICE9ICdib29sJyBhbmQgXAogICAgICAgICAgICAgIG5vdCBhcmdfb3B0cy5nZXQoJ2Nob2ljZXMnLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAjIHNraXAgYm9vbGVhbiBhbmQgZW51bXMgYXMgdGhleSBhcmUgYWJvdXQgJ3Bhc3N3b3JkJyBzdGF0ZQogICAgICAgICAgICAgICAgbG9nX2FyZ3NbcGFyYW1dID0gJ05PVF9MT0dHSU5HX1BBU1NXT1JEJwogICAgICAgICAgICAgICAgc2VsZi53YXJuKCdNb2R1bGUgZGlkIG5vdCBzZXQgbm9fbG9nIGZvciAlcycgJSBwYXJhbSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBhcmFtX3ZhbCA9IHNlbGYucGFyYW1zW3BhcmFtXQogICAgICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UocGFyYW1fdmFsLCAodGV4dF90eXBlLCBiaW5hcnlfdHlwZSkpOgogICAgICAgICAgICAgICAgICAgIHBhcmFtX3ZhbCA9IHN0cihwYXJhbV92YWwpCiAgICAgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UocGFyYW1fdmFsLCB0ZXh0X3R5cGUpOgogICAgICAgICAgICAgICAgICAgIHBhcmFtX3ZhbCA9IHBhcmFtX3ZhbC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgICAgIGxvZ19hcmdzW3BhcmFtXSA9IGhldXJpc3RpY19sb2dfc2FuaXRpemUocGFyYW1fdmFsLCBzZWxmLm5vX2xvZ192YWx1ZXMpCgogICAgICAgIG1zZyA9IFsnJXM9JXMnICUgKHRvX25hdGl2ZShhcmcpLCB0b19uYXRpdmUodmFsKSkgZm9yIGFyZywgdmFsIGluIGxvZ19hcmdzLml0ZW1zKCldCiAgICAgICAgaWYgbXNnOgogICAgICAgICAgICBtc2cgPSAnSW52b2tlZCB3aXRoICVzJyAlICcgJy5qb2luKG1zZykKICAgICAgICBlbHNlOgogICAgICAgICAgICBtc2cgPSAnSW52b2tlZCcKCiAgICAgICAgc2VsZi5sb2cobXNnLCBsb2dfYXJncz1sb2dfYXJncykKCgogICAgZGVmIF9zZXRfY3dkKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY3dkID0gb3MuZ2V0Y3dkKCkKICAgICAgICAgICAgaWYgbm90IG9zLmFjY2Vzcyhjd2QsIG9zLkZfT0t8b3MuUl9PSyk6CiAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oKQogICAgICAgICAgICByZXR1cm4gY3dkCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAjIHdlIGRvbid0IGhhdmUgYWNjZXNzIHRvIHRoZSBjd2QsIHByb2JhYmx5IGJlY2F1c2Ugb2Ygc3Vkby4KICAgICAgICAgICAgIyBUcnkgYW5kIG1vdmUgdG8gYSBuZXV0cmFsIGxvY2F0aW9uIHRvIHByZXZlbnQgZXJyb3JzCiAgICAgICAgICAgIGZvciBjd2QgaW4gW29zLnBhdGguZXhwYW5kdmFycygnJEhPTUUnKSwgdGVtcGZpbGUuZ2V0dGVtcGRpcigpXToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBvcy5hY2Nlc3MoY3dkLCBvcy5GX09LfG9zLlJfT0spOgogICAgICAgICAgICAgICAgICAgICAgICBvcy5jaGRpcihjd2QpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjd2QKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgIyB3ZSB3b24ndCBlcnJvciBoZXJlLCBhcyBpdCBtYXkgKm5vdCogYmUgYSBwcm9ibGVtLAogICAgICAgICMgYW5kIHdlIGRvbid0IHdhbnQgdG8gYnJlYWsgbW9kdWxlcyB1bm5lY2Vzc2FyaWx5CiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X2Jpbl9wYXRoKHNlbGYsIGFyZywgcmVxdWlyZWQ9RmFsc2UsIG9wdF9kaXJzPVtdKToKICAgICAgICAnJycKICAgICAgICBmaW5kIHN5c3RlbSBleGVjdXRhYmxlIGluIFBBVEguCiAgICAgICAgT3B0aW9uYWwgYXJndW1lbnRzOgogICAgICAgICAgIC0gcmVxdWlyZWQ6ICBpZiBleGVjdXRhYmxlIGlzIG5vdCBmb3VuZCBhbmQgcmVxdWlyZWQgaXMgdHJ1ZSwgZmFpbF9qc29uCiAgICAgICAgICAgLSBvcHRfZGlyczogIG9wdGlvbmFsIGxpc3Qgb2YgZGlyZWN0b3JpZXMgdG8gc2VhcmNoIGluIGFkZGl0aW9uIHRvIFBBVEgKICAgICAgICBpZiBmb3VuZCByZXR1cm4gZnVsbCBwYXRoOyBvdGhlcndpc2UgcmV0dXJuIE5vbmUKICAgICAgICAnJycKICAgICAgICBzYmluX3BhdGhzID0gWycvc2JpbicsICcvdXNyL3NiaW4nLCAnL3Vzci9sb2NhbC9zYmluJ10KICAgICAgICBwYXRocyA9IFtdCiAgICAgICAgZm9yIGQgaW4gb3B0X2RpcnM6CiAgICAgICAgICAgIGlmIGQgaXMgbm90IE5vbmUgYW5kIG9zLnBhdGguZXhpc3RzKGQpOgogICAgICAgICAgICAgICAgcGF0aHMuYXBwZW5kKGQpCiAgICAgICAgcGF0aHMgKz0gb3MuZW52aXJvbi5nZXQoJ1BBVEgnLCAnJykuc3BsaXQob3MucGF0aHNlcCkKICAgICAgICBiaW5fcGF0aCA9IE5vbmUKICAgICAgICAjIG1hbmdsZSBQQVRIIHRvIGluY2x1ZGUgL3NiaW4gZGlycwogICAgICAgIGZvciBwIGluIHNiaW5fcGF0aHM6CiAgICAgICAgICAgIGlmIHAgbm90IGluIHBhdGhzIGFuZCBvcy5wYXRoLmV4aXN0cyhwKToKICAgICAgICAgICAgICAgIHBhdGhzLmFwcGVuZChwKQogICAgICAgIGZvciBkIGluIHBhdGhzOgogICAgICAgICAgICBpZiBub3QgZDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHBhdGggPSBvcy5wYXRoLmpvaW4oZCwgYXJnKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKSBhbmQgbm90IG9zLnBhdGguaXNkaXIocGF0aCkgYW5kIGlzX2V4ZWN1dGFibGUocGF0aCk6CiAgICAgICAgICAgICAgICBiaW5fcGF0aCA9IHBhdGgKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgcmVxdWlyZWQgYW5kIGJpbl9wYXRoIGlzIE5vbmU6CiAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nRmFpbGVkIHRvIGZpbmQgcmVxdWlyZWQgZXhlY3V0YWJsZSAlcyBpbiBwYXRoczogJXMnICUgKGFyZywgb3MucGF0aHNlcC5qb2luKHBhdGhzKSkpCiAgICAgICAgcmV0dXJuIGJpbl9wYXRoCgogICAgZGVmIGJvb2xlYW4oc2VsZiwgYXJnKToKICAgICAgICAnJycgcmV0dXJuIGEgYm9vbCBmb3IgdGhlIGFyZyAnJycKICAgICAgICBpZiBhcmcgaXMgTm9uZSBvciBpc2luc3RhbmNlKGFyZywgYm9vbCk6CiAgICAgICAgICAgIHJldHVybiBhcmcKICAgICAgICBpZiBpc2luc3RhbmNlKGFyZywgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgYXJnID0gYXJnLmxvd2VyKCkKICAgICAgICBpZiBhcmcgaW4gQk9PTEVBTlNfVFJVRToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbGlmIGFyZyBpbiBCT09MRUFOU19GQUxTRToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSclcyBpcyBub3QgYSB2YWxpZCBib29sZWFuLiBWYWxpZCBib29sZWFucyBpbmNsdWRlOiAlcycgJSAodG9fdGV4dChhcmcpLCAnLCcuam9pbihbJyVzJyAlIHggZm9yIHggaW4gQk9PTEVBTlNdKSkpCgogICAgZGVmIGpzb25pZnkoc2VsZiwgZGF0YSk6CiAgICAgICAgZm9yIGVuY29kaW5nIGluICgidXRmLTgiLCAibGF0aW4tMSIpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhkYXRhLCBlbmNvZGluZz1lbmNvZGluZykKICAgICAgICAgICAgIyBPbGQgc3lzdGVtcyB1c2luZyBvbGQgc2ltcGxlanNvbiBtb2R1bGUgZG9lcyBub3Qgc3VwcG9ydCBlbmNvZGluZyBrZXl3b3JkLgogICAgICAgICAgICBleGNlcHQgVHlwZUVycm9yOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG5ld19kYXRhID0ganNvbl9kaWN0X2J5dGVzX3RvX3VuaWNvZGUoZGF0YSwgZW5jb2Rpbmc9ZW5jb2RpbmcpCiAgICAgICAgICAgICAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICByZXR1cm4ganNvbi5kdW1wcyhuZXdfZGF0YSkKICAgICAgICAgICAgZXhjZXB0IFVuaWNvZGVEZWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSdJbnZhbGlkIHVuaWNvZGUgZW5jb2RpbmcgZW5jb3VudGVyZWQnKQoKICAgIGRlZiBmcm9tX2pzb24oc2VsZiwgZGF0YSk6CiAgICAgICAgcmV0dXJuIGpzb24ubG9hZHMoZGF0YSkKCiAgICBkZWYgYWRkX2NsZWFudXBfZmlsZShzZWxmLCBwYXRoKToKICAgICAgICBpZiBwYXRoIG5vdCBpbiBzZWxmLmNsZWFudXBfZmlsZXM6CiAgICAgICAgICAgIHNlbGYuY2xlYW51cF9maWxlcy5hcHBlbmQocGF0aCkKCiAgICBkZWYgZG9fY2xlYW51cF9maWxlcyhzZWxmKToKICAgICAgICBmb3IgcGF0aCBpbiBzZWxmLmNsZWFudXBfZmlsZXM6CiAgICAgICAgICAgIHNlbGYuY2xlYW51cChwYXRoKQoKICAgIGRlZiBfcmV0dXJuX2Zvcm1hdHRlZChzZWxmLCBrd2FyZ3MpOgoKICAgICAgICBzZWxmLmFkZF9wYXRoX2luZm8oa3dhcmdzKQoKICAgICAgICBpZiAnaW52b2NhdGlvbicgbm90IGluIGt3YXJnczoKICAgICAgICAgICAga3dhcmdzWydpbnZvY2F0aW9uJ10gPSB7J21vZHVsZV9hcmdzJzogc2VsZi5wYXJhbXN9CgogICAgICAgIGlmICd3YXJuaW5ncycgaW4ga3dhcmdzOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGt3YXJnc1snd2FybmluZ3MnXSwgbGlzdCk6CiAgICAgICAgICAgICAgICBmb3IgdyBpbiBrd2FyZ3NbJ3dhcm5pbmdzJ106CiAgICAgICAgICAgICAgICAgICAgc2VsZi53YXJuKHcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLndhcm4oa3dhcmdzWyd3YXJuaW5ncyddKQoKICAgICAgICBpZiBzZWxmLl93YXJuaW5nczoKICAgICAgICAgICAga3dhcmdzWyd3YXJuaW5ncyddID0gc2VsZi5fd2FybmluZ3MKCiAgICAgICAgaWYgJ2RlcHJlY2F0aW9ucycgaW4ga3dhcmdzOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGt3YXJnc1snZGVwcmVjYXRpb25zJ10sIGxpc3QpOgogICAgICAgICAgICAgICAgZm9yIGQgaW4ga3dhcmdzWydkZXByZWNhdGlvbnMnXToKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGQsIFNFUVVFTkNFVFlQRSkgYW5kIGxlbihkKSA9PSAyOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRlcHJlY2F0ZShkWzBdLCB2ZXJzaW9uPWRbMV0pCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kZXByZWNhdGUoZCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuZGVwcmVjYXRlKGt3YXJnc1snZGVwcmVjYXRpb25zJ10pCgogICAgICAgIGlmIHNlbGYuX2RlcHJlY2F0aW9uczoKICAgICAgICAgICAga3dhcmdzWydkZXByZWNhdGlvbnMnXSA9IHNlbGYuX2RlcHJlY2F0aW9ucwoKICAgICAgICBrd2FyZ3MgPSByZW1vdmVfdmFsdWVzKGt3YXJncywgc2VsZi5ub19sb2dfdmFsdWVzKQogICAgICAgIHByaW50KCdcbiVzJyAlIHNlbGYuanNvbmlmeShrd2FyZ3MpKQoKICAgIGRlZiBleGl0X2pzb24oc2VsZiwgKiprd2FyZ3MpOgogICAgICAgICcnJyByZXR1cm4gZnJvbSB0aGUgbW9kdWxlLCB3aXRob3V0IGVycm9yICcnJwoKICAgICAgICBpZiBub3QgJ2NoYW5nZWQnIGluIGt3YXJnczoKICAgICAgICAgICAga3dhcmdzWydjaGFuZ2VkJ10gPSBGYWxzZQoKICAgICAgICBzZWxmLmRvX2NsZWFudXBfZmlsZXMoKQogICAgICAgIHNlbGYuX3JldHVybl9mb3JtYXR0ZWQoa3dhcmdzKQogICAgICAgIHN5cy5leGl0KDApCgogICAgZGVmIGZhaWxfanNvbihzZWxmLCAqKmt3YXJncyk6CiAgICAgICAgJycnIHJldHVybiBmcm9tIHRoZSBtb2R1bGUsIHdpdGggYW4gZXJyb3IgbWVzc2FnZSAnJycKCiAgICAgICAgYXNzZXJ0ICdtc2cnIGluIGt3YXJncywgImltcGxlbWVudGF0aW9uIGVycm9yIC0tIG1zZyB0byBleHBsYWluIHRoZSBlcnJvciBpcyByZXF1aXJlZCIKICAgICAgICBrd2FyZ3NbJ2ZhaWxlZCddID0gVHJ1ZQoKICAgICAgICBpZiBub3QgJ2NoYW5nZWQnIGluIGt3YXJnczoKICAgICAgICAgICAga3dhcmdzWydjaGFuZ2VkJ10gPSBGYWxzZQoKICAgICAgICBzZWxmLmRvX2NsZWFudXBfZmlsZXMoKQogICAgICAgIHNlbGYuX3JldHVybl9mb3JtYXR0ZWQoa3dhcmdzKQogICAgICAgIHN5cy5leGl0KDEpCgogICAgZGVmIGZhaWxfb25fbWlzc2luZ19wYXJhbXMoc2VsZiwgcmVxdWlyZWRfcGFyYW1zPU5vbmUpOgogICAgICAgICcnJyBUaGlzIGlzIGZvciBjaGVja2luZyBmb3IgcmVxdWlyZWQgcGFyYW1zIHdoZW4gd2UgY2FuIG5vdCBjaGVjayB2aWEgYXJnc3BlYyBiZWNhdXNlIHdlCiAgICAgICAgbmVlZCBtb3JlIGluZm9ybWF0aW9uIHRoYW4gaXMgc2ltcGx5IGdpdmVuIGluIHRoZSBhcmdzcGVjLgogICAgICAgICcnJwogICAgICAgIGlmIG5vdCByZXF1aXJlZF9wYXJhbXM6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIG1pc3NpbmdfcGFyYW1zID0gW10KICAgICAgICBmb3IgcmVxdWlyZWRfcGFyYW0gaW4gcmVxdWlyZWRfcGFyYW1zOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5wYXJhbXMuZ2V0KHJlcXVpcmVkX3BhcmFtKToKICAgICAgICAgICAgICAgIG1pc3NpbmdfcGFyYW1zLmFwcGVuZChyZXF1aXJlZF9wYXJhbSkKICAgICAgICBpZiBtaXNzaW5nX3BhcmFtczoKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJtaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50czogJXMiICUgJywnLmpvaW4obWlzc2luZ19wYXJhbXMpKQoKICAgIGRlZiBkaWdlc3RfZnJvbV9maWxlKHNlbGYsIGZpbGVuYW1lLCBhbGdvcml0aG0pOgogICAgICAgICcnJyBSZXR1cm4gaGV4IGRpZ2VzdCBvZiBsb2NhbCBmaWxlIGZvciBhIGRpZ2VzdF9tZXRob2Qgc3BlY2lmaWVkIGJ5IG5hbWUsIG9yIE5vbmUgaWYgZmlsZSBpcyBub3QgcHJlc2VudC4gJycnCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZpbGVuYW1lKToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKGZpbGVuYW1lKToKICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24obXNnPSJhdHRlbXB0ZWQgdG8gdGFrZSBjaGVja3N1bSBvZiBkaXJlY3Rvcnk6ICVzIiAlIGZpbGVuYW1lKQoKICAgICAgICAjIHByZXNlcnZlIG9sZCBiZWhhdmlvdXIgd2hlcmUgdGhlIHRoaXJkIHBhcmFtZXRlciB3YXMgYSBoYXNoIGFsZ29yaXRobSBvYmplY3QKICAgICAgICBpZiBoYXNhdHRyKGFsZ29yaXRobSwgJ2hleGRpZ2VzdCcpOgogICAgICAgICAgICBkaWdlc3RfbWV0aG9kID0gYWxnb3JpdGhtCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGlnZXN0X21ldGhvZCA9IEFWQUlMQUJMRV9IQVNIX0FMR09SSVRITVNbYWxnb3JpdGhtXSgpCiAgICAgICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iQ291bGQgbm90IGhhc2ggZmlsZSAnJXMnIHdpdGggYWxnb3JpdGhtICclcycuIEF2YWlsYWJsZSBhbGdvcml0aG1zOiAlcyIgJQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmaWxlbmFtZSwgYWxnb3JpdGhtLCAnLCAnLmpvaW4oQVZBSUxBQkxFX0hBU0hfQUxHT1JJVEhNUykpKQoKICAgICAgICBibG9ja3NpemUgPSA2NCAqIDEwMjQKICAgICAgICBpbmZpbGUgPSBvcGVuKG9zLnBhdGgucmVhbHBhdGgoZmlsZW5hbWUpLCAncmInKQogICAgICAgIGJsb2NrID0gaW5maWxlLnJlYWQoYmxvY2tzaXplKQogICAgICAgIHdoaWxlIGJsb2NrOgogICAgICAgICAgICBkaWdlc3RfbWV0aG9kLnVwZGF0ZShibG9jaykKICAgICAgICAgICAgYmxvY2sgPSBpbmZpbGUucmVhZChibG9ja3NpemUpCiAgICAgICAgaW5maWxlLmNsb3NlKCkKICAgICAgICByZXR1cm4gZGlnZXN0X21ldGhvZC5oZXhkaWdlc3QoKQoKICAgIGRlZiBtZDUoc2VsZiwgZmlsZW5hbWUpOgogICAgICAgICcnJyBSZXR1cm4gTUQ1IGhleCBkaWdlc3Qgb2YgbG9jYWwgZmlsZSB1c2luZyBkaWdlc3RfZnJvbV9maWxlKCkuCgogICAgICAgIERvIG5vdCB1c2UgdGhpcyBmdW5jdGlvbiB1bmxlc3MgeW91IGhhdmUgbm8gb3RoZXIgY2hvaWNlIGZvcjoKICAgICAgICAgICAgMSkgT3B0aW9uYWwgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKICAgICAgICAgICAgMikgQ29tcGF0aWJpbGl0eSB3aXRoIGEgdGhpcmQgcGFydHkgcHJvdG9jb2wKCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3aWxsIG5vdCB3b3JrIG9uIHN5c3RlbXMgY29tcGx5aW5nIHdpdGggRklQUy0xNDAtMi4KCiAgICAgICAgTW9zdCB1c2VzIG9mIHRoaXMgZnVuY3Rpb24gY2FuIHVzZSB0aGUgbW9kdWxlLnNoYTEgZnVuY3Rpb24gaW5zdGVhZC4KICAgICAgICAnJycKICAgICAgICBpZiAnbWQ1JyBub3QgaW4gQVZBSUxBQkxFX0hBU0hfQUxHT1JJVEhNUzoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignTUQ1IG5vdCBhdmFpbGFibGUuICBQb3NzaWJseSBydW5uaW5nIGluIEZJUFMgbW9kZScpCiAgICAgICAgcmV0dXJuIHNlbGYuZGlnZXN0X2Zyb21fZmlsZShmaWxlbmFtZSwgJ21kNScpCgogICAgZGVmIHNoYTEoc2VsZiwgZmlsZW5hbWUpOgogICAgICAgICcnJyBSZXR1cm4gU0hBMSBoZXggZGlnZXN0IG9mIGxvY2FsIGZpbGUgdXNpbmcgZGlnZXN0X2Zyb21fZmlsZSgpLiAnJycKICAgICAgICByZXR1cm4gc2VsZi5kaWdlc3RfZnJvbV9maWxlKGZpbGVuYW1lLCAnc2hhMScpCgogICAgZGVmIHNoYTI1NihzZWxmLCBmaWxlbmFtZSk6CiAgICAgICAgJycnIFJldHVybiBTSEEtMjU2IGhleCBkaWdlc3Qgb2YgbG9jYWwgZmlsZSB1c2luZyBkaWdlc3RfZnJvbV9maWxlKCkuICcnJwogICAgICAgIHJldHVybiBzZWxmLmRpZ2VzdF9mcm9tX2ZpbGUoZmlsZW5hbWUsICdzaGEyNTYnKQoKICAgIGRlZiBiYWNrdXBfbG9jYWwoc2VsZiwgZm4pOgogICAgICAgICcnJ21ha2UgYSBkYXRlLW1hcmtlZCBiYWNrdXAgb2YgdGhlIHNwZWNpZmllZCBmaWxlLCByZXR1cm4gVHJ1ZSBvciBGYWxzZSBvbiBzdWNjZXNzIG9yIGZhaWx1cmUnJycKCiAgICAgICAgYmFja3VwZGVzdCA9ICcnCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZm4pOgogICAgICAgICAgICAjIGJhY2t1cHMgbmFtZWQgYmFzZW5hbWUuUElELllZWVktTU0tRERASEg6TU06U1N+CiAgICAgICAgICAgIGV4dCA9IHRpbWUuc3RyZnRpbWUoIiVZLSVtLSVkQCVIOiVNOiVTfiIsIHRpbWUubG9jYWx0aW1lKHRpbWUudGltZSgpKSkKICAgICAgICAgICAgYmFja3VwZGVzdCA9ICclcy4lcy4lcycgJSAoZm4sIG9zLmdldHBpZCgpLCBleHQpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzaHV0aWwuY29weTIoZm4sIGJhY2t1cGRlc3QpCiAgICAgICAgICAgIGV4Y2VwdCAoc2h1dGlsLkVycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nQ291bGQgbm90IG1ha2UgYmFja3VwIG9mICVzIHRvICVzOiAlcycgJSAoZm4sIGJhY2t1cGRlc3QsIGUpKQoKICAgICAgICByZXR1cm4gYmFja3VwZGVzdAoKICAgIGRlZiBjbGVhbnVwKHNlbGYsIHRtcGZpbGUpOgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHRtcGZpbGUpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvcy51bmxpbmsodG1wZmlsZSkKICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKCJjb3VsZCBub3QgY2xlYW51cCAlczogJXMiICUgKHRtcGZpbGUsIGUpKQoKICAgIGRlZiBhdG9taWNfbW92ZShzZWxmLCBzcmMsIGRlc3QsIHVuc2FmZV93cml0ZXM9RmFsc2UpOgogICAgICAgICcnJ2F0b21pY2FsbHkgbW92ZSBzcmMgdG8gZGVzdCwgY29weWluZyBhdHRyaWJ1dGVzIGZyb20gZGVzdCwgcmV0dXJucyB0cnVlIG9uIHN1Y2Nlc3MKICAgICAgICBpdCB1c2VzIG9zLnJlbmFtZSB0byBlbnN1cmUgdGhpcyBhcyBpdCBpcyBhbiBhdG9taWMgb3BlcmF0aW9uLCByZXN0IG9mIHRoZSBmdW5jdGlvbiBpcwogICAgICAgIHRvIHdvcmsgYXJvdW5kIGxpbWl0YXRpb25zLCBjb3JuZXIgY2FzZXMgYW5kIGVuc3VyZSBzZWxpbnV4IGNvbnRleHQgaXMgc2F2ZWQgaWYgcG9zc2libGUnJycKICAgICAgICBjb250ZXh0ID0gTm9uZQogICAgICAgIGRlc3Rfc3RhdCA9IE5vbmUKICAgICAgICBiX3NyYyA9IHRvX2J5dGVzKHNyYywgZXJyb3JzPSdzdXJyb2dhdGVfb3Jfc3RyaWN0JykKICAgICAgICBiX2Rlc3QgPSB0b19ieXRlcyhkZXN0LCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGJfZGVzdCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc3Rfc3RhdCA9IG9zLnN0YXQoYl9kZXN0KQoKICAgICAgICAgICAgICAgICMgY29weSBtb2RlIGFuZCBvd25lcnNoaXAKICAgICAgICAgICAgICAgIG9zLmNobW9kKGJfc3JjLCBkZXN0X3N0YXQuc3RfbW9kZSAmIFBFUk1fQklUUykKICAgICAgICAgICAgICAgIG9zLmNob3duKGJfc3JjLCBkZXN0X3N0YXQuc3RfdWlkLCBkZXN0X3N0YXQuc3RfZ2lkKQoKICAgICAgICAgICAgICAgICMgdHJ5IHRvIGNvcHkgZmxhZ3MgaWYgcG9zc2libGUKICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIob3MsICdjaGZsYWdzJykgYW5kIGhhc2F0dHIoZGVzdF9zdGF0LCAnc3RfZmxhZ3MnKToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLmNoZmxhZ3MoYl9zcmMsIGRlc3Rfc3RhdC5zdF9mbGFncykKICAgICAgICAgICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZXJyIGluICdFT1BOT1RTVVBQJywgJ0VOT1RTVVAnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGFzYXR0cihlcnJubywgZXJyKSBhbmQgZS5lcnJubyA9PSBnZXRhdHRyKGVycm5vLCBlcnIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGUuZXJybm8gIT0gZXJybm8uRVBFUk06CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgaWYgc2VsZi5zZWxpbnV4X2VuYWJsZWQoKToKICAgICAgICAgICAgICAgIGNvbnRleHQgPSBzZWxmLnNlbGludXhfY29udGV4dChkZXN0KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gc2VsZi5zZWxpbnV4X2RlZmF1bHRfY29udGV4dChkZXN0KQoKICAgICAgICBjcmVhdGluZyA9IG5vdCBvcy5wYXRoLmV4aXN0cyhiX2Rlc3QpCgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBPcHRpbWlzdGljYWxseSB0cnkgYSByZW5hbWUsIHNvbHZlcyBzb21lIGNvcm5lciBjYXNlcyBhbmQgY2FuIGF2b2lkIHVzZWxlc3Mgd29yaywgdGhyb3dzIGV4Y2VwdGlvbiBpZiBub3QgYXRvbWljLgogICAgICAgICAgICBvcy5yZW5hbWUoYl9zcmMsIGJfZGVzdCkKICAgICAgICBleGNlcHQgKElPRXJyb3IsIE9TRXJyb3IpOgogICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgIGlmIGUuZXJybm8gbm90IGluIFtlcnJuby5FUEVSTSwgZXJybm8uRVhERVYsIGVycm5vLkVBQ0NFUywgZXJybm8uRVRYVEJTWSwgZXJybm8uRUJVU1ldOgogICAgICAgICAgICAgICAgIyBvbmx5IHRyeSB3b3JrYXJvdW5kcyBmb3IgZXJybm8gMTggKGNyb3NzIGRldmljZSksIDEgKG5vdCBwZXJtaXR0ZWQpLCAgMTMgKHBlcm1pc3Npb24gZGVuaWVkKQogICAgICAgICAgICAgICAgIyBhbmQgMjYgKHRleHQgZmlsZSBidXN5KSB3aGljaCBoYXBwZW5zIG9uIHZhZ3JhbnQgc3luY2VkIGZvbGRlcnMgYW5kIG90aGVyICdleG90aWMnIG5vbiBwb3NpeCBmaWxlIHN5c3RlbXMKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nQ291bGQgbm90IHJlcGxhY2UgZmlsZTogJXMgdG8gJXM6ICVzJyAlIChzcmMsIGRlc3QsIGUpLCBleGNlcHRpb249dHJhY2ViYWNrLmZvcm1hdF9leGMoKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGJfZGVzdF9kaXIgPSBvcy5wYXRoLmRpcm5hbWUoYl9kZXN0KQogICAgICAgICAgICAgICAgIyBVc2UgYnl0ZXMgaGVyZS4gIEluIHRoZSBzaGlwcGFibGUgQ0ksIHRoaXMgZmFpbHMgd2l0aAogICAgICAgICAgICAgICAgIyBhIFVuaWNvZGVFcnJvciB3aXRoIHN1cnJvZ2F0ZWVzY2FwZSdkIHN0cmluZ3MgZm9yIGFuIHVua25vd24KICAgICAgICAgICAgICAgICMgcmVhc29uIChkb2Vzbid0IGhhcHBlbiBpbiBhIGxvY2FsIFVidW50dTE2LjA0IFZNKQogICAgICAgICAgICAgICAgbmF0aXZlX2Rlc3RfZGlyID0gYl9kZXN0X2RpcgogICAgICAgICAgICAgICAgbmF0aXZlX3N1ZmZpeCA9IG9zLnBhdGguYmFzZW5hbWUoYl9kZXN0KQogICAgICAgICAgICAgICAgbmF0aXZlX3ByZWZpeCA9IGIoJy5hbnNpYmxlX3RtcCcpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgdG1wX2Rlc3RfZmQsIHRtcF9kZXN0X25hbWUgPSB0ZW1wZmlsZS5ta3N0ZW1wKCBwcmVmaXg9bmF0aXZlX3ByZWZpeCwgZGlyPW5hdGl2ZV9kZXN0X2Rpciwgc3VmZml4PW5hdGl2ZV9zdWZmaXgpCiAgICAgICAgICAgICAgICBleGNlcHQgKE9TRXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J1RoZSBkZXN0aW5hdGlvbiBkaXJlY3RvcnkgKCVzKSBpcyBub3Qgd3JpdGFibGUgYnkgdGhlIGN1cnJlbnQgdXNlci4gRXJyb3Igd2FzOiAlcycgJSAob3MucGF0aC5kaXJuYW1lKGRlc3QpLCBlKSkKICAgICAgICAgICAgICAgIGV4Y2VwdCBUeXBlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgIyBXZSBleHBlY3QgdGhhdCB0aGlzIGlzIGhhcHBlbmluZyBiZWNhdXNlIHB5dGhvbjMuNC54IGFuZAogICAgICAgICAgICAgICAgICAgICMgYmVsb3cgY2FuJ3QgaGFuZGxlIGJ5dGUgc3RyaW5ncyBpbiBta3N0ZW1wKCkuICBUcmFjZWJhY2sKICAgICAgICAgICAgICAgICAgICAjIHdvdWxkIGVuZCBpbiBzb21ldGhpbmcgbGlrZToKICAgICAgICAgICAgICAgICAgICAjICAgICBmaWxlID0gX29zLnBhdGguam9pbihkaXIsIHByZSArIG5hbWUgKyBzdWYpCiAgICAgICAgICAgICAgICAgICAgIyBUeXBlRXJyb3I6IGNhbid0IGNvbmNhdCBieXRlcyB0byBzdHIKICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0ZhaWxlZCBjcmVhdGluZyB0ZW1wIGZpbGUgZm9yIGF0b21pYyBtb3ZlLiAgVGhpcyB1c3VhbGx5IGhhcHBlbnMgd2hlbiB1c2luZyBQeXRob24zIGxlc3MgdGhhbiBQeXRob24zLjUuICcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSB1c2UgUHl0aG9uMi54IG9yIFB5dGhvbjMuNSBvciBncmVhdGVyLicsIGV4Y2VwdGlvbj10cmFjZWJhY2suZm9ybWF0X2V4YygpKQoKICAgICAgICAgICAgICAgIGJfdG1wX2Rlc3RfbmFtZSA9IHRvX2J5dGVzKHRtcF9kZXN0X25hbWUsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyBjbG9zZSB0bXAgZmlsZSBoYW5kbGUgYmVmb3JlIGZpbGUgb3BlcmF0aW9ucyB0byBwcmV2ZW50IHRleHQgZmlsZSBidXN5IGVycm9ycyBvbiB2Ym94ZnMgc3luY2VkIGZvbGRlcnMgKHdpbmRvd3MgaG9zdCkKICAgICAgICAgICAgICAgICAgICAgICAgb3MuY2xvc2UodG1wX2Rlc3RfZmQpCiAgICAgICAgICAgICAgICAgICAgICAgICMgbGVhdmVzIHRtcCBmaWxlIGJlaGluZCB3aGVuIHN1ZG8gYW5kIG5vdCByb290CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNodXRpbC5tb3ZlKGJfc3JjLCBiX3RtcF9kZXN0X25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBPU0Vycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjbGVhbnVwIHdpbGwgaGFwcGVuIGJ5ICdybScgb2YgdGVtcGRpcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjb3B5MiB3aWxsIHByZXNlcnZlIHNvbWUgbWV0YWRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5MihiX3NyYywgYl90bXBfZGVzdF9uYW1lKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5zZWxpbnV4X2VuYWJsZWQoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0X2NvbnRleHRfaWZfZGlmZmVyZW50KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJfdG1wX2Rlc3RfbmFtZSwgY29udGV4dCwgRmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcF9zdGF0ID0gb3Muc3RhdChiX3RtcF9kZXN0X25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXN0X3N0YXQgYW5kICh0bXBfc3RhdC5zdF91aWQgIT0gZGVzdF9zdGF0LnN0X3VpZCBvciB0bXBfc3RhdC5zdF9naWQgIT0gZGVzdF9zdGF0LnN0X2dpZCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MuY2hvd24oYl90bXBfZGVzdF9uYW1lLCBkZXN0X3N0YXQuc3RfdWlkLCBkZXN0X3N0YXQuc3RfZ2lkKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGUuZXJybm8gIT0gZXJybm8uRVBFUk06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVuYW1lKGJfdG1wX2Rlc3RfbmFtZSwgYl9kZXN0KQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgKHNodXRpbC5FcnJvciwgT1NFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB1bnNhZmVfd3JpdGVzIGFuZCBlLmVycm5vID09IGVycm5vLkVCVVNZOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX3Vuc2FmZV93cml0ZXMoYl90bXBfZGVzdF9uYW1lLCBiX2Rlc3QpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0nVW5hYmxlIHRvIHJlbmFtZSBmaWxlOiAlcyB0byAlczogJXMnICUgKHNyYywgZGVzdCwgZSksIGV4Y2VwdGlvbj10cmFjZWJhY2suZm9ybWF0X2V4YygpKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoc2h1dGlsLkVycm9yLCBPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0ZhaWxlZCB0byByZXBsYWNlIGZpbGU6ICVzIHRvICVzOiAlcycgJSAoc3JjLCBkZXN0LCBlKSwgZXhjZXB0aW9uPXRyYWNlYmFjay5mb3JtYXRfZXhjKCkpCiAgICAgICAgICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAgICAgICAgIHNlbGYuY2xlYW51cChiX3RtcF9kZXN0X25hbWUpCgogICAgICAgIGlmIGNyZWF0aW5nOgogICAgICAgICAgICAjIG1ha2Ugc3VyZSB0aGUgZmlsZSBoYXMgdGhlIGNvcnJlY3QgcGVybWlzc2lvbnMKICAgICAgICAgICAgIyBiYXNlZCBvbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB1bWFzawogICAgICAgICAgICB1bWFzayA9IG9zLnVtYXNrKDApCiAgICAgICAgICAgIG9zLnVtYXNrKHVtYXNrKQogICAgICAgICAgICBvcy5jaG1vZChiX2Rlc3QsIERFRkFVTFRfUEVSTSAmIH51bWFzaykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MuY2hvd24oYl9kZXN0LCBvcy5nZXRldWlkKCksIG9zLmdldGVnaWQoKSkKICAgICAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgICAgICAjIFdlJ3JlIG9rYXkgd2l0aCB0cnlpbmcgb3VyIGJlc3QgaGVyZS4gIElmIHRoZSB1c2VyIGlzIG5vdAogICAgICAgICAgICAgICAgIyByb290IChvciBvbGQgVW5pY2VzKSB0aGV5IHdvbid0IGJlIGFibGUgdG8gY2hvd24uCiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIGlmIHNlbGYuc2VsaW51eF9lbmFibGVkKCk6CiAgICAgICAgICAgICMgcmVuYW1lIG1pZ2h0IG5vdCBwcmVzZXJ2ZSBjb250ZXh0CiAgICAgICAgICAgIHNlbGYuc2V0X2NvbnRleHRfaWZfZGlmZmVyZW50KGRlc3QsIGNvbnRleHQsIEZhbHNlKQoKICAgIGRlZiBfdW5zYWZlX3dyaXRlcyhzZWxmLCBzcmMsIGRlc3QpOgogICAgICAgICMgc2FkbHkgdGhlcmUgYXJlIHNvbWUgc2l0dWF0aW9ucyB3aGVyZSB3ZSBjYW5ub3QgZW5zdXJlIGF0b21pY2l0eSwgYnV0IG9ubHkgaWYKICAgICAgICAjIHRoZSB1c2VyIGluc2lzdHMgYW5kIHdlIGdldCB0aGUgYXBwcm9wcmlhdGUgZXJyb3Igd2UgdXBkYXRlIHRoZSBmaWxlIHVuc2FmZWx5CiAgICAgICAgdHJ5OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBvdXRfZGVzdCA9IG9wZW4oZGVzdCwgJ3diJykKICAgICAgICAgICAgICAgIGluX3NyYyA9IG9wZW4oc3JjLCAncmInKQogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlb2JqKGluX3NyYywgb3V0X2Rlc3QpCiAgICAgICAgICAgIGZpbmFsbHk6ICAjIGFzc3VyaW5nIGNsb3NlZCBmaWxlcyBpbiAyLjQgY29tcGF0aWJsZSB3YXkKICAgICAgICAgICAgICAgIGlmIG91dF9kZXN0OgogICAgICAgICAgICAgICAgICAgIG91dF9kZXN0LmNsb3NlKCkKICAgICAgICAgICAgICAgIGlmIGluX3NyYzoKICAgICAgICAgICAgICAgICAgICBpbl9zcmMuY2xvc2UoKQogICAgICAgIGV4Y2VwdCAoc2h1dGlsLkVycm9yLCBPU0Vycm9yLCBJT0Vycm9yKToKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihtc2c9J0NvdWxkIG5vdCB3cml0ZSBkYXRhIHRvIGZpbGUgKCVzKSBmcm9tICglcyk6ICVzJyAlIChkZXN0LCBzcmMsIGUpLCBleGNlcHRpb249dHJhY2ViYWNrLmZvcm1hdF9leGMoKSkKCgogICAgZGVmIF9yZWFkX2Zyb21fcGlwZXMoc2VsZiwgcnBpcGVzLCByZmRzLCBmaWxlX2Rlc2NyaXB0b3IpOgogICAgICAgIGRhdGEgPSBiKCcnKQogICAgICAgIGlmIGZpbGVfZGVzY3JpcHRvciBpbiByZmRzOgogICAgICAgICAgICBkYXRhID0gb3MucmVhZChmaWxlX2Rlc2NyaXB0b3IuZmlsZW5vKCksIDkwMDApCiAgICAgICAgICAgIGlmIGRhdGEgPT0gYignJyk6CiAgICAgICAgICAgICAgICBycGlwZXMucmVtb3ZlKGZpbGVfZGVzY3JpcHRvcikKCiAgICAgICAgcmV0dXJuIGRhdGEKCiAgICBkZWYgcnVuX2NvbW1hbmQoc2VsZiwgYXJncywgY2hlY2tfcmM9RmFsc2UsIGNsb3NlX2Zkcz1UcnVlLCBleGVjdXRhYmxlPU5vbmUsIGRhdGE9Tm9uZSwgYmluYXJ5X2RhdGE9RmFsc2UsIHBhdGhfcHJlZml4PU5vbmUsIGN3ZD1Ob25lLAogICAgICAgICAgICAgICAgICAgIHVzZV91bnNhZmVfc2hlbGw9RmFsc2UsIHByb21wdF9yZWdleD1Ob25lLCBlbnZpcm9uX3VwZGF0ZT1Ob25lLCB1bWFzaz1Ob25lLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKToKICAgICAgICAnJycKICAgICAgICBFeGVjdXRlIGEgY29tbWFuZCwgcmV0dXJucyByYywgc3Rkb3V0LCBhbmQgc3RkZXJyLgoKICAgICAgICA6YXJnIGFyZ3M6IGlzIHRoZSBjb21tYW5kIHRvIHJ1bgogICAgICAgICAgICAqIElmIGFyZ3MgaXMgYSBsaXN0LCB0aGUgY29tbWFuZCB3aWxsIGJlIHJ1biB3aXRoIHNoZWxsPUZhbHNlLgogICAgICAgICAgICAqIElmIGFyZ3MgaXMgYSBzdHJpbmcgYW5kIHVzZV91bnNhZmVfc2hlbGw9RmFsc2UgaXQgd2lsbCBzcGxpdCBhcmdzIHRvIGEgbGlzdCBhbmQgcnVuIHdpdGggc2hlbGw9RmFsc2UKICAgICAgICAgICAgKiBJZiBhcmdzIGlzIGEgc3RyaW5nIGFuZCB1c2VfdW5zYWZlX3NoZWxsPVRydWUgaXQgcnVucyB3aXRoIHNoZWxsPVRydWUuCiAgICAgICAgOmt3IGNoZWNrX3JjOiBXaGV0aGVyIHRvIGNhbGwgZmFpbF9qc29uIGluIGNhc2Ugb2Ygbm9uIHplcm8gUkMuCiAgICAgICAgICAgIERlZmF1bHQgRmFsc2UKICAgICAgICA6a3cgY2xvc2VfZmRzOiBTZWUgZG9jdW1lbnRhdGlvbiBmb3Igc3VicHJvY2Vzcy5Qb3BlbigpLiBEZWZhdWx0IFRydWUKICAgICAgICA6a3cgZXhlY3V0YWJsZTogU2VlIGRvY3VtZW50YXRpb24gZm9yIHN1YnByb2Nlc3MuUG9wZW4oKS4gRGVmYXVsdCBOb25lCiAgICAgICAgOmt3IGRhdGE6IElmIGdpdmVuLCBpbmZvcm1hdGlvbiB0byB3cml0ZSB0byB0aGUgc3RkaW4gb2YgdGhlIGNvbW1hbmQKICAgICAgICA6a3cgYmluYXJ5X2RhdGE6IElmIEZhbHNlLCBhcHBlbmQgYSBuZXdsaW5lIHRvIHRoZSBkYXRhLiAgRGVmYXVsdCBGYWxzZQogICAgICAgIDprdyBwYXRoX3ByZWZpeDogSWYgZ2l2ZW4sIGFkZGl0aW9uYWwgcGF0aCB0byBmaW5kIHRoZSBjb21tYW5kIGluLgogICAgICAgICAgICBUaGlzIGFkZHMgdG8gdGhlIFBBVEggZW52aXJvbm1lbnQgdmFpcmFibGUgc28gaGVscGVyIGNvbW1hbmRzIGluCiAgICAgICAgICAgIHRoZSBzYW1lIGRpcmVjdG9yeSBjYW4gYWxzbyBiZSBmb3VuZAogICAgICAgIDprdyBjd2Q6IElmIGdpdmVuLCB3b3JraW5nIGRpcmVjdG9yeSB0byBydW4gdGhlIGNvbW1hbmQgaW5zaWRlCiAgICAgICAgOmt3IHVzZV91bnNhZmVfc2hlbGw6IFNlZSBgYXJnc2AgcGFyYW1ldGVyLiAgRGVmYXVsdCBGYWxzZQogICAgICAgIDprdyBwcm9tcHRfcmVnZXg6IFJlZ2V4IHN0cmluZyAobm90IGEgY29tcGlsZWQgcmVnZXgpIHdoaWNoIGNhbiBiZQogICAgICAgICAgICB1c2VkIHRvIGRldGVjdCBwcm9tcHRzIGluIHRoZSBzdGRvdXQgd2hpY2ggd291bGQgb3RoZXJ3aXNlIGNhdXNlCiAgICAgICAgICAgIHRoZSBleGVjdXRpb24gdG8gaGFuZyAoZXNwZWNpYWxseSBpZiBubyBpbnB1dCBkYXRhIGlzIHNwZWNpZmllZCkKICAgICAgICA6a3cgZW52aXJvbl91cGRhdGU6IGRpY3Rpb25hcnkgdG8gKnVwZGF0ZSogb3MuZW52aXJvbiB3aXRoCiAgICAgICAgOmt3IHVtYXNrOiBVbWFzayB0byBiZSB1c2VkIHdoZW4gcnVubmluZyB0aGUgY29tbWFuZC4gRGVmYXVsdCBOb25lCiAgICAgICAgOmt3IGVuY29kaW5nOiBTaW5jZSB3ZSByZXR1cm4gbmF0aXZlIHN0cmluZ3MsIG9uIHB5dGhvbjMgd2UgbmVlZCB0bwogICAgICAgICAgICBrbm93IHRoZSBlbmNvZGluZyB0byB1c2UgdG8gdHJhbnNmb3JtIGZyb20gYnl0ZXMgdG8gdGV4dC4gIElmIHlvdQogICAgICAgICAgICB3YW50IHRvIGFsd2F5cyBnZXQgYnl0ZXMgYmFjaywgdXNlIGVuY29kaW5nPU5vbmUuICBUaGUgZGVmYXVsdCBpcwogICAgICAgICAgICAidXRmLTgiLiAgVGhpcyBkb2VzIG5vdCBhZmZlY3QgdHJhbnNmb3JtYXRpb24gb2Ygc3RyaW5ncyBnaXZlbiBhcwogICAgICAgICAgICBhcmdzLgogICAgICAgIDprdyBlcnJvcnM6IFNpbmNlIHdlIHJldHVybiBuYXRpdmUgc3RyaW5ncywgb24gcHl0aG9uMyB3ZSBuZWVkIHRvCiAgICAgICAgICAgIHRyYW5zZm9ybSBzdGRvdXQgYW5kIHN0ZGVyciBmcm9tIGJ5dGVzIHRvIHRleHQuICBJZiB0aGUgYnl0ZXMgYXJlCiAgICAgICAgICAgIHVuZGVjb2RhYmxlIGluIHRoZSBgYGVuY29kaW5nYGAgc3BlY2lmaWVkLCB0aGVuIHVzZSB0aGlzIGVycm9yCiAgICAgICAgICAgIGhhbmRsZXIgdG8gZGVhbCB3aXRoIHRoZW0uICBUaGUgZGVmYXVsdCBpcyBgYHN1cnJvZ2F0ZV9vcl9zdHJpY3RgYAogICAgICAgICAgICB3aGljaCBtZWFucyB0aGF0IHRoZSBieXRlcyB3aWxsIGJlIGRlY29kZWQgdXNpbmcgdGhlCiAgICAgICAgICAgIHN1cnJvZ2F0ZWVzY2FwZSBlcnJvciBoYW5kbGVyIGlmIGF2YWlsYWJsZSAoYXZhaWxhYmxlIG9uIGFsbAogICAgICAgICAgICBweXRob24zIHZlcnNpb25zIHdlIHN1cHBvcnQpIG90aGVyd2lzZSBhIFVuaWNvZGVFcnJvciB0cmFjZWJhY2sKICAgICAgICAgICAgd2lsbCBiZSByYWlzZWQuICBUaGlzIGRvZXMgbm90IGFmZmVjdCB0cmFuc2Zvcm1hdGlvbnMgb2Ygc3RyaW5ncwogICAgICAgICAgICBnaXZlbiBhcyBhcmdzLgogICAgICAgIDpyZXR1cm5zOiBBIDMtdHVwbGUgb2YgcmV0dXJuIGNvZGUgKGludGVnZXIpLCBzdGRvdXQgKG5hdGl2ZSBzdHJpbmcpLAogICAgICAgICAgICBhbmQgc3RkZXJyIChuYXRpdmUgc3RyaW5nKS4gIE9uIHB5dGhvbjIsIHN0ZG91dCBhbmQgc3RkZXJyIGFyZSBib3RoCiAgICAgICAgICAgIGJ5dGUgc3RyaW5ncy4gIE9uIHB5dGhvbjMsIHN0ZG91dCBhbmQgc3RkZXJyIGFyZSB0ZXh0IHN0cmluZ3MgY29udmVydGVkCiAgICAgICAgICAgIGFjY29yZGluZyB0byB0aGUgZW5jb2RpbmcgYW5kIGVycm9ycyBwYXJhbWV0ZXJzLiAgSWYgeW91IHdhbnQgYnl0ZQogICAgICAgICAgICBzdHJpbmdzIG9uIHB5dGhvbjMsIHVzZSBlbmNvZGluZz1Ob25lIHRvIHR1cm4gZGVjb2RpbmcgdG8gdGV4dCBvZmYuCiAgICAgICAgJycnCgogICAgICAgIGlmIGlzaW5zdGFuY2UoYXJncywgbGlzdCk6CiAgICAgICAgICAgIGlmIHVzZV91bnNhZmVfc2hlbGw6CiAgICAgICAgICAgICAgICBhcmdzID0gIiAiLmpvaW4oW3NobGV4X3F1b3RlKHgpIGZvciB4IGluIGFyZ3NdKQogICAgICAgICAgICAgICAgc2hlbGwgPSBUcnVlCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGFyZ3MsIChiaW5hcnlfdHlwZSwgdGV4dF90eXBlKSkgYW5kIHVzZV91bnNhZmVfc2hlbGw6CiAgICAgICAgICAgIHNoZWxsID0gVHJ1ZQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShhcmdzLCAoYmluYXJ5X3R5cGUsIHRleHRfdHlwZSkpOgogICAgICAgICAgICBpZiBub3QgdXNlX3Vuc2FmZV9zaGVsbDoKICAgICAgICAgICAgICAgICMgT24gcHl0aG9uMi42IGFuZCBiZWxvdywgc2hsZXggaGFzIHByb2JsZW1zIHdpdGggdGV4dCB0eXBlCiAgICAgICAgICAgICAgICAjIE9uIHB5dGhvbjMsIHNobGV4IG5lZWRzIGEgdGV4dCB0eXBlLgogICAgICAgICAgICAgICAgaWYgUFkyOgogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSB0b19ieXRlcyhhcmdzLCBlcnJvcnM9J3N1cnJvZ2F0ZV9vcl9zdHJpY3QnKQogICAgICAgICAgICAgICAgZWxpZiBQWTM6CiAgICAgICAgICAgICAgICAgICAgYXJncyA9IHRvX3RleHQoYXJncywgZXJyb3JzPSdzdXJyb2dhdGVlc2NhcGUnKQogICAgICAgICAgICAgICAgYXJncyA9IHNobGV4LnNwbGl0KGFyZ3MpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbXNnID0gIkFyZ3VtZW50ICdhcmdzJyB0byBydW5fY29tbWFuZCBtdXN0IGJlIGxpc3Qgb3Igc3RyaW5nIgogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihyYz0yNTcsIGNtZD1hcmdzLCBtc2c9bXNnKQoKICAgICAgICBzaGVsbCA9IEZhbHNlCiAgICAgICAgaWYgdXNlX3Vuc2FmZV9zaGVsbDoKICAgICAgICAgICAgaWYgZXhlY3V0YWJsZSBpcyBOb25lOgogICAgICAgICAgICAgICAgZXhlY3V0YWJsZSA9IG9zLmVudmlyb24uZ2V0KCdTSEVMTCcpCiAgICAgICAgICAgIGlmIGV4ZWN1dGFibGU6CiAgICAgICAgICAgICAgICBhcmdzID0gW2V4ZWN1dGFibGUsICctYycsIGFyZ3NdCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzaGVsbCA9IFRydWUKCiAgICAgICAgcHJvbXB0X3JlID0gTm9uZQogICAgICAgIGlmIHByb21wdF9yZWdleDoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwcm9tcHRfcmVnZXgsIHRleHRfdHlwZSk6CiAgICAgICAgICAgICAgICBpZiBQWTM6CiAgICAgICAgICAgICAgICAgICAgcHJvbXB0X3JlZ2V4ID0gdG9fYnl0ZXMocHJvbXB0X3JlZ2V4LCBlcnJvcnM9J3N1cnJvZ2F0ZWVzY2FwZScpCiAgICAgICAgICAgICAgICBlbGlmIFBZMjoKICAgICAgICAgICAgICAgICAgICBwcm9tcHRfcmVnZXggPSB0b19ieXRlcyhwcm9tcHRfcmVnZXgsIGVycm9ycz0nc3Vycm9nYXRlX29yX3N0cmljdCcpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHByb21wdF9yZSA9IHJlLmNvbXBpbGUocHJvbXB0X3JlZ2V4LCByZS5NVUxUSUxJTkUpCiAgICAgICAgICAgIGV4Y2VwdCByZS5lcnJvcjoKICAgICAgICAgICAgICAgIHNlbGYuZmFpbF9qc29uKG1zZz0iaW52YWxpZCBwcm9tcHQgcmVndWxhciBleHByZXNzaW9uIGdpdmVuIHRvIHJ1bl9jb21tYW5kIikKCiAgICAgICAgIyBleHBhbmQgdGhpbmdzIGxpa2UgJEhPTUUgYW5kIH4KICAgICAgICBpZiBub3Qgc2hlbGw6CiAgICAgICAgICAgIGFyZ3MgPSBbIG9zLnBhdGguZXhwYW5kdXNlcihvcy5wYXRoLmV4cGFuZHZhcnMoeCkpIGZvciB4IGluIGFyZ3MgaWYgeCBpcyBub3QgTm9uZSBdCgogICAgICAgIHJjID0gMAogICAgICAgIG1zZyA9IE5vbmUKICAgICAgICBzdF9pbiA9IE5vbmUKCiAgICAgICAgIyBNYW5pcHVsYXRlIHRoZSBlbnZpcm9uIHdlJ2xsIHNlbmQgdG8gdGhlIG5ldyBwcm9jZXNzCiAgICAgICAgb2xkX2Vudl92YWxzID0ge30KICAgICAgICAjIFdlIGNhbiBzZXQgdGhpcyBmcm9tIGJvdGggYW4gYXR0cmlidXRlIGFuZCBwZXIgY2FsbAogICAgICAgIGZvciBrZXksIHZhbCBpbiBzZWxmLnJ1bl9jb21tYW5kX2Vudmlyb25fdXBkYXRlLml0ZW1zKCk6CiAgICAgICAgICAgIG9sZF9lbnZfdmFsc1trZXldID0gb3MuZW52aXJvbi5nZXQoa2V5LCBOb25lKQogICAgICAgICAgICBvcy5lbnZpcm9uW2tleV0gPSB2YWwKICAgICAgICBpZiBlbnZpcm9uX3VwZGF0ZToKICAgICAgICAgICAgZm9yIGtleSwgdmFsIGluIGVudmlyb25fdXBkYXRlLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBvbGRfZW52X3ZhbHNba2V5XSA9IG9zLmVudmlyb24uZ2V0KGtleSwgTm9uZSkKICAgICAgICAgICAgICAgIG9zLmVudmlyb25ba2V5XSA9IHZhbAogICAgICAgIGlmIHBhdGhfcHJlZml4OgogICAgICAgICAgICBvbGRfZW52X3ZhbHNbJ1BBVEgnXSA9IG9zLmVudmlyb25bJ1BBVEgnXQogICAgICAgICAgICBvcy5lbnZpcm9uWydQQVRIJ10gPSAiJXM6JXMiICUgKHBhdGhfcHJlZml4LCBvcy5lbnZpcm9uWydQQVRIJ10pCgogICAgICAgICMgSWYgdXNpbmcgdGVzdC1tb2R1bGUgYW5kIGV4cGxvZGUsIHRoZSByZW1vdGUgbGliIHBhdGggd2lsbCByZXNlbWJsZSAuLi4KICAgICAgICAjICAgL3RtcC90ZXN0X21vZHVsZV9zY3JhdGNoL2RlYnVnX2Rpci9hbnNpYmxlL21vZHVsZV91dGlscy9iYXNpYy5weQogICAgICAgICMgSWYgdXNpbmcgYW5zaWJsZSBvciBhbnNpYmxlLXBsYXlib29rIHdpdGggYSByZW1vdGUgc3lzdGVtIC4uLgogICAgICAgICMgICAvdG1wL2Fuc2libGVfdm13ZUxRL2Fuc2libGVfbW9kbGliLnppcC9hbnNpYmxlL21vZHVsZV91dGlscy9iYXNpYy5weQoKICAgICAgICAjIENsZWFuIG91dCBweXRob24gcGF0aHMgc2V0IGJ5IGFuc2liYWxsegogICAgICAgIGlmICdQWVRIT05QQVRIJyBpbiBvcy5lbnZpcm9uOgogICAgICAgICAgICBweXBhdGhzID0gb3MuZW52aXJvblsnUFlUSE9OUEFUSCddLnNwbGl0KCc6JykKICAgICAgICAgICAgcHlwYXRocyA9IFt4IGZvciB4IGluIHB5cGF0aHMgXAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgeC5lbmRzd2l0aCgnL2Fuc2libGVfbW9kbGliLnppcCcpIFwKICAgICAgICAgICAgICAgICAgICAgICAgYW5kIG5vdCB4LmVuZHN3aXRoKCcvZGVidWdfZGlyJyldCiAgICAgICAgICAgIG9zLmVudmlyb25bJ1BZVEhPTlBBVEgnXSA9ICc6Jy5qb2luKHB5cGF0aHMpCiAgICAgICAgICAgIGlmIG5vdCBvcy5lbnZpcm9uWydQWVRIT05QQVRIJ106CiAgICAgICAgICAgICAgICBkZWwgb3MuZW52aXJvblsnUFlUSE9OUEFUSCddCgogICAgICAgICMgY3JlYXRlIGEgcHJpbnRhYmxlIHZlcnNpb24gb2YgdGhlIGNvbW1hbmQgZm9yIHVzZQogICAgICAgICMgaW4gcmVwb3J0aW5nIGxhdGVyLCB3aGljaCBzdHJpcHMgb3V0IHRoaW5ncyBsaWtlCiAgICAgICAgIyBwYXNzd29yZHMgZnJvbSB0aGUgYXJncyBsaXN0CiAgICAgICAgdG9fY2xlYW5fYXJncyA9IGFyZ3MKICAgICAgICBpZiBQWTI6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXJncywgdGV4dF90eXBlKToKICAgICAgICAgICAgICAgIHRvX2NsZWFuX2FyZ3MgPSB0b19ieXRlcyhhcmdzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoYXJncywgYmluYXJ5X3R5cGUpOgogICAgICAgICAgICAgICAgdG9fY2xlYW5fYXJncyA9IHRvX3RleHQoYXJncykKICAgICAgICBpZiBpc2luc3RhbmNlKGFyZ3MsICh0ZXh0X3R5cGUsIGJpbmFyeV90eXBlKSk6CiAgICAgICAgICAgIHRvX2NsZWFuX2FyZ3MgPSBzaGxleC5zcGxpdCh0b19jbGVhbl9hcmdzKQoKICAgICAgICBjbGVhbl9hcmdzID0gW10KICAgICAgICBpc19wYXNzd2QgPSBGYWxzZQogICAgICAgIGZvciBhcmcgaW4gdG9fY2xlYW5fYXJnczoKICAgICAgICAgICAgaWYgaXNfcGFzc3dkOgogICAgICAgICAgICAgICAgaXNfcGFzc3dkID0gRmFsc2UKICAgICAgICAgICAgICAgIGNsZWFuX2FyZ3MuYXBwZW5kKCcqKioqKioqKicpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBpZiBQQVNTV0RfQVJHX1JFLm1hdGNoKGFyZyk6CiAgICAgICAgICAgICAgICBzZXBfaWR4ID0gYXJnLmZpbmQoJz0nKQogICAgICAgICAgICAgICAgaWYgc2VwX2lkeCA+IC0xOgogICAgICAgICAgICAgICAgICAgIGNsZWFuX2FyZ3MuYXBwZW5kKCclcz0qKioqKioqKicgJSBhcmdbOnNlcF9pZHhdKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlzX3Bhc3N3ZCA9IFRydWUKICAgICAgICAgICAgYXJnID0gaGV1cmlzdGljX2xvZ19zYW5pdGl6ZShhcmcsIHNlbGYubm9fbG9nX3ZhbHVlcykKICAgICAgICAgICAgY2xlYW5fYXJncy5hcHBlbmQoYXJnKQogICAgICAgIGNsZWFuX2FyZ3MgPSAnICcuam9pbihzaGxleF9xdW90ZShhcmcpIGZvciBhcmcgaW4gY2xlYW5fYXJncykKCiAgICAgICAgaWYgZGF0YToKICAgICAgICAgICAgc3RfaW4gPSBzdWJwcm9jZXNzLlBJUEUKCiAgICAgICAga3dhcmdzID0gZGljdCgKICAgICAgICAgICAgZXhlY3V0YWJsZT1leGVjdXRhYmxlLAogICAgICAgICAgICBzaGVsbD1zaGVsbCwKICAgICAgICAgICAgY2xvc2VfZmRzPWNsb3NlX2ZkcywKICAgICAgICAgICAgc3RkaW49c3RfaW4sCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgKQoKICAgICAgICAjIHN0b3JlIHRoZSBwd2QKICAgICAgICBwcmV2X2RpciA9IG9zLmdldGN3ZCgpCgogICAgICAgICMgbWFrZSBzdXJlIHdlJ3JlIGluIHRoZSByaWdodCB3b3JraW5nIGRpcmVjdG9yeQogICAgICAgIGlmIGN3ZCBhbmQgb3MucGF0aC5pc2Rpcihjd2QpOgogICAgICAgICAgICBjd2QgPSBvcy5wYXRoLmFic3BhdGgob3MucGF0aC5leHBhbmR1c2VyKGN3ZCkpCiAgICAgICAgICAgIGt3YXJnc1snY3dkJ10gPSBjd2QKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgb3MuY2hkaXIoY3dkKQogICAgICAgICAgICBleGNlcHQgKE9TRXJyb3IsIElPRXJyb3IpOgogICAgICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQogICAgICAgICAgICAgICAgc2VsZi5mYWlsX2pzb24ocmM9ZS5lcnJubywgbXNnPSJDb3VsZCBub3Qgb3BlbiAlcywgJXMiICUgKGN3ZCwgc3RyKGUpKSkKCiAgICAgICAgb2xkX3VtYXNrID0gTm9uZQogICAgICAgIGlmIHVtYXNrOgogICAgICAgICAgICBvbGRfdW1hc2sgPSBvcy51bWFzayh1bWFzaykKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBzZWxmLl9kZWJ1ZzoKICAgICAgICAgICAgICAgIHNlbGYubG9nKCdFeGVjdXRpbmc6ICcgKyBjbGVhbl9hcmdzKQogICAgICAgICAgICBjbWQgPSBzdWJwcm9jZXNzLlBvcGVuKGFyZ3MsICoqa3dhcmdzKQoKICAgICAgICAgICAgIyB0aGUgY29tbXVuaWNhdGlvbiBsb2dpYyBoZXJlIGlzIGVzc2VudGlhbGx5IHRha2VuIGZyb20gdGhhdAogICAgICAgICAgICAjIG9mIHRoZSBfY29tbXVuaWNhdGUoKSBmdW5jdGlvbiBpbiBzc2gucHkKCiAgICAgICAgICAgIHN0ZG91dCA9IGIoJycpCiAgICAgICAgICAgIHN0ZGVyciA9IGIoJycpCiAgICAgICAgICAgIHJwaXBlcyA9IFtjbWQuc3Rkb3V0LCBjbWQuc3RkZXJyXQoKICAgICAgICAgICAgaWYgZGF0YToKICAgICAgICAgICAgICAgIGlmIG5vdCBiaW5hcnlfZGF0YToKICAgICAgICAgICAgICAgICAgICBkYXRhICs9ICdcbicKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSwgdGV4dF90eXBlKToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gdG9fYnl0ZXMoZGF0YSkKICAgICAgICAgICAgICAgIGNtZC5zdGRpbi53cml0ZShkYXRhKQogICAgICAgICAgICAgICAgY21kLnN0ZGluLmNsb3NlKCkKCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICByZmRzLCB3ZmRzLCBlZmRzID0gc2VsZWN0LnNlbGVjdChycGlwZXMsIFtdLCBycGlwZXMsIDEpCiAgICAgICAgICAgICAgICBzdGRvdXQgKz0gc2VsZi5fcmVhZF9mcm9tX3BpcGVzKHJwaXBlcywgcmZkcywgY21kLnN0ZG91dCkKICAgICAgICAgICAgICAgIHN0ZGVyciArPSBzZWxmLl9yZWFkX2Zyb21fcGlwZXMocnBpcGVzLCByZmRzLCBjbWQuc3RkZXJyKQogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBjaGVja2luZyBmb3IgcHJvbXB0cywgZG8gaXQgbm93CiAgICAgICAgICAgICAgICBpZiBwcm9tcHRfcmU6CiAgICAgICAgICAgICAgICAgICAgaWYgcHJvbXB0X3JlLnNlYXJjaChzdGRvdXQpIGFuZCBub3QgZGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZW5jb2Rpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQgPSB0b19uYXRpdmUoc3Rkb3V0LCBlbmNvZGluZz1lbmNvZGluZywgZXJyb3JzPWVycm9ycykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ZG91dCA9IHN0ZG91dAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKDI1Nywgc3Rkb3V0LCAiQSBwcm9tcHQgd2FzIGVuY291bnRlcmVkIHdoaWxlIHJ1bm5pbmcgYSBjb21tYW5kLCBidXQgbm8gaW5wdXQgZGF0YSB3YXMgc3BlY2lmaWVkIikKICAgICAgICAgICAgICAgICMgb25seSBicmVhayBvdXQgaWYgbm8gcGlwZXMgYXJlIGxlZnQgdG8gcmVhZCBvcgogICAgICAgICAgICAgICAgIyB0aGUgcGlwZXMgYXJlIGNvbXBsZXRlbHkgcmVhZCBhbmQKICAgICAgICAgICAgICAgICMgdGhlIHByb2Nlc3MgaXMgdGVybWluYXRlZAogICAgICAgICAgICAgICAgaWYgKG5vdCBycGlwZXMgb3Igbm90IHJmZHMpIGFuZCBjbWQucG9sbCgpIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAjIE5vIHBpcGVzIGFyZSBsZWZ0IHRvIHJlYWQgYnV0IHByb2Nlc3MgaXMgbm90IHlldCB0ZXJtaW5hdGVkCiAgICAgICAgICAgICAgICAjIE9ubHkgdGhlbiBpdCBpcyBzYWZlIHRvIHdhaXQgZm9yIHRoZSBwcm9jZXNzIHRvIGJlIGZpbmlzaGVkCiAgICAgICAgICAgICAgICAjIE5PVEU6IEFjdHVhbGx5IGNtZC5wb2xsKCkgaXMgYWx3YXlzIE5vbmUgaGVyZSBpZiBycGlwZXMgaXMgZW1wdHkKICAgICAgICAgICAgICAgIGVsaWYgbm90IHJwaXBlcyBhbmQgY21kLnBvbGwoKSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIGNtZC53YWl0KCkKICAgICAgICAgICAgICAgICAgICAjIFRoZSBwcm9jZXNzIGlzIHRlcm1pbmF0ZWQuIFNpbmNlIG5vIHBpcGVzIHRvIHJlYWQgZnJvbSBhcmUKICAgICAgICAgICAgICAgICAgICAjIGxlZnQsIHRoZXJlIGlzIG5vIG5lZWQgdG8gY2FsbCBzZWxlY3QoKSBhZ2Fpbi4KICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgY21kLnN0ZG91dC5jbG9zZSgpCiAgICAgICAgICAgIGNtZC5zdGRlcnIuY2xvc2UoKQoKICAgICAgICAgICAgcmMgPSBjbWQucmV0dXJuY29kZQogICAgICAgIGV4Y2VwdCAoT1NFcnJvciwgSU9FcnJvcik6CiAgICAgICAgICAgIGUgPSBnZXRfZXhjZXB0aW9uKCkKICAgICAgICAgICAgc2VsZi5sb2coIkVycm9yIEV4ZWN1dGluZyBDTUQ6JXMgRXhjZXB0aW9uOiVzIiAlIChjbGVhbl9hcmdzLCB0b19uYXRpdmUoZSkpKQogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihyYz1lLmVycm5vLCBtc2c9dG9fbmF0aXZlKGUpLCBjbWQ9Y2xlYW5fYXJncykKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBlID0gZ2V0X2V4Y2VwdGlvbigpCiAgICAgICAgICAgIHNlbGYubG9nKCJFcnJvciBFeGVjdXRpbmcgQ01EOiVzIEV4Y2VwdGlvbjolcyIgJSAoY2xlYW5fYXJncyx0b19uYXRpdmUodHJhY2ViYWNrLmZvcm1hdF9leGMoKSkpKQogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihyYz0yNTcsIG1zZz10b19uYXRpdmUoZSksIGV4Y2VwdGlvbj10cmFjZWJhY2suZm9ybWF0X2V4YygpLCBjbWQ9Y2xlYW5fYXJncykKCiAgICAgICAgIyBSZXN0b3JlIGVudiBzZXR0aW5ncwogICAgICAgIGZvciBrZXksIHZhbCBpbiBvbGRfZW52X3ZhbHMuaXRlbXMoKToKICAgICAgICAgICAgaWYgdmFsIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBkZWwgb3MuZW52aXJvbltrZXldCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBvcy5lbnZpcm9uW2tleV0gPSB2YWwKCiAgICAgICAgaWYgb2xkX3VtYXNrOgogICAgICAgICAgICBvcy51bWFzayhvbGRfdW1hc2spCgogICAgICAgIGlmIHJjICE9IDAgYW5kIGNoZWNrX3JjOgogICAgICAgICAgICBtc2cgPSBoZXVyaXN0aWNfbG9nX3Nhbml0aXplKHN0ZGVyci5yc3RyaXAoKSwgc2VsZi5ub19sb2dfdmFsdWVzKQogICAgICAgICAgICBzZWxmLmZhaWxfanNvbihjbWQ9Y2xlYW5fYXJncywgcmM9cmMsIHN0ZG91dD1zdGRvdXQsIHN0ZGVycj1zdGRlcnIsIG1zZz1tc2cpCgogICAgICAgICMgcmVzZXQgdGhlIHB3ZAogICAgICAgIG9zLmNoZGlyKHByZXZfZGlyKQoKICAgICAgICBpZiBlbmNvZGluZyBpcyBub3QgTm9uZToKICAgICAgICAgICAgcmV0dXJuIChyYywgdG9fbmF0aXZlKHN0ZG91dCwgZW5jb2Rpbmc9ZW5jb2RpbmcsIGVycm9ycz1lcnJvcnMpLAogICAgICAgICAgICAgICAgICAgIHRvX25hdGl2ZShzdGRlcnIsIGVuY29kaW5nPWVuY29kaW5nLCBlcnJvcnM9ZXJyb3JzKSkKICAgICAgICByZXR1cm4gKHJjLCBzdGRvdXQsIHN0ZGVycikKCiAgICBkZWYgYXBwZW5kX3RvX2ZpbGUoc2VsZiwgZmlsZW5hbWUsIHN0cik6CiAgICAgICAgZmlsZW5hbWUgPSBvcy5wYXRoLmV4cGFuZHZhcnMob3MucGF0aC5leHBhbmR1c2VyKGZpbGVuYW1lKSkKICAgICAgICBmaCA9IG9wZW4oZmlsZW5hbWUsICdhJykKICAgICAgICBmaC53cml0ZShzdHIpCiAgICAgICAgZmguY2xvc2UoKQoKICAgIGRlZiBieXRlc190b19odW1hbihzZWxmLCBzaXplKToKICAgICAgICByZXR1cm4gYnl0ZXNfdG9faHVtYW4oc2l6ZSkKCiAgICAjIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgcHJldHR5X2J5dGVzID0gYnl0ZXNfdG9faHVtYW4KCiAgICBkZWYgaHVtYW5fdG9fYnl0ZXMoc2VsZiwgbnVtYmVyLCBpc2JpdHM9RmFsc2UpOgogICAgICAgIHJldHVybiBodW1hbl90b19ieXRlcyhudW1iZXIsIGlzYml0cykKCiAgICAjCiAgICAjIEJhY2t3YXJkcyBjb21wYXQKICAgICMKCiAgICAjIEluIDIuMCwgbW92ZWQgZnJvbSBpbnNpZGUgdGhlIG1vZHVsZSB0byB0aGUgdG9wbGV2ZWwKICAgIGlzX2V4ZWN1dGFibGUgPSBpc19leGVjdXRhYmxlCgoKZGVmIGdldF9tb2R1bGVfcGF0aCgpOgogICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLnJlYWxwYXRoKF9fZmlsZV9fKSkKUEsDBBQAAAAAAOG7K0tejO4p2AsCANgLAgAcAAAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvY25vcy5weSMgVGhpcyBjb2RlIGlzIHBhcnQgb2YgQW5zaWJsZSwgYnV0IGlzIGFuIGluZGVwZW5kZW50IGNvbXBvbmVudC4KIyBUaGlzIHBhcnRpY3VsYXIgZmlsZSBzbmlwcGV0LCBhbmQgdGhpcyBmaWxlIHNuaXBwZXQgb25seSwgaXMgQlNEIGxpY2Vuc2VkLgojIE1vZHVsZXMgeW91IHdyaXRlIHVzaW5nIHRoaXMgc25pcHBldCwgd2hpY2ggaXMgZW1iZWRkZWQgZHluYW1pY2FsbHkgYnkKIyBBbnNpYmxlIHN0aWxsIGJlbG9uZyB0byB0aGUgYXV0aG9yIG9mIHRoZSBtb2R1bGUsIGFuZCBtYXkgYXNzaWduIHRoZWlyIG93bgojIGxpY2Vuc2UgdG8gdGhlIGNvbXBsZXRlIHdvcmsuCiMKIyBDb3B5cmlnaHQgKEMpIDIwMTcgTGVub3ZvLCBJbmMuCiMgQWxsIHJpZ2h0cyByZXNlcnZlZC4KIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAojIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKIyAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiMgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KIyAgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KIwojIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgojIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKIyBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRQojIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUKIyBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SCiMgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKIyBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKIyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTgojIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiMgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUKIyBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KIwojIENvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcwojIExlbm92byBOZXR3b3JraW5nCgppbXBvcnQgdGltZQppbXBvcnQgZnRwbGliCmltcG9ydCBzb2NrZXQKaW1wb3J0IHJlCnRyeToKICAgIGltcG9ydCBjbm9zX2Vycm9yY29kZXMKICAgIGltcG9ydCBjbm9zX2RldmljZXJ1bGVzCiAgICBIQVNfTElCID0gVHJ1ZQpleGNlcHQ6CiAgICBIQVNfTElCID0gRmFsc2UKZnJvbSBkaXN0dXRpbHMuY21kIGltcG9ydCBDb21tYW5kCgoKZGVmIGludGVyZmFjZUNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VBcmcxLAogICAgICAgIGludGVyZmFjZUFyZzIsIGludGVyZmFjZUFyZzMsIGludGVyZmFjZUFyZzQsIGludGVyZmFjZUFyZzUsCiAgICAgICAgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNywgaW50ZXJmYWNlQXJnOCwgaW50ZXJmYWNlQXJnOSk6CiAgICByZXRWYWwgPSAiIgogICAgY29tbWFuZCA9ICJpbnRlcmZhY2UgIgogICAgbmV3UHJvbXB0ID0gcHJvbXB0CiAgICBpZihpbnRlcmZhY2VBcmcxID09ICJwb3J0LWFnZ3JlZ2F0aW9uIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiICIgKyBpbnRlcmZhY2VBcmcxICsgIiAiICsgaW50ZXJmYWNlQXJnMiArICJcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pbnRlcmZhY2VfdmFsdWUiLCBpbnRlcmZhY2VBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZikjIgogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaW50ZXJmYWNlX3JhbmdlIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZi1yYW5nZSkjIgogICAgICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBuZXdQcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pbnRlcmZhY2Vfc3RyaW5nIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmLXJhbmdlKSMiCiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBpbnRlcmZhY2VMZXZlbDJDb25maWcoCiAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgbmV3UHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc1LCBpbnRlcmZhY2VBcmc2LCBpbnRlcmZhY2VBcmc3LCBpbnRlcmZhY2VBcmc4LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc5KQogICAgZWxpZihpbnRlcmZhY2VBcmcxID09ICJldGhlcm5ldCIpOgogICAgICAgICMgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VBcmcxICsgIiAxLyIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImV0aGVybmV0X2ludGVyZmFjZV92YWx1ZSIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmKSMiCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlQXJnMSArICIgMS8iICsgaW50ZXJmYWNlQXJnMiArICIgXG4iCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBuZXdQcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICAgICBlbHNlOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJldGhlcm5ldF9pbnRlcmZhY2VfcmFuZ2UiLCBpbnRlcmZhY2VBcmcyKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgXAogICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUFyZzEgKyAiIDEvIiArIGludGVyZmFjZUFyZzIgKyAiIFxuIgogICAgICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYtcmFuZ2UpIyIKICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiZXRoZXJuZXRfaW50ZXJmYWNlX3N0cmluZyIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIFwKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlQXJnMSArICIgIiArIGludGVyZmFjZUFyZzIgKyAiXG4iCiAgICAgICAgICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYtcmFuZ2UpIyIKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBuZXdQcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIGludGVyZmFjZUxldmVsMkNvbmZpZygKICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBuZXdQcm9tcHQsIHRpbWVvdXQsIGludGVyZmFjZUFyZzMsIGludGVyZmFjZUFyZzQsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzUsIGludGVyZmFjZUFyZzYsIGludGVyZmFjZUFyZzcsIGludGVyZmFjZUFyZzgsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzkpCiAgICBlbGlmKGludGVyZmFjZUFyZzEgPT0gImxvb3BiYWNrIik6CiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJsb29wYmFja19pbnRlcmZhY2VfdmFsdWUiLCBpbnRlcmZhY2VBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBuZXdQcm9tcHQgPSAiKGNvbmZpZy1pZikjIgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUFyZzEgKyAiICIgKyBpbnRlcmZhY2VBcmcyICsgIlxuIgogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgbmV3UHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIHJldFZhbCA9IHJldFZhbCArIGludGVyZmFjZUxldmVsMkNvbmZpZygKICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBuZXdQcm9tcHQsIHRpbWVvdXQsIGludGVyZmFjZUFyZzMsIGludGVyZmFjZUFyZzQsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzUsIGludGVyZmFjZUFyZzYsIGludGVyZmFjZUFyZzcsIGludGVyZmFjZUFyZzgsCiAgICAgICAgICAgIGludGVyZmFjZUFyZzkpCiAgICBlbGlmKGludGVyZmFjZUFyZzEgPT0gIm1nbXQiKToKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm1nbXRfaW50ZXJmYWNlX3ZhbHVlIiwgaW50ZXJmYWNlQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgbmV3UHJvbXB0ID0gIihjb25maWctaWYpIyIKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VBcmcxICsgIiAiICsgaW50ZXJmYWNlQXJnMiArICJcbiIKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgICAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIG5ld1Byb21wdCwgdGltZW91dCwgb2JqKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBpbnRlcmZhY2VMZXZlbDJDb25maWcoCiAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgbmV3UHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VBcmczLCBpbnRlcmZhY2VBcmc0LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc1LCBpbnRlcmZhY2VBcmc2LCBpbnRlcmZhY2VBcmc3LCBpbnRlcmZhY2VBcmc4LAogICAgICAgICAgICBpbnRlcmZhY2VBcmc5KQogICAgZWxpZihpbnRlcmZhY2VBcmcxID09ICJ2bGFuIik6CiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2ludGVyZmFjZV92YWx1ZSIsIGludGVyZmFjZUFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIG5ld1Byb21wdCA9ICIoY29uZmlnLWlmKSMiCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlQXJnMSArICIgIiArIGludGVyZmFjZUFyZzIgKyAiXG4iCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBuZXdQcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTAyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgaW50ZXJmYWNlTGV2ZWwyQ29uZmlnKAogICAgICAgICAgICBvYmosIGRldmljZVR5cGUsIG5ld1Byb21wdCwgdGltZW91dCwgaW50ZXJmYWNlQXJnMywgaW50ZXJmYWNlQXJnNCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnNSwgaW50ZXJmYWNlQXJnNiwgaW50ZXJmYWNlQXJnNywgaW50ZXJmYWNlQXJnOCwKICAgICAgICAgICAgaW50ZXJmYWNlQXJnOSkKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGludGVyZmFjZUxldmVsMkNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBpbnRlcmZhY2VMMkFyZzEsIGludGVyZmFjZUwyQXJnMiwKICAgIGludGVyZmFjZUwyQXJnMywgaW50ZXJmYWNlTDJBcmc0LCBpbnRlcmZhY2VMMkFyZzUsIGludGVyZmFjZUwyQXJnNiwKICAgICAgICBpbnRlcmZhY2VMMkFyZzcpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiIgogICAgaWYoaW50ZXJmYWNlTDJBcmcxID09ICJhZ2dyZWdhdGlvbi1ncm91cCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImFnZ3JlZ2F0aW9uLWdyb3VwIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJhZ2dyZWdhdGlvbl9ncm91cF9ubyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiIG1vZGUgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhZ2dyZWdhdGlvbl9ncm91cF9tb2RlIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAwIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDEiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gImJmZCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImJmZCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiA9PSAiZWNobyIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImludGVydmFsIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9pbnRlcnZhbCIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfbWlucngiLCBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBtaW5yeCAiICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF8gbXVsdGlwbGllciIsIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgbXVsdGlwbGllciAiICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM1IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzQiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYXV0aGVudGljYXRpb24iKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2F1dGhfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgaWYoKGludGVyZmFjZUwyQXJnMyA9PSAia2V5ZWQtbWQ1Iikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnMyA9PSAia2V5ZWQtc2hhMSIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzMgPT0gIm1ldGljdWxvdXMta2V5ZWQtbWQ1Iikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnMyA9PSAibWV0aWN1bG91cy1rZXllZC1zaGExIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzMgPT0gInNpbXBsZSIpKToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImtleS1jaGFpbiIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9jaGFpbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM3IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAia2V5LWlkIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfa2V5X2lkIiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIga2V5ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzOCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQxIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJpcHY0IiBvciBpbnRlcmZhY2VMMkFyZzIgPT0gImlwdjYiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2lwdjRfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJhdXRoZW50aWNhdGlvbiIpOgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfYXV0aF9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigoaW50ZXJmYWNlTDJBcmc0ID09ICJrZXllZC1tZDUiKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzQgPT0gImtleWVkLXNoYTEiKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzQgPT0gIm1ldGljdWxvdXMta2V5ZWQtbWQ1Iikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmc0ID09ICJtZXRpY3Vsb3VzLWtleWVkLXNoYTEiKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmc0ID09ICJzaW1wbGUiKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfa2V5X29wdGlvbnMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNSA9PSAia2V5LWNoYWluIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9jaGFpbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc1ID09ICJrZXktaWQiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfa2V5X2lkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2ICsgIiBrZXkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2tleV9uYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzOSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQxIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczID09ICJlY2hvIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzMgPT0gImludGVydmFsIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9pbnRlcnZhbCIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9taW5yeCIsIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBtaW5yeCAiICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfIG11bHRpcGxpZXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBtdWx0aXBsaWVyICIgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjM2IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzNCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgICMgTm9uZSBpcyB0YWtlbiBjYXJlIGhlcmUKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJuZWlnaGJvciIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiIHNyYy1pcCAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX25laWdoYm9yX2lwIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiIGRlc3QtaXAgIgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX25laWdoYm9yX2lwIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzUgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9uZWlnaGJvcl9vcHRpb25zIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNSArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKChpbnRlcmZhY2VMMkFyZzYgPT0gImFkbWluLWRvd24iKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpbnRlcmZhY2VMMkFyZzYgPT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5vbi1wZXJzaXN0ZW50IikpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc2ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigoaW50ZXJmYWNlTDJBcmc3IGlzIG5vdCBOb25lKSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGludGVyZmFjZUwyQXJnNyA9PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFkbWluLWRvd24iKSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3NyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjc3IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRWxzZSBpcyBub3QgdGhlcmUgYXJlIGl0cyBvcHRpb25zYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRWxzZSBpcyBub3QgdGhlcmUgYXMgdGhpcyBpcyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgICAgICAjIEVsc2UgaXMgbm90IHRoZXJlIGFzIHRoaXMgaXMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQyIgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDUiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwNSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiYnJpZGdlLXBvcnQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJicmlkZ2UtcG9ydCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIGlmKGludGVyZmFjZUwyQXJnMiBpcyBOb25lKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYWNjZXNzIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiB2bGFuICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2FjY2Vzc192bGFuIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAyIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJtb2RlIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJmZF9icmlkZ2Vwb3J0X21vZGUiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInRydW5rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInRydW5rX29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgIGlmKChpbnRlcmZhY2VMMkFyZzMgPT0gImFsbG93ZWQiKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAoaW50ZXJmYWNlTDJBcmczID09ICJuYXRpdmUiKSk6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAidmxhbiAiICAjIE9ubHkgcGVybWl0aW5nIG9uZSB2bGFuIGlkCiAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJhbGwiIG9yIGludGVyZmFjZUwyQXJnNCA9PSAibm9uZSIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJhZGQiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQgPT0gInJlbW92ZSIgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNCA9PSAibm9uZSIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZmRfYWNjZXNzX3ZsYW4iLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmZkX2FjY2Vzc192bGFuIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjAyIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA0IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDQiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIwNSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiZGVzY3JpcHRpb24iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJkZXNjcmlwdGlvbiIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydENoX2Rlc2NyaXB0aW9uIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDYiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiZHVwbGV4Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiZHVwbGV4IikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJkdXBsZXhfb3B0aW9uIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDciCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiZmxvd2NvbnRyb2wiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJmbG93Y29udHJvbCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiZmxvd2NvbnRyb2xfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJvbiIgb3IgaW50ZXJmYWNlTDJBcmczID09ICJvZmYiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjA4IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMDkiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAiaXAiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJpcCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXBfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJhY2Nlc3MtZ3JvdXAiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhY2Nlc3Nncm91cF9uYW1lIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImluIiBvciBpbnRlcmZhY2VMMkFyZzQgPT0gIm91dCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDUiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0NiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJhZGRyZXNzIik6CiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImRoY3AiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzMgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2NCIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2NCIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc1ID09ICJzZWNvbmRhcnkiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzUgaXMgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3OCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjc5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjRfbWFzayIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAic2Vjb25kYXJ5Iik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc0IGlzIE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3OSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJhcnAiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJhcnBfaXBhZGRyZXNzIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFycF9tYWNhZGRyZXNzIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDciCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczID09ICJ0aW1lb3V0Iik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFycF90aW1lb3V0X3ZhbHVlIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNDgiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0OSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJkaGNwIik6CiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImNsaWVudCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJjbGFzcy1pZCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAicmVxdWVzdCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzUgPT0gImJvb3RmaWxlLW5hbWUiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc1ID09ICJob3N0LW5hbWUiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc1ID09ICJsb2ctc2VydmVyIiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSA9PSAidGZ0cC1zZXJ2ZXItbmFtZSIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUgKyAiICIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1MSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzMgPT0gInJlbGF5Iik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiIGFkZHJlc3MgIgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicmVsYXlfaXBhZGRyZXNzIiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTIiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1MyIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJvc3BmIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiaXBfb3NwZl9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTQiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInBvcnQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgImFjY2Vzcy1ncm91cCAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWNjZXNzZ3JvdXBfbmFtZSIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiBpbiIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0NiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJwb3J0LXVucmVhY2hhYmxlIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgoKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInJlZGlyZWN0cyIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJyb3V0ZXIiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAwICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiYXJlYSIgb3IKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczID09ICJtdWx0aS1hcmVhIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm9zcGZfaWRfZGVjaW1hbF92YWx1ZSIsIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJvc3BmX2lkX2lwYWRkcmVzX3ZhbHVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1NSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1NiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidW5yZWFjaGFibGVzIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI0NCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjQ0IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJpcHY2Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiaXB2NiIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2Nl9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzIgPT0gImFkZHJlc3MiKToKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAiZGhjcCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2Nl9hZGRyZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzQgPT0gImFueWNhc3QiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0ID09ICJzZWNvbmRhcnkiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0IGlzIE5vbmUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzYiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3NSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiZGhjcCIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfZGhjcCIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgInJlbGF5IGFkZHJlc3MgIiArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiZXRoZXJuZXQiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJwb3J0Y2hhbm5lbF9pcHY2X2RoY3BfZXRoZXJuZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBpbnRlcmZhY2UgZXRoZXJuZXQgIiArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzEiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnNCA9PSAidmxhbiIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfZGhjcF92bGFuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgaW50ZXJmYWNlIHZsYW4gIiArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNzIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3MCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2OSIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAibGluay1sb2NhbCIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2lwdjZfbGlua2xvY2FsIiwgaW50ZXJmYWNlTDJBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI3MyIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJuZCIpOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gIm5laWdoYm9yIik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2Nl9uZWlnaGJvcl9hZGRyZXNzIiwKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydGNoYW5uZWxfaXB2Nl9uZWlnaGJvcl9tYWMiLAogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzQpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2NyIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjY4IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjYiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAibGFjcCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImxhY3AiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImxhY3Bfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJwb3J0LXByaW9yaXR5Iik6CiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicG9ydF9wcmlvcml0eSIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTAiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAic3VzcGVuZC1pbmRpdmlkdWFsIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidGltZW91dCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnMyA9PSAibG9uZyIgb3IgaW50ZXJmYWNlTDJBcmczID09ICJzaG9ydCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTEiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxMiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjEyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJsbGRwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgibGxkcCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAibGxkcF9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzIgPT0gInJlY2VpdmUiIG9yCiAgICAgICAgICAgICAgICAgICAgaW50ZXJmYWNlTDJBcmcyID09ICJ0cmFwLW5vdGlmaWNhdGlvbiIgb3IKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzIgPT0gInRyYW5zbWl0Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidGx2LXNlbGVjdCIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImxsZHBfdGx2X29wdGlvbnMiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjEzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTQiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxNCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAibG9hZC1pbnRlcnZhbCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImxvYWQtaW50ZXJ2YWwiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImxvYWRfaW50ZXJ2YWxfZGVsYXkiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJjb3VudGVyIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImxvYWRfaW50ZXJ2YWxfY291bnRlciIsIGludGVyZmFjZUwyQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJsb2FkX2ludGVydmFsX2RlbGF5IiwgaW50ZXJmYWNlTDJBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTUiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIxNiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjE3IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAibWFjIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgibWFjIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiBwb3J0IGFjY2Vzcy1ncm91cCAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJtYWNfYWNjZXNzZ3JvdXBfbmFtZSIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjE4IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gIm1hYy1hZGRyZXNzIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgibWFjLWFkZHJlc3MiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm1hY19hZGRyZXNzIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMTkiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gIm1hYy1sZWFybiIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm1hYy1sZWFybiIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgZGlzYWJsZSIKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gIm1pY3JvYnVyc3QtZGV0ZWN0aW9uIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgibWljcm9idXJzdC1kZXRlY3Rpb24iKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiIGVuYWJsZSB0aHJlc2hvbGQgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAibWljcm9idXJzdF90aHJlc2hvbGQiLCBpbnRlcmZhY2VMMkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyMCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAibXR1Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgibXR1IikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgIm10dV92YWx1ZSIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjIxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJzZXJ2aWNlIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgic2VydmljZSIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgaW5zdGFuY2UgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAic2VydmljZV9pbnN0YW5jZSIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjIyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJzZXJ2aWNlLXBvbGljeSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInNlcnZpY2UtcG9saWN5IikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJzZXJ2aWNlX3BvbGljeV9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzIgPT0gImlucHV0IiBvciBpbnRlcmZhY2VMMkFyZzIgPT0gIm91dHB1dCIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNlcnZpY2VfcG9saWN5X25hbWUiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjIzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImNvcHAtc3lzdGVtLXBvbGljeSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiY2xhc3MgYWxsIgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidHlwZSIgYW5kIGludGVyZmFjZUwyQXJnMyA9PSAicW9zIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJpbnB1dCIgb3IgaW50ZXJmYWNlTDJBcmc0ID09ICJvdXRwdXQiKToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNlcnZpY2VfcG9saWN5X25hbWUiLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAidHlwZSIgYW5kIGludGVyZmFjZUwyQXJnMyA9PSAicXVldWluZyIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMgKyAiICIKICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiaW5wdXQiIG9yIGludGVyZmFjZUwyQXJnNCA9PSAib3V0cHV0Iik6CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzZXJ2aWNlX3BvbGljeV9uYW1lIiwgaW50ZXJmYWNlTDJBcmc1KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjIzIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjQiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJzaHV0ZG93biIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInNodXRkb3duIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJzbm1wIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgic25tcCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIHRyYXAgbGluay1zdGF0dXMgIgoKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic3Bhbm5pbmctdHJlZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInNwYW5uaW5nLXRyZWUiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNwYW5uaW5nX3RyZWVfb3B0aW9ucyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJicGR1ZmlsdGVyIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJlbmFibGUiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnMyA9PSAiZGlzYWJsZSIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTciCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiYnBkdWd1YXJkIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJlbmFibGUiIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnMyA9PSAiZGlzYWJsZSIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNTgiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiY29zdCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX2Nvc3QiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzMgPT0gImF1dG8iKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU5IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gImRpc2FibGUiIG9yIGludGVyZmFjZUwyQXJnMiA9PSAiZW5hYmxlIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAiZ3VhcmQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImxvb3AiIG9yIGludGVyZmFjZUwyQXJnMyA9PSAicm9vdCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjAiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAibGluay10eXBlIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmczID09ICJhdXRvIiBvcgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMgPT0gInBvaW50LXRvLXBvaW50IiBvcgogICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMgPT0gInNoYXJlZCIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjEiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gIm1zdCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX2ludGVyZmFjZXJhbmdlIiwKICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMyArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiY29zdCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX2Nvc3QiLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzUgPT0gImF1dG8iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJwb3J0LXByaW9yaXR5Iik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNwYW5uaW5nX3RyZWVfcG9ydHByaW9yaXR5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI1OSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjU5IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yNjMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKGludGVyZmFjZUwyQXJnMiA9PSAicG9ydCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIgKyAiIHR5cGUgZWRnZSIKICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzIgPT0gInBvcnQtcHJpb3JpdHkiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmcyICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAic3Bhbm5pbmdfdHJlZV9wb3J0cHJpb3JpdHkiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjY0IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmcyID09ICJ2bGFuIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5faWRfcmFuZ2UiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMwogICAgICAgICAgICAgICAgICAgIGlmKGludGVyZmFjZUwyQXJnNCA9PSAiY29zdCIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzcGFubmluZ190cmVlX2Nvc3QiLCBpbnRlcmZhY2VMMkFyZzUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgZWxpZihpbnRlcmZhY2VMMkFyZzUgPT0gImF1dG8iKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjYzIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmc0ID09ICJwb3J0LXByaW9yaXR5Iik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmc0ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInNwYW5uaW5nX3RyZWVfcG9ydHByaW9yaXR5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVyZmFjZUwyQXJnNSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnNQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2NCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjY0IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzQiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI2MyIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic3BlZWQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzcGVlZCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiaW50ZXJmYWNlX3NwZWVkIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjUiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKGludGVyZmFjZUwyQXJnMSA9PSAic3Rvcm0tY29udHJvbCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInN0b3JtLWNvbnRyb2wiKQogICAgICAgIGNvbW1hbmQgPSBpbnRlcmZhY2VMMkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInN0b3JtY29udHJvbF9vcHRpb25zIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgbGV2ZWwgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzdG9ybWNvbnRyb2xfbGV2ZWwiLCBpbnRlcmZhY2VMMkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzMKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjI2IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMjciCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmIChpbnRlcmZhY2VMMkFyZzEgPT0gInZsYW4iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJ2bGFuIikKICAgICAgICBjb21tYW5kID0gaW50ZXJmYWNlTDJBcmcxICsgIiBkb3QxcSB0YWcgbmF0aXZlICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInBvcnRjaGFubmVsX2RvdDFxX3RhZyIsIGludGVyZmFjZUwyQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBpbnRlcmZhY2VMMkFyZzIKICAgICAgICAgICAgaWYoaW50ZXJmYWNlTDJBcmcyID09ICJlZ3Jlc3Mtb25seSIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIGVuYWJsZSIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjI4IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZiAoaW50ZXJmYWNlTDJBcmcxID09ICJ2cnJwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgidnJycCIpCiAgICAgICAgY29tbWFuZCA9IGludGVyZmFjZUwyQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2cnJwX2lkIiwgaW50ZXJmYWNlTDJBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGludGVyZmFjZUwyQXJnMiArICIgIgogICAgICAgICAgICBpZihpbnRlcmZhY2VMMkFyZzMgPT0gImlwdjYiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgaW50ZXJmYWNlTDJBcmczICsgIiAiCiAgICAgICAgICAgIGVsaWYoaW50ZXJmYWNlTDJBcmczIGlzIE5vbmUpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIyOSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjMwIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxzZToKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjMzIgogICAgICAgIHJldHVybiByZXRWYWwKCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgICMgQ29tZSBiYWNrIHRvIGNvbmZpZyBtb2RlCiAgICBpZigocHJvbXB0ID09ICIoY29uZmlnLWlmKSMiKSBvciAocHJvbXB0ID09ICIoY29uZmlnLWlmLXJhbmdlKSMiKSk6CiAgICAgICAgY29tbWFuZCA9ICJleGl0IFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKGNvbmZpZykjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgcG9ydENoYW5uZWxDb25maWcoCiAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHBvcnRDaEFyZzEsIHBvcnRDaEFyZzIsIHBvcnRDaEFyZzMsCiAgICAgICAgcG9ydENoQXJnNCwgcG9ydENoQXJnNSwgcG9ydENoQXJnNiwgcG9ydENoQXJnNyk6CiAgICByZXRWYWwgPSAiIgogICAgY29tbWFuZCA9ICIiCiAgICBpZihwb3J0Q2hBcmcxID09ICJwb3J0LWFnZ3JlZ2F0aW9uIiBhbmQgcHJvbXB0ID09ICIoY29uZmlnKSMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHBvcnRDaEFyZzEgKyAiIGxvYWQtYmFsYW5jZSBldGhlcm5ldCAiCiAgICAgICAgaWYocG9ydENoQXJnMiA9PSAiZGVzdGluYXRpb24taXAiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAiZGVzdGluYXRpb24tbWFjIiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gImRlc3RpbmF0aW9uLXBvcnQiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLWRlc3QtaXAiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLWRlc3QtbWFjIiBvcgogICAgICAgICAgIHBvcnRDaEFyZzIgPT0gInNvdXJjZS1kZXN0LXBvcnQiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLWludGVyZmFjZSIgb3IKICAgICAgICAgICBwb3J0Q2hBcmcyID09ICJzb3VyY2UtaXAiIG9yCiAgICAgICAgICAgcG9ydENoQXJnMiA9PSAic291cmNlLW1hYyIgb3IKICAgICAgICAgICBwb3J0Q2hBcmcyID09ICJzb3VyY2UtcG9ydCIpOgoKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChwb3J0Q2hBcmcyKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHBvcnRDaEFyZzIgKyAiICIKICAgICAgICAgICAgaWYocG9ydENoQXJnMyBpcyBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiIKICAgICAgICAgICAgZWxpZihwb3J0Q2hBcmczID09ICJzb3VyY2UtaW50ZXJmYWNlIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHBvcnRDaEFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yMzEiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTIzMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKIyBFT00KCgpkZWYgcm91dGVyQ29uZmlnKAogICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHByb3RvY29sLCBhc051bSwgcm91dGVyQXJnMSwKICAgIHJvdXRlckFyZzIsIHJvdXRlckFyZzMsIHJvdXRlckFyZzQsIHJvdXRlckFyZzUsIHJvdXRlckFyZzYsIHJvdXRlckFyZzcsCiAgICAgICAgcm91dGVyQXJnOCk6CiAgICByZXRWYWwgPSAiIgogICAgIyBXYWl0IHRpbWUgdG8gZ2V0IHJlc3BvbnNlIGZyb20gc2VydmVyCiAgICB0aW1lb3V0ID0gdGltZW91dAogICAgaWYocHJvdG9jb2wgPT0gImJncCIpOgogICAgICAgICMgYmdwIGNvbmZpZyBjb21tYW5kIGhhcHBlbnMgaGVyZS4KICAgICAgICBjb21tYW5kID0gInJvdXRpbmctcHJvdG9jb2wgYmdwICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAiYmdwX2FzX251bWJlciIsIGFzTnVtKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAjIEJHUCBjb21tYW5kIGhhcHBlbnMgaGVyZS4gSXQgY3JlYXRlcyBpZiBub3QgcHJlc2VudAogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGFzTnVtICsgIlxuIgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgICAgIGNvbW1hbmQsICIoY29uZmlnLXJvdXRlcikjIiwgdGltZW91dCwgb2JqKQogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBiZ3BDb25maWcoCiAgICAgICAgICAgICAgICBvYmosIGRldmljZVR5cGUsICIoY29uZmlnLXJvdXRlcikjIiwgdGltZW91dCwgcm91dGVyQXJnMSwKICAgICAgICAgICAgICAgIHJvdXRlckFyZzIsIHJvdXRlckFyZzMsIHJvdXRlckFyZzQsIHJvdXRlckFyZzUsIHJvdXRlckFyZzYsCiAgICAgICAgICAgICAgICByb3V0ZXJBcmc3LCByb3V0ZXJBcmc4KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzYiCgogICAgZWxpZihwcm90b2NvbCA9PSAib3NwZiIpOgogICAgICAgIHJldFZhbCA9ICJDb21tYW5kIFZhbHVlIGlzIE5vdCBzdXBwb3J0ZWQgYXMgb2Ygbm93IgoKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTE3NyIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGJncE5laWdoYm9yQUZDb25maWcoCiAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgYmdwTmVpZ2hib3JBRkFyZzEsIGJncE5laWdoYm9yQUZBcmcyLAogICAgICAgIGJncE5laWdoYm9yQUZBcmczKToKICAgIHJldFZhbCA9ICIiCiAgICBjb21tYW5kID0gIiIKICAgIHRpbWVvdXQgPSB0aW1lb3V0CiAgICBpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAiYWxsb3dhcy1pbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzEgKyAiICIKICAgICAgICBpZihiZ3BOZWlnaGJvckFGQXJnMiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9hZl9vY2N1cmFuY2VzIiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyNSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAiZGVmYXVsdC1vcmlnaW5hdGUiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwTmVpZ2hib3JBRkFyZzIgaXMgbm90IE5vbmUgYW5kIGJncE5laWdoYm9yQUZBcmcyID09ICJyb3V0ZS1tYXAiKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMiArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfcm91dGVtYXAiLCBiZ3BOZWlnaGJvckFGQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzI0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAiZmlsdGVyLWxpc3QiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfZmlsdGVybmFtZSIsIGJncE5laWdoYm9yQUZBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQUZBcmczID09ICJpbiIgb3IgYmdwTmVpZ2hib3JBRkFyZzMgPT0gIm91dCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMyMyIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzIyIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAibWF4aW11bS1wcmVmaXgiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfbWF4cHJlZml4IiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoYmdwTmVpZ2hib3JBRkFyZzMgaXMgbm90IE5vbmUpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzI2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAibmV4dC1ob3Atc2VsZiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzEKCiAgICBlbGlmKGJncE5laWdoYm9yQUZBcmcxID09ICJwcmVmaXgtbGlzdCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9hZl9wcmVmaXhuYW1lIiwgYmdwTmVpZ2hib3JBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoYmdwTmVpZ2hib3JBRkFyZzMgPT0gImluIiBvciBiZ3BOZWlnaGJvckFGQXJnMyA9PSAib3V0Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzIxIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMjAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncE5laWdoYm9yQUZBcmcxID09ICJyb3V0ZS1tYXAiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfcm91dGVtYXAiLCBiZ3BOZWlnaGJvckFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTkiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwTmVpZ2hib3JBRkFyZzEgPT0gInJvdXRlLXJlZmxlY3Rvci1jbGllbnQiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAic2VuZC1jb21tdW5pdHkiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwTmVpZ2hib3JBRkFyZzIgaXMgbm90IE5vbmUgYW5kIGJncE5laWdoYm9yQUZBcmcyID09ICJleHRlbmRlZCIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKCiAgICBlbGlmKGJncE5laWdoYm9yQUZBcmcxID09ICJzb2Z0LXJlY29uZmlndXJhdGlvbiIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBRkFyZzEgKyAiIGluYm91bmQiCgogICAgZWxpZihiZ3BOZWlnaGJvckFGQXJnMSA9PSAidW5zdXBwcmVzcy1tYXAiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfYWZfcm91dGVtYXAiLCBiZ3BOZWlnaGJvckFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFGQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTgiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTciCiAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgY29tbWFuZCA9ICJleGl0IFxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgXAogICAgICAgIHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgY29tbWFuZCwgIihjb25maWctcm91dGVyLW5laWdoYm9yKSMiLCB0aW1lb3V0LCBvYmopCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGJncE5laWdoYm9yQ29uZmlnKAogICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIGJncE5laWdoYm9yQXJnMSwgYmdwTmVpZ2hib3JBcmcyLAogICAgICAgIGJncE5laWdoYm9yQXJnMywgYmdwTmVpZ2hib3JBcmc0LCBiZ3BOZWlnaGJvckFyZzUpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiIgogICAgdGltZW91dCA9IHRpbWVvdXQKCiAgICBpZihiZ3BOZWlnaGJvckFyZzEgPT0gImFkZHJlc3MtZmFtaWx5Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9hZGRyZXNzX2ZhbWlseSIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIgKyAiIHVuaWNhc3QgXG4iCiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICAgICAgcmV0VmFsID0gd2FpdEZvckRldmljZVJlc3BvbnNlKAogICAgICAgICAgICAgICAgY29tbWFuZCwgIihjb25maWctcm91dGVyLW5laWdoYm9yLWFmKSMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIGJncE5laWdoYm9yQUZDb25maWcoCiAgICAgICAgICAgICAgICBvYmosIGRldmljZVR5cGUsICIoY29uZmlnLXJvdXRlci1uZWlnaGJvci1hZikjIiwgdGltZW91dCwKICAgICAgICAgICAgICAgIGJncE5laWdoYm9yQXJnMywgYmdwTmVpZ2hib3JBcmc0LCBiZ3BOZWlnaGJvckFyZzUpCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImFkdmVydGlzZW1lbnQtaW50ZXJ2YWwiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMQoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJiZmQiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIGlmKGJncE5laWdoYm9yQXJnMiBpcyBub3QgTm9uZSBhbmQgYmdwTmVpZ2hib3JBcmcyID09ICJtdXRpaG9wIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAiY29ubmVjdGlvbi1yZXRyeS10aW1lIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9jb25uZWN0aW9uX3JldHJ5dGltZSIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE1IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImRlc2NyaXB0aW9uIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl9kZXNjcmlwdGlvbiIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzE0IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImRpc2FsbG93LWluZmluaXRlLWhvbGR0aW1lIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAiZG9udC1jYXBhYmlsaXR5LW5lZ290aWF0ZSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImR5bmFtaWMtY2FwYWJpbGl0eSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gImViZ3AtbXVsdGlob3AiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX21heGhvcGNvdW50IiwgYmdwTmVpZ2hib3JBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTMiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJpbnRlcmZhY2UiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgICMgVEJECiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAibG9jYWwtYXMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX2xvY2FsX2FzIiwgYmdwTmVpZ2hib3JBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMiArICIgIgogICAgICAgICAgICBpZihiZ3BOZWlnaGJvckFyZzMgaXMgbm90IE5vbmUgYW5kCiAgICAgICAgICAgICAgICAgICAgYmdwTmVpZ2hib3JBcmczID09ICJuby1wcmVwZW5kIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMyArICIgIgogICAgICAgICAgICAgICAgaWYoYmdwTmVpZ2hib3JBcmc0IGlzIG5vdCBOb25lIGFuZAogICAgICAgICAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzQgPT0gInJlcGxhY2UtYXMiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgIGlmKGJncE5laWdoYm9yQXJnNSBpcyBub3QgTm9uZSBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJncE5laWdoYm9yQXJnNSA9PSAiZHVhbC1hcyIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnNQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMTIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAibWF4aW11bS1wZWVycyIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfbWF4cGVlcnMiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMxMSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJwYXNzd29yZCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfcGFzc3dvcmQiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMxMCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwTmVpZ2hib3JBcmcxID09ICJyZW1vdmUtcHJpdmF0ZS1BUyIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gInRpbWVycyIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfbmVpZ2hib3JfdGltZXJzX0tlZXBhbGl2ZSIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX3RpbWVyc19ob2xkdGltZSIsIGJncE5laWdoYm9yQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwOSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzA4IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gInRyYW5zcG9ydCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiBjb25uZWN0aW9uLW1vZGUgcGFzc2l2ZSAiCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gInR0bC1zZWN1cml0eSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcxICsgIiBob3BzICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl90dGxfaG9wcyIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzA3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BOZWlnaGJvckFyZzEgPT0gInVwZGF0ZS1zb3VyY2UiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMSArICIgIgogICAgICAgIGlmKGJncE5laWdoYm9yQXJnMiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl91cGRhdGVfb3B0aW9ucyIsIGJncE5laWdoYm9yQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoYmdwTmVpZ2hib3JBcmcyID09ICJldGhlcm5ldCIpOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX25laWdoYm9yX3VwZGF0ZV9ldGhlcm5ldCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJncE5laWdoYm9yQXJnMykKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzMKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzA0IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbGlmKGJncE5laWdoYm9yQXJnMiA9PSAibG9vcGJhY2siKToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl91cGRhdGVfbG9vcGJhY2siLAogICAgICAgICAgICAgICAgICAgICAgICBiZ3BOZWlnaGJvckFyZzMpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmczCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwNSIKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl91cGRhdGVfdmxhbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJncE5laWdoYm9yQXJnMykKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzMKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzA2IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncE5laWdoYm9yQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0zMDMiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncE5laWdoYm9yQXJnMSA9PSAid2VpZ2h0Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BOZWlnaGJvckFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImJncF9uZWlnaGJvcl93ZWlnaHQiLCBiZ3BOZWlnaGJvckFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwTmVpZ2hib3JBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTMwMSIKICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICBjb21tYW5kID0gImV4aXQgXG4iCiAgICByZXRWYWwgPSByZXRWYWwgKyBcCiAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoY29uZmlnLXJvdXRlcikjIiwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBiZ3BBRkNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBiZ3BBRkFyZzEsIGJncEFGQXJnMiwgYmdwQUZBcmczLAogICAgICAgIGJncEFGQXJnNCwgYmdwQUZBcmc1LCBiZ3BBRkFyZzYpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiIgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgIGlmKGJncEFGQXJnMSA9PSAiYWdncmVnYXRlLWFkZHJlc3MiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX2FnZ3JlZ2F0ZV9wcmVmaXgiLCBiZ3BBRkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncEFGQXJnMiBpcyBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgIGVsaWYoYmdwQUZBcmcyID09ICJhcy1zZXQiIG9yIGJncEFGQXJnMiA9PSAic3VtbWFyeS1vbmx5Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoYmdwQUZBcmczIGlzIE5vbmUpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgICAgICBlbGlmKGJncEFGQXJnMiA9PSAiYXMtc2V0Iik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAic3VtbWFyeS1vbmx5IgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICJhcy1zZXQiCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjk3IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTYiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYoYmdwQUZBcmcxID09ICJjbGllbnQtdG8tY2xpZW50Iik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzEgKyAiIHJlZmxlY3Rpb24gIgogICAgZWxpZihiZ3BBRkFyZzEgPT0gImRhbXBlbmluZyIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwQUZBcmcyID09ICJyb3V0ZS1tYXAiKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWRkcmZhbWlseV9yb3V0ZW1hcF9uYW1lIiwgYmdwQUZBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTk2IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYoYmdwQUZBcmcyIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAicmVhY2hhYmlsaXR5X2hhbGZfbGlmZSIsIGJncEFGQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMiArICIgIgogICAgICAgICAgICAgICAgaWYoYmdwQUZBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgICAgICB2YWx1ZTEgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzdGFydF9yZXVzZV9yb3V0ZV92YWx1ZSIsIGJncEFGQXJnMykKICAgICAgICAgICAgICAgICAgICB2YWx1ZTIgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJzdGFydF9zdXBwcmVzc19yb3V0ZV92YWx1ZSIsIGJncEFGQXJnNCkKICAgICAgICAgICAgICAgICAgICB2YWx1ZTMgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJtYXhfZHVyYXRpb25fdG9fc3VwcHJlc3Nfcm91dGUiLAogICAgICAgICAgICAgICAgICAgICAgICBiZ3BBRkFyZzUpCiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUxID09ICJvayIgYW5kIHZhbHVlMiA9PSAib2siIGFuZCB2YWx1ZTMgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczICsgIiAiICsgYmdwQUZBcmc0ICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiAiICsgYmdwQUZBcmc1ICsgIiAiCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnNiBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1bnJlYWNoYWJpbGl0eV9oYWxmdGltZV9mb3JfcGVuYWx0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdwQUZBcmc2KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzYKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjk1IgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjk0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQUZBcmcxID09ICJkaXN0YW5jZSIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJkaXN0YW5jZV9leHRlcm5hbF9BUyIsIGJncEFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiZGlzdGFuY2VfaW50ZXJuYWxfQVMiLCBiZ3BBRkFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzMgKyAiICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJkaXN0YW5jZV9sb2NhbF9yb3V0ZXMiLCBiZ3BBRkFyZzQpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnNAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjkxIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTIiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5MyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZihiZ3BBRkFyZzEgPT0gIm1heGltdW0tcGF0aHMiKToKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJtYXhwYXRoX29wdGlvbiIsIGJncEFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibWF4cGF0aF9udW1iZXJzIiwgYmdwQUZBcmczKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTk5IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0yOTAiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFGQXJnMSA9PSAibmV0d29yayIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwQUZBcmcyID09ICJzeW5jaHJvbml6YXRpb24iKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJuZXR3b3JrX2lwX3ByZWZpeF93aXRoX21hc2siLCBiZ3BBRkFyZzIpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgICAgIGlmKGJncEFGQXJnMyBpcyBub3QgTm9uZSBhbmQgYmdwQUZBcmczID09ICJiYWNrZG9vciIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgICAgICBlbGlmKGJncEFGQXJnMyBpcyBub3QgTm9uZSBhbmQgYmdwQUZBcmczID09ICJyb3V0ZS1tYXAiKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMwogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWRkcmZhbWlseV9yb3V0ZW1hcF9uYW1lIiwgYmdwQUZBcmc0KQogICAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBpZihiZ3BBRkFyZzUgaXMgbm90IE5vbmUgYW5kIGJncEFGQXJnNSA9PSAiYmFja2Rvb3IiKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmc1CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMjk4IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTYiCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJuZXR3b3JrX2lwX3ByZWZpeF92YWx1ZSIsIGJncEFGQXJnMikKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcyICsgIiAiCiAgICAgICAgICAgICAgICAgICAgaWYoYmdwQUZBcmczIGlzIG5vdCBOb25lIGFuZCBiZ3BBRkFyZzMgPT0gImJhY2tkb29yIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgICAgICAgICAgZWxpZihiZ3BBRkFyZzMgaXMgbm90IE5vbmUgYW5kIGJncEFGQXJnMyA9PSAicm91dGUtbWFwIik6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmczCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFkZHJmYW1pbHlfcm91dGVtYXBfbmFtZSIsIGJncEFGQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYmdwQUZBcmc1IGlzIG5vdCBOb25lIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZ3BBRkFyZzUgPT0gImJhY2tkb29yIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5OCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTk2IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICAgICAgICAgIGVsaWYoYmdwQUZBcmczIGlzIG5vdCBOb25lIGFuZCBiZ3BBRkFyZzMgPT0gIm1hc2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzMKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAibmV0d29ya19pcF9wcmVmaXhfbWFzayIsIGJncEFGQXJnNCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnNCArICIgIgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTI5OSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMzAwIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFGQXJnMSA9PSAibmV4dGhvcCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQUZBcmcxICsgIiB0cmlnZ2VyLWRlbGF5IGNyaXRpY2FsICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm5leHRob3BfY3J0aXRpY2FsX2RlbGF5IiwgYmdwQUZBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMiArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJuZXh0aG9wX25vbmNydGl0aWNhbF9kZWxheSIsIGJncEFGQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFGQXJnMyArICIgIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5OCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTk3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKGJncEFGQXJnMSA9PSAicmVkaXN0cmlidXRlIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgImFkZHJmYW1pbHlfcmVkaXN0cmlidXRlX29wdGlvbiIsIGJncEFGQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzIgKyAiICIKICAgICAgICAgICAgaWYoYmdwQUZBcmcyIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgInJvdXRlLW1hcCAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiYWRkcmZhbWlseV9yb3V0ZW1hcF9uYW1lIiwgYmdwQUZBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgZWxpZihiZ3BBRkFyZzEgPT0gInNhdmUiIG9yIGJncEFGQXJnMSA9PSAic3luY2hyb25pemF0aW9uIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBRkFyZzEKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5NCIKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgIGNvbW1hbmQgPSAiZXhpdCBcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIFwKICAgICAgICB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIihjb25maWctcm91dGVyKSMiLCB0aW1lb3V0LCBvYmopCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGJncENvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCBiZ3BBcmcxLCBiZ3BBcmcyLCBiZ3BBcmczLCBiZ3BBcmc0LAogICAgICAgIGJncEFncjUsIGJncEFyZzYsIGJncEFyZzcsIGJncEFyZzgpOgogICAgcmV0VmFsID0gIiIKICAgIGNvbW1hbmQgPSAiIgogICAgIyBXYWl0IHRpbWUgdG8gZ2V0IHJlc3BvbnNlIGZyb20gc2VydmVyCiAgICB0aW1lb3V0ID0gdGltZW91dAogICAgaWYoYmdwQXJnMSA9PSAiYWRkcmVzcy1mYW1pbHkiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfYWRkcmVzc19mYW1pbHkiLCBiZ3BBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIgKyAiICIgKyAidW5pY2FzdCBcbiIKICAgICAgICAgICAgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICAgICAgcmV0VmFsID0gd2FpdEZvckRldmljZVJlc3BvbnNlKAogICAgICAgICAgICAgICAgY29tbWFuZCwgIihjb25maWctcm91dGVyLWFmKSMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIGJncEFGQ29uZmlnKAogICAgICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy1yb3V0ZXItYWYpIyIsIHRpbWVvdXQsCiAgICAgICAgICAgICAgICBiZ3BBcmczLCBiZ3BBcmc0LCBiZ3BBZ3I1LCBiZ3BBcmc2LCBiZ3BBcmc3LCBiZ3BBcmc4KQogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE3OCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiYmVzdHBhdGgiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiAiCiAgICAgICAgaWYoYmdwQXJnMiA9PSAiYWx3YXlzLWNvbXBhcmUtbWVkIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJjb21wYXJlLWNvbmZlZC1hc3BhdGgiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcyKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbGlmKGJncEFyZzIgPT0gImNvbXBhcmUtcm91dGVyaWQiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcyKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbGlmKGJncEFyZzIgPT0gImRvbnQtY29tcGFyZS1vcmlnaW5hdG9yLWlkIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJ0aWUtYnJlYWstb24tYWdlIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJhcy1wYXRoIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyICsgIiAiCiAgICAgICAgICAgIGlmKGJncEFyZzMgPT0gImlnbm9yZSIgb3IgYmdwQXJnMyA9PSAibXVsdGlwYXRoLXJlbGF4Iik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzMKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzkiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZihiZ3BBcmcyID09ICJtZWQiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcyKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIgKyAiICIKICAgICAgICAgICAgaWYoYmdwQXJnMyA9PSAiY29uZmVkIiBvcgogICAgICAgICAgICAgICBiZ3BBcmczID09ICJtaXNzaW5nLWFzLXdvcnN0IiBvcgogICAgICAgICAgICAgICBiZ3BBcmczID09ICJub24tZGV0ZXJtaW5pc3RpYyIgb3IKICAgICAgICAgICAgICAgYmdwQXJnMyA9PSAicmVtb3ZlLXJlY3YtbWVkIiBvcgogICAgICAgICAgICAgICBiZ3BBcmczID09ICJyZW1vdmUtc2VuZC1tZWQiKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4MCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTgxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJiZ3AiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiBhcy1sb2NhbC1jb3VudCAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJiZ3BfYmdwX2xvY2FsX2NvdW50IiwgYmdwQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4MiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAiY2x1c3Rlci1pZCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAiY2x1c3Rlcl9pZF9hc19pcCIsIGJncEFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgImNsdXN0ZXJfaWRfYXNfbnVtYmVyIiwgYmdwQXJnMikKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJjb25mZWRlcmF0aW9uIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgIgogICAgICAgIGlmKGJncEFyZzIgPT0gImlkZW50aWZpZXIiKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiY29uZmVkZXJhdGlvbl9pZGVudGlmaWVyIiwgYmdwQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgIiArIGJncEFyZzIgKyAiICIgKyBiZ3BBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTg0IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYoYmdwQXJnMiA9PSAicGVlcnMiKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAiY29uZmVkZXJhdGlvbl9wZWVyc19hcyIsIGJncEFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiICIgKyBiZ3BBcmcyICsgIiAiICsgYmdwQXJnMwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE4NSIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTg2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJlbmZvcmNlLWZpcnN0LWFzIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMQoKICAgIGVsaWYoYmdwQXJnMSA9PSAiZmFzdC1leHRlcm5hbC1mYWlsb3ZlciIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEKCiAgICBlbGlmKGJncEFyZzEgPT0gImdyYWNlZnVsLXJlc3RhcnQiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiBzdGFsZXBhdGgtdGltZSAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJzdGFsZXBhdGhfZGVsYXlfdmFsdWUiLCBiZ3BBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTg3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZihiZ3BBcmcxID09ICJncmFjZWZ1bC1yZXN0YXJ0LWhlbHBlciIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEKCiAgICBlbGlmKGJncEFyZzEgPT0gImxvZy1uZWlnaGJvci1jaGFuZ2VzIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMWYKCiAgICBlbGlmKGJncEFyZzEgPT0gIm1heGFzLWxpbWl0Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJtYXhhc19saW1pdF9hcyIsIGJncEFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODgiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gIm5laWdoYm9yIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dChiZ3BBcmcxKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAibmVpZ2hib3JfaXBhZGRyZXNzIiwgYmdwQXJnMikKICAgICAgICAjIHJldFZhbCA9ICJFcnJvci0xMDIiCiAgICAgICAgIyByZXR1cm4gcmV0VmFsCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgICAgICBpZihiZ3BBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiByZW1vdGUtYXMgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgIm5laWdoYm9yX2FzIiwgYmdwQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMyArICJcbiIKICAgICAgICAgICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gd2FpdEZvckRldmljZVJlc3BvbnNlKAogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLCAiKGNvbmZpZy1yb3V0ZXItbmVpZ2hib3IpIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBiZ3BOZWlnaGJvckNvbmZpZygKICAgICAgICAgICAgICAgICAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy1yb3V0ZXItbmVpZ2hib3IpIyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQsIGJncEFyZzQsIGJncEFncjUsIGJncEFyZzYsIGJncEFyZzcsIGJncEFyZzgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xODkiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gInJvdXRlci1pZCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAicm91dGVyX2lkIiwgYmdwQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE5MCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYoYmdwQXJnMSA9PSAic2h1dGRvd24iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxCgogICAgZWxpZihiZ3BBcmcxID09ICJzeW5jaHJvbml6YXRpb24iKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxCgogICAgZWxpZihiZ3BBcmcxID09ICJ0aW1lcnMiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KGJncEFyZzEpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyBiZ3BBcmcxICsgIiBiZ3AgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAiYmdwX2tlZXBhbGl2ZV9pbnRlcnZhbCIsIGJncEFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgYmdwQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTEiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBpZihiZ3BBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgImJncF9ob2xkdGltZSIsIGJncEFyZzMpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyAiICIgKyBiZ3BBcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTkyIgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xOTIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKGJncEFyZzEgPT0gInZyZiIpOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIGJncEFyZzEgKyAiIGRlZmF1bHQiCiAgICBlbHNlOgogICAgICAgICMgZGVidWdPdXRwdXQoYmdwQXJnMSkKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTkyIgogICAgICAgIHJldHVybiByZXRWYWwKICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgIyBDb21lIGJhY2sgdG8gY29uZmlnIG1vZGUKICAgIGNvbW1hbmQgPSAiZXhpdCBcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKGNvbmZpZykjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgdmxhbkNvbmZpZygKICAgIG9iaiwgZGV2aWNlVHlwZSwgcHJvbXB0LCB0aW1lb3V0LCB2bGFuQXJnMSwgdmxhbkFyZzIsIHZsYW5BcmczLAogICAgICAgIHZsYW5Bcmc0LCB2bGFuQXJnNSk6CgogICAgcmV0VmFsID0gIiIKICAgICMgV2FpdCB0aW1lIHRvIGdldCByZXNwb25zZSBmcm9tIHNlcnZlcgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgICMgdmxhbiBjb25maWcgY29tbWFuZCBoYXBwZW5zIGhlcmUuCiAgICBjb21tYW5kID0gInZsYW4gIgoKICAgIGlmKHZsYW5BcmcxID09ICJhY2Nlc3MtbWFwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiYWNjZXNzLW1hcCAiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fYWNjZXNzX21hcF9uYW1lIiwgdmxhbkFyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzIgKyAiIFxuIgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgICAgIHJldFZhbCA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZSgKICAgICAgICAgICAgICAgIGNvbW1hbmQsICIoY29uZmlnLWFjY2Vzcy1tYXApIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgdmxhbkFjY2Vzc01hcENvbmZpZygKICAgICAgICAgICAgICAgIG9iaiwgZGV2aWNlVHlwZSwgIihjb25maWctYWNjZXNzLW1hcCkjIiwgdGltZW91dCwgdmxhbkFyZzMsCiAgICAgICAgICAgICAgICB2bGFuQXJnNCwgdmxhbkFyZzUpCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTMwIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFuQXJnMSA9PSAiZG90MXEiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJkb3QxcSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMSArICIgdGFnIG5hdGl2ZSAiCiAgICAgICAgaWYodmxhbkFyZzIgaXMgbm90IE5vbmUpOgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2RvdDFxX3RhZyIsIHZsYW5BcmcyKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzEiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFuQXJnMSA9PSAiZmlsdGVyIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCggImZpbHRlciIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMSArICIgIgogICAgICAgIGlmKHZsYW5BcmcyIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9maWx0ZXJfbmFtZSIsIHZsYW5BcmcyKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzIgKyAiIHZsYW4tbGlzdCAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhbl9pZCIsIHZsYW5BcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5faWRfcmFuZ2UiLCB2bGFuQXJnMykKICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFUlJPUi0xMzMiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzMiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbHNlOgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2bGFuX2lkIiwgdmxhbkFyZzEpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIHJldFZhbCA9IGNyZWF0ZVZsYW4ob2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy12bGFuKSMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQsIHZsYW5BcmcxLCB2bGFuQXJnMiwgdmxhbkFyZzMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmxhbkFyZzQsIHZsYW5Bcmc1KQogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9pZF9yYW5nZSIsIHZsYW5BcmcxKQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIHJldFZhbCA9IGNyZWF0ZVZsYW4ob2JqLCBkZXZpY2VUeXBlLCAiKGNvbmZpZy12bGFuKSMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0LCB2bGFuQXJnMSwgdmxhbkFyZzIsIHZsYW5BcmczLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bGFuQXJnNCwgdmxhbkFyZzUpCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzMiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM0IgogICAgICAgIHJldHVybiByZXRWYWwKCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaikKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgdmxhbkFjY2Vzc01hcENvbmZpZygKICAgICAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgdmxhbkFyZzMsIHZsYW5Bcmc0LCB2bGFuQXJnNSk6CiAgICByZXRWYWwgPSAiIgogICAgIyBXYWl0IHRpbWUgdG8gZ2V0IHJlc3BvbnNlIGZyb20gc2VydmVyCiAgICB0aW1lb3V0ID0gdGltZW91dAogICAgY29tbWFuZCA9ICIiCiAgICBpZih2bGFuQXJnMyA9PSAiYWN0aW9uIik6CiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9hY2Nlc3NtYXBfYWN0aW9uIiwgdmxhbkFyZzQpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM1IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKHZsYW5BcmczID09ICJtYXRjaCIpOgogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICBpZih2bGFuQXJnNCA9PSAiaXAiIG9yIHZsYW5Bcmc0ID09ICJtYWMiKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNCArICIgYWRkcmVzcyAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fYWNjZXNzX21hcF9uYW1lIiwgdmxhbkFyZzUpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEzNiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTM3IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBlbGlmKHZsYW5BcmczID09ICJzdGF0aXN0aWNzIik6CiAgICAgICAgY29tbWFuZCA9IHZsYW5BcmczICsgIiBwZXItZW50cnkiCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzgiCiAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBjaGVja1ZsYW5OYW1lTm90QXNzaWduZWQoCiAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHZsYW5JZCwgdmxhbk5hbWUpOgogICAgcmV0VmFsID0gIm9rIgogICAgY29tbWFuZCA9ICJkaXNwbGF5IHZsYW4gaWQgIiArIHZsYW5JZCArICIgXG4iCiAgICByZXRWYWwgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgcHJvbXB0LCB0aW1lb3V0LCBvYmopCiAgICBpZihyZXRWYWwuZmluZCh2bGFuTmFtZSkgIT0gLTEpOgogICAgICAgIHJldHVybiAiTm9rIgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCiMgVXRpbGl0eSBNZXRob2QgdG8gY3JlYXRlIHZsYW4KZGVmIGNyZWF0ZVZsYW4oCiAgICAgICAgb2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsIHZsYW5BcmcxLCB2bGFuQXJnMiwgdmxhbkFyZzMsCiAgICAgICAgdmxhbkFyZzQsIHZsYW5Bcmc1KToKCiAgICAjIHZsYW4gY29uZmlnIGNvbW1hbmQgaGFwcGVucyBoZXJlLiBJdCBjcmVhdGVzIGlmIG5vdCBwcmVzZW50CiAgICBjb21tYW5kID0gInZsYW4gIiArIHZsYW5BcmcxICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgY29tbWFuZCA9ICIiCiAgICBpZih2bGFuQXJnMiA9PSAibmFtZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm5hbWUiKQogICAgICAgIGNvbW1hbmQgPSB2bGFuQXJnMiArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2bGFuX25hbWUiLCB2bGFuQXJnMykKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1ZsYW5OYW1lTm90QXNzaWduZWQob2JqLCBkZXZpY2VUeXBlLCBwcm9tcHQsIHRpbWVvdXQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZsYW5BcmcxLCB2bGFuQXJnMykKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gIlxuIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xMzkiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgIGVsaWYgKHZsYW5BcmcyID09ICJmbG9vZCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImZsb29kIikKICAgICAgICBjb21tYW5kID0gdmxhbkFyZzIgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhbl9mbG9vZCIsIHZsYW5BcmczKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0MCIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhbkFyZzIgPT0gInN0YXRlIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgic3RhdGUiKQogICAgICAgIGNvbW1hbmQgPSB2bGFuQXJnMiArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2bGFuX3N0YXRlIiwgdmxhbkFyZzMpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQxIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFuQXJnMiA9PSAiaXAiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJpcCIpCiAgICAgICAgY29tbWFuZCA9IHZsYW5BcmcyICsgIiBpZ21wIHNub29waW5nICIKICAgICAgICAjIGRlYnVnT3V0cHV0KCJ2bGFuQXJnMyIpCiAgICAgICAgaWYodmxhbkFyZzMgaXMgTm9uZSBvciB2bGFuQXJnMyA9PSAiIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoIk5vbmUgb3IgZW1wdHkiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZAogICAgICAgIGVsaWYodmxhbkFyZzMgPT0gImZhc3QtbGVhdmUiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgiZmFzdC1sZWF2ZSIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMKCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gImxhc3QtbWVtYmVyLXF1ZXJ5LWludGVydmFsIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoImxhc3QtbWVtYmVyLXF1ZXJ5LWludGVydmFsIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX2xhc3RfbWVtYmVyX3F1ZXJ5X2ludGVydmFsIiwgdmxhbkFyZzQpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0MiIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInF1ZXJpZXIiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgicXVlcmllciIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgInZsYW5fcXVlcmllciIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInF1ZXJpZXItdGltZW91dCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJxdWVyaWVyLXRpbWVvdXQiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fcXVlcmllcl90aW1lb3V0IiwgdmxhbkFyZzQpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0NCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAicXVlcnktaW50ZXJ2YWwiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgicXVlcnktaW50ZXJ2YWwiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fcXVlcnlfaW50ZXJ2YWwiLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQ1IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJxdWVyeS1tYXgtcmVzcG9uc2UtdGltZSIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJxdWVyeS1tYXgtcmVzcG9uc2UtdGltZSIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9xdWVyeV9tYXhfcmVzcG9uc2VfdGltZSIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDYiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInJlcG9ydC1zdXBwcmVzc2lvbiIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJyZXBvcnQtc3VwcHJlc3Npb24iKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczCgogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJyb2J1c3RuZXNzLXZhcmlhYmxlIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInJvYnVzdG5lc3MtdmFyaWFibGUiKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fcm9idXN0bmVzc192YXJpYWJsZSIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNDciCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gInN0YXJ0dXAtcXVlcnktY291bnQiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgic3RhcnR1cC1xdWVyeS1jb3VudCIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiICIKICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9zdGFydHVwX3F1ZXJ5X2NvdW50IiwgdmxhbkFyZzQpCiAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE0OCIKICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBlbGlmICh2bGFuQXJnMyA9PSAic3RhcnR1cC1xdWVyeS1pbnRlcnZhbCIpOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJzdGFydHVwLXF1ZXJ5LWludGVydmFsIikKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMyArICIgIgogICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFuX3N0YXJ0dXBfcXVlcnlfaW50ZXJ2YWwiLCB2bGFuQXJnNCkKICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTQ5IgogICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJzdGF0aWMtZ3JvdXAiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgic3RhdGljLWdyb3VwIikKICAgICAgICAgICAgIyBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgICMgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoZGV2aWNlVHlwZSwgdmFyaWFibGVJZCwgdmxhbkFyZzQpCiAgICAgICAgICAgICMgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICMgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNAoKICAgICAgICAgICAgIyBlbHNlIDoKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTEwMiIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsaWYgKHZsYW5BcmczID09ICJ2ZXJzaW9uIik6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoInZlcnNpb24iKQogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5BcmczICsgIiAiCiAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fc25vb3BpbmdfdmVyc2lvbiIsIHZsYW5Bcmc0KQogICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzQKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNTAiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxpZiAodmxhbkFyZzMgPT0gIm1yb3V0ZXIiKToKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCgibXJvdXRlciIpCiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhbkFyZzMgKyAiIGludGVyZmFjZSAiCiAgICAgICAgICAgIGlmKHZsYW5Bcmc0ID09ICJldGhlcm5ldCIpOgogICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNCArICIgIgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYW5fZXRoZXJuZXRfaW50ZXJmYWNlIiwgdmxhbkFyZzUpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc1CiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNTEiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKHZsYW5Bcmc0ID09ICJwb3J0LWFnZ3JlZ2F0aW9uIik6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYW5Bcmc0ICsgIiAiCiAgICAgICAgICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhbl9wb3J0YWdnX251bWJlciIsIHZsYW5Bcmc1KQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnNQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTUyIgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNTMiCiAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFuQXJnMwoKICAgIGVsc2U6CiAgICAgICAgcmV0VmFsID0gIkVycm9yLTE1NCIKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICBjb21tYW5kID0gY29tbWFuZCArICJcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArICJcbiIgKyBcCiAgICAgICAgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsIHByb21wdCwgdGltZW91dCwgb2JqKQogICAgIyBDb21lIGJhY2sgdG8gY29uZmlnIG1vZGUKICAgIGNvbW1hbmQgPSAiZXhpdCBcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKGNvbmZpZykjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCgpkZWYgdmxhZ0NvbmZpZygKICAgICAgICBvYmosIGRldmljZVR5cGUsIHByb21wdCwgdGltZW91dCwgdmxhZ0FyZzEsIHZsYWdBcmcyLCB2bGFnQXJnMywKICAgICAgICB2bGFnQXJnNCk6CgogICAgcmV0VmFsID0gIiIKICAgICMgV2FpdCB0aW1lIHRvIGdldCByZXNwb25zZSBmcm9tIHNlcnZlcgogICAgdGltZW91dCA9IHRpbWVvdXQKICAgICMgdmxhZyBjb25maWcgY29tbWFuZCBoYXBwZW5zIGhlcmUuCiAgICBjb21tYW5kID0gInZsYWcgIgoKICAgIGlmKHZsYWdBcmcxID09ICJlbmFibGUiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJlbmFibGUiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKCiAgICBlbGlmKHZsYWdBcmcxID09ICJhdXRvLXJlY292ZXJ5Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiYXV0by1yZWNvdmVyeSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICBkZXZpY2VUeXBlLCAidmxhZ19hdXRvX3JlY292ZXJ5IiwgdmxhZ0FyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTYwIgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFnQXJnMSA9PSAiY29uZmlnLWNvbnNpc3RlbmN5Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiY29uZmlnLWNvbnNpc3RlbmN5IikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX2NvbmZpZ19jb25zaXN0ZW5jeSIsIHZsYWdBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2MSIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhZ0FyZzEgPT0gImlzbCIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImlzbCIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgcG9ydC1hZ2dyZWdhdGlvbiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3BvcnRfYWdncmVnYXRpb24iLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjIiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYWdBcmcxID09ICJtYWMtYWRkcmVzcy10YWJsZSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoIm1hYy1hZGRyZXNzLXRhYmxlIikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiByZWZyZXNoIgoKICAgIGVsaWYodmxhZ0FyZzEgPT0gInBlZXItZ2F0ZXdheSIpOgogICAgICAgICMgZGVidWdPdXRwdXQoInBlZXItZ2F0ZXdheSIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgIgoKICAgIGVsaWYodmxhZ0FyZzEgPT0gInByaW9yaXR5Iik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgicHJpb3JpdHkiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhZ19wcmlvcml0eSIsIHZsYWdBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2MyIKICAgICAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgIGVsaWYodmxhZ0FyZzEgPT0gInN0YXJ0dXAtZGVsYXkiKToKICAgICAgICAjIGRlYnVnT3V0cHV0KCJzdGFydHVwLWRlbGF5IikKICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcxICsgIiAiCiAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3N0YXJ0dXBfZGVsYXkiLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjQiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYWdBcmcxID09ICJ0aWVyLWlkIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgidGllci1pZCIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgIgogICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKGRldmljZVR5cGUsICJ2bGFnX3RpZXJfaWQiLCB2bGFnQXJnMikKICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjUiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbGlmKHZsYWdBcmcxID09ICJ2cnJwIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgidnJycCIpCiAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMSArICIgYWN0aXZlIgoKICAgIGVsaWYodmxhZ0FyZzEgPT0gImluc3RhbmNlIik6CiAgICAgICAgIyBkZWJ1Z091dHB1dCgiaW5zdGFuY2UiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCAidmxhZ19pbnN0YW5jZSIsIHZsYWdBcmcyKQogICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyCiAgICAgICAgICAgIGlmKHZsYWdBcmczIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiBwb3J0LWFnZ3JlZ2F0aW9uICIKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX3BvcnRfYWdncmVnYXRpb24iLCB2bGFnQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzMKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gIkVycm9yLTE2MiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArICIgZW5hYmxlICIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY2IgogICAgICAgICAgICByZXR1cm4gcmV0VmFsCgogICAgZWxpZih2bGFnQXJnMSA9PSAiaGx0aGNoayIpOgogICAgICAgICMgZGVidWdPdXRwdXQoImhsdGhjaGsiKQogICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzEgKyAiICIKICAgICAgICB2YWx1ZSA9IGNoZWNrU2FuaXR5b2ZWYXJpYWJsZSgKICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYWdfaGx0aGNoa19vcHRpb25zIiwgdmxhZ0FyZzIpCiAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgIGlmKHZsYWdBcmcyID09ICJrZWVwYWxpdmUtYXR0ZW1wdHMiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX2tlZXBhbGl2ZV9hdHRlbXB0cyIsIHZsYWdBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMiArICIgIiArIHZsYWdBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjciCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKHZsYWdBcmcyID09ICJrZWVwYWxpdmUtaW50ZXJ2YWwiKToKICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgIGRldmljZVR5cGUsICJ2bGFnX2tlZXBhbGl2ZV9pbnRlcnZhbCIsIHZsYWdBcmczKQogICAgICAgICAgICAgICAgaWYodmFsdWUgPT0gIm9rIik6CiAgICAgICAgICAgICAgICAgICAgY29tbWFuZCA9IGNvbW1hbmQgKyB2bGFnQXJnMiArICIgIiArIHZsYWdBcmczCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNjgiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbGlmKHZsYWdBcmcyID09ICJyZXRyeS1pbnRlcnZhbCIpOgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYWdfcmV0cnlfaW50ZXJ2YWwiLCB2bGFnQXJnMykKICAgICAgICAgICAgICAgIGlmKHZhbHVlID09ICJvayIpOgogICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgdmxhZ0FyZzIgKyAiICIgKyB2bGFnQXJnMwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTY5IgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICAgICAgZWxpZih2bGFnQXJnMiA9PSAicGVlci1pcCIpOgogICAgICAgICAgICAgICAgIyBIZXJlIEkgYW0gbm90IHRha2luZyBjYXJlIG9mIElQVjYgb3B0aW9uLgogICAgICAgICAgICAgICAgdmFsdWUgPSBjaGVja1Nhbml0eW9mVmFyaWFibGUoCiAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYWdfcGVlcmlwIiwgdmxhZ0FyZzMpCiAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gY29tbWFuZCArIHZsYWdBcmcyICsgIiAiICsgdmxhZ0FyZzMKICAgICAgICAgICAgICAgICAgICBpZih2bGFnQXJnNCBpcyBub3QgTm9uZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY2hlY2tTYW5pdHlvZlZhcmlhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlVHlwZSwgInZsYWdfcGVlcmlwX3ZyZiIsIHZsYWdBcmc0KQogICAgICAgICAgICAgICAgICAgICAgICBpZih2YWx1ZSA9PSAib2siKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIiB2cmYgIiArIHZsYWdBcmc0CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXRWYWwgPSAiRXJyb3ItMTcwIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzEiCiAgICAgICAgICAgIHJldHVybiByZXRWYWwKCiAgICBlbHNlOgogICAgICAgIHJldFZhbCA9ICJFcnJvci0xNzIiCiAgICAgICAgcmV0dXJuIHJldFZhbAoKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIGNvbW1hbmQgPSBjb21tYW5kICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoY29uZmlnKSMiLCB0aW1lb3V0LCBvYmopCgogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBVdGlsaXR5IE1ldGhvZCB0byBiYWNrIHVwIHRoZSBzdGFydCB1cCBjb25maWcKIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFRGVFAgb3IgRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9TdGFydHVwQ29uZmlnQmFja1VwKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSAmIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBpZihwcm90b2NvbCA9PSAiZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCBzdGFydHVwLWNvbmZpZyAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgXAogICAgICAgICAgICB1c2VybmFtZSArICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UocGFzc3dvcmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAidGZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3Agc3RhcnR1cC1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyBcCiAgICAgICAgICAgICI6Ly8iICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgdnJmIG1hbmFnZW1lbnRcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIGJhY2sgdXAgdGhlIHN0YXJ0IHVwIGNvbmZpZwojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgU0NQIG9yIFNGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwoKCmRlZiBkb1NlY3VyZVN0YXJ0dXBDb25maWdCYWNrVXAoCiAgICAgICAgcHJvdG9jb2wsIHRpbWVvdXQsIGNvbmZTZXJ2ZXJJcCwgY29uZlBhdGgsIGNvbmZTZXJ2ZXJVc2VyLAogICAgICAgIGNvbmZTZXJ2ZXJQd2QsIG9iaik6CiAgICAjIHNlcnZlciA9ICIxMC4yNDEuMTA1LjIxNCIKICAgIHNlcnZlciA9IGNvbmZTZXJ2ZXJJcAoKICAgICMgdXNlcm5hbWUgPSAicGJob3NhbGUiCiAgICB1c2VybmFtZSA9IGNvbmZTZXJ2ZXJVc2VyCgogICAgIyBwYXNzd29yZCA9ICJMYWI0bWFuMSIKICAgIHBhc3N3b3JkID0gY29uZlNlcnZlclB3ZAoKICAgIHBhdGggPSAiY25vc19jb25maWciCiAgICBpZigoY29uZlBhdGggaXMgbm90IE5vbmUpIGFuZCAoY29uZlBhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gY29uZlBhdGgKCiAgICByZXRWYWwgPSAiIgoKICAgICMgY29uZmlnIGJhY2t1cCBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgY29tbWFuZCA9ICJjcCBzdGFydHVwLWNvbmZpZyAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgXAogICAgICAgIHVzZXJuYW1lICsgIkAiICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgdnJmIG1hbmFnZW1lbnRcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJlc3BvbnNlID0gd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoeWVzL25vKSIsIDMsIG9iaikKICAgIGlmKHJlc3BvbnNlLmxvd2VyKCkuZmluZCgiZXJyb3ItMTAxIikpOgogICAgICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgcmV0VmFsID0gcmV0VmFsICsgcmVzcG9uc2UKICAgIGlmKHByb3RvY29sID09ICJzY3AiKToKICAgICAgICBjb21tYW5kID0gInllcyBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJ0aW1lb3V0OiIsIDMsIG9iaikKICAgICAgICBjb21tYW5kID0gIjBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbGlmKHByb3RvY29sID09ICJzZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICAjIFBhc3N3b3JkIGVudHJ5IGhhcHBlbnMgaGVyZQogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgVXRpbGl0eSBNZXRob2QgdG8gcmVzdG9yZSB0aGUgUnVubmluZyBjb25maWcKIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFRGVFAgb3IgRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9TdGFydFVwQ29uZmlnUm9sbGJhY2soCiAgICAgICAgcHJvdG9jb2wsIHRpbWVvdXQsIGNvbmZTZXJ2ZXJJcCwgY29uZlBhdGgsIGNvbmZTZXJ2ZXJVc2VyLAogICAgICAgIGNvbmZTZXJ2ZXJQd2QsIG9iaik6CiAgICAjIHNlcnZlciA9ICIxMC4yNDEuMTA1LjIxNCIKICAgIHNlcnZlciA9IGNvbmZTZXJ2ZXJJcAoKICAgICMgdXNlcm5hbWUgPSAicGJob3NhbGUiCiAgICB1c2VybmFtZSA9IGNvbmZTZXJ2ZXJVc2VyCgogICAgIyBwYXNzd29yZCA9ICJMYWI0bWFuMSIKICAgIHBhc3N3b3JkID0gY29uZlNlcnZlclB3ZAoKICAgIHBhdGggPSAiY25vc19jb25maWciCiAgICBpZigoY29uZlBhdGggaXMgbm90IE5vbmUpICYgKGNvbmZQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGNvbmZQYXRoCgogICAgcmV0VmFsID0gIiIKCiAgICAjIGNvbmZpZyBiYWNrdXAgY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGlmKHByb3RvY29sID09ICJmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgIjovLyIgKyB1c2VybmFtZSArIFwKICAgICAgICAgICAgIkAiICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgc3RhcnR1cC1jb25maWcgdnJmIG1hbmFnZW1lbnRcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiW25dIiwgdGltZW91dCwgb2JqKQogICAgICAgIGNvbW1hbmQgPSAieVxuIgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShwYXNzd29yZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICBlbGlmKHByb3RvY29sID09ICJ0ZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgXAogICAgICAgICAgICBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiBzdGFydHVwLWNvbmZpZyB2cmYgbWFuYWdlbWVudFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIHRpbWVvdXQsIG9iaikKICAgICAgICBjb21tYW5kID0gInlcbiIKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICBlbHNlOgogICAgICAgIHJldHVybiAiRXJyb3ItMTEwIgoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgVXRpbGl0eSBNZXRob2QgdG8gcmVzdG9yZSB0aGUgc3RhcnQgdXAgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBTQ1Agb3IgU0ZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvU2VjdXJlU3RhcnRVcENvbmZpZ1JvbGxiYWNrKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSBhbmQgKGNvbmZQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGNvbmZQYXRoCgogICAgcmV0VmFsID0gIiIKCiAgICAjIGNvbmZpZyBiYWNrdXAgY29tbWFuZCBoYXBwZW5zIGhlcmUKCiAgICAjIGNwIHNmdHAgc2Z0cDovL3Jvb3RAMTAuMjQxLjEwNi4xMTgvY25vc19jb25maWcvcnVubmluZ19jb25maWcuY29uZgogICAgIyBzdGFydHVwLWNvbmZpZyB2cmYgbWFuYWdlbWVudAogICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgdXNlcm5hbWUgKyBcCiAgICAgICAgIkAiICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgc3RhcnR1cC1jb25maWcgdnJmIG1hbmFnZW1lbnQgXG4iCgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmVzcG9uc2UgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIih5ZXMvbm8pIiwgMywgb2JqKQogICAgaWYocmVzcG9uc2UubG93ZXIoKS5maW5kKCJlcnJvci0xMDEiKSk6CiAgICAgICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiW25dIiwgdGltZW91dCwgb2JqKQogICAgICAgIGNvbW1hbmQgPSAieVxuIgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICByZXRWYWwgPSByZXRWYWwgKyByZXNwb25zZQogICAgaWYocHJvdG9jb2wgPT0gInNjcCIpOgogICAgICAgIGNvbW1hbmQgPSAieWVzIFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgInRpbWVvdXQ6IiwgMywgb2JqKQogICAgICAgIGNvbW1hbmQgPSAiMFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsaWYocHJvdG9jb2wgPT0gInNmdHAiKToKICAgICAgICBjb21tYW5kID0gInllcyBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbHNlOgogICAgICAgIHJldHVybiAiRXJyb3ItMTEwIgoKICAgICMgUGFzc3dvcmQgZW50cnkgaGFwcGVucyBoZXJlCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICBjb21tYW5kID0gcGFzc3dvcmQgKyAiXG4iCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIHRpbWVvdXQsIG9iaikKICAgIGNvbW1hbmQgPSAieVxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgVXRpbGl0eSBNZXRob2QgdG8gYmFjayB1cCB0aGUgUnVubmluZyBjb25maWcKIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFRGVFAgb3IgRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9SdW5uaW5nQ29uZmlnQmFja1VwKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSAmIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBpZihwcm90b2NvbCA9PSAiZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCBydW5uaW5nLWNvbmZpZyAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgXAogICAgICAgICAgICB1c2VybmFtZSArICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UocGFzc3dvcmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAidGZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgcnVubmluZy1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyBcCiAgICAgICAgICAgICI6Ly8iICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgdnJmIG1hbmFnZW1lbnRcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKIyBVdGlsaXR5IE1ldGhvZCB0byBiYWNrIHVwIHRoZSBydW5uaW5nIGNvbmZpZwojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgU0NQIG9yIFNGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwpkZWYgZG9TZWN1cmVSdW5uaW5nQ29uZmlnQmFja1VwKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSBhbmQgKGNvbmZQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGNvbmZQYXRoCgogICAgcmV0VmFsID0gIiIKCiAgICAjIGNvbmZpZyBiYWNrdXAgY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGNvbW1hbmQgPSAiY3AgcnVubmluZy1jb25maWcgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICB1c2VybmFtZSArICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXNwb25zZSA9IHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKHllcy9ubykiLCAzLCBvYmopCiAgICBpZihyZXNwb25zZS5sb3dlcigpLmZpbmQoImVycm9yLTEwMSIpKToKICAgICAgICBjb21tYW5kID0gcGFzc3dvcmQgKyAiXG4iCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgICAgIHJldHVybiByZXRWYWwKICAgIHJldFZhbCA9IHJldFZhbCArIHJlc3BvbnNlCiAgICBpZihwcm90b2NvbCA9PSAic2NwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAidGltZW91dDoiLCAzLCBvYmopCiAgICAgICAgY29tbWFuZCA9ICIwXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAic2Z0cCIpOgogICAgICAgIGNvbW1hbmQgPSAieWVzIFxuIgogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIlBhc3N3b3JkOiIsIDMsIG9iaikKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCgogICAgIyBQYXNzd29yZCBlbnRyeSBoYXBwZW5zIGhlcmUKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIGNvbW1hbmQgPSBwYXNzd29yZCArICJcbiIKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIHJlc3RvcmUgdGhlIFJ1bm5pbmcgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBURlRQIG9yIEZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvUnVubmluZ0NvbmZpZ1JvbGxiYWNrKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSAmIChjb25mUGF0aCAhPSAiIikpOgogICAgICAgIHBhdGggPSBjb25mUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBjb25maWcgYmFja3VwIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBpZihwcm90b2NvbCA9PSAiZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgdXNlcm5hbWUgKyBcCiAgICAgICAgICAgICJAIiArIHNlcnZlciArICIvIiArIHBhdGggKyAiIHJ1bm5pbmctY29uZmlnIHZyZiBtYW5hZ2VtZW50XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UocGFzc3dvcmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxpZihwcm90b2NvbCA9PSAidGZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIFwKICAgICAgICAgICAgc2VydmVyICsgIi8iICsgcGF0aCArICIgcnVubmluZy1jb25maWcgdnJmIG1hbmFnZW1lbnRcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIHJlc3RvcmUgdGhlIHJ1bm5pbmcgY29uZmlnCiMgVGhpcyBtZXRob2Qgc3VwcG9ydHMgb25seSBTQ1Agb3IgU0ZUUAojIFR1bmluZyBvZiB0aW1lb3V0IHBhcmFtZXRlciBpcyBwZW5kaW5nCgoKZGVmIGRvU2VjdXJlUnVubmluZ0NvbmZpZ1JvbGxiYWNrKAogICAgICAgIHByb3RvY29sLCB0aW1lb3V0LCBjb25mU2VydmVySXAsIGNvbmZQYXRoLCBjb25mU2VydmVyVXNlciwKICAgICAgICBjb25mU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBjb25mU2VydmVySXAKCiAgICAjIHVzZXJuYW1lID0gInBiaG9zYWxlIgogICAgdXNlcm5hbWUgPSBjb25mU2VydmVyVXNlcgoKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGNvbmZTZXJ2ZXJQd2QKCiAgICBwYXRoID0gImNub3NfY29uZmlnIgogICAgaWYoKGNvbmZQYXRoIGlzIG5vdCBOb25lKSBhbmQgKGNvbmZQYXRoICE9ICIiKSk6CiAgICAgICAgcGF0aCA9IGNvbmZQYXRoCgogICAgcmV0VmFsID0gIiIKCiAgICAjIGNvbmZpZyBiYWNrdXAgY29tbWFuZCBoYXBwZW5zIGhlcmUKCiAgICAjIGNwIHNmdHAgc2Z0cDovL3Jvb3RAMTAuMjQxLjEwNi4xMTgvY25vc19jb25maWcvcnVubmluZ19jb25maWcuY29uZgogICAgIyBydW5uaW5nLWNvbmZpZyB2cmYgbWFuYWdlbWVudAogICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgdXNlcm5hbWUgKyBcCiAgICAgICAgIkAiICsgc2VydmVyICsgIi8iICsgcGF0aCArICIgcnVubmluZy1jb25maWcgdnJmIG1hbmFnZW1lbnQgXG4iCgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmVzcG9uc2UgPSB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIih5ZXMvbm8pIiwgMywgb2JqKQogICAgaWYocmVzcG9uc2UubG93ZXIoKS5maW5kKCJlcnJvci0xMDEiKSk6CiAgICAgICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiIyIsIHRpbWVvdXQsIG9iaikKICAgICAgICByZXR1cm4gcmV0VmFsCiAgICByZXRWYWwgPSByZXRWYWwgKyByZXNwb25zZQoKICAgIGlmKHByb3RvY29sID09ICJzY3AiKToKICAgICAgICBjb21tYW5kID0gInllcyBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJ0aW1lb3V0OiIsIDMsIG9iaikKICAgICAgICBjb21tYW5kID0gIjBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbGlmKHByb3RvY29sID09ICJzZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5ZXMgXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICAjIFBhc3N3b3JkIGVudHJ5IGhhcHBlbnMgaGVyZQogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQoKICAgIHJldHVybiByZXRWYWwKIyBFT00KCiMgVXRpbGl0eSBNZXRob2QgdG8gZG93bmxvYWQgYW4gaW1hZ2UgZnJvbSBGVFAvVEZUUCBzZXJ2ZXIgdG8gZGV2aWNlLgojIFRoaXMgbWV0aG9kIHN1cHBvcnRzIG9ubHkgRlRQIG9yIFRGVFAKIyBUdW5pbmcgb2YgdGltZW91dCBwYXJhbWV0ZXIgaXMgcGVuZGluZwoKCmRlZiBkb0ltYWdlVHJhbnNmZXIoCiAgICBwcm90b2NvbCwgdGltZW91dCwgaW1nU2VydmVySXAsIGltZ1BhdGgsIGltZ1R5cGUsIGltZ1NlcnZlclVzZXIsCiAgICAgICAgaW1nU2VydmVyUHdkLCBvYmopOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNi4xMTgiCiAgICBzZXJ2ZXIgPSBpbWdTZXJ2ZXJJcAogICAgIyB1c2VybmFtZSA9ICJyb290IgogICAgdXNlcm5hbWUgPSBpbWdTZXJ2ZXJVc2VyCiAgICAjIHBhc3N3b3JkID0gInJvb3QxMjMiCiAgICBwYXNzd29yZCA9IGltZ1NlcnZlclB3ZAoKICAgIHR5cGUgPSAib3MiCiAgICBpZihpbWdUeXBlIGlzIG5vdCBOb25lKToKICAgICAgICB0eXBlID0gaW1nVHlwZS5sb3dlcigpCgogICAgcGF0aCA9ICJjbm9zX2ltYWdlcyIKICAgIGlmKChpbWdQYXRoIGlzIG5vdCBOb25lKSBhbmQgKGltZ1BhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gaW1nUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBJbWFnZSB0cmFuc2ZlciBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgaWYocHJvdG9jb2wgPT0gImZ0cCIpOgogICAgICAgIGNvbW1hbmQgPSAiY3AgIiArIHByb3RvY29sICsgIiAiICsgcHJvdG9jb2wgKyAiOi8vIiArIHVzZXJuYW1lICsgXAogICAgICAgICAgICAiQCIgKyBzZXJ2ZXIgKyAiLyIgKyBwYXRoICsgIiBzeXN0ZW0taW1hZ2UgIiArIHR5cGUgKyBcCiAgICAgICAgICAgICIgdnJmIG1hbmFnZW1lbnRcbiIKICAgIGVsaWYocHJvdG9jb2wgPT0gInRmdHAiKToKICAgICAgICBjb21tYW5kID0gImNwICIgKyBwcm90b2NvbCArICIgIiArIHByb3RvY29sICsgIjovLyIgKyBzZXJ2ZXIgKyBcCiAgICAgICAgICAgICIvIiArIHBhdGggKyAiIHN5c3RlbS1pbWFnZSAiICsgdHlwZSArICIgdnJmIG1hbmFnZW1lbnRcbiIKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuICJFcnJvci0xMTAiCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIltuXSIsIDMsIG9iaikKICAgICMgQ29uZmlybWF0aW9uIGNvbW1hbmQgaGFwcGVucyBoZXJlCiAgICBjb21tYW5kID0gInlcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgICMgcmV0VmFsID0gcmV0VmFsKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIih5ZXMvbm8pPyIsIDMsIG9iaikKICAgICMgY29tbWFuZCA9ICJZZXMgXG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICBpZihwcm90b2NvbCA9PSAiZnRwIik6CiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICAgICAgIyBQYXNzd29yZCBlbnRyeSBoYXBwZW5zIGhlcmUgT25seSBmb3IgRlRQCiAgICAgICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIiBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAjIENoYW5nZSB0byBzdGFuZGJ5IGltYWdlIHkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiW25dIiwgdGltZW91dCwgb2JqKQogICAgY29tbWFuZCA9ICJ5XG4iCiAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICByZXRWYWwgPSByZXRWYWwgKyB3YWl0Rm9yRGV2aWNlUmVzcG9uc2UoY29tbWFuZCwgIiMiLCB0aW1lb3V0LCBvYmopCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIFV0aWxpdHkgTWV0aG9kIHRvIGRvd25sb2FkIGFuIGltYWdlIGZyb20gU0ZUUC9TQ1Agc2VydmVyIHRvIGRldmljZS4KIyBUaGlzIG1ldGhvZCBzdXBwb3J0cyBvbmx5IFNDUCBvciBTRlRQCiMgVHVuaW5nIG9mIHRpbWVvdXQgcGFyYW1ldGVyIGlzIHBlbmRpbmcKCgpkZWYgZG9TZWN1cmVJbWFnZVRyYW5zZmVyKAogICAgcHJvdG9jb2wsIHRpbWVvdXQsIGltZ1NlcnZlcklwLCBpbWdQYXRoLCBpbWdUeXBlLCBpbWdTZXJ2ZXJVc2VyLAogICAgICAgIGltZ1NlcnZlclB3ZCwgb2JqKToKICAgICMgc2VydmVyID0gIjEwLjI0MS4xMDUuMjE0IgogICAgc2VydmVyID0gaW1nU2VydmVySXAKICAgICMgdXNlcm5hbWUgPSAicGJob3NhbGUiCiAgICB1c2VybmFtZSA9IGltZ1NlcnZlclVzZXIKICAgICMgcGFzc3dvcmQgPSAiTGFiNG1hbjEiCiAgICBwYXNzd29yZCA9IGltZ1NlcnZlclB3ZAoKICAgIHR5cGUgPSAic2NwIgogICAgaWYoaW1nVHlwZSBpcyBub3QgTm9uZSk6CiAgICAgICAgdHlwZSA9IGltZ1R5cGUubG93ZXIoKQoKICAgIHBhdGggPSAiY25vc19pbWFnZXMiCiAgICBpZigoaW1nUGF0aCBpcyBub3QgTm9uZSkgYW5kKGltZ1BhdGggIT0gIiIpKToKICAgICAgICBwYXRoID0gaW1nUGF0aAoKICAgIHJldFZhbCA9ICIiCgogICAgIyBJbWFnZSB0cmFuc2ZlciBjb21tYW5kIGhhcHBlbnMgaGVyZQogICAgY29tbWFuZCA9ICJjcCAiICsgcHJvdG9jb2wgKyAiICIgKyBwcm90b2NvbCArICI6Ly8iICsgdXNlcm5hbWUgKyAiQCIgKyBcCiAgICAgICAgc2VydmVyICsgIi8iICsgcGF0aCArICIgc3lzdGVtLWltYWdlICIgKyB0eXBlICsgIiB2cmYgbWFuYWdlbWVudCBcbiIKICAgICMgZGVidWdPdXRwdXQoY29tbWFuZCkKICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiW25dIiwgMywgb2JqKQogICAgIyBDb25maXJtYXRpb24gY29tbWFuZCBoYXBwZW5zIGhlcmUKICAgIGlmKHByb3RvY29sID09ICJzY3AiKToKICAgICAgICBjb21tYW5kID0gInlcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIoeWVzL25vKT8iLCAzLCBvYmopCiAgICAgICAgY29tbWFuZCA9ICJZZXNcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJ0aW1lb3V0OiIsIDMsIG9iaikKICAgICAgICBjb21tYW5kID0gIjBcbiIKICAgICAgICAjIGRlYnVnT3V0cHV0KGNvbW1hbmQpCiAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJQYXNzd29yZDoiLCAzLCBvYmopCiAgICBlbGlmKHByb3RvY29sID09ICJzZnRwIik6CiAgICAgICAgY29tbWFuZCA9ICJ5XG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiKHllcy9ubyk/IiwgMywgb2JqKQogICAgICAgIGNvbW1hbmQgPSAiWWVzXG4iCiAgICAgICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgICAgIHJldFZhbCA9IHJldFZhbCArIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCAiUGFzc3dvcmQ6IiwgMywgb2JqKQogICAgZWxzZToKICAgICAgICByZXR1cm4gIkVycm9yLTExMCIKCiAgICAjIFBhc3N3b3JkIGVudHJ5IGhhcHBlbnMgaGVyZQogICAgY29tbWFuZCA9IHBhc3N3b3JkICsgIlxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICJbbl0iLCB0aW1lb3V0LCBvYmopCiAgICAjIENoYW5nZSB0byBzdGFuZGJ5IGltYWdlIHkKICAgIGNvbW1hbmQgPSAieVxuIgogICAgIyBkZWJ1Z091dHB1dChjb21tYW5kKQogICAgcmV0VmFsID0gcmV0VmFsICsgd2FpdEZvckRldmljZVJlc3BvbnNlKGNvbW1hbmQsICIjIiwgdGltZW91dCwgb2JqKQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKIyBNZXRob2QgdG8gZmluZCB3aGV0aGVyIGltYWdlIGlzIHRoZXJlIGluIHNlcnZlciBvciBub3QKIyBUaGlzIGlzIG5vdCBjb21wbGV0ZS4gTmVlZCB0byBmaWd1cmUgb3V0IEhvdyB0byBkbyBmb3IgU0NQIGFuZCBTRlRQCgoKZGVmIGNoZWNrU2VydmVyRm9ySW1hZ2UocHJvdG9jb2wsIGlwYWRkcmVzcywgZm9sZGVyLCB1c2VybmFtZSwgcGFzc3dvcmQpOgogICAgIyBzZXJ2ZXIgPSAiMTAuMjQxLjEwNS4yMTQiCiAgICBzZXJ2ZXIgPSBpcGFkZHJlc3MKICAgICMgdXNlcm5hbWUgPSAicGJob3NhbGUiCiAgICB1c2VybmFtZSA9IHVzZXJuYW1lCiAgICAjIHBhc3N3b3JkID0gIkxhYjRtYW4xIgogICAgcGFzc3dvcmQgPSBwYXNzd29yZAogICAgaW1hZ2VEaXIgPSAiY25vc19pbWFnZXMiCiAgICBvdXRwdXQgPSAwCiAgICB0cnk6CiAgICAgICAgZnRwID0gZnRwbGliLkZUUChzZXJ2ZXIpCiAgICAgICAgZnRwLmxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgIyBkZWJ1Z091dHB1dCBlCiAgICAgICAgcmV0dXJuIDEKICAgIGVsc2U6CiAgICAgICAgZmlsZWxpc3QgPSBbXSAgIyB0byBzdG9yZSBhbGwgZmlsZXMKICAgICAgICBmdHAucmV0cmxpbmVzKCdOTFNUJywgZmlsZWxpc3QuYXBwZW5kKSAgIyBhcHBlbmQgdG8gbGlzdAogICAgICAgIG51bSA9IDAKICAgICAgICBmb3IgZiBpbiBmaWxlbGlzdDoKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dCBmCiAgICAgICAgICAgIGlmKGYgPT0gaW1hZ2VEaXIpOgogICAgICAgICAgICAgICAgbnVtID0gMQogICAgICAgIGlmKG51bSA9PSAwKToKICAgICAgICAgICAgcmVzcCA9IGZ0cC5ta2QoaW1hZ2VEaXIpCiAgICAgICAgaWYocmVzcCAhPSBpbWFnZURpcik6CiAgICAgICAgICAgIHJldHVybiAxCiAgICByZXR1cm4gb3V0cHV0CiMgRU9NCgojIE1ldGhvZCBmb3IgZGV2aWNlIHJlc3BvbnNlIHRoYW4gdGltZSBkZWxheQojCgoKZGVmIGVudGVyRW5hYmxlTW9kZUZvckRldmljZShlbmFibGVQYXNzd29yZCwgdGltZW91dCwgb2JqKToKICAgIGNvbW1hbmQgPSAiZW5hYmxlXG4iCiAgICBwd2RQcm9tcHQgPSAicGFzc3dvcmQ6IgogICAgIyBkZWJ1Z091dHB1dChlbmFibGVQYXNzd29yZCkKICAgICMgZGVidWdPdXRwdXQoJ1xuJykKICAgIG9iai5zZXR0aW1lb3V0KGludCh0aW1lb3V0KSkKICAgICMgRXhlY3V0aW5nIGVuYWJsZQogICAgb2JqLnNlbmQoY29tbWFuZCkKICAgIGZsYWcgPSBGYWxzZQogICAgcmV0VmFsID0gIiIKICAgIGNvdW50ID0gNQogICAgd2hpbGUgbm90IGZsYWc6CiAgICAgICAgIyBJZiB3YWl0IHRpbWUgaXMgZXhlY2VlZGVkLgogICAgICAgIGlmKGNvdW50ID09IDApOgogICAgICAgICAgICBmbGFnID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvdW50ID0gY291bnQgLSAxCiAgICAgICAgIyBBIGRlbGF5IG9mIG9uZSBzZWNvbmQKICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBidWZmQnl0ZSA9IG9iai5yZWN2KDk5OTkpCiAgICAgICAgICAgIGJ1ZmYgPSBidWZmQnl0ZS5kZWNvZGUoKQogICAgICAgICAgICByZXRWYWwgPSByZXRWYWwgKyBidWZmCiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoYnVmZikKICAgICAgICAgICAgZ290aXQgPSBidWZmLmZpbmQocHdkUHJvbXB0KQogICAgICAgICAgICBpZihnb3RpdCAhPSAtMSk6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICBpZihlbmFibGVQYXNzd29yZCBpcyBOb25lIG9yIGVuYWJsZVBhc3N3b3JkID09ICIiKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIlxuIEVycm9yLTEwNiIKICAgICAgICAgICAgICAgIG9iai5zZW5kKGVuYWJsZVBhc3N3b3JkKQogICAgICAgICAgICAgICAgb2JqLnNlbmQoIlxyIikKICAgICAgICAgICAgICAgIG9iai5zZW5kKCJcbiIpCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpCiAgICAgICAgICAgICAgICBpbm5lckJ1ZmZCeXRlID0gb2JqLnJlY3YoOTk5OSkKICAgICAgICAgICAgICAgIGlubmVyQnVmZiA9IGlubmVyQnVmZkJ5dGUuZGVjb2RlKCkKICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArIGlubmVyQnVmZgogICAgICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChpbm5lckJ1ZmYpCiAgICAgICAgICAgICAgICBpbm5lckdvdGl0ID0gaW5uZXJCdWZmLmZpbmQoIiMiKQogICAgICAgICAgICAgICAgaWYoaW5uZXJHb3RpdCAhPSAtMSk6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgZ290aXQgPSBidWZmLmZpbmQoIiMiKQogICAgICAgICAgICAgICAgaWYoZ290aXQgIT0gLTEpOgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXRWYWwKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbCArICJcbiBFcnJvci0xMDEiCiAgICAgICAgICAgIGZsYWcgPSBUcnVlCiAgICBpZihyZXRWYWwgPT0gIiIpOgogICAgICAgIHJldFZhbCA9ICJcbiBFcnJvci0xMDEiCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgojIE1ldGhvZCBmb3IgZGV2aWNlIHJlc3BvbnNlIHRoYW4gdGltZSBkZWxheQojCgoKZGVmIHdhaXRGb3JEZXZpY2VSZXNwb25zZShjb21tYW5kLCBwcm9tcHQsIHRpbWVvdXQsIG9iaik6CiAgICBvYmouc2V0dGltZW91dChpbnQodGltZW91dCkpCiAgICBvYmouc2VuZChjb21tYW5kKQogICAgZmxhZyA9IEZhbHNlCiAgICByZXRWYWwgPSAiIgogICAgd2hpbGUgbm90IGZsYWc6CiAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgIHRyeToKICAgICAgICAgICAgYnVmZkJ5dGUgPSBvYmoucmVjdig5OTk5KQogICAgICAgICAgICBidWZmID0gYnVmZkJ5dGUuZGVjb2RlKCkKICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgYnVmZgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KHJldFZhbCkKICAgICAgICAgICAgZ290aXQgPSBidWZmLmZpbmQocHJvbXB0KQogICAgICAgICAgICBpZihnb3RpdCAhPSAtMSk6CiAgICAgICAgICAgICAgICBmbGFnID0gVHJ1ZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgaWYgcHJvbXB0ICE9ICIoeWVzL25vKT8iOgogICAgICAgICAgICAgICAgcmV0VmFsID0gcmV0VmFsICsgIlxuIEVycm9yLTEwMSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldFZhbCA9IHJldFZhbAogICAgICAgICAgICBmbGFnID0gVHJ1ZQogICAgcmV0dXJuIHJldFZhbAojIEVPTQoKCmRlZiBjaGVja091dHB1dEZvckVycm9yKG91dHB1dCk6CiAgICByZXRWYWwgPSAiIgogICAgaW5kZXggPSBvdXRwdXQubG93ZXIoKS5maW5kKCJlcnJvciIpCiAgICBzdGFydEluZGV4ID0gaW5kZXggKyA2CiAgICBpZihpbmRleCA9PSAtMSk6CiAgICAgICAgaW5kZXggPSBvdXRwdXQubG93ZXIoKS5maW5kKCJpbnZhbGlkIikKICAgICAgICBzdGFydEluZGV4ID0gaW5kZXggKyA4CiAgICAgICAgaWYoaW5kZXggPT0gLTEpOgogICAgICAgICAgICBpbmRleCA9IG91dHB1dC5sb3dlcigpLmZpbmQoImluY29ycmVjdCIpCiAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleCArIDkKICAgICAgICAgICAgaWYoaW5kZXggPT0gLTEpOgogICAgICAgICAgICAgICAgaW5kZXggPSBvdXRwdXQubG93ZXIoKS5maW5kKCJmYWlsdXJlIikKICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXggPSBpbmRleCArIDgKICAgICAgICAgICAgICAgIGlmKGluZGV4ID09IC0xKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGVuZEluZGV4ID0gc3RhcnRJbmRleCArIDMKICAgIGVycm9yQ29kZSA9IG91dHB1dFtzdGFydEluZGV4OmVuZEluZGV4XQogICAgcmVzdWx0ID0gZXJyb3JDb2RlLmlzZGlnaXQoKQogICAgaWYocmVzdWx0IGlzIG5vdCBUcnVlKToKICAgICAgICByZXR1cm4gIkRldmljZSByZXR1cm5lZCBhbiBFcnJvci4gUGxlYXNlIGNoZWNrIFJlc3VsdHMgZm9yIG1vcmUgXAogICAgICAgIGluZm9ybWF0aW9uIgoKICAgIGVycm9yRmlsZSA9ICJkaWN0aW9uYXJ5L0Vycm9yQ29kZXMubHZvIgogICAgdHJ5OgogICAgICAgICMgd2l0aCBvcGVuKGVycm9yRmlsZSwgJ3InKSBhcyBmOgogICAgICAgIGYgPSBvcGVuKGVycm9yRmlsZSwgJ3InKQogICAgICAgIGZvciBsaW5lIGluIGY6CiAgICAgICAgICAgIGlmKCc9JyBpbiBsaW5lKToKICAgICAgICAgICAgICAgIGRhdGEgPSBsaW5lLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgIGlmKGRhdGFbMF0uc3RyaXAoKSA9PSBlcnJvckNvZGUpOgogICAgICAgICAgICAgICAgICAgIGVycm9yU3RyaW5nID0gZGF0YVsxXS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yU3RyaW5nCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIGVycm9yU3RyaW5nID0gY25vc19lcnJvcmNvZGVzLmdldEVycm9yU3RyaW5nKGVycm9yQ29kZSkKICAgICAgICBlcnJvclN0cmluZyA9IGVycm9yU3RyaW5nLnN0cmlwKCkKICAgICAgICByZXR1cm4gZXJyb3JTdHJpbmcKICAgIHJldHVybiAiRXJyb3IgQ29kZSBOb3QgRm91bmQiCiMgRU9NCgoKZGVmIGNoZWNrU2FuaXR5b2ZWYXJpYWJsZShkZXZpY2VUeXBlLCB2YXJpYWJsZUlkLCB2YXJpYWJsZVZhbHVlKToKICAgIHJldFZhbCA9ICIiCiAgICBydWxlRmlsZSA9ICJkaWN0aW9uYXJ5LyIgKyBkZXZpY2VUeXBlICsgIl9ydWxlcy5sdm8iCiAgICBydWxlU3RyaW5nID0gZ2V0UnVsZVN0cmluZ0ZvclZhcmlhYmxlKGRldmljZVR5cGUsIHJ1bGVGaWxlLCB2YXJpYWJsZUlkKQogICAgcmV0VmFsID0gdmFsaWRhdGVWYWx1ZUFnYWluc3RSdWxlKHJ1bGVTdHJpbmcsIHZhcmlhYmxlVmFsdWUpCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGdldFJ1bGVTdHJpbmdGb3JWYXJpYWJsZShkZXZpY2VUeXBlLCBydWxlRmlsZSwgdmFyaWFibGVJZCk6CiAgICByZXRWYWwgPSAiIgogICAgdHJ5OgogICAgICAgICMgd2l0aCBvcGVuKHJ1bGVGaWxlLCAncicpIGFzIGY6CiAgICAgICAgZiA9IG9wZW4oZXJyb3JGaWxlLCAncicpCiAgICAgICAgZm9yIGxpbmUgaW4gZjoKICAgICAgICAgICAgIyBkZWJ1Z091dHB1dChsaW5lKQogICAgICAgICAgICBpZignOicgaW4gbGluZSk6CiAgICAgICAgICAgICAgICBkYXRhID0gbGluZS5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAjIGRlYnVnT3V0cHV0KGRhdGFbMF0pCiAgICAgICAgICAgICAgICBpZihkYXRhWzBdLnN0cmlwKCkgPT0gdmFyaWFibGVJZCk6CiAgICAgICAgICAgICAgICAgICAgcmV0VmFsID0gbGluZQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBydWxlU3RyaW5nID0gY25vc19kZXZpY2VydWxlcy5nZXRSdWxlU3RyaW5nKGRldmljZVR5cGUsIHZhcmlhYmxlSWQpCiAgICAgICAgcmV0VmFsID0gcnVsZVN0cmluZy5zdHJpcCgpCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIHZhbGlkYXRlVmFsdWVBZ2FpbnN0UnVsZShydWxlU3RyaW5nLCB2YXJpYWJsZVZhbHVlKToKCiAgICByZXRWYWwgPSAiIgogICAgaWYocnVsZVN0cmluZyA9PSAiIik6CiAgICAgICAgcmV0dXJuIDEKICAgIHJ1bGVzID0gcnVsZVN0cmluZy5zcGxpdCgnOicpCiAgICB2YXJpYWJsZVR5cGUgPSBydWxlc1sxXS5zdHJpcCgpCiAgICB2YXJSYW5nZSA9IHJ1bGVzWzJdLnN0cmlwKCkKICAgIGlmKHZhcmlhYmxlVHlwZSA9PSAiSU5URUdFUiIpOgogICAgICAgIHJlc3VsdCA9IGNoZWNrSW50ZWdlcih2YXJpYWJsZVZhbHVlKQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExMSIKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJGTE9BVCIpOgogICAgICAgIHJlc3VsdCA9IGNoZWNrRmxvYXQodmFyaWFibGVWYWx1ZSkKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTIiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIklOVEVHRVJfVkFMVUUiKToKICAgICAgICBpbnRfcmFuZ2UgPSB2YXJSYW5nZS5zcGxpdCgnLScpCiAgICAgICAgciA9IHJhbmdlKGludChpbnRfcmFuZ2VbMF0uc3RyaXAoKSksIGludChpbnRfcmFuZ2VbMV0uc3RyaXAoKSkpCiAgICAgICAgaWYoY2hlY2tJbnRlZ2VyKHZhcmlhYmxlVmFsdWUpIGlzIG5vdCBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTEiCiAgICAgICAgcmVzdWx0ID0gaW50KHZhcmlhYmxlVmFsdWUpIGluIHIKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTMiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIklOVEVHRVJfVkFMVUVfUkFOR0UiKToKICAgICAgICBpbnRfcmFuZ2UgPSB2YXJSYW5nZS5zcGxpdCgnLScpCiAgICAgICAgdmFyTG93ZXIgPSBpbnRfcmFuZ2VbMF0uc3RyaXAoKQogICAgICAgIHZhckhpZ2hlciA9IGludF9yYW5nZVsxXS5zdHJpcCgpCiAgICAgICAgciA9IHJhbmdlKGludCh2YXJMb3dlciksIGludCh2YXJIaWdoZXIpKQogICAgICAgIHZhbF9yYW5nZSA9IHZhcmlhYmxlVmFsdWUuc3BsaXQoJy0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgdmFsTG93ZXIgPSB2YWxfcmFuZ2VbMF0uc3RyaXAoKQogICAgICAgICAgICB2YWxIaWdoZXIgPSB2YWxfcmFuZ2VbMV0uc3RyaXAoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTEzIgogICAgICAgIGlmKChjaGVja0ludGVnZXIodmFsTG93ZXIpIGlzIG5vdCBUcnVlKSBvcgogICAgICAgICAgICAgICAgKGNoZWNrSW50ZWdlcih2YWxIaWdoZXIpIGlzIG5vdCBUcnVlKSk6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQoIkVycm9yLTExNCIpCiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE0IgogICAgICAgIHJlc3VsdCA9IChpbnQodmFsTG93ZXIpIGluIHIpIGFuZCAoaW50KHZhbEhpZ2hlcilpbiByKSBcCiAgICAgICAgICAgIGFuZCAoaW50KHZhbExvd2VyKSA8IGludCh2YWxIaWdoZXIpKQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIGRlYnVnT3V0cHV0KCJFcnJvci0xMTMiKQogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExMyIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiSU5URUdFUl9PUFRJT05TIik6CiAgICAgICAgaW50X29wdGlvbnMgPSB2YXJSYW5nZS5zcGxpdCgnLCcpCiAgICAgICAgaWYoY2hlY2tJbnRlZ2VyKHZhcmlhYmxlVmFsdWUpIGlzIG5vdCBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTEiCiAgICAgICAgZm9yIG9wdCBpbiBpbnRfb3B0aW9uczoKICAgICAgICAgICAgaWYob3B0LnN0cmlwKCkgaXMgdmFyaWFibGVWYWx1ZSk6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExNSIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiTE9ORyIpOgogICAgICAgIHJlc3VsdCA9IGNoZWNrTG9uZyh2YXJpYWJsZVZhbHVlKQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExNiIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiTE9OR19WQUxVRSIpOgogICAgICAgIGxvbmdfcmFuZ2UgPSB2YXJSYW5nZS5zcGxpdCgnLScpCiAgICAgICAgciA9IHJhbmdlKGxvbmcobG9uZ19yYW5nZVswXS5zdHJpcCgpKSwgbG9uZyhsb25nX3JhbmdlWzFdLnN0cmlwKCkpKQogICAgICAgIGlmKGNoZWNrTG9uZyh2YXJpYWJsZVZhbHVlKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgICMgZGVidWdPdXRwdXQodmFyaWFibGVWYWx1ZSkKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTYiCiAgICAgICAgcmVzdWx0ID0gbG9uZyh2YXJpYWJsZVZhbHVlKSBpbiByCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTEzIgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJMT05HX1ZBTFVFX1JBTkdFIik6CiAgICAgICAgbG9uZ19yYW5nZSA9IHZhclJhbmdlLnNwbGl0KCctJykKICAgICAgICByID0gcmFuZ2UobG9uZyhsb25nX3JhbmdlWzBdLnN0cmlwKCkpLCBsb25nKGxvbmdfcmFuZ2VbMV0uc3RyaXAoKSkpCiAgICAgICAgdmFsX3JhbmdlID0gdmFyaWFibGVWYWx1ZS5zcGxpdCgnLScpCiAgICAgICAgaWYoKGNoZWNrTG9uZyh2YWxfcmFuZ2VbMF0pIGlzIG5vdCBUcnVlKSBvcgogICAgICAgICAgICAgICAgKGNoZWNrTG9uZyh2YWxfcmFuZ2VbMV0pIGlzIG5vdCBUcnVlKSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE3IgogICAgICAgIHJlc3VsdCA9ICh2YWxfcmFuZ2VbMF0gaW4gcikgYW5kICgKICAgICAgICAgICAgdmFsX3JhbmdlWzFdIGluIHIpIGFuZCAodmFsX3JhbmdlWzBdIDwgdmFsX3JhbmdlWzFdKQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExMyIKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJMT05HX09QVElPTlMiKToKICAgICAgICBsb25nX29wdGlvbnMgPSB2YXJSYW5nZS5zcGxpdCgnLCcpCiAgICAgICAgaWYoY2hlY2tMb25nKHZhcmlhYmxlVmFsdWUpIGlzIG5vdCBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTYiCiAgICAgICAgZm9yIG9wdCBpbiBsb25nX29wdGlvbnM6CiAgICAgICAgICAgIGlmKG9wdC5zdHJpcCgpID09IHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTUiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIlRFWFQiKToKICAgICAgICBpZih2YXJpYWJsZVZhbHVlID09ICIiKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTgiCiAgICAgICAgaWYoVHJ1ZSBpcyBpc2luc3RhbmNlKHZhcmlhYmxlVmFsdWUsIHN0cikpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJOT19WQUxJREFUSU9OIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE4IgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAib2siCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIlRFWFRfT1JfRU1QVFkiKToKICAgICAgICBpZih2YXJpYWJsZVZhbHVlIGlzIE5vbmUgb3IgdmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgaWYocmVzdWx0ID09IGlzaW5zdGFuY2UodmFyaWFibGVWYWx1ZSwgc3RyKSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTkiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIk1BVENIX1RFWFQiKToKICAgICAgICBpZih2YXJpYWJsZVZhbHVlID09ICIiKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTgiCiAgICAgICAgaWYoaXNpbnN0YW5jZSh2YXJpYWJsZVZhbHVlLCBzdHIpKToKICAgICAgICAgICAgaWYodmFyUmFuZ2UgPT0gdmFyaWFibGVWYWx1ZSk6CiAgICAgICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMjAiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTkiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIk1BVENIX1RFWFRfT1JfRU1QVFkiKToKICAgICAgICBpZih2YXJpYWJsZVZhbHVlIGlzIE5vbmUgb3IgdmFyaWFibGVWYWx1ZSA9PSAiIik6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgaWYoaXNpbnN0YW5jZSh2YXJpYWJsZVZhbHVlLCBzdHIpKToKICAgICAgICAgICAgaWYodmFyUmFuZ2UgPT0gdmFyaWFibGVWYWx1ZSk6CiAgICAgICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMjAiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTkiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIlRFWFRfT1BUSU9OUyIpOgogICAgICAgIHN0cl9vcHRpb25zID0gdmFyUmFuZ2Uuc3BsaXQoJywnKQogICAgICAgIGlmKGlzaW5zdGFuY2UodmFyaWFibGVWYWx1ZSwgc3RyKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgogICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgZm9yIG9wdCBpbiBzdHJfb3B0aW9uczoKICAgICAgICAgICAgaWYob3B0LnN0cmlwKCkgPT0gdmFyaWFibGVWYWx1ZSk6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTExNSIKCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiVEVYVF9PUFRJT05TX09SX0VNUFRZIik6CiAgICAgICAgaWYodmFyaWFibGVWYWx1ZSBpcyBOb25lIG9yIHZhcmlhYmxlVmFsdWUgPT0gIiIpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIHN0cl9vcHRpb25zID0gdmFyUmFuZ2Uuc3BsaXQoJywnKQogICAgICAgIGlmKGlzaW5zdGFuY2UodmFyaWFibGVWYWx1ZSwgc3RyKSBpcyBub3QgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTE5IgogICAgICAgIGZvciBvcHQgaW4gc3RyX29wdGlvbnM6CiAgICAgICAgICAgIGlmKG9wdC5zdHJpcCgpID09IHZhcmlhYmxlVmFsdWUpOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTUiCgogICAgZWxpZih2YXJpYWJsZVR5cGUgPT0gIklQVjRBZGRyZXNzIik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzb2NrZXQuaW5ldF9wdG9uKHNvY2tldC5BRl9JTkVULCB2YXJpYWJsZVZhbHVlKQogICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgZXhjZXB0IHNvY2tldC5FcnJvcjoKICAgICAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICBpZihyZXN1bHQgaXMgVHJ1ZSk6CiAgICAgICAgICAgIHJldHVybiAib2siCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMjEiCiAgICBlbGlmKHZhcmlhYmxlVHlwZSA9PSAiSVBWNEFkZHJlc3NXaXRoTWFzayIpOgogICAgICAgIGlmKHZhcmlhYmxlVmFsdWUgaXMgTm9uZSBvciB2YXJpYWJsZVZhbHVlID09ICIiKToKICAgICAgICAgICAgcmV0dXJuICJFcnJvci0xMTkiCiAgICAgICAgc3RyX29wdGlvbnMgPSB2YXJpYWJsZVZhbHVlLnNwbGl0KCcvJykKICAgICAgICBpcGFkZHIgPSBzdHJfb3B0aW9uc1swXQogICAgICAgIG1hc2sgPSBzdHJfb3B0aW9uc1sxXQogICAgICAgIHRyeToKICAgICAgICAgICAgc29ja2V0LmluZXRfcHRvbihzb2NrZXQuQUZfSU5FVCwgaXBhZGRyKQogICAgICAgICAgICBpZihjaGVja0ludGVnZXIobWFzaykgaXMgVHJ1ZSk6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIGV4Y2VwdCBzb2NrZXQuRXJyb3I6CiAgICAgICAgICAgIHJlc3VsdCA9IEZhbHNlCiAgICAgICAgaWYocmVzdWx0IGlzIFRydWUpOgogICAgICAgICAgICByZXR1cm4gIm9rIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiAiRXJyb3ItMTIxIgoKICAgIGVsaWYodmFyaWFibGVUeXBlID09ICJJUFY2QWRkcmVzcyIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc29ja2V0LmluZXRfcHRvbihzb2NrZXQuQUZfSU5FVDYsIHZhcmlhYmxlVmFsdWUpCiAgICAgICAgICAgIHJlc3VsdCA9IFRydWUKICAgICAgICBleGNlcHQgc29ja2V0LkVycm9yOgogICAgICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIGlmKHJlc3VsdCBpcyBUcnVlKToKICAgICAgICAgICAgcmV0dXJuICJvayIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gIkVycm9yLTEyMiIKCiAgICByZXR1cm4gcmV0VmFsCiMgRU9NCgoKZGVmIGRpc2FibGVQYWdpbmcocmVtb3RlX2Nvbm4pOgogICAgcmVtb3RlX2Nvbm4uc2VuZCgidGVybWluYWwgbGVuZ3RoIDBcbiIpCiAgICB0aW1lLnNsZWVwKDEpCiAgICAjIENsZWFyIHRoZSBidWZmZXIgb24gdGhlIHNjcmVlbgogICAgb3V0cHV0Qnl0ZSA9IHJlbW90ZV9jb25uLnJlY3YoMTAwMCkKICAgIG91dHB1dCA9IG91dHB1dEJ5dGUuZGVjb2RlKCkKICAgIHJldHVybiBvdXRwdXQKIyBFT00KCgpkZWYgY2hlY2tJbnRlZ2VyKHMpOgogICAgdHJ5OgogICAgICAgIGludChzKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICByZXR1cm4gRmFsc2UKIyBFT00KCgpkZWYgY2hlY2tGbG9hdChzKToKICAgIHRyeToKICAgICAgICBmbG9hdChzKQogICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICByZXR1cm4gRmFsc2UKIyBFT00KCgpkZWYgY2hlY2tMb25nKHMpOgogICAgdHJ5OgogICAgICAgIGxvbmcocykKICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgcmV0dXJuIEZhbHNlCgoKZGVmIGRlYnVnT3V0cHV0KGNvbW1hbmQpOgogICAgZiA9IG9wZW4oJ2RlYnVnT3VwdXQudHh0JywgJ2EnKQogICAgZi53cml0ZShzdHIoY29tbWFuZCkpICAjIHB5dGhvbiB3aWxsIGNvbnZlcnQgXG4gdG8gb3MubGluZXNlcAogICAgZi5jbG9zZSgpICAjIHlvdSBjYW4gb21pdCBpbiBtb3N0IGNhc2VzIGFzIHRoZSBkZXN0cnVjdG9yIHdpbGwgY2FsbCBpdAojIEVPTQpQSwMEFAAAAAAA4bsrS7XYBAYlMAAAJTAAAB0AAABhbnNpYmxlL21vZHVsZV91dGlscy9fdGV4dC5weSMgVGhpcyBjb2RlIGlzIHBhcnQgb2YgQW5zaWJsZSwgYnV0IGlzIGFuIGluZGVwZW5kZW50IGNvbXBvbmVudC4KIyBUaGlzIHBhcnRpY3VsYXIgZmlsZSBzbmlwcGV0LCBhbmQgdGhpcyBmaWxlIHNuaXBwZXQgb25seSwgaXMgQlNEIGxpY2Vuc2VkLgojIE1vZHVsZXMgeW91IHdyaXRlIHVzaW5nIHRoaXMgc25pcHBldCwgd2hpY2ggaXMgZW1iZWRkZWQgZHluYW1pY2FsbHkgYnkgQW5zaWJsZQojIHN0aWxsIGJlbG9uZyB0byB0aGUgYXV0aG9yIG9mIHRoZSBtb2R1bGUsIGFuZCBtYXkgYXNzaWduIHRoZWlyIG93biBsaWNlbnNlCiMgdG8gdGhlIGNvbXBsZXRlIHdvcmsuCiMKIyBDb3B5cmlnaHQgKGMpLCBUb3NoaW8gS3VyYXRvbWkgPGEuYmFkZ2VyQGdtYWlsLmNvbT4sIDIwMTYKIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sCiMgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAojICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgojICAgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5ECiMgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQKIyBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuCiMgSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCiMgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLAojIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUwojIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QKIyBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUKIyBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KIwoKIiIiCi4uIHdhcm46OiBUaGlzIG1vZHVsZV91dGlsIGlzIGN1cnJlbnRseSBpbnRlcm5hbCBpbXBsZW1lbnRhdGlvbi4KICAgIFdlIHdhbnQgdG8gZXZhbHVhdGUgdGhpcyBjb2RlIGZvciBzdGFiaWxpdHkgYW5kIEFQSSBzdWl0YWJpbGl0eSBiZWZvcmUKICAgIG1ha2luZyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBndWFyYW50ZWVzLiAgVGhlIEFQSSBtYXkgY2hhbmdlIGJldHdlZW4KICAgIHJlbGVhc2VzLiAgRG8gbm90IHVzZSB0aGlzIHVubGVzcyB5b3UgYXJlIHdpbGxpbmcgdG8gcG9ydCB5b3VyIG1vZHVsZSBjb2RlLgoiIiIKaW1wb3J0IGNvZGVjcwoKZnJvbSBhbnNpYmxlLm1vZHVsZV91dGlscy5zaXggaW1wb3J0IFBZMywgdGV4dF90eXBlLCBiaW5hcnlfdHlwZQoKCnRyeToKICAgIGNvZGVjcy5sb29rdXBfZXJyb3IoJ3N1cnJvZ2F0ZWVzY2FwZScpCiAgICBIQVNfU1VSUk9HQVRFRVNDQVBFID0gVHJ1ZQpleGNlcHQgTG9va3VwRXJyb3I6CiAgICBIQVNfU1VSUk9HQVRFRVNDQVBFID0gRmFsc2UKCgpfQ09NUE9TRURfRVJST1JfSEFORExFUlMgPSBmcm96ZW5zZXQoKE5vbmUsICdzdXJyb2dhdGVfb3JfZXNjYXBlJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdXJyb2dhdGVfb3Jfc3RyaWN0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdXJyb2dhdGVfdGhlbl9yZXBsYWNlJykpCgoKZGVmIHRvX2J5dGVzKG9iaiwgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPU5vbmUsIG5vbnN0cmluZz0nc2ltcGxlcmVwcicpOgogICAgIiIiTWFrZSBzdXJlIHRoYXQgYSBzdHJpbmcgaXMgYSBieXRlIHN0cmluZwoKICAgIDphcmcgb2JqOiBBbiBvYmplY3QgdG8gbWFrZSBzdXJlIGlzIGEgYnl0ZSBzdHJpbmcuICBJbiBtb3N0IGNhc2VzIHRoaXMKICAgICAgICB3aWxsIGJlIGVpdGhlciBhIHRleHQgc3RyaW5nIG9yIGEgYnl0ZSBzdHJpbmcuICBIb3dldmVyLCB3aXRoCiAgICAgICAgYGBub25zdHJpbmc9J3NpbXBsZXJlcHInYGAsIHRoaXMgY2FuIGJlIHVzZWQgYXMgYSB0cmFjZWJhY2stZnJlZQogICAgICAgIHZlcnNpb24gb2YgYGBzdHIob2JqKWBgLgogICAgOmt3YXJnIGVuY29kaW5nOiBUaGUgZW5jb2RpbmcgdG8gdXNlIHRvIHRyYW5zZm9ybSBmcm9tIGEgdGV4dCBzdHJpbmcgdG8KICAgICAgICBhIGJ5dGUgc3RyaW5nLiAgRGVmYXVsdHMgdG8gdXNpbmcgJ3V0Zi04Jy4KICAgIDprd2FyZyBlcnJvcnM6IFRoZSBlcnJvciBoYW5kbGVyIHRvIHVzZSBpZiB0aGUgdGV4dCBzdHJpbmcgaXMgbm90CiAgICAgICAgZW5jb2RhYmxlIHVzaW5nIHRoZSBzcGVjaWZpZWQgZW5jb2RpbmcuICBBbnkgdmFsaWQgYGNvZGVjcyBlcnJvcgogICAgICAgIGhhbmRsZXIgPGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzIvbGlicmFyeS9jb2RlY3MuaHRtbCNjb2RlYy1iYXNlLWNsYXNzZXM+YF8KICAgICAgICBtYXkgYmUgc3BlY2lmaWVkLiBUaGVyZSBhcmUgdGhyZWUgYWRkaXRpb25hbCBlcnJvciBzdHJhdGVnaWVzCiAgICAgICAgc3BlY2lmaWNhbGx5IGFpbWVkIGF0IGhlbHBpbmcgcGVvcGxlIHRvIHBvcnQgY29kZS4gIFRoZSBmaXJzdCB0d28gYXJlOgoKICAgICAgICAgICAgOnN1cnJvZ2F0ZV9vcl9zdHJpY3Q6IFdpbGwgdXNlIGBgc3Vycm9nYXRlZXNjYXBlYGAgaWYgaXQgaXMgYSB2YWxpZAogICAgICAgICAgICAgICAgaGFuZGxlciwgb3RoZXJ3aXNlIGl0IHdpbGwgdXNlIGBgc3RyaWN0YGAKICAgICAgICAgICAgOnN1cnJvZ2F0ZV9vcl9yZXBsYWNlOiBXaWxsIHVzZSBgYHN1cnJvZ2F0ZWVzY2FwZWBgIGlmIGl0IGlzIGEgdmFsaWQKICAgICAgICAgICAgICAgIGhhbmRsZXIsIG90aGVyd2lzZSBpdCB3aWxsIHVzZSBgYHJlcGxhY2VgYC4KCiAgICAgICAgQmVjYXVzZSBgYHN1cnJvZ2F0ZWVzY2FwZWBgIHdhcyBhZGRlZCBpbiBQeXRob24zIHRoaXMgdXN1YWxseSBtZWFucyB0aGF0CiAgICAgICAgUHl0aG9uMyB3aWxsIHVzZSBgYHN1cnJvZ2F0ZWVzY2FwZWBgIGFuZCBQeXRob24yIHdpbGwgdXNlIHRoZSBmYWxsYmFjawogICAgICAgIGVycm9yIGhhbmRsZXIuIE5vdGUgdGhhdCB0aGUgY29kZSBjaGVja3MgZm9yIGBgc3Vycm9nYXRlZXNjYXBlYGAgd2hlbiB0aGUKICAgICAgICBtb2R1bGUgaXMgaW1wb3J0ZWQuICBJZiB5b3UgaGF2ZSBhIGJhY2twb3J0IG9mIGBgc3Vycm9nYXRlZXNjYXBlYGAgZm9yCiAgICAgICAgUHl0aG9uMiwgYmUgc3VyZSB0byByZWdpc3RlciB0aGUgZXJyb3IgaGFuZGxlciBwcmlvciB0byBpbXBvcnRpbmcgdGhpcwogICAgICAgIG1vZHVsZS4KCiAgICAgICAgVGhlIGxhc3QgZXJyb3IgaGFuZGxlciBpczoKCiAgICAgICAgICAgIDpzdXJyb2dhdGVfdGhlbl9yZXBsYWNlOiBXaWxsIHVzZSBgYHN1cnJvZ2F0ZWVzY2FwZWBgIGlmIGl0IGlzIGEgdmFsaWQKICAgICAgICAgICAgICAgIGhhbmRsZXIuICBJZiBlbmNvZGluZyB3aXRoIGBgc3Vycm9nYXRlZXNjYXBlYGAgd291bGQgdHJhY2ViYWNrLAogICAgICAgICAgICAgICAgc3Vycm9nYXRlcyBhcmUgZmlyc3QgcmVwbGFjZWQgd2l0aCBhIHJlcGxhY2VtZW50IGNoYXJhY3RlcnMKICAgICAgICAgICAgICAgIGFuZCB0aGVuIHRoZSBzdHJpbmcgaXMgZW5jb2RlZCB1c2luZyBgYHJlcGxhY2VgYCAod2hpY2ggcmVwbGFjZXMKICAgICAgICAgICAgICAgIHRoZSByZXN0IG9mIHRoZSBub25lbmNvZGFibGUgYnl0ZXMpLiAgSWYgYGBzdXJyb2dhdGVlc2NhcGVgYCBpcwogICAgICAgICAgICAgICAgbm90IHByZXNlbnQgaXQgd2lsbCBzaW1wbHkgdXNlIGBgcmVwbGFjZWBgLiAgKEFkZGVkIGluIEFuc2libGUgMi4zKQogICAgICAgICAgICAgICAgVGhpcyBzdHJhdGVneSBpcyBkZXNpZ25lZCB0byBuZXZlciB0cmFjZWJhY2sgd2hlbiBpdCBhdHRlbXB0cwogICAgICAgICAgICAgICAgdG8gZW5jb2RlIGEgc3RyaW5nLgoKICAgICAgICBUaGUgZGVmYXVsdCB1bnRpbCBBbnNpYmxlLTIuMiB3YXMgYGBzdXJyb2dhdGVfb3JfcmVwbGFjZWBgCiAgICAgICAgRnJvbSBBbnNpYmxlLTIuMyBvbndhcmRzLCB0aGUgZGVmYXVsdCBpcyBgYHN1cnJvZ2F0ZV90aGVuX3JlcGxhY2VgYC4KCiAgICA6a3dhcmcgbm9uc3RyaW5nOiBUaGUgc3RyYXRlZ3kgdG8gdXNlIGlmIGEgbm9uc3RyaW5nIGlzIHNwZWNpZmllZCBpbgogICAgICAgIGBgb2JqYGAuICBEZWZhdWx0IGlzICdzaW1wbGVyZXByJy4gIFZhbGlkIHZhbHVlcyBhcmU6CgogICAgICAgIDpzaW1wbGVyZXByOiBUaGUgZGVmYXVsdC4gIFRoaXMgdGFrZXMgdGhlIGBgc3RyYGAgb2YgdGhlIG9iamVjdCBhbmQKICAgICAgICAgICAgdGhlbiByZXR1cm5zIHRoZSBieXRlcyB2ZXJzaW9uIG9mIHRoYXQgc3RyaW5nLgogICAgICAgIDplbXB0eTogUmV0dXJuIGFuIGVtcHR5IGJ5dGUgc3RyaW5nCiAgICAgICAgOnBhc3N0aHJ1OiBSZXR1cm4gdGhlIG9iamVjdCBwYXNzZWQgaW4KICAgICAgICA6c3RyaWN0OiBSYWlzZSBhIDpleGM6YFR5cGVFcnJvcmAKCiAgICA6cmV0dXJuczogVHlwaWNhbGx5IHRoaXMgcmV0dXJucyBhIGJ5dGUgc3RyaW5nLiAgSWYgYSBub25zdHJpbmcgb2JqZWN0IGlzCiAgICAgICAgcGFzc2VkIGluIHRoaXMgbWF5IGJlIGEgZGlmZmVyZW50IHR5cGUgZGVwZW5kaW5nIG9uIHRoZSBzdHJhdGVneQogICAgICAgIHNwZWNpZmllZCBieSBub25zdHJpbmcuICBUaGlzIHdpbGwgbmV2ZXIgcmV0dXJuIGEgdGV4dCBzdHJpbmcuCgogICAgLi4gbm90ZTo6IElmIHBhc3NlZCBhIGJ5dGUgc3RyaW5nLCB0aGlzIGZ1bmN0aW9uIGRvZXMgbm90IGNoZWNrIHRoYXQgdGhlCiAgICAgICAgc3RyaW5nIGlzIHZhbGlkIGluIHRoZSBzcGVjaWZpZWQgZW5jb2RpbmcuICBJZiBpdCdzIGltcG9ydGFudCB0aGF0IHRoZQogICAgICAgIGJ5dGUgc3RyaW5nIGlzIGluIHRoZSBzcGVjaWZpZWQgZW5jb2RpbmcgZG86OgoKICAgICAgICAgICAgZW5jb2RlZF9zdHJpbmcgPSB0b19ieXRlcyh0b190ZXh0KGlucHV0X3N0cmluZywgJ2xhdGluLTEnKSwgJ3V0Zi04JykKCiAgICAuLiB2ZXJzaW9uX2NoYW5nZWQ6OiAyLjMKCiAgICAgICAgQWRkZWQgdGhlIGBgc3Vycm9nYXRlX3RoZW5fcmVwbGFjZWBgIGVycm9yIGhhbmRsZXIgYW5kIG1hZGUgaXQgdGhlIGRlZmF1bHQgZXJyb3IgaGFuZGxlci4KICAgICIiIgogICAgaWYgaXNpbnN0YW5jZShvYmosIGJpbmFyeV90eXBlKToKICAgICAgICByZXR1cm4gb2JqCgogICAgIyBXZSdyZSBnaXZlbiBhIHRleHQgc3RyaW5nCiAgICAjIElmIGl0IGhhcyBzdXJyb2dhdGVzLCB3ZSBrbm93IGJlY2F1c2UgaXQgd2lsbCBkZWNvZGUKICAgIG9yaWdpbmFsX2Vycm9ycyA9IGVycm9ycwogICAgaWYgZXJyb3JzIGluIF9DT01QT1NFRF9FUlJPUl9IQU5ETEVSUzoKICAgICAgICBpZiBIQVNfU1VSUk9HQVRFRVNDQVBFOgogICAgICAgICAgICBlcnJvcnMgPSAnc3Vycm9nYXRlZXNjYXBlJwogICAgICAgIGVsaWYgZXJyb3JzID09ICdzdXJyb2dhdGVfb3Jfc3RyaWN0JzoKICAgICAgICAgICAgZXJyb3JzID0gJ3N0cmljdCcKICAgICAgICBlbHNlOgogICAgICAgICAgICBlcnJvcnMgPSAncmVwbGFjZScKCiAgICBpZiBpc2luc3RhbmNlKG9iaiwgdGV4dF90eXBlKToKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgVHJ5IHRoaXMgZmlyc3QgYXMgaXQncyB0aGUgZmFzdGVzdAogICAgICAgICAgICByZXR1cm4gb2JqLmVuY29kZShlbmNvZGluZywgZXJyb3JzKQogICAgICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6CiAgICAgICAgICAgIGlmIG9yaWdpbmFsX2Vycm9ycyBpbiAoTm9uZSwgJ3N1cnJvZ2F0ZV90aGVuX3JlcGxhY2UnKToKICAgICAgICAgICAgICAgICMgU2xvdyBidXQgd29ya3MKICAgICAgICAgICAgICAgIHJldHVybl9zdHJpbmcgPSBvYmouZW5jb2RlKCd1dGYtOCcsICdzdXJyb2dhdGVlc2NhcGUnKQogICAgICAgICAgICAgICAgcmV0dXJuX3N0cmluZyA9IHJldHVybl9zdHJpbmcuZGVjb2RlKCd1dGYtOCcsICdyZXBsYWNlJykKICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5fc3RyaW5nLmVuY29kZShlbmNvZGluZywgJ3JlcGxhY2UnKQogICAgICAgICAgICByYWlzZQoKICAgICMgTm90ZTogV2UgZG8gdGhlc2UgbGFzdCBldmVuIHRob3VnaCB3ZSBoYXZlIHRvIGNhbGwgdG9fYnl0ZXMgYWdhaW4gb24gdGhlCiAgICAjIHZhbHVlIGJlY2F1c2Ugd2UncmUgb3B0aW1pemluZyB0aGUgY29tbW9uIGNhc2UKICAgIGlmIG5vbnN0cmluZyA9PSAnc2ltcGxlcmVwcic6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB2YWx1ZSA9IHN0cihvYmopCiAgICAgICAgZXhjZXB0IFVuaWNvZGVFcnJvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdmFsdWUgPSByZXByKG9iaikKICAgICAgICAgICAgZXhjZXB0IFVuaWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgICMgR2l2aW5nIHVwCiAgICAgICAgICAgICAgICByZXR1cm4gdG9fYnl0ZXMoJycpCiAgICBlbGlmIG5vbnN0cmluZyA9PSAncGFzc3RocnUnOgogICAgICAgIHJldHVybiBvYmoKICAgIGVsaWYgbm9uc3RyaW5nID09ICdlbXB0eSc6CiAgICAgICAgIyBweXRob24yLjQgZG9lc24ndCBoYXZlIGInJwogICAgICAgIHJldHVybiB0b19ieXRlcygnJykKICAgIGVsaWYgbm9uc3RyaW5nID09ICdzdHJpY3QnOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignb2JqIG11c3QgYmUgYSBzdHJpbmcgdHlwZScpCiAgICBlbHNlOgogICAgICAgIHJhaXNlIFR5cGVFcnJvcignSW52YWxpZCB2YWx1ZSAlcyBmb3IgdG9fYnl0ZXNcJyBub25zdHJpbmcgcGFyYW1ldGVyJyAlIG5vbnN0cmluZykKCiAgICByZXR1cm4gdG9fYnl0ZXModmFsdWUsIGVuY29kaW5nLCBlcnJvcnMpCgoKZGVmIHRvX3RleHQob2JqLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9Tm9uZSwgbm9uc3RyaW5nPSdzaW1wbGVyZXByJyk6CiAgICAiIiJNYWtlIHN1cmUgdGhhdCBhIHN0cmluZyBpcyBhIHRleHQgc3RyaW5nCgogICAgOmFyZyBvYmo6IEFuIG9iamVjdCB0byBtYWtlIHN1cmUgaXMgYSB0ZXh0IHN0cmluZy4gIEluIG1vc3QgY2FzZXMgdGhpcwogICAgICAgIHdpbGwgYmUgZWl0aGVyIGEgdGV4dCBzdHJpbmcgb3IgYSBieXRlIHN0cmluZy4gIEhvd2V2ZXIsIHdpdGgKICAgICAgICBgYG5vbnN0cmluZz0nc2ltcGxlcmVwcidgYCwgdGhpcyBjYW4gYmUgdXNlZCBhcyBhIHRyYWNlYmFjay1mcmVlCiAgICAgICAgdmVyc2lvbiBvZiBgYHN0cihvYmopYGAuCiAgICA6a3dhcmcgZW5jb2Rpbmc6IFRoZSBlbmNvZGluZyB0byB1c2UgdG8gdHJhbnNmb3JtIGZyb20gYSBieXRlIHN0cmluZyB0bwogICAgICAgIGEgdGV4dCBzdHJpbmcuICBEZWZhdWx0cyB0byB1c2luZyAndXRmLTgnLgogICAgOmt3YXJnIGVycm9yczogVGhlIGVycm9yIGhhbmRsZXIgdG8gdXNlIGlmIHRoZSBieXRlIHN0cmluZyBpcyBub3QKICAgICAgICBkZWNvZGFibGUgdXNpbmcgdGhlIHNwZWNpZmllZCBlbmNvZGluZy4gIEFueSB2YWxpZCBgY29kZWNzIGVycm9yCiAgICAgICAgaGFuZGxlciA8aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMi9saWJyYXJ5L2NvZGVjcy5odG1sI2NvZGVjLWJhc2UtY2xhc3Nlcz5gXwogICAgICAgIG1heSBiZSBzcGVjaWZpZWQuICAgV2Ugc3VwcG9ydCB0aHJlZSBhZGRpdGlvbmFsIGVycm9yIHN0cmF0ZWdpZXMKICAgICAgICBzcGVjaWZpY2FsbHkgYWltZWQgYXQgaGVscGluZyBwZW9wbGUgdG8gcG9ydCBjb2RlOgoKICAgICAgICAgICAgOnN1cnJvZ2F0ZV9vcl9zdHJpY3Q6IFdpbGwgdXNlIHN1cnJvZ2F0ZWVzY2FwZSBpZiBpdCBpcyBhIHZhbGlkCiAgICAgICAgICAgICAgICBoYW5kbGVyLCBvdGhlcndpc2UgaXQgd2lsbCB1c2Ugc3RyaWN0CiAgICAgICAgICAgIDpzdXJyb2dhdGVfb3JfcmVwbGFjZTogV2lsbCB1c2Ugc3Vycm9nYXRlZXNjYXBlIGlmIGl0IGlzIGEgdmFsaWQKICAgICAgICAgICAgICAgIGhhbmRsZXIsIG90aGVyd2lzZSBpdCB3aWxsIHVzZSByZXBsYWNlLgogICAgICAgICAgICA6c3Vycm9nYXRlX3RoZW5fcmVwbGFjZTogRG9lcyB0aGUgc2FtZSBhcyBzdXJyb2dhdGVfb3JfcmVwbGFjZSBidXQKICAgICAgICAgICAgICAgIGB3YXMgYWRkZWQgZm9yIHN5bW1ldHJ5IHdpdGggdGhlIGVycm9yIGhhbmRsZXJzIGluCiAgICAgICAgICAgICAgICA6ZnVuYzpgYW5zaWJsZS5tb2R1bGVfdXRpbHMuX3RleHQudG9fYnl0ZXNgIChBZGRlZCBpbiBBbnNpYmxlIDIuMykKCiAgICAgICAgQmVjYXVzZSBzdXJyb2dhdGVlc2NhcGUgd2FzIGFkZGVkIGluIFB5dGhvbjMgdGhpcyB1c3VhbGx5IG1lYW5zIHRoYXQKICAgICAgICBQeXRob24zIHdpbGwgdXNlIGBzdXJyb2dhdGVlc2NhcGVgIGFuZCBQeXRob24yIHdpbGwgdXNlIHRoZSBmYWxsYmFjawogICAgICAgIGVycm9yIGhhbmRsZXIuIE5vdGUgdGhhdCB0aGUgY29kZSBjaGVja3MgZm9yIHN1cnJvZ2F0ZWVzY2FwZSB3aGVuIHRoZQogICAgICAgIG1vZHVsZSBpcyBpbXBvcnRlZC4gIElmIHlvdSBoYXZlIGEgYmFja3BvcnQgb2YgYHN1cnJvZ2F0ZWVzY2FwZWAgZm9yCiAgICAgICAgcHl0aG9uMiwgYmUgc3VyZSB0byByZWdpc3RlciB0aGUgZXJyb3IgaGFuZGxlciBwcmlvciB0byBpbXBvcnRpbmcgdGhpcwogICAgICAgIG1vZHVsZS4KCiAgICAgICAgVGhlIGRlZmF1bHQgdW50aWwgQW5zaWJsZS0yLjIgd2FzIGBzdXJyb2dhdGVfb3JfcmVwbGFjZWAKICAgICAgICBJbiBBbnNpYmxlLTIuMyB0aGlzIGRlZmF1bHRzIHRvIGBzdXJyb2dhdGVfdGhlbl9yZXBsYWNlYCBmb3Igc3ltbWV0cnkKICAgICAgICB3aXRoIDpmdW5jOmBhbnNpYmxlLm1vZHVsZV91dGlscy5fdGV4dC50b19ieXRlc2AgLgogICAgOmt3YXJnIG5vbnN0cmluZzogVGhlIHN0cmF0ZWd5IHRvIHVzZSBpZiBhIG5vbnN0cmluZyBpcyBzcGVjaWZpZWQgaW4KICAgICAgICBgYG9iamBgLiAgRGVmYXVsdCBpcyAnc2ltcGxlcmVwcicuICBWYWxpZCB2YWx1ZXMgYXJlOgoKICAgICAgICA6c2ltcGxlcmVwcjogVGhlIGRlZmF1bHQuICBUaGlzIHRha2VzIHRoZSBgYHN0cmBgIG9mIHRoZSBvYmplY3QgYW5kCiAgICAgICAgICAgIHRoZW4gcmV0dXJucyB0aGUgdGV4dCB2ZXJzaW9uIG9mIHRoYXQgc3RyaW5nLgogICAgICAgIDplbXB0eTogUmV0dXJuIGFuIGVtcHR5IHRleHQgc3RyaW5nCiAgICAgICAgOnBhc3N0aHJ1OiBSZXR1cm4gdGhlIG9iamVjdCBwYXNzZWQgaW4KICAgICAgICA6c3RyaWN0OiBSYWlzZSBhIDpleGM6YFR5cGVFcnJvcmAKCiAgICA6cmV0dXJuczogVHlwaWNhbGx5IHRoaXMgcmV0dXJucyBhIHRleHQgc3RyaW5nLiAgSWYgYSBub25zdHJpbmcgb2JqZWN0IGlzCiAgICAgICAgcGFzc2VkIGluIHRoaXMgbWF5IGJlIGEgZGlmZmVyZW50IHR5cGUgZGVwZW5kaW5nIG9uIHRoZSBzdHJhdGVneQogICAgICAgIHNwZWNpZmllZCBieSBub25zdHJpbmcuICBUaGlzIHdpbGwgbmV2ZXIgcmV0dXJuIGEgYnl0ZSBzdHJpbmcuCiAgICAgICAgRnJvbSBBbnNpYmxlLTIuMyBvbndhcmRzLCB0aGUgZGVmYXVsdCBpcyBgc3Vycm9nYXRlX3RoZW5fcmVwbGFjZWAuCgogICAgLi4gdmVyc2lvbl9jaGFuZ2VkOjogMi4zCgogICAgICAgIEFkZGVkIHRoZSBzdXJyb2dhdGVfdGhlbl9yZXBsYWNlIGVycm9yIGhhbmRsZXIgYW5kIG1hZGUgaXQgdGhlIGRlZmF1bHQgZXJyb3IgaGFuZGxlci4KICAgICIiIgogICAgaWYgaXNpbnN0YW5jZShvYmosIHRleHRfdHlwZSk6CiAgICAgICAgcmV0dXJuIG9iagoKICAgIGlmIGVycm9ycyBpbiBfQ09NUE9TRURfRVJST1JfSEFORExFUlM6CiAgICAgICAgaWYgSEFTX1NVUlJPR0FURUVTQ0FQRToKICAgICAgICAgICAgZXJyb3JzID0gJ3N1cnJvZ2F0ZWVzY2FwZScKICAgICAgICBlbGlmIGVycm9ycyA9PSAnc3Vycm9nYXRlX29yX3N0cmljdCc6CiAgICAgICAgICAgIGVycm9ycyA9ICdzdHJpY3QnCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZXJyb3JzID0gJ3JlcGxhY2UnCgogICAgaWYgaXNpbnN0YW5jZShvYmosIGJpbmFyeV90eXBlKToKICAgICAgICAjIE5vdGU6IFdlIGRvbid0IG5lZWQgc3BlY2lhbCBoYW5kbGluZyBmb3Igc3Vycm9nYXRlX3RoZW5fcmVwbGFjZQogICAgICAgICMgYmVjYXVzZSBhbGwgYnl0ZXMgd2lsbCBlaXRoZXIgYmUgbWFkZSBpbnRvIHN1cnJvZ2F0ZXMgb3IgYXJlIHZhbGlkCiAgICAgICAgIyB0byBkZWNvZGUuCiAgICAgICAgcmV0dXJuIG9iai5kZWNvZGUoZW5jb2RpbmcsIGVycm9ycykKCiAgICAjIE5vdGU6IFdlIGRvIHRoZXNlIGxhc3QgZXZlbiB0aG91Z2ggd2UgaGF2ZSB0byBjYWxsIHRvX3RleHQgYWdhaW4gb24gdGhlCiAgICAjIHZhbHVlIGJlY2F1c2Ugd2UncmUgb3B0aW1pemluZyB0aGUgY29tbW9uIGNhc2UKICAgIGlmIG5vbnN0cmluZyA9PSAnc2ltcGxlcmVwcic6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB2YWx1ZSA9IHN0cihvYmopCiAgICAgICAgZXhjZXB0IFVuaWNvZGVFcnJvcjoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdmFsdWUgPSByZXByKG9iaikKICAgICAgICAgICAgZXhjZXB0IFVuaWNvZGVFcnJvcjoKICAgICAgICAgICAgICAgICMgR2l2aW5nIHVwCiAgICAgICAgICAgICAgICByZXR1cm4gdScnCiAgICBlbGlmIG5vbnN0cmluZyA9PSAncGFzc3RocnUnOgogICAgICAgIHJldHVybiBvYmoKICAgIGVsaWYgbm9uc3RyaW5nID09ICdlbXB0eSc6CiAgICAgICAgcmV0dXJuIHUnJwogICAgZWxpZiBub25zdHJpbmcgPT0gJ3N0cmljdCc6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCdvYmogbXVzdCBiZSBhIHN0cmluZyB0eXBlJykKICAgIGVsc2U6CiAgICAgICAgcmFpc2UgVHlwZUVycm9yKCdJbnZhbGlkIHZhbHVlICVzIGZvciB0b190ZXh0XCdzIG5vbnN0cmluZyBwYXJhbWV0ZXInICUgbm9uc3RyaW5nKQoKICAgIHJldHVybiB0b190ZXh0KHZhbHVlLCBlbmNvZGluZywgZXJyb3JzKQoKCiM6IDpweTpmdW5jOmB0b19uYXRpdmVgCiM6ICAgICAgVHJhbnNmb3JtIGEgdmFyaWFibGUgaW50byB0aGUgbmF0aXZlIHN0ciB0eXBlIGZvciB0aGUgcHl0aG9uIHZlcnNpb24KIzoKIzogICAgICBPbiBQeXRob24yLCB0aGlzIGlzIGFuIGFsaWFzIGZvcgojOiAgICAgIDpmdW5jOmB+YW5zaWJsZS5tb2R1bGVfdXRpbHMudG9fYnl0ZXNgLiAgT24gUHl0aG9uMyBpdCBpcyBhbiBhbGlhcyBmb3IKIzogICAgICA6ZnVuYzpgfmFuc2libGUubW9kdWxlX3V0aWxzLnRvX3RleHRgLiAgSXQgbWFrZXMgaXQgZWFzaWVyIHRvCiM6ICAgICAgdHJhbnNmb3JtIGEgdmFyaWFibGUgaW50byB0aGUgbmF0aXZlIHN0ciB0eXBlIGZvciB0aGUgcHl0aG9uIHZlcnNpb24KIzogICAgICB0aGUgY29kZSBpcyBydW5uaW5nIG9uLiAgVXNlIHRoaXMgd2hlbiBjb25zdHJ1Y3RpbmcgdGhlIG1lc3NhZ2UgdG8KIzogICAgICBzZW5kIHRvIGV4Y2VwdGlvbnMgb3Igd2hlbiBkZWFsaW5nIHdpdGggYW4gQVBJIHRoYXQgbmVlZHMgdG8gdGFrZQojOiAgICAgIGEgbmF0aXZlIHN0cmluZy4gIEV4YW1wbGU6OgojOgojOiAgICAgICAgICB0cnk6CiM6ICAgICAgICAgICAgICAxLy8wCiM6ICAgICAgICAgIGV4Y2VwdCBaZXJvRGl2aXNpb25FcnJvciBhcyBlOgojOiAgICAgICAgICAgICAgcmFpc2UgTXlFeGNlcHRpb24oJ0VuY291bnRlcmVkIGFuZCBlcnJvcjogJXMnICUgdG9fbmF0aXZlKGUpKQppZiBQWTM6CiAgICB0b19uYXRpdmUgPSB0b190ZXh0CmVsc2U6CiAgICB0b19uYXRpdmUgPSB0b19ieXRlcwpQSwMEFAAAAAAA4bsrSyXctH4TEAAAExAAACIAAABhbnNpYmxlL21vZHVsZV91dGlscy9weWNvbXBhdDI0LnB5IyBUaGlzIGNvZGUgaXMgcGFydCBvZiBBbnNpYmxlLCBidXQgaXMgYW4gaW5kZXBlbmRlbnQgY29tcG9uZW50LgojIFRoaXMgcGFydGljdWxhciBmaWxlIHNuaXBwZXQsIGFuZCB0aGlzIGZpbGUgc25pcHBldCBvbmx5LCBpcyBCU0QgbGljZW5zZWQuCiMgTW9kdWxlcyB5b3Ugd3JpdGUgdXNpbmcgdGhpcyBzbmlwcGV0LCB3aGljaCBpcyBlbWJlZGRlZCBkeW5hbWljYWxseSBieSBBbnNpYmxlCiMgc3RpbGwgYmVsb25nIHRvIHRoZSBhdXRob3Igb2YgdGhlIG1vZHVsZSwgYW5kIG1heSBhc3NpZ24gdGhlaXIgb3duIGxpY2Vuc2UKIyB0byB0aGUgY29tcGxldGUgd29yay4KIwojIENvcHlyaWdodCAoYykgMjAxNiwgVG9zaGlvIEt1cmF0b21pIDx0a3VyYXRvbWlAYW5zaWJsZS5jb20+CiMgQ29weXJpZ2h0IChjKSAyMDE1LCBNYXJpdXMgR2VkbWluYXMKIwojIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sCiMgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgojCiMgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAojICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgojICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAojICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgojICAgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5ECiMgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQKIyBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuCiMgSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsCiMgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLAojIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUwojIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QKIyBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUKIyBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KIwoKaW1wb3J0IHN5cwoKZGVmIGdldF9leGNlcHRpb24oKToKICAgICIiIkdldCB0aGUgY3VycmVudCBleGNlcHRpb24uCgogICAgVGhpcyBjb2RlIG5lZWRzIHRvIHdvcmsgb24gUHl0aG9uIDIuNCB0aHJvdWdoIDMueCwgc28gd2UgY2Fubm90IHVzZQogICAgImV4Y2VwdCBFeGNlcHRpb24sIGU6IiAoU3ludGF4RXJyb3Igb24gUHl0aG9uIDMueCkgbm9yCiAgICAiZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOiIgKFN5bnRheEVycm9yIG9uIFB5dGhvbiAyLjQtMi41KS4KICAgIEluc3RlYWQgd2UgbXVzdCB1c2UgOjoKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZSA9IGdldF9leGNlcHRpb24oKQoKICAgICIiIgogICAgcmV0dXJuIHN5cy5leGNfaW5mbygpWzFdCgp0cnk6CiAgICAjIFB5dGhvbiAyLjYrCiAgICBmcm9tIGFzdCBpbXBvcnQgbGl0ZXJhbF9ldmFsCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICMgYSByZXBsYWNlbWVudCBmb3IgbGl0ZXJhbF9ldmFsIHRoYXQgd29ya3Mgd2l0aCBweXRob24gMi40LiBmcm9tOgogICAgIyBodHRwczovL21haWwucHl0aG9uLm9yZy9waXBlcm1haWwvcHl0aG9uLWxpc3QvMjAwOS1TZXB0ZW1iZXIvNTUxODgwLmh0bWwKICAgICMgd2hpY2ggaXMgZXNzZW50aWFsbHkgYSBjdXQvcGFzdGUgZnJvbSBhbiBlYXJsaWVyICgyLjYpIHZlcnNpb24gb2YgcHl0aG9uJ3MKICAgICMgYXN0LnB5CiAgICBmcm9tIGNvbXBpbGVyIGltcG9ydCBhc3QsIHBhcnNlCiAgICBmcm9tIGFuc2libGUubW9kdWxlX3V0aWxzLnNpeCBpbXBvcnQgYmluYXJ5X3R5cGUsIHN0cmluZ190eXBlcywgdGV4dF90eXBlCgogICAgZGVmIGxpdGVyYWxfZXZhbChub2RlX29yX3N0cmluZyk6CiAgICAgICAgIiIiCiAgICAgICAgU2FmZWx5IGV2YWx1YXRlIGFuIGV4cHJlc3Npb24gbm9kZSBvciBhIHN0cmluZyBjb250YWluaW5nIGEgUHl0aG9uCiAgICAgICAgZXhwcmVzc2lvbi4gIFRoZSBzdHJpbmcgb3Igbm9kZSBwcm92aWRlZCBtYXkgb25seSBjb25zaXN0IG9mIHRoZSAgZm9sbG93aW5nCiAgICAgICAgUHl0aG9uIGxpdGVyYWwgc3RydWN0dXJlczogc3RyaW5ncywgbnVtYmVycywgdHVwbGVzLCBsaXN0cywgZGljdHMsICBib29sZWFucywKICAgICAgICBhbmQgTm9uZS4KICAgICAgICAiIiIKICAgICAgICBfc2FmZV9uYW1lcyA9IHsnTm9uZSc6IE5vbmUsICdUcnVlJzogVHJ1ZSwgJ0ZhbHNlJzogRmFsc2V9CiAgICAgICAgaWYgaXNpbnN0YW5jZShub2RlX29yX3N0cmluZywgc3RyaW5nX3R5cGVzKToKICAgICAgICAgICAgbm9kZV9vcl9zdHJpbmcgPSBwYXJzZShub2RlX29yX3N0cmluZywgbW9kZT0nZXZhbCcpCiAgICAgICAgaWYgaXNpbnN0YW5jZShub2RlX29yX3N0cmluZywgYXN0LkV4cHJlc3Npb24pOgogICAgICAgICAgICBub2RlX29yX3N0cmluZyA9IG5vZGVfb3Jfc3RyaW5nLm5vZGUKCiAgICAgICAgZGVmIF9jb252ZXJ0KG5vZGUpOgogICAgICAgICAgICAjIE9rYXkgdG8gdXNlIGxvbmcgaGVyZSBiZWNhdXNlIHRoaXMgaXMgb25seSBmb3IgcHl0aG9uIDIuNCBhbmQgMi41CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZSwgYXN0LkNvbnN0KSBhbmQgaXNpbnN0YW5jZShub2RlLnZhbHVlLCAodGV4dF90eXBlLCBiaW5hcnlfdHlwZSwgaW50LCBmbG9hdCwgbG9uZywgY29tcGxleCkpOgogICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUudmFsdWUKICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5UdXBsZSk6CiAgICAgICAgICAgICAgICByZXR1cm4gdHVwbGUobWFwKF9jb252ZXJ0LCBub2RlLm5vZGVzKSkKICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5MaXN0KToKICAgICAgICAgICAgICAgIHJldHVybiBsaXN0KG1hcChfY29udmVydCwgbm9kZS5ub2RlcykpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCBhc3QuRGljdCk6CiAgICAgICAgICAgICAgICByZXR1cm4gZGljdCgoX2NvbnZlcnQoayksIF9jb252ZXJ0KHYpKSBmb3IgaywgdiBpbiBub2RlLml0ZW1zKCkpCiAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCBhc3QuTmFtZSk6CiAgICAgICAgICAgICAgICBpZiBub2RlLm5hbWUgaW4gX3NhZmVfbmFtZXM6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9zYWZlX25hbWVzW25vZGUubmFtZV0KICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5VbmFyeVN1Yik6CiAgICAgICAgICAgICAgICByZXR1cm4gLV9jb252ZXJ0KG5vZGUuZXhwcikKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignbWFsZm9ybWVkIHN0cmluZycpCiAgICAgICAgcmV0dXJuIF9jb252ZXJ0KG5vZGVfb3Jfc3RyaW5nKQoKX19hbGxfXyA9ICgnZ2V0X2V4Y2VwdGlvbicsICdsaXRlcmFsX2V2YWwnKQpQSwMEFAAAAAAA4bsrSxgXcvUBEQAAAREAACQAAABhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX19pbml0X18ucHkjIFRoaXMgY29kZSBpcyBwYXJ0IG9mIEFuc2libGUsIGJ1dCBpcyBhbiBpbmRlcGVuZGVudCBjb21wb25lbnQuCiMgVGhpcyBwYXJ0aWN1bGFyIGZpbGUgc25pcHBldCwgYW5kIHRoaXMgZmlsZSBzbmlwcGV0IG9ubHksIGlzIEJTRCBsaWNlbnNlZC4KIyBNb2R1bGVzIHlvdSB3cml0ZSB1c2luZyB0aGlzIHNuaXBwZXQsIHdoaWNoIGlzIGVtYmVkZGVkIGR5bmFtaWNhbGx5IGJ5IEFuc2libGUKIyBzdGlsbCBiZWxvbmcgdG8gdGhlIGF1dGhvciBvZiB0aGUgbW9kdWxlLCBhbmQgbWF5IGFzc2lnbiB0aGVpciBvd24gbGljZW5zZQojIHRvIHRoZSBjb21wbGV0ZSB3b3JrLgojCiMgQ29weXJpZ2h0IChjKSAyMDE3LCBUb3NoaW8gS3VyYXRvbWkgPHRrdXJhdG9taUBhbnNpYmxlLmNvbT4KIwojIFRoaXMgY29kZSBpcyBiYXNlZCBvbiBjb2RlIGZyb20gQXN0cm9weSBhbmQgcmV0YWlucyB0aGVpciAzLWNsYXVzZSBCU0QgbGljZW5zZQojIHJlcHJvZHVjZWQgYmVsb3c6CiMKIyBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNiwgQXN0cm9weSBEZXZlbG9wZXJzCiMKIyBBbGwgcmlnaHRzIHJlc2VydmVkLgojCiMgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiMgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiMKIyAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcwojICAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiMgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiMgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiMgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KIyAqIE5laXRoZXIgdGhlIG5hbWUgb2YgdGhlIEFzdHJvcHkgVGVhbSBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiMgICBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0CiMgICBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiMKIyBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKIyBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiMgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFCiMgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRQojIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMCiMgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IKIyBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUgojIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksCiMgT1IgVE9SVCAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UKIyBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgojCiMgQXN0cm9weSBMaWNlbnNlOiBodHRwczovL2dpdGh1Yi5jb20vYXN0cm9weS9hc3Ryb3B5L2Jsb2IvY2YzMjY1ZTQyYTBkYjhlMDBiYjkwNjQ0ZGIzN2M4MTUwZjVhYzAwYy9saWNlbnNlcy9MSUNFTlNFLnJzdAojIEFzdHJvcHkgQ29kZTogaHR0cHM6Ly9naXRodWIuY29tL2FzdHJvcHkvYXN0cm9weS9ibG9iL2NmMzI2NWU0MmEwZGI4ZTAwYmI5MDY0NGRiMzdjODE1MGY1YWMwMGMvYXN0cm9weS9leHRlcm4vc2l4LnB5CgoiIiIKSGFuZGxlIGxvYWRpbmcgc2l4IHBhY2thZ2UgZnJvbSBzeXN0ZW0gb3IgZnJvbSB0aGUgYnVuZGxlZCBjb3B5CiIiIgpmcm9tIF9fZnV0dXJlX18gaW1wb3J0IGFic29sdXRlX2ltcG9ydAoKaW1wb3J0IGltcCBhcyBfaW1wCmltcG9ydCBzeXMgYXMgX3N5cwoKdHJ5OgogICAgZnJvbSBkaXN0dXRpbHMudmVyc2lvbiBpbXBvcnQgTG9vc2VWZXJzaW9uIGFzIF9Mb29zZVZlcnNpb24KZXhjZXB0IEltcG9ydEVycm9yOgogICAgIyBTb21lIHBsYXRmb3JtcyAqY291Z2gqU29sYXJpcypjb3VnaCogZG9uJ3Qgc2hpcCB0aGUgd2hvbGUgc3RkbGliCiAgICBfTG9vc2VWZXJzaW9uID0gTm9uZQoKdHJ5OgogICAgaW1wb3J0IHNpeCBhcyBfc3lzdGVtX3NpeApleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBfc3lzdGVtX3NpeCA9IE5vbmUKCmZyb20gLiBpbXBvcnQgX3NpeCBhcyBfYnVuZGxlZF9zaXgKCgpkZWYgX2ZpbmRfbW9kdWxlKG5hbWUsIHBhdGg9Tm9uZSk6CiAgICAiIiJBbHRlcm5hdGl2ZSB0byBgaW1wLmZpbmRfbW9kdWxlYCB0aGF0IGNhbiBhbHNvIHNlYXJjaCBpbiBzdWJwYWNrYWdlcyIiIgogICAgcGFydHMgPSBuYW1lLnNwbGl0KCcuJykKCiAgICBmb3IgcGFydCBpbiBwYXJ0czoKICAgICAgICBpZiBwYXRoIGlzIG5vdCBOb25lOgogICAgICAgICAgICBwYXRoID0gW3BhdGhdCiAgICAgICAgZmgsIHBhdGgsIGRlc2NyID0gX2ltcC5maW5kX21vZHVsZShwYXJ0LCBwYXRoKQogICAgcmV0dXJuIGZoLCBwYXRoLCBkZXNjcgoKCmRlZiBfZ2V0X2J1bmRsZWRfc2l4X3NvdXJjZSgpOgogICAgIyBTcGVjaWFsIGltcG9ydCBsb2FkZXIgKHppcGltcG9ydCBmb3IgaW5zdGFuY2UpCiAgICBmb3VuZCA9IEZhbHNlCiAgICBmb3IgcGF0aCBpbiBfc3lzLnBhdGg6CiAgICAgICAgaW1wb3J0ZXIgPSBfc3lzLnBhdGhfaW1wb3J0ZXJfY2FjaGUuZ2V0KHBhdGgpCiAgICAgICAgaWYgaW1wb3J0ZXI6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZvdW5kID0gaW1wb3J0ZXIuZmluZF9tb2R1bGUoJ2Fuc2libGUvbW9kdWxlX3V0aWxzL3NpeC9fc2l4JykKICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaWYgZm91bmQ6CiAgICAgICAgICAgICAgICBicmVhawogICAgZWxzZToKICAgICAgICByYWlzZSBJbXBvcnRFcnJvcigiQ291bGQgbm90IGZpbmQgYW5zaWJsZS5tb2R1bGVfdXRpbHMuc2l4Ll9zaXgiKQoKICAgIG1vZHVsZV9zb3VyY2UgPSBpbXBvcnRlci5nZXRfc291cmNlKCdhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX3NpeCcpCiAgICByZXR1cm4gbW9kdWxlX3NvdXJjZQoKCmRlZiBfZ2V0X3NpeF9zb3VyY2UoKToKICAgICIiIkltcG9ydCB0aGUgbmV3ZXN0IHZlcnNpb24gb2YgdGhlIHNpeCBsaWJyYXJ5IHRoYXQncyBhdmFpbGFibGUiIiIKICAgIG1vZF9pbmZvID0gTm9uZQogICAgdHJ5OgogICAgICAgIGlmIF9zeXN0ZW1fc2l4IGFuZCBfTG9vc2VWZXJzaW9uIGFuZCBcCiAgICAgICAgICAgICAgICBfTG9vc2VWZXJzaW9uKF9zeXN0ZW1fc2l4Ll9fdmVyc2lvbl9fKSA+PSBfTG9vc2VWZXJzaW9uKF9idW5kbGVkX3NpeC5fX3ZlcnNpb25fXyk6CiAgICAgICAgICAgIG1vZF9pbmZvID0gX2ZpbmRfbW9kdWxlKCdzaXgnKQogICAgZXhjZXB0OgogICAgICAgICMgQW55IGVycm9ycyBmaW5kaW5nIHRoZSBzeXN0ZW0gbGlicmFyeSwgdXNlIG91ciBidW5kbGVkIGxpYiBpbnN0ZWFkCiAgICAgICAgcGFzcwoKICAgIGlmIG5vdCBtb2RfaW5mbzoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG1vZF9pbmZvID0gX2ZpbmRfbW9kdWxlKCdhbnNpYmxlLm1vZHVsZV91dGlscy5zaXguX3NpeCcpCiAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgICAgICAjIHppcGltcG9ydAogICAgICAgICAgICBtb2R1bGVfc291cmNlID0gX2dldF9idW5kbGVkX3NpeF9zb3VyY2UoKQogICAgICAgICAgICByZXR1cm4gbW9kdWxlX3NvdXJjZQoKICAgIHJldHVybiBtb2RfaW5mb1swXS5yZWFkKCkKCnNvdXJjZSA9IF9nZXRfc2l4X3NvdXJjZSgpCmV4ZWMoc291cmNlKQpQSwMEFAAAAAAA4bsrSzjix9GRdQAAkXUAACAAAABhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX3NpeC5weSIiIlV0aWxpdGllcyBmb3Igd3JpdGluZyBjb2RlIHRoYXQgcnVucyBvbiBQeXRob24gMiBhbmQgMyIiIgoKIyBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxNSBCZW5qYW1pbiBQZXRlcnNvbgojCiMgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQojIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiMgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwojIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKIyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKIyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgojCiMgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsCiMgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KIwojIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiMgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiMgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiMgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgojIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiMgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUKIyBTT0ZUV0FSRS4KCmZyb20gX19mdXR1cmVfXyBpbXBvcnQgYWJzb2x1dGVfaW1wb3J0CgppbXBvcnQgZnVuY3Rvb2xzCmltcG9ydCBpdGVydG9vbHMKaW1wb3J0IG9wZXJhdG9yCmltcG9ydCBzeXMKaW1wb3J0IHR5cGVzCgpfX2F1dGhvcl9fID0gIkJlbmphbWluIFBldGVyc29uIDxiZW5qYW1pbkBweXRob24ub3JnPiIKX192ZXJzaW9uX18gPSAiMS4xMC4wIgoKCiMgVXNlZnVsIGZvciB2ZXJ5IGNvYXJzZSB2ZXJzaW9uIGRpZmZlcmVudGlhdGlvbi4KUFkyID0gc3lzLnZlcnNpb25faW5mb1swXSA9PSAyClBZMyA9IHN5cy52ZXJzaW9uX2luZm9bMF0gPT0gMwpQWTM0ID0gc3lzLnZlcnNpb25faW5mb1swOjJdID49ICgzLCA0KQoKaWYgUFkzOgogICAgc3RyaW5nX3R5cGVzID0gc3RyLAogICAgaW50ZWdlcl90eXBlcyA9IGludCwKICAgIGNsYXNzX3R5cGVzID0gdHlwZSwKICAgIHRleHRfdHlwZSA9IHN0cgogICAgYmluYXJ5X3R5cGUgPSBieXRlcwogICAgTUFYU0laRSA9IHN5cy5tYXhzaXplCmVsc2U6CiAgICBzdHJpbmdfdHlwZXMgPSBiYXNlc3RyaW5nLAogICAgaW50ZWdlcl90eXBlcyA9IChpbnQsIGxvbmcpCiAgICBjbGFzc190eXBlcyA9ICh0eXBlLCB0eXBlcy5DbGFzc1R5cGUpCiAgICB0ZXh0X3R5cGUgPSB1bmljb2RlCiAgICBiaW5hcnlfdHlwZSA9IHN0cgoKICAgIGlmIHN5cy5wbGF0Zm9ybS5zdGFydHN3aXRoKCJqYXZhIik6CiAgICAgICAgIyBKeXRob24gYWx3YXlzIHVzZXMgMzIgYml0cy4KICAgICAgICBNQVhTSVpFID0gaW50KCgxIDw8IDMxKSAtIDEpCiAgICBlbHNlOgogICAgICAgICMgSXQncyBwb3NzaWJsZSB0byBoYXZlIHNpemVvZihsb25nKSAhPSBzaXplb2YoUHlfc3NpemVfdCkuCiAgICAgICAgY2xhc3MgWChvYmplY3QpOgoKICAgICAgICAgICAgZGVmIF9fbGVuX18oc2VsZik6CiAgICAgICAgICAgICAgICByZXR1cm4gMSA8PCAzMQogICAgICAgIHRyeToKICAgICAgICAgICAgbGVuKFgoKSkKICAgICAgICBleGNlcHQgT3ZlcmZsb3dFcnJvcjoKICAgICAgICAgICAgIyAzMi1iaXQKICAgICAgICAgICAgTUFYU0laRSA9IGludCgoMSA8PCAzMSkgLSAxKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgNjQtYml0CiAgICAgICAgICAgIE1BWFNJWkUgPSBpbnQoKDEgPDwgNjMpIC0gMSkKICAgICAgICBkZWwgWAoKCmRlZiBfYWRkX2RvYyhmdW5jLCBkb2MpOgogICAgIiIiQWRkIGRvY3VtZW50YXRpb24gdG8gYSBmdW5jdGlvbi4iIiIKICAgIGZ1bmMuX19kb2NfXyA9IGRvYwoKCmRlZiBfaW1wb3J0X21vZHVsZShuYW1lKToKICAgICIiIkltcG9ydCBtb2R1bGUsIHJldHVybmluZyB0aGUgbW9kdWxlIGFmdGVyIHRoZSBsYXN0IGRvdC4iIiIKICAgIF9faW1wb3J0X18obmFtZSkKICAgIHJldHVybiBzeXMubW9kdWxlc1tuYW1lXQoKCmNsYXNzIF9MYXp5RGVzY3Iob2JqZWN0KToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZSk6CiAgICAgICAgc2VsZi5uYW1lID0gbmFtZQoKICAgIGRlZiBfX2dldF9fKHNlbGYsIG9iaiwgdHApOgogICAgICAgIHJlc3VsdCA9IHNlbGYuX3Jlc29sdmUoKQogICAgICAgIHNldGF0dHIob2JqLCBzZWxmLm5hbWUsIHJlc3VsdCkgICMgSW52b2tlcyBfX3NldF9fLgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBUaGlzIGlzIGEgYml0IHVnbHksIGJ1dCBpdCBhdm9pZHMgcnVubmluZyB0aGlzIGFnYWluIGJ5CiAgICAgICAgICAgICMgcmVtb3ZpbmcgdGhpcyBkZXNjcmlwdG9yLgogICAgICAgICAgICBkZWxhdHRyKG9iai5fX2NsYXNzX18sIHNlbGYubmFtZSkKICAgICAgICBleGNlcHQgQXR0cmlidXRlRXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICByZXR1cm4gcmVzdWx0CgoKY2xhc3MgTW92ZWRNb2R1bGUoX0xhenlEZXNjcik6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsIG9sZCwgbmV3PU5vbmUpOgogICAgICAgIHN1cGVyKE1vdmVkTW9kdWxlLCBzZWxmKS5fX2luaXRfXyhuYW1lKQogICAgICAgIGlmIFBZMzoKICAgICAgICAgICAgaWYgbmV3IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBuZXcgPSBuYW1lCiAgICAgICAgICAgIHNlbGYubW9kID0gbmV3CiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5tb2QgPSBvbGQKCiAgICBkZWYgX3Jlc29sdmUoc2VsZik6CiAgICAgICAgcmV0dXJuIF9pbXBvcnRfbW9kdWxlKHNlbGYubW9kKQoKICAgIGRlZiBfX2dldGF0dHJfXyhzZWxmLCBhdHRyKToKICAgICAgICBfbW9kdWxlID0gc2VsZi5fcmVzb2x2ZSgpCiAgICAgICAgdmFsdWUgPSBnZXRhdHRyKF9tb2R1bGUsIGF0dHIpCiAgICAgICAgc2V0YXR0cihzZWxmLCBhdHRyLCB2YWx1ZSkKICAgICAgICByZXR1cm4gdmFsdWUKCgpjbGFzcyBfTGF6eU1vZHVsZSh0eXBlcy5Nb2R1bGVUeXBlKToKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbmFtZSk6CiAgICAgICAgc3VwZXIoX0xhenlNb2R1bGUsIHNlbGYpLl9faW5pdF9fKG5hbWUpCiAgICAgICAgc2VsZi5fX2RvY19fID0gc2VsZi5fX2NsYXNzX18uX19kb2NfXwoKICAgIGRlZiBfX2Rpcl9fKHNlbGYpOgogICAgICAgIGF0dHJzID0gWyJfX2RvY19fIiwgIl9fbmFtZV9fIl0KICAgICAgICBhdHRycyArPSBbYXR0ci5uYW1lIGZvciBhdHRyIGluIHNlbGYuX21vdmVkX2F0dHJpYnV0ZXNdCiAgICAgICAgcmV0dXJuIGF0dHJzCgogICAgIyBTdWJjbGFzc2VzIHNob3VsZCBvdmVycmlkZSB0aGlzCiAgICBfbW92ZWRfYXR0cmlidXRlcyA9IFtdCgoKY2xhc3MgTW92ZWRBdHRyaWJ1dGUoX0xhenlEZXNjcik6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG5hbWUsIG9sZF9tb2QsIG5ld19tb2QsIG9sZF9hdHRyPU5vbmUsIG5ld19hdHRyPU5vbmUpOgogICAgICAgIHN1cGVyKE1vdmVkQXR0cmlidXRlLCBzZWxmKS5fX2luaXRfXyhuYW1lKQogICAgICAgIGlmIFBZMzoKICAgICAgICAgICAgaWYgbmV3X21vZCBpcyBOb25lOgogICAgICAgICAgICAgICAgbmV3X21vZCA9IG5hbWUKICAgICAgICAgICAgc2VsZi5tb2QgPSBuZXdfbW9kCiAgICAgICAgICAgIGlmIG5ld19hdHRyIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBvbGRfYXR0ciBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIG5ld19hdHRyID0gbmFtZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBuZXdfYXR0ciA9IG9sZF9hdHRyCiAgICAgICAgICAgIHNlbGYuYXR0ciA9IG5ld19hdHRyCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5tb2QgPSBvbGRfbW9kCiAgICAgICAgICAgIGlmIG9sZF9hdHRyIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBvbGRfYXR0ciA9IG5hbWUKICAgICAgICAgICAgc2VsZi5hdHRyID0gb2xkX2F0dHIKCiAgICBkZWYgX3Jlc29sdmUoc2VsZik6CiAgICAgICAgbW9kdWxlID0gX2ltcG9ydF9tb2R1bGUoc2VsZi5tb2QpCiAgICAgICAgcmV0dXJuIGdldGF0dHIobW9kdWxlLCBzZWxmLmF0dHIpCgoKY2xhc3MgX1NpeE1ldGFQYXRoSW1wb3J0ZXIob2JqZWN0KToKCiAgICAiIiIKICAgIEEgbWV0YSBwYXRoIGltcG9ydGVyIHRvIGltcG9ydCBzaXgubW92ZXMgYW5kIGl0cyBzdWJtb2R1bGVzLgoKICAgIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIFBFUDMwMiBmaW5kZXIgYW5kIGxvYWRlci4gSXQgc2hvdWxkIGJlIGNvbXBhdGlibGUKICAgIHdpdGggUHl0aG9uIDIuNSBhbmQgYWxsIGV4aXN0aW5nIHZlcnNpb25zIG9mIFB5dGhvbjMKICAgICIiIgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzaXhfbW9kdWxlX25hbWUpOgogICAgICAgIHNlbGYubmFtZSA9IHNpeF9tb2R1bGVfbmFtZQogICAgICAgIHNlbGYua25vd25fbW9kdWxlcyA9IHt9CgogICAgZGVmIF9hZGRfbW9kdWxlKHNlbGYsIG1vZCwgKmZ1bGxuYW1lcyk6CiAgICAgICAgZm9yIGZ1bGxuYW1lIGluIGZ1bGxuYW1lczoKICAgICAgICAgICAgc2VsZi5rbm93bl9tb2R1bGVzW3NlbGYubmFtZSArICIuIiArIGZ1bGxuYW1lXSA9IG1vZAoKICAgIGRlZiBfZ2V0X21vZHVsZShzZWxmLCBmdWxsbmFtZSk6CiAgICAgICAgcmV0dXJuIHNlbGYua25vd25fbW9kdWxlc1tzZWxmLm5hbWUgKyAiLiIgKyBmdWxsbmFtZV0KCiAgICBkZWYgZmluZF9tb2R1bGUoc2VsZiwgZnVsbG5hbWUsIHBhdGg9Tm9uZSk6CiAgICAgICAgaWYgZnVsbG5hbWUgaW4gc2VsZi5rbm93bl9tb2R1bGVzOgogICAgICAgICAgICByZXR1cm4gc2VsZgogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9fZ2V0X21vZHVsZShzZWxmLCBmdWxsbmFtZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gc2VsZi5rbm93bl9tb2R1bGVzW2Z1bGxuYW1lXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IoIlRoaXMgbG9hZGVyIGRvZXMgbm90IGtub3cgbW9kdWxlICIgKyBmdWxsbmFtZSkKCiAgICBkZWYgbG9hZF9tb2R1bGUoc2VsZiwgZnVsbG5hbWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBpbiBjYXNlIG9mIGEgcmVsb2FkCiAgICAgICAgICAgIHJldHVybiBzeXMubW9kdWxlc1tmdWxsbmFtZV0KICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBtb2QgPSBzZWxmLl9fZ2V0X21vZHVsZShmdWxsbmFtZSkKICAgICAgICBpZiBpc2luc3RhbmNlKG1vZCwgTW92ZWRNb2R1bGUpOgogICAgICAgICAgICBtb2QgPSBtb2QuX3Jlc29sdmUoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG1vZC5fX2xvYWRlcl9fID0gc2VsZgogICAgICAgIHN5cy5tb2R1bGVzW2Z1bGxuYW1lXSA9IG1vZAogICAgICAgIHJldHVybiBtb2QKCiAgICBkZWYgaXNfcGFja2FnZShzZWxmLCBmdWxsbmFtZSk6CiAgICAgICAgIiIiCiAgICAgICAgUmV0dXJuIHRydWUsIGlmIHRoZSBuYW1lZCBtb2R1bGUgaXMgYSBwYWNrYWdlLgoKICAgICAgICBXZSBuZWVkIHRoaXMgbWV0aG9kIHRvIGdldCBjb3JyZWN0IHNwZWMgb2JqZWN0cyB3aXRoCiAgICAgICAgUHl0aG9uIDMuNCAoc2VlIFBFUDQ1MSkKICAgICAgICAiIiIKICAgICAgICByZXR1cm4gaGFzYXR0cihzZWxmLl9fZ2V0X21vZHVsZShmdWxsbmFtZSksICJfX3BhdGhfXyIpCgogICAgZGVmIGdldF9jb2RlKHNlbGYsIGZ1bGxuYW1lKToKICAgICAgICAiIiJSZXR1cm4gTm9uZQoKICAgICAgICBSZXF1aXJlZCwgaWYgaXNfcGFja2FnZSBpcyBpbXBsZW1lbnRlZCIiIgogICAgICAgIHNlbGYuX19nZXRfbW9kdWxlKGZ1bGxuYW1lKSAgIyBldmVudHVhbGx5IHJhaXNlcyBJbXBvcnRFcnJvcgogICAgICAgIHJldHVybiBOb25lCiAgICBnZXRfc291cmNlID0gZ2V0X2NvZGUgICMgc2FtZSBhcyBnZXRfY29kZQoKX2ltcG9ydGVyID0gX1NpeE1ldGFQYXRoSW1wb3J0ZXIoX19uYW1lX18pCgoKY2xhc3MgX01vdmVkSXRlbXMoX0xhenlNb2R1bGUpOgoKICAgICIiIkxhenkgbG9hZGluZyBvZiBtb3ZlZCBvYmplY3RzIiIiCiAgICBfX3BhdGhfXyA9IFtdICAjIG1hcmsgYXMgcGFja2FnZQoKCl9tb3ZlZF9hdHRyaWJ1dGVzID0gWwogICAgTW92ZWRBdHRyaWJ1dGUoImNTdHJpbmdJTyIsICJjU3RyaW5nSU8iLCAiaW8iLCAiU3RyaW5nSU8iKSwKICAgIE1vdmVkQXR0cmlidXRlKCJmaWx0ZXIiLCAiaXRlcnRvb2xzIiwgImJ1aWx0aW5zIiwgImlmaWx0ZXIiLCAiZmlsdGVyIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiZmlsdGVyZmFsc2UiLCAiaXRlcnRvb2xzIiwgIml0ZXJ0b29scyIsICJpZmlsdGVyZmFsc2UiLCAiZmlsdGVyZmFsc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJpbnB1dCIsICJfX2J1aWx0aW5fXyIsICJidWlsdGlucyIsICJyYXdfaW5wdXQiLCAiaW5wdXQiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJpbnRlcm4iLCAiX19idWlsdGluX18iLCAic3lzIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgibWFwIiwgIml0ZXJ0b29scyIsICJidWlsdGlucyIsICJpbWFwIiwgIm1hcCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImdldGN3ZCIsICJvcyIsICJvcyIsICJnZXRjd2R1IiwgImdldGN3ZCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImdldGN3ZGIiLCAib3MiLCAib3MiLCAiZ2V0Y3dkIiwgImdldGN3ZGIiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJyYW5nZSIsICJfX2J1aWx0aW5fXyIsICJidWlsdGlucyIsICJ4cmFuZ2UiLCAicmFuZ2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJyZWxvYWRfbW9kdWxlIiwgIl9fYnVpbHRpbl9fIiwgImltcG9ydGxpYiIgaWYgUFkzNCBlbHNlICJpbXAiLCAicmVsb2FkIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicmVkdWNlIiwgIl9fYnVpbHRpbl9fIiwgImZ1bmN0b29scyIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInNobGV4X3F1b3RlIiwgInBpcGVzIiwgInNobGV4IiwgInF1b3RlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiU3RyaW5nSU8iLCAiU3RyaW5nSU8iLCAiaW8iKSwKICAgIE1vdmVkQXR0cmlidXRlKCJVc2VyRGljdCIsICJVc2VyRGljdCIsICJjb2xsZWN0aW9ucyIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlVzZXJMaXN0IiwgIlVzZXJMaXN0IiwgImNvbGxlY3Rpb25zIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiVXNlclN0cmluZyIsICJVc2VyU3RyaW5nIiwgImNvbGxlY3Rpb25zIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgieHJhbmdlIiwgIl9fYnVpbHRpbl9fIiwgImJ1aWx0aW5zIiwgInhyYW5nZSIsICJyYW5nZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInppcCIsICJpdGVydG9vbHMiLCAiYnVpbHRpbnMiLCAiaXppcCIsICJ6aXAiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ6aXBfbG9uZ2VzdCIsICJpdGVydG9vbHMiLCAiaXRlcnRvb2xzIiwgIml6aXBfbG9uZ2VzdCIsICJ6aXBfbG9uZ2VzdCIpLAogICAgTW92ZWRNb2R1bGUoImJ1aWx0aW5zIiwgIl9fYnVpbHRpbl9fIiksCiAgICBNb3ZlZE1vZHVsZSgiY29uZmlncGFyc2VyIiwgIkNvbmZpZ1BhcnNlciIpLAogICAgTW92ZWRNb2R1bGUoImNvcHlyZWciLCAiY29weV9yZWciKSwKICAgIE1vdmVkTW9kdWxlKCJkYm1fZ251IiwgImdkYm0iLCAiZGJtLmdudSIpLAogICAgTW92ZWRNb2R1bGUoIl9kdW1teV90aHJlYWQiLCAiZHVtbXlfdGhyZWFkIiwgIl9kdW1teV90aHJlYWQiKSwKICAgIE1vdmVkTW9kdWxlKCJodHRwX2Nvb2tpZWphciIsICJjb29raWVsaWIiLCAiaHR0cC5jb29raWVqYXIiKSwKICAgIE1vdmVkTW9kdWxlKCJodHRwX2Nvb2tpZXMiLCAiQ29va2llIiwgImh0dHAuY29va2llcyIpLAogICAgTW92ZWRNb2R1bGUoImh0bWxfZW50aXRpZXMiLCAiaHRtbGVudGl0eWRlZnMiLCAiaHRtbC5lbnRpdGllcyIpLAogICAgTW92ZWRNb2R1bGUoImh0bWxfcGFyc2VyIiwgIkhUTUxQYXJzZXIiLCAiaHRtbC5wYXJzZXIiKSwKICAgIE1vdmVkTW9kdWxlKCJodHRwX2NsaWVudCIsICJodHRwbGliIiwgImh0dHAuY2xpZW50IiksCiAgICBNb3ZlZE1vZHVsZSgiZW1haWxfbWltZV9tdWx0aXBhcnQiLCAiZW1haWwuTUlNRU11bHRpcGFydCIsICJlbWFpbC5taW1lLm11bHRpcGFydCIpLAogICAgTW92ZWRNb2R1bGUoImVtYWlsX21pbWVfbm9ubXVsdGlwYXJ0IiwgImVtYWlsLk1JTUVOb25NdWx0aXBhcnQiLCAiZW1haWwubWltZS5ub25tdWx0aXBhcnQiKSwKICAgIE1vdmVkTW9kdWxlKCJlbWFpbF9taW1lX3RleHQiLCAiZW1haWwuTUlNRVRleHQiLCAiZW1haWwubWltZS50ZXh0IiksCiAgICBNb3ZlZE1vZHVsZSgiZW1haWxfbWltZV9iYXNlIiwgImVtYWlsLk1JTUVCYXNlIiwgImVtYWlsLm1pbWUuYmFzZSIpLAogICAgTW92ZWRNb2R1bGUoIkJhc2VIVFRQU2VydmVyIiwgIkJhc2VIVFRQU2VydmVyIiwgImh0dHAuc2VydmVyIiksCiAgICBNb3ZlZE1vZHVsZSgiQ0dJSFRUUFNlcnZlciIsICJDR0lIVFRQU2VydmVyIiwgImh0dHAuc2VydmVyIiksCiAgICBNb3ZlZE1vZHVsZSgiU2ltcGxlSFRUUFNlcnZlciIsICJTaW1wbGVIVFRQU2VydmVyIiwgImh0dHAuc2VydmVyIiksCiAgICBNb3ZlZE1vZHVsZSgiY1BpY2tsZSIsICJjUGlja2xlIiwgInBpY2tsZSIpLAogICAgTW92ZWRNb2R1bGUoInF1ZXVlIiwgIlF1ZXVlIiksCiAgICBNb3ZlZE1vZHVsZSgicmVwcmxpYiIsICJyZXByIiksCiAgICBNb3ZlZE1vZHVsZSgic29ja2V0c2VydmVyIiwgIlNvY2tldFNlcnZlciIpLAogICAgTW92ZWRNb2R1bGUoIl90aHJlYWQiLCAidGhyZWFkIiwgIl90aHJlYWQiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyIiwgIlRraW50ZXIiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX2RpYWxvZyIsICJEaWFsb2ciLCAidGtpbnRlci5kaWFsb2ciKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX2ZpbGVkaWFsb2ciLCAiRmlsZURpYWxvZyIsICJ0a2ludGVyLmZpbGVkaWFsb2ciKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX3Njcm9sbGVkdGV4dCIsICJTY3JvbGxlZFRleHQiLCAidGtpbnRlci5zY3JvbGxlZHRleHQiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX3NpbXBsZWRpYWxvZyIsICJTaW1wbGVEaWFsb2ciLCAidGtpbnRlci5zaW1wbGVkaWFsb2ciKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX3RpeCIsICJUaXgiLCAidGtpbnRlci50aXgiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX3R0ayIsICJ0dGsiLCAidGtpbnRlci50dGsiKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX2NvbnN0YW50cyIsICJUa2NvbnN0YW50cyIsICJ0a2ludGVyLmNvbnN0YW50cyIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfZG5kIiwgIlRrZG5kIiwgInRraW50ZXIuZG5kIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9jb2xvcmNob29zZXIiLCAidGtDb2xvckNob29zZXIiLAogICAgICAgICAgICAgICAgInRraW50ZXIuY29sb3JjaG9vc2VyIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9jb21tb25kaWFsb2ciLCAidGtDb21tb25EaWFsb2ciLAogICAgICAgICAgICAgICAgInRraW50ZXIuY29tbW9uZGlhbG9nIiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl90a2ZpbGVkaWFsb2ciLCAidGtGaWxlRGlhbG9nIiwgInRraW50ZXIuZmlsZWRpYWxvZyIpLAogICAgTW92ZWRNb2R1bGUoInRraW50ZXJfZm9udCIsICJ0a0ZvbnQiLCAidGtpbnRlci5mb250IiksCiAgICBNb3ZlZE1vZHVsZSgidGtpbnRlcl9tZXNzYWdlYm94IiwgInRrTWVzc2FnZUJveCIsICJ0a2ludGVyLm1lc3NhZ2Vib3giKSwKICAgIE1vdmVkTW9kdWxlKCJ0a2ludGVyX3Rrc2ltcGxlZGlhbG9nIiwgInRrU2ltcGxlRGlhbG9nIiwKICAgICAgICAgICAgICAgICJ0a2ludGVyLnNpbXBsZWRpYWxvZyIpLAogICAgTW92ZWRNb2R1bGUoInVybGxpYl9wYXJzZSIsIF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWJfcGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZE1vZHVsZSgidXJsbGliX2Vycm9yIiwgX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYl9lcnJvciIsICJ1cmxsaWIuZXJyb3IiKSwKICAgIE1vdmVkTW9kdWxlKCJ1cmxsaWIiLCBfX25hbWVfXyArICIubW92ZXMudXJsbGliIiwgX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYiIpLAogICAgTW92ZWRNb2R1bGUoInVybGxpYl9yb2JvdHBhcnNlciIsICJyb2JvdHBhcnNlciIsICJ1cmxsaWIucm9ib3RwYXJzZXIiKSwKICAgIE1vdmVkTW9kdWxlKCJ4bWxycGNfY2xpZW50IiwgInhtbHJwY2xpYiIsICJ4bWxycGMuY2xpZW50IiksCiAgICBNb3ZlZE1vZHVsZSgieG1scnBjX3NlcnZlciIsICJTaW1wbGVYTUxSUENTZXJ2ZXIiLCAieG1scnBjLnNlcnZlciIpLApdCiMgQWRkIHdpbmRvd3Mgc3BlY2lmaWMgbW9kdWxlcy4KaWYgc3lzLnBsYXRmb3JtID09ICJ3aW4zMiI6CiAgICBfbW92ZWRfYXR0cmlidXRlcyArPSBbCiAgICAgICAgTW92ZWRNb2R1bGUoIndpbnJlZyIsICJfd2lucmVnIiksCiAgICBdCgpmb3IgYXR0ciBpbiBfbW92ZWRfYXR0cmlidXRlczoKICAgIHNldGF0dHIoX01vdmVkSXRlbXMsIGF0dHIubmFtZSwgYXR0cikKICAgIGlmIGlzaW5zdGFuY2UoYXR0ciwgTW92ZWRNb2R1bGUpOgogICAgICAgIF9pbXBvcnRlci5fYWRkX21vZHVsZShhdHRyLCAibW92ZXMuIiArIGF0dHIubmFtZSkKZGVsIGF0dHIKCl9Nb3ZlZEl0ZW1zLl9tb3ZlZF9hdHRyaWJ1dGVzID0gX21vdmVkX2F0dHJpYnV0ZXMKCm1vdmVzID0gX01vdmVkSXRlbXMoX19uYW1lX18gKyAiLm1vdmVzIikKX2ltcG9ydGVyLl9hZGRfbW9kdWxlKG1vdmVzLCAibW92ZXMiKQoKCmNsYXNzIE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3BhcnNlKF9MYXp5TW9kdWxlKToKCiAgICAiIiJMYXp5IGxvYWRpbmcgb2YgbW92ZWQgb2JqZWN0cyBpbiBzaXgubW92ZXMudXJsbGliX3BhcnNlIiIiCgoKX3VybGxpYl9wYXJzZV9tb3ZlZF9hdHRyaWJ1dGVzID0gWwogICAgTW92ZWRBdHRyaWJ1dGUoIlBhcnNlUmVzdWx0IiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlNwbGl0UmVzdWx0IiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInBhcnNlX3FzIiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInBhcnNlX3FzbCIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxkZWZyYWciLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsam9pbiIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxwYXJzZSIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxzcGxpdCIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmx1bnBhcnNlIiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVybHVuc3BsaXQiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgicXVvdGUiLCAidXJsbGliIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInF1b3RlX3BsdXMiLCAidXJsbGliIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVucXVvdGUiLCAidXJsbGliIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVucXVvdGVfcGx1cyIsICJ1cmxsaWIiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsZW5jb2RlIiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJzcGxpdHF1ZXJ5IiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJzcGxpdHRhZyIsICJ1cmxsaWIiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgic3BsaXR1c2VyIiwgInVybGxpYiIsICJ1cmxsaWIucGFyc2UiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1c2VzX2ZyYWdtZW50IiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVzZXNfbmV0bG9jIiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVzZXNfcGFyYW1zIiwgInVybHBhcnNlIiwgInVybGxpYi5wYXJzZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoInVzZXNfcXVlcnkiLCAidXJscGFyc2UiLCAidXJsbGliLnBhcnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXNlc19yZWxhdGl2ZSIsICJ1cmxwYXJzZSIsICJ1cmxsaWIucGFyc2UiKSwKXQpmb3IgYXR0ciBpbiBfdXJsbGliX3BhcnNlX21vdmVkX2F0dHJpYnV0ZXM6CiAgICBzZXRhdHRyKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3BhcnNlLCBhdHRyLm5hbWUsIGF0dHIpCmRlbCBhdHRyCgpNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9wYXJzZS5fbW92ZWRfYXR0cmlidXRlcyA9IF91cmxsaWJfcGFyc2VfbW92ZWRfYXR0cmlidXRlcwoKX2ltcG9ydGVyLl9hZGRfbW9kdWxlKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3BhcnNlKF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWJfcGFyc2UiKSwKICAgICAgICAgICAgICAgICAgICAgICJtb3Zlcy51cmxsaWJfcGFyc2UiLCAibW92ZXMudXJsbGliLnBhcnNlIikKCgpjbGFzcyBNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9lcnJvcihfTGF6eU1vZHVsZSk6CgogICAgIiIiTGF6eSBsb2FkaW5nIG9mIG1vdmVkIG9iamVjdHMgaW4gc2l4Lm1vdmVzLnVybGxpYl9lcnJvciIiIgoKCl91cmxsaWJfZXJyb3JfbW92ZWRfYXR0cmlidXRlcyA9IFsKICAgIE1vdmVkQXR0cmlidXRlKCJVUkxFcnJvciIsICJ1cmxsaWIyIiwgInVybGxpYi5lcnJvciIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBFcnJvciIsICJ1cmxsaWIyIiwgInVybGxpYi5lcnJvciIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkNvbnRlbnRUb29TaG9ydEVycm9yIiwgInVybGxpYiIsICJ1cmxsaWIuZXJyb3IiKSwKXQpmb3IgYXR0ciBpbiBfdXJsbGliX2Vycm9yX21vdmVkX2F0dHJpYnV0ZXM6CiAgICBzZXRhdHRyKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX2Vycm9yLCBhdHRyLm5hbWUsIGF0dHIpCmRlbCBhdHRyCgpNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9lcnJvci5fbW92ZWRfYXR0cmlidXRlcyA9IF91cmxsaWJfZXJyb3JfbW92ZWRfYXR0cmlidXRlcwoKX2ltcG9ydGVyLl9hZGRfbW9kdWxlKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX2Vycm9yKF9fbmFtZV9fICsgIi5tb3Zlcy51cmxsaWIuZXJyb3IiKSwKICAgICAgICAgICAgICAgICAgICAgICJtb3Zlcy51cmxsaWJfZXJyb3IiLCAibW92ZXMudXJsbGliLmVycm9yIikKCgpjbGFzcyBNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXF1ZXN0KF9MYXp5TW9kdWxlKToKCiAgICAiIiJMYXp5IGxvYWRpbmcgb2YgbW92ZWQgb2JqZWN0cyBpbiBzaXgubW92ZXMudXJsbGliX3JlcXVlc3QiIiIKCgpfdXJsbGliX3JlcXVlc3RfbW92ZWRfYXR0cmlidXRlcyA9IFsKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxvcGVuIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJpbnN0YWxsX29wZW5lciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiYnVpbGRfb3BlbmVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJwYXRobmFtZTJ1cmwiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgidXJsMnBhdGhuYW1lIiwgInVybGxpYiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImdldHByb3hpZXMiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiUmVxdWVzdCIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiT3BlbmVyRGlyZWN0b3IiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBEZWZhdWx0RXJyb3JIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQUmVkaXJlY3RIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQQ29va2llUHJvY2Vzc29yIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJQcm94eUhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkJhc2VIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQUGFzc3dvcmRNZ3IiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkhUVFBQYXNzd29yZE1ncldpdGhEZWZhdWx0UmVhbG0iLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIkFic3RyYWN0QmFzaWNBdXRoSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUEJhc2ljQXV0aEhhbmRsZXIiLCAidXJsbGliMiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlByb3h5QmFzaWNBdXRoSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiQWJzdHJhY3REaWdlc3RBdXRoSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUERpZ2VzdEF1dGhIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJQcm94eURpZ2VzdEF1dGhIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJIVFRQSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUFNIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJGaWxlSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiRlRQSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiQ2FjaGVGVFBIYW5kbGVyIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJVbmtub3duSGFuZGxlciIsICJ1cmxsaWIyIiwgInVybGxpYi5yZXF1ZXN0IiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiSFRUUEVycm9yUHJvY2Vzc29yIiwgInVybGxpYjIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxyZXRyaWV2ZSIsICJ1cmxsaWIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJ1cmxjbGVhbnVwIiwgInVybGxpYiIsICJ1cmxsaWIucmVxdWVzdCIpLAogICAgTW92ZWRBdHRyaWJ1dGUoIlVSTG9wZW5lciIsICJ1cmxsaWIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJGYW5jeVVSTG9wZW5lciIsICJ1cmxsaWIiLCAidXJsbGliLnJlcXVlc3QiKSwKICAgIE1vdmVkQXR0cmlidXRlKCJwcm94eV9ieXBhc3MiLCAidXJsbGliIiwgInVybGxpYi5yZXF1ZXN0IiksCl0KZm9yIGF0dHIgaW4gX3VybGxpYl9yZXF1ZXN0X21vdmVkX2F0dHJpYnV0ZXM6CiAgICBzZXRhdHRyKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JlcXVlc3QsIGF0dHIubmFtZSwgYXR0cikKZGVsIGF0dHIKCk1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JlcXVlc3QuX21vdmVkX2F0dHJpYnV0ZXMgPSBfdXJsbGliX3JlcXVlc3RfbW92ZWRfYXR0cmlidXRlcwoKX2ltcG9ydGVyLl9hZGRfbW9kdWxlKE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JlcXVlc3QoX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYi5yZXF1ZXN0IiksCiAgICAgICAgICAgICAgICAgICAgICAibW92ZXMudXJsbGliX3JlcXVlc3QiLCAibW92ZXMudXJsbGliLnJlcXVlc3QiKQoKCmNsYXNzIE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3Jlc3BvbnNlKF9MYXp5TW9kdWxlKToKCiAgICAiIiJMYXp5IGxvYWRpbmcgb2YgbW92ZWQgb2JqZWN0cyBpbiBzaXgubW92ZXMudXJsbGliX3Jlc3BvbnNlIiIiCgoKX3VybGxpYl9yZXNwb25zZV9tb3ZlZF9hdHRyaWJ1dGVzID0gWwogICAgTW92ZWRBdHRyaWJ1dGUoImFkZGJhc2UiLCAidXJsbGliIiwgInVybGxpYi5yZXNwb25zZSIpLAogICAgTW92ZWRBdHRyaWJ1dGUoImFkZGNsb3NlaG9vayIsICJ1cmxsaWIiLCAidXJsbGliLnJlc3BvbnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiYWRkaW5mbyIsICJ1cmxsaWIiLCAidXJsbGliLnJlc3BvbnNlIiksCiAgICBNb3ZlZEF0dHJpYnV0ZSgiYWRkaW5mb3VybCIsICJ1cmxsaWIiLCAidXJsbGliLnJlc3BvbnNlIiksCl0KZm9yIGF0dHIgaW4gX3VybGxpYl9yZXNwb25zZV9tb3ZlZF9hdHRyaWJ1dGVzOgogICAgc2V0YXR0cihNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXNwb25zZSwgYXR0ci5uYW1lLCBhdHRyKQpkZWwgYXR0cgoKTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcmVzcG9uc2UuX21vdmVkX2F0dHJpYnV0ZXMgPSBfdXJsbGliX3Jlc3BvbnNlX21vdmVkX2F0dHJpYnV0ZXMKCl9pbXBvcnRlci5fYWRkX21vZHVsZShNb2R1bGVfc2l4X21vdmVzX3VybGxpYl9yZXNwb25zZShfX25hbWVfXyArICIubW92ZXMudXJsbGliLnJlc3BvbnNlIiksCiAgICAgICAgICAgICAgICAgICAgICAibW92ZXMudXJsbGliX3Jlc3BvbnNlIiwgIm1vdmVzLnVybGxpYi5yZXNwb25zZSIpCgoKY2xhc3MgTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcm9ib3RwYXJzZXIoX0xhenlNb2R1bGUpOgoKICAgICIiIkxhenkgbG9hZGluZyBvZiBtb3ZlZCBvYmplY3RzIGluIHNpeC5tb3Zlcy51cmxsaWJfcm9ib3RwYXJzZXIiIiIKCgpfdXJsbGliX3JvYm90cGFyc2VyX21vdmVkX2F0dHJpYnV0ZXMgPSBbCiAgICBNb3ZlZEF0dHJpYnV0ZSgiUm9ib3RGaWxlUGFyc2VyIiwgInJvYm90cGFyc2VyIiwgInVybGxpYi5yb2JvdHBhcnNlciIpLApdCmZvciBhdHRyIGluIF91cmxsaWJfcm9ib3RwYXJzZXJfbW92ZWRfYXR0cmlidXRlczoKICAgIHNldGF0dHIoTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcm9ib3RwYXJzZXIsIGF0dHIubmFtZSwgYXR0cikKZGVsIGF0dHIKCk1vZHVsZV9zaXhfbW92ZXNfdXJsbGliX3JvYm90cGFyc2VyLl9tb3ZlZF9hdHRyaWJ1dGVzID0gX3VybGxpYl9yb2JvdHBhcnNlcl9tb3ZlZF9hdHRyaWJ1dGVzCgpfaW1wb3J0ZXIuX2FkZF9tb2R1bGUoTW9kdWxlX3NpeF9tb3Zlc191cmxsaWJfcm9ib3RwYXJzZXIoX19uYW1lX18gKyAiLm1vdmVzLnVybGxpYi5yb2JvdHBhcnNlciIpLAogICAgICAgICAgICAgICAgICAgICAgIm1vdmVzLnVybGxpYl9yb2JvdHBhcnNlciIsICJtb3Zlcy51cmxsaWIucm9ib3RwYXJzZXIiKQoKCmNsYXNzIE1vZHVsZV9zaXhfbW92ZXNfdXJsbGliKHR5cGVzLk1vZHVsZVR5cGUpOgoKICAgICIiIkNyZWF0ZSBhIHNpeC5tb3Zlcy51cmxsaWIgbmFtZXNwYWNlIHRoYXQgcmVzZW1ibGVzIHRoZSBQeXRob24gMyBuYW1lc3BhY2UiIiIKICAgIF9fcGF0aF9fID0gW10gICMgbWFyayBhcyBwYWNrYWdlCiAgICBwYXJzZSA9IF9pbXBvcnRlci5fZ2V0X21vZHVsZSgibW92ZXMudXJsbGliX3BhcnNlIikKICAgIGVycm9yID0gX2ltcG9ydGVyLl9nZXRfbW9kdWxlKCJtb3Zlcy51cmxsaWJfZXJyb3IiKQogICAgcmVxdWVzdCA9IF9pbXBvcnRlci5fZ2V0X21vZHVsZSgibW92ZXMudXJsbGliX3JlcXVlc3QiKQogICAgcmVzcG9uc2UgPSBfaW1wb3J0ZXIuX2dldF9tb2R1bGUoIm1vdmVzLnVybGxpYl9yZXNwb25zZSIpCiAgICByb2JvdHBhcnNlciA9IF9pbXBvcnRlci5fZ2V0X21vZHVsZSgibW92ZXMudXJsbGliX3JvYm90cGFyc2VyIikKCiAgICBkZWYgX19kaXJfXyhzZWxmKToKICAgICAgICByZXR1cm4gWydwYXJzZScsICdlcnJvcicsICdyZXF1ZXN0JywgJ3Jlc3BvbnNlJywgJ3JvYm90cGFyc2VyJ10KCl9pbXBvcnRlci5fYWRkX21vZHVsZShNb2R1bGVfc2l4X21vdmVzX3VybGxpYihfX25hbWVfXyArICIubW92ZXMudXJsbGliIiksCiAgICAgICAgICAgICAgICAgICAgICAibW92ZXMudXJsbGliIikKCgpkZWYgYWRkX21vdmUobW92ZSk6CiAgICAiIiJBZGQgYW4gaXRlbSB0byBzaXgubW92ZXMuIiIiCiAgICBzZXRhdHRyKF9Nb3ZlZEl0ZW1zLCBtb3ZlLm5hbWUsIG1vdmUpCgoKZGVmIHJlbW92ZV9tb3ZlKG5hbWUpOgogICAgIiIiUmVtb3ZlIGl0ZW0gZnJvbSBzaXgubW92ZXMuIiIiCiAgICB0cnk6CiAgICAgICAgZGVsYXR0cihfTW92ZWRJdGVtcywgbmFtZSkKICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRlbCBtb3Zlcy5fX2RpY3RfX1tuYW1lXQogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICAgICAgcmFpc2UgQXR0cmlidXRlRXJyb3IoIm5vIHN1Y2ggbW92ZSwgJXIiICUgKG5hbWUsKSkKCgppZiBQWTM6CiAgICBfbWV0aF9mdW5jID0gIl9fZnVuY19fIgogICAgX21ldGhfc2VsZiA9ICJfX3NlbGZfXyIKCiAgICBfZnVuY19jbG9zdXJlID0gIl9fY2xvc3VyZV9fIgogICAgX2Z1bmNfY29kZSA9ICJfX2NvZGVfXyIKICAgIF9mdW5jX2RlZmF1bHRzID0gIl9fZGVmYXVsdHNfXyIKICAgIF9mdW5jX2dsb2JhbHMgPSAiX19nbG9iYWxzX18iCmVsc2U6CiAgICBfbWV0aF9mdW5jID0gImltX2Z1bmMiCiAgICBfbWV0aF9zZWxmID0gImltX3NlbGYiCgogICAgX2Z1bmNfY2xvc3VyZSA9ICJmdW5jX2Nsb3N1cmUiCiAgICBfZnVuY19jb2RlID0gImZ1bmNfY29kZSIKICAgIF9mdW5jX2RlZmF1bHRzID0gImZ1bmNfZGVmYXVsdHMiCiAgICBfZnVuY19nbG9iYWxzID0gImZ1bmNfZ2xvYmFscyIKCgp0cnk6CiAgICBhZHZhbmNlX2l0ZXJhdG9yID0gbmV4dApleGNlcHQgTmFtZUVycm9yOgogICAgZGVmIGFkdmFuY2VfaXRlcmF0b3IoaXQpOgogICAgICAgIHJldHVybiBpdC5uZXh0KCkKbmV4dCA9IGFkdmFuY2VfaXRlcmF0b3IKCgp0cnk6CiAgICBjYWxsYWJsZSA9IGNhbGxhYmxlCmV4Y2VwdCBOYW1lRXJyb3I6CiAgICBkZWYgY2FsbGFibGUob2JqKToKICAgICAgICByZXR1cm4gYW55KCJfX2NhbGxfXyIgaW4ga2xhc3MuX19kaWN0X18gZm9yIGtsYXNzIGluIHR5cGUob2JqKS5fX21yb19fKQoKCmlmIFBZMzoKICAgIGRlZiBnZXRfdW5ib3VuZF9mdW5jdGlvbih1bmJvdW5kKToKICAgICAgICByZXR1cm4gdW5ib3VuZAoKICAgIGNyZWF0ZV9ib3VuZF9tZXRob2QgPSB0eXBlcy5NZXRob2RUeXBlCgogICAgZGVmIGNyZWF0ZV91bmJvdW5kX21ldGhvZChmdW5jLCBjbHMpOgogICAgICAgIHJldHVybiBmdW5jCgogICAgSXRlcmF0b3IgPSBvYmplY3QKZWxzZToKICAgIGRlZiBnZXRfdW5ib3VuZF9mdW5jdGlvbih1bmJvdW5kKToKICAgICAgICByZXR1cm4gdW5ib3VuZC5pbV9mdW5jCgogICAgZGVmIGNyZWF0ZV9ib3VuZF9tZXRob2QoZnVuYywgb2JqKToKICAgICAgICByZXR1cm4gdHlwZXMuTWV0aG9kVHlwZShmdW5jLCBvYmosIG9iai5fX2NsYXNzX18pCgogICAgZGVmIGNyZWF0ZV91bmJvdW5kX21ldGhvZChmdW5jLCBjbHMpOgogICAgICAgIHJldHVybiB0eXBlcy5NZXRob2RUeXBlKGZ1bmMsIE5vbmUsIGNscykKCiAgICBjbGFzcyBJdGVyYXRvcihvYmplY3QpOgoKICAgICAgICBkZWYgbmV4dChzZWxmKToKICAgICAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikuX19uZXh0X18oc2VsZikKCiAgICBjYWxsYWJsZSA9IGNhbGxhYmxlCl9hZGRfZG9jKGdldF91bmJvdW5kX2Z1bmN0aW9uLAogICAgICAgICAiIiJHZXQgdGhlIGZ1bmN0aW9uIG91dCBvZiBhIHBvc3NpYmx5IHVuYm91bmQgZnVuY3Rpb24iIiIpCgoKZ2V0X21ldGhvZF9mdW5jdGlvbiA9IG9wZXJhdG9yLmF0dHJnZXR0ZXIoX21ldGhfZnVuYykKZ2V0X21ldGhvZF9zZWxmID0gb3BlcmF0b3IuYXR0cmdldHRlcihfbWV0aF9zZWxmKQpnZXRfZnVuY3Rpb25fY2xvc3VyZSA9IG9wZXJhdG9yLmF0dHJnZXR0ZXIoX2Z1bmNfY2xvc3VyZSkKZ2V0X2Z1bmN0aW9uX2NvZGUgPSBvcGVyYXRvci5hdHRyZ2V0dGVyKF9mdW5jX2NvZGUpCmdldF9mdW5jdGlvbl9kZWZhdWx0cyA9IG9wZXJhdG9yLmF0dHJnZXR0ZXIoX2Z1bmNfZGVmYXVsdHMpCmdldF9mdW5jdGlvbl9nbG9iYWxzID0gb3BlcmF0b3IuYXR0cmdldHRlcihfZnVuY19nbG9iYWxzKQoKCmlmIFBZMzoKICAgIGRlZiBpdGVya2V5cyhkLCAqKmt3KToKICAgICAgICByZXR1cm4gaXRlcihkLmtleXMoKiprdykpCgogICAgZGVmIGl0ZXJ2YWx1ZXMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGl0ZXIoZC52YWx1ZXMoKiprdykpCgogICAgZGVmIGl0ZXJpdGVtcyhkLCAqKmt3KToKICAgICAgICByZXR1cm4gaXRlcihkLml0ZW1zKCoqa3cpKQoKICAgIGRlZiBpdGVybGlzdHMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGl0ZXIoZC5saXN0cygqKmt3KSkKCiAgICB2aWV3a2V5cyA9IG9wZXJhdG9yLm1ldGhvZGNhbGxlcigia2V5cyIpCgogICAgdmlld3ZhbHVlcyA9IG9wZXJhdG9yLm1ldGhvZGNhbGxlcigidmFsdWVzIikKCiAgICB2aWV3aXRlbXMgPSBvcGVyYXRvci5tZXRob2RjYWxsZXIoIml0ZW1zIikKZWxzZToKICAgIGRlZiBpdGVya2V5cyhkLCAqKmt3KToKICAgICAgICByZXR1cm4gZC5pdGVya2V5cygqKmt3KQoKICAgIGRlZiBpdGVydmFsdWVzKGQsICoqa3cpOgogICAgICAgIHJldHVybiBkLml0ZXJ2YWx1ZXMoKiprdykKCiAgICBkZWYgaXRlcml0ZW1zKGQsICoqa3cpOgogICAgICAgIHJldHVybiBkLml0ZXJpdGVtcygqKmt3KQoKICAgIGRlZiBpdGVybGlzdHMoZCwgKiprdyk6CiAgICAgICAgcmV0dXJuIGQuaXRlcmxpc3RzKCoqa3cpCgogICAgdmlld2tleXMgPSBvcGVyYXRvci5tZXRob2RjYWxsZXIoInZpZXdrZXlzIikKCiAgICB2aWV3dmFsdWVzID0gb3BlcmF0b3IubWV0aG9kY2FsbGVyKCJ2aWV3dmFsdWVzIikKCiAgICB2aWV3aXRlbXMgPSBvcGVyYXRvci5tZXRob2RjYWxsZXIoInZpZXdpdGVtcyIpCgpfYWRkX2RvYyhpdGVya2V5cywgIlJldHVybiBhbiBpdGVyYXRvciBvdmVyIHRoZSBrZXlzIG9mIGEgZGljdGlvbmFyeS4iKQpfYWRkX2RvYyhpdGVydmFsdWVzLCAiUmV0dXJuIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIHZhbHVlcyBvZiBhIGRpY3Rpb25hcnkuIikKX2FkZF9kb2MoaXRlcml0ZW1zLAogICAgICAgICAiUmV0dXJuIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIChrZXksIHZhbHVlKSBwYWlycyBvZiBhIGRpY3Rpb25hcnkuIikKX2FkZF9kb2MoaXRlcmxpc3RzLAogICAgICAgICAiUmV0dXJuIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIChrZXksIFt2YWx1ZXNdKSBwYWlycyBvZiBhIGRpY3Rpb25hcnkuIikKCgppZiBQWTM6CiAgICBkZWYgYihzKToKICAgICAgICByZXR1cm4gcy5lbmNvZGUoImxhdGluLTEiKQoKICAgIGRlZiB1KHMpOgogICAgICAgIHJldHVybiBzCiAgICB1bmljaHIgPSBjaHIKICAgIGltcG9ydCBzdHJ1Y3QKICAgIGludDJieXRlID0gc3RydWN0LlN0cnVjdCgiPkIiKS5wYWNrCiAgICBkZWwgc3RydWN0CiAgICBieXRlMmludCA9IG9wZXJhdG9yLml0ZW1nZXR0ZXIoMCkKICAgIGluZGV4Ynl0ZXMgPSBvcGVyYXRvci5nZXRpdGVtCiAgICBpdGVyYnl0ZXMgPSBpdGVyCiAgICBpbXBvcnQgaW8KICAgIFN0cmluZ0lPID0gaW8uU3RyaW5nSU8KICAgIEJ5dGVzSU8gPSBpby5CeXRlc0lPCiAgICBfYXNzZXJ0Q291bnRFcXVhbCA9ICJhc3NlcnRDb3VudEVxdWFsIgogICAgaWYgc3lzLnZlcnNpb25faW5mb1sxXSA8PSAxOgogICAgICAgIF9hc3NlcnRSYWlzZXNSZWdleCA9ICJhc3NlcnRSYWlzZXNSZWdleHAiCiAgICAgICAgX2Fzc2VydFJlZ2V4ID0gImFzc2VydFJlZ2V4cE1hdGNoZXMiCiAgICBlbHNlOgogICAgICAgIF9hc3NlcnRSYWlzZXNSZWdleCA9ICJhc3NlcnRSYWlzZXNSZWdleCIKICAgICAgICBfYXNzZXJ0UmVnZXggPSAiYXNzZXJ0UmVnZXgiCmVsc2U6CiAgICBkZWYgYihzKToKICAgICAgICByZXR1cm4gcwogICAgIyBXb3JrYXJvdW5kIGZvciBzdGFuZGFsb25lIGJhY2tzbGFzaAoKICAgIGRlZiB1KHMpOgogICAgICAgIHJldHVybiB1bmljb2RlKHMucmVwbGFjZShyJ1xcJywgcidcXFxcJyksICJ1bmljb2RlX2VzY2FwZSIpCiAgICB1bmljaHIgPSB1bmljaHIKICAgIGludDJieXRlID0gY2hyCgogICAgZGVmIGJ5dGUyaW50KGJzKToKICAgICAgICByZXR1cm4gb3JkKGJzWzBdKQoKICAgIGRlZiBpbmRleGJ5dGVzKGJ1ZiwgaSk6CiAgICAgICAgcmV0dXJuIG9yZChidWZbaV0pCiAgICBpdGVyYnl0ZXMgPSBmdW5jdG9vbHMucGFydGlhbChpdGVydG9vbHMuaW1hcCwgb3JkKQogICAgaW1wb3J0IFN0cmluZ0lPCiAgICBTdHJpbmdJTyA9IEJ5dGVzSU8gPSBTdHJpbmdJTy5TdHJpbmdJTwogICAgX2Fzc2VydENvdW50RXF1YWwgPSAiYXNzZXJ0SXRlbXNFcXVhbCIKICAgIF9hc3NlcnRSYWlzZXNSZWdleCA9ICJhc3NlcnRSYWlzZXNSZWdleHAiCiAgICBfYXNzZXJ0UmVnZXggPSAiYXNzZXJ0UmVnZXhwTWF0Y2hlcyIKX2FkZF9kb2MoYiwgIiIiQnl0ZSBsaXRlcmFsIiIiKQpfYWRkX2RvYyh1LCAiIiJUZXh0IGxpdGVyYWwiIiIpCgoKZGVmIGFzc2VydENvdW50RXF1YWwoc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgIHJldHVybiBnZXRhdHRyKHNlbGYsIF9hc3NlcnRDb3VudEVxdWFsKSgqYXJncywgKiprd2FyZ3MpCgoKZGVmIGFzc2VydFJhaXNlc1JlZ2V4KHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICByZXR1cm4gZ2V0YXR0cihzZWxmLCBfYXNzZXJ0UmFpc2VzUmVnZXgpKCphcmdzLCAqKmt3YXJncykKCgpkZWYgYXNzZXJ0UmVnZXgoc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgIHJldHVybiBnZXRhdHRyKHNlbGYsIF9hc3NlcnRSZWdleCkoKmFyZ3MsICoqa3dhcmdzKQoKCmlmIFBZMzoKICAgIGV4ZWNfID0gZ2V0YXR0cihtb3Zlcy5idWlsdGlucywgImV4ZWMiKQoKICAgIGRlZiByZXJhaXNlKHRwLCB2YWx1ZSwgdGI9Tm9uZSk6CiAgICAgICAgaWYgdmFsdWUgaXMgTm9uZToKICAgICAgICAgICAgdmFsdWUgPSB0cCgpCiAgICAgICAgaWYgdmFsdWUuX190cmFjZWJhY2tfXyBpcyBub3QgdGI6CiAgICAgICAgICAgIHJhaXNlIHZhbHVlLndpdGhfdHJhY2ViYWNrKHRiKQogICAgICAgIHJhaXNlIHZhbHVlCgplbHNlOgogICAgZGVmIGV4ZWNfKF9jb2RlXywgX2dsb2JzXz1Ob25lLCBfbG9jc189Tm9uZSk6CiAgICAgICAgIiIiRXhlY3V0ZSBjb2RlIGluIGEgbmFtZXNwYWNlLiIiIgogICAgICAgIGlmIF9nbG9ic18gaXMgTm9uZToKICAgICAgICAgICAgZnJhbWUgPSBzeXMuX2dldGZyYW1lKDEpCiAgICAgICAgICAgIF9nbG9ic18gPSBmcmFtZS5mX2dsb2JhbHMKICAgICAgICAgICAgaWYgX2xvY3NfIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBfbG9jc18gPSBmcmFtZS5mX2xvY2FscwogICAgICAgICAgICBkZWwgZnJhbWUKICAgICAgICBlbGlmIF9sb2NzXyBpcyBOb25lOgogICAgICAgICAgICBfbG9jc18gPSBfZ2xvYnNfCiAgICAgICAgZXhlYygiIiJleGVjIF9jb2RlXyBpbiBfZ2xvYnNfLCBfbG9jc18iIiIpCgogICAgZXhlY18oIiIiZGVmIHJlcmFpc2UodHAsIHZhbHVlLCB0Yj1Ob25lKToKICAgIHJhaXNlIHRwLCB2YWx1ZSwgdGIKIiIiKQoKCmlmIHN5cy52ZXJzaW9uX2luZm9bOjJdID09ICgzLCAyKToKICAgIGV4ZWNfKCIiImRlZiByYWlzZV9mcm9tKHZhbHVlLCBmcm9tX3ZhbHVlKToKICAgIGlmIGZyb21fdmFsdWUgaXMgTm9uZToKICAgICAgICByYWlzZSB2YWx1ZQogICAgcmFpc2UgdmFsdWUgZnJvbSBmcm9tX3ZhbHVlCiIiIikKZWxpZiBzeXMudmVyc2lvbl9pbmZvWzoyXSA+ICgzLCAyKToKICAgIGV4ZWNfKCIiImRlZiByYWlzZV9mcm9tKHZhbHVlLCBmcm9tX3ZhbHVlKToKICAgIHJhaXNlIHZhbHVlIGZyb20gZnJvbV92YWx1ZQoiIiIpCmVsc2U6CiAgICBkZWYgcmFpc2VfZnJvbSh2YWx1ZSwgZnJvbV92YWx1ZSk6CiAgICAgICAgcmFpc2UgdmFsdWUKCgpwcmludF8gPSBnZXRhdHRyKG1vdmVzLmJ1aWx0aW5zLCAicHJpbnQiLCBOb25lKQppZiBwcmludF8gaXMgTm9uZToKICAgIGRlZiBwcmludF8oKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAiIiJUaGUgbmV3LXN0eWxlIHByaW50IGZ1bmN0aW9uIGZvciBQeXRob24gMi40IGFuZCAyLjUuIiIiCiAgICAgICAgZnAgPSBrd2FyZ3MucG9wKCJmaWxlIiwgc3lzLnN0ZG91dCkKICAgICAgICBpZiBmcCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZGVmIHdyaXRlKGRhdGEpOgogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShkYXRhLCBiYXNlc3RyaW5nKToKICAgICAgICAgICAgICAgIGRhdGEgPSBzdHIoZGF0YSkKICAgICAgICAgICAgIyBJZiB0aGUgZmlsZSBoYXMgYW4gZW5jb2RpbmcsIGVuY29kZSB1bmljb2RlIHdpdGggaXQuCiAgICAgICAgICAgIGlmIChpc2luc3RhbmNlKGZwLCBmaWxlKSBhbmQKICAgICAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGRhdGEsIHVuaWNvZGUpIGFuZAogICAgICAgICAgICAgICAgICAgIGZwLmVuY29kaW5nIGlzIG5vdCBOb25lKToKICAgICAgICAgICAgICAgIGVycm9ycyA9IGdldGF0dHIoZnAsICJlcnJvcnMiLCBOb25lKQogICAgICAgICAgICAgICAgaWYgZXJyb3JzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JzID0gInN0cmljdCIKICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLmVuY29kZShmcC5lbmNvZGluZywgZXJyb3JzKQogICAgICAgICAgICBmcC53cml0ZShkYXRhKQogICAgICAgIHdhbnRfdW5pY29kZSA9IEZhbHNlCiAgICAgICAgc2VwID0ga3dhcmdzLnBvcCgic2VwIiwgTm9uZSkKICAgICAgICBpZiBzZXAgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VwLCB1bmljb2RlKToKICAgICAgICAgICAgICAgIHdhbnRfdW5pY29kZSA9IFRydWUKICAgICAgICAgICAgZWxpZiBub3QgaXNpbnN0YW5jZShzZXAsIHN0cik6CiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoInNlcCBtdXN0IGJlIE5vbmUgb3IgYSBzdHJpbmciKQogICAgICAgIGVuZCA9IGt3YXJncy5wb3AoImVuZCIsIE5vbmUpCiAgICAgICAgaWYgZW5kIGlzIG5vdCBOb25lOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGVuZCwgdW5pY29kZSk6CiAgICAgICAgICAgICAgICB3YW50X3VuaWNvZGUgPSBUcnVlCiAgICAgICAgICAgIGVsaWYgbm90IGlzaW5zdGFuY2UoZW5kLCBzdHIpOgogICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKCJlbmQgbXVzdCBiZSBOb25lIG9yIGEgc3RyaW5nIikKICAgICAgICBpZiBrd2FyZ3M6CiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigiaW52YWxpZCBrZXl3b3JkIGFyZ3VtZW50cyB0byBwcmludCgpIikKICAgICAgICBpZiBub3Qgd2FudF91bmljb2RlOgogICAgICAgICAgICBmb3IgYXJnIGluIGFyZ3M6CiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGFyZywgdW5pY29kZSk6CiAgICAgICAgICAgICAgICAgICAgd2FudF91bmljb2RlID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgd2FudF91bmljb2RlOgogICAgICAgICAgICBuZXdsaW5lID0gdW5pY29kZSgiXG4iKQogICAgICAgICAgICBzcGFjZSA9IHVuaWNvZGUoIiAiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5ld2xpbmUgPSAiXG4iCiAgICAgICAgICAgIHNwYWNlID0gIiAiCiAgICAgICAgaWYgc2VwIGlzIE5vbmU6CiAgICAgICAgICAgIHNlcCA9IHNwYWNlCiAgICAgICAgaWYgZW5kIGlzIE5vbmU6CiAgICAgICAgICAgIGVuZCA9IG5ld2xpbmUKICAgICAgICBmb3IgaSwgYXJnIGluIGVudW1lcmF0ZShhcmdzKToKICAgICAgICAgICAgaWYgaToKICAgICAgICAgICAgICAgIHdyaXRlKHNlcCkKICAgICAgICAgICAgd3JpdGUoYXJnKQogICAgICAgIHdyaXRlKGVuZCkKaWYgc3lzLnZlcnNpb25faW5mb1s6Ml0gPCAoMywgMyk6CiAgICBfcHJpbnQgPSBwcmludF8KCiAgICBkZWYgcHJpbnRfKCphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgZnAgPSBrd2FyZ3MuZ2V0KCJmaWxlIiwgc3lzLnN0ZG91dCkKICAgICAgICBmbHVzaCA9IGt3YXJncy5wb3AoImZsdXNoIiwgRmFsc2UpCiAgICAgICAgX3ByaW50KCphcmdzLCAqKmt3YXJncykKICAgICAgICBpZiBmbHVzaCBhbmQgZnAgaXMgbm90IE5vbmU6CiAgICAgICAgICAgIGZwLmZsdXNoKCkKCl9hZGRfZG9jKHJlcmFpc2UsICIiIlJlcmFpc2UgYW4gZXhjZXB0aW9uLiIiIikKCmlmIHN5cy52ZXJzaW9uX2luZm9bMDoyXSA8ICgzLCA0KToKICAgIGRlZiB3cmFwcyh3cmFwcGVkLCBhc3NpZ25lZD1mdW5jdG9vbHMuV1JBUFBFUl9BU1NJR05NRU5UUywKICAgICAgICAgICAgICB1cGRhdGVkPWZ1bmN0b29scy5XUkFQUEVSX1VQREFURVMpOgogICAgICAgIGRlZiB3cmFwcGVyKGYpOgogICAgICAgICAgICBmID0gZnVuY3Rvb2xzLndyYXBzKHdyYXBwZWQsIGFzc2lnbmVkLCB1cGRhdGVkKShmKQogICAgICAgICAgICBmLl9fd3JhcHBlZF9fID0gd3JhcHBlZAogICAgICAgICAgICByZXR1cm4gZgogICAgICAgIHJldHVybiB3cmFwcGVyCmVsc2U6CiAgICB3cmFwcyA9IGZ1bmN0b29scy53cmFwcwoKCmRlZiB3aXRoX21ldGFjbGFzcyhtZXRhLCAqYmFzZXMpOgogICAgIiIiQ3JlYXRlIGEgYmFzZSBjbGFzcyB3aXRoIGEgbWV0YWNsYXNzLiIiIgogICAgIyBUaGlzIHJlcXVpcmVzIGEgYml0IG9mIGV4cGxhbmF0aW9uOiB0aGUgYmFzaWMgaWRlYSBpcyB0byBtYWtlIGEgZHVtbXkKICAgICMgbWV0YWNsYXNzIGZvciBvbmUgbGV2ZWwgb2YgY2xhc3MgaW5zdGFudGlhdGlvbiB0aGF0IHJlcGxhY2VzIGl0c2VsZiB3aXRoCiAgICAjIHRoZSBhY3R1YWwgbWV0YWNsYXNzLgogICAgY2xhc3MgbWV0YWNsYXNzKG1ldGEpOgoKICAgICAgICBkZWYgX19uZXdfXyhjbHMsIG5hbWUsIHRoaXNfYmFzZXMsIGQpOgogICAgICAgICAgICByZXR1cm4gbWV0YShuYW1lLCBiYXNlcywgZCkKICAgIHJldHVybiB0eXBlLl9fbmV3X18obWV0YWNsYXNzLCAndGVtcG9yYXJ5X2NsYXNzJywgKCksIHt9KQoKCmRlZiBhZGRfbWV0YWNsYXNzKG1ldGFjbGFzcyk6CiAgICAiIiJDbGFzcyBkZWNvcmF0b3IgZm9yIGNyZWF0aW5nIGEgY2xhc3Mgd2l0aCBhIG1ldGFjbGFzcy4iIiIKICAgIGRlZiB3cmFwcGVyKGNscyk6CiAgICAgICAgb3JpZ192YXJzID0gY2xzLl9fZGljdF9fLmNvcHkoKQogICAgICAgIHNsb3RzID0gb3JpZ192YXJzLmdldCgnX19zbG90c19fJykKICAgICAgICBpZiBzbG90cyBpcyBub3QgTm9uZToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzbG90cywgc3RyKToKICAgICAgICAgICAgICAgIHNsb3RzID0gW3Nsb3RzXQogICAgICAgICAgICBmb3Igc2xvdHNfdmFyIGluIHNsb3RzOgogICAgICAgICAgICAgICAgb3JpZ192YXJzLnBvcChzbG90c192YXIpCiAgICAgICAgb3JpZ192YXJzLnBvcCgnX19kaWN0X18nLCBOb25lKQogICAgICAgIG9yaWdfdmFycy5wb3AoJ19fd2Vha3JlZl9fJywgTm9uZSkKICAgICAgICByZXR1cm4gbWV0YWNsYXNzKGNscy5fX25hbWVfXywgY2xzLl9fYmFzZXNfXywgb3JpZ192YXJzKQogICAgcmV0dXJuIHdyYXBwZXIKCgpkZWYgcHl0aG9uXzJfdW5pY29kZV9jb21wYXRpYmxlKGtsYXNzKToKICAgICIiIgogICAgQSBkZWNvcmF0b3IgdGhhdCBkZWZpbmVzIF9fdW5pY29kZV9fIGFuZCBfX3N0cl9fIG1ldGhvZHMgdW5kZXIgUHl0aG9uIDIuCiAgICBVbmRlciBQeXRob24gMyBpdCBkb2VzIG5vdGhpbmcuCgogICAgVG8gc3VwcG9ydCBQeXRob24gMiBhbmQgMyB3aXRoIGEgc2luZ2xlIGNvZGUgYmFzZSwgZGVmaW5lIGEgX19zdHJfXyBtZXRob2QKICAgIHJldHVybmluZyB0ZXh0IGFuZCBhcHBseSB0aGlzIGRlY29yYXRvciB0byB0aGUgY2xhc3MuCiAgICAiIiIKICAgIGlmIFBZMjoKICAgICAgICBpZiAnX19zdHJfXycgbm90IGluIGtsYXNzLl9fZGljdF9fOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJAcHl0aG9uXzJfdW5pY29kZV9jb21wYXRpYmxlIGNhbm5vdCBiZSBhcHBsaWVkICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidG8gJXMgYmVjYXVzZSBpdCBkb2Vzbid0IGRlZmluZSBfX3N0cl9fKCkuIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2xhc3MuX19uYW1lX18pCiAgICAgICAga2xhc3MuX191bmljb2RlX18gPSBrbGFzcy5fX3N0cl9fCiAgICAgICAga2xhc3MuX19zdHJfXyA9IGxhbWJkYSBzZWxmOiBzZWxmLl9fdW5pY29kZV9fKCkuZW5jb2RlKCd1dGYtOCcpCiAgICByZXR1cm4ga2xhc3MKCgojIENvbXBsZXRlIHRoZSBtb3ZlcyBpbXBsZW1lbnRhdGlvbi4KIyBUaGlzIGNvZGUgaXMgYXQgdGhlIGVuZCBvZiB0aGlzIG1vZHVsZSB0byBzcGVlZCB1cCBtb2R1bGUgbG9hZGluZy4KIyBUdXJuIHRoaXMgbW9kdWxlIGludG8gYSBwYWNrYWdlLgpfX3BhdGhfXyA9IFtdICAjIHJlcXVpcmVkIGZvciBQRVAgMzAyIGFuZCBQRVAgNDUxCl9fcGFja2FnZV9fID0gX19uYW1lX18gICMgc2VlIFBFUCAzNjYgQFJlc2VydmVkQXNzaWdubWVudAppZiBnbG9iYWxzKCkuZ2V0KCJfX3NwZWNfXyIpIGlzIG5vdCBOb25lOgogICAgX19zcGVjX18uc3VibW9kdWxlX3NlYXJjaF9sb2NhdGlvbnMgPSBbXSAgIyBQRVAgNDUxIEBVbmRlZmluZWRWYXJpYWJsZQojIFJlbW92ZSBvdGhlciBzaXggbWV0YSBwYXRoIGltcG9ydGVycywgc2luY2UgdGhleSBjYXVzZSBwcm9ibGVtcy4gVGhpcyBjYW4KIyBoYXBwZW4gaWYgc2l4IGlzIHJlbW92ZWQgZnJvbSBzeXMubW9kdWxlcyBhbmQgdGhlbiByZWxvYWRlZC4gKFNldHVwdG9vbHMgZG9lcwojIHRoaXMgZm9yIHNvbWUgcmVhc29uLikKaWYgc3lzLm1ldGFfcGF0aDoKICAgIGZvciBpLCBpbXBvcnRlciBpbiBlbnVtZXJhdGUoc3lzLm1ldGFfcGF0aCk6CiAgICAgICAgIyBIZXJlJ3Mgc29tZSByZWFsIG5hc3RpbmVzczogQW5vdGhlciAiaW5zdGFuY2UiIG9mIHRoZSBzaXggbW9kdWxlIG1pZ2h0CiAgICAgICAgIyBiZSBmbG9hdGluZyBhcm91bmQuIFRoZXJlZm9yZSwgd2UgY2FuJ3QgdXNlIGlzaW5zdGFuY2UoKSB0byBjaGVjayBmb3IKICAgICAgICAjIHRoZSBzaXggbWV0YSBwYXRoIGltcG9ydGVyLCBzaW5jZSB0aGUgb3RoZXIgc2l4IGluc3RhbmNlIHdpbGwgaGF2ZQogICAgICAgICMgaW5zZXJ0ZWQgYW4gaW1wb3J0ZXIgd2l0aCBkaWZmZXJlbnQgY2xhc3MuCiAgICAgICAgaWYgKHR5cGUoaW1wb3J0ZXIpLl9fbmFtZV9fID09ICJfU2l4TWV0YVBhdGhJbXBvcnRlciIgYW5kCiAgICAgICAgICAgICAgICBpbXBvcnRlci5uYW1lID09IF9fbmFtZV9fKToKICAgICAgICAgICAgZGVsIHN5cy5tZXRhX3BhdGhbaV0KICAgICAgICAgICAgYnJlYWsKICAgIGRlbCBpLCBpbXBvcnRlcgojIEZpbmFsbHksIGFkZCB0aGUgaW1wb3J0ZXIgdG8gdGhlIG1ldGEgcGF0aCBpbXBvcnQgaG9vay4Kc3lzLm1ldGFfcGF0aC5hcHBlbmQoX2ltcG9ydGVyKQpQSwECFAMUAAAAAADhuytLj6fxUncAAAB3AAAAEwAAAAAAAAAAAAAAgAEAAAAAYW5zaWJsZS9fX2luaXRfXy5weVBLAQIUAxQAAAAAAOG7K0udxfFrSAAAAEgAAAAgAAAAAAAAAAAAAACAAagAAABhbnNpYmxlL21vZHVsZV91dGlscy9fX2luaXRfXy5weVBLAQIUAxQAAAAAAOG7K0vRW489biwAAG4sAAAbAAAAAAAAAAAAAACAAS4BAABhbnNpYmxlX21vZHVsZV9jbm9zX3ZsYW4ucHlQSwECFAMUAAAAAADhuytLO985lTCKAQAwigEAHQAAAAAAAAAAAAAAgAHVLQAAYW5zaWJsZS9tb2R1bGVfdXRpbHMvYmFzaWMucHlQSwECFAMUAAAAAADhuytLXozuKdgLAgDYCwIAHAAAAAAAAAAAAAAAgAFAuAEAYW5zaWJsZS9tb2R1bGVfdXRpbHMvY25vcy5weVBLAQIUAxQAAAAAAOG7K0u12AQGJTAAACUwAAAdAAAAAAAAAAAAAACAAVLEAwBhbnNpYmxlL21vZHVsZV91dGlscy9fdGV4dC5weVBLAQIUAxQAAAAAAOG7K0sl3LR+ExAAABMQAAAiAAAAAAAAAAAAAACAAbL0AwBhbnNpYmxlL21vZHVsZV91dGlscy9weWNvbXBhdDI0LnB5UEsBAhQDFAAAAAAA4bsrSxgXcvUBEQAAAREAACQAAAAAAAAAAAAAAIABBQUEAGFuc2libGUvbW9kdWxlX3V0aWxzL3NpeC9fX2luaXRfXy5weVBLAQIUAxQAAAAAAOG7K0s44sfRkXUAAJF1AAAgAAAAAAAAAAAAAACAAUgWBABhbnNpYmxlL21vZHVsZV91dGlscy9zaXgvX3NpeC5weVBLBQYAAAAACQAJAKgCAAAXjAQAAAA="""
def invoke_module(module, modlib_path, json_params):
    pythonpath = os.environ.get('PYTHONPATH')
    if pythonpath:
        os.environ['PYTHONPATH'] = ':'.join((modlib_path, pythonpath))
    else:
        os.environ['PYTHONPATH'] = modlib_path
    p = subprocess.Popen(['/usr/bin/python', module], env=os.environ, shell=False, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE)
    (stdout, stderr) = p.communicate(json_params)
    if not isinstance(stderr, (bytes, unicode)):
        stderr = stderr.read()
    if not isinstance(stdout, (bytes, unicode)):
        stdout = stdout.read()
    if PY3:
        sys.stderr.buffer.write(stderr)
        sys.stdout.buffer.write(stdout)
    else:
        sys.stderr.write(stderr)
        sys.stdout.write(stdout)
    return p.returncode
def debug(command, zipped_mod, json_params):
    basedir = os.path.join(os.path.abspath(os.path.dirname(__file__)), 'debug_dir')
    args_path = os.path.join(basedir, 'args')
    script_path = os.path.join(basedir, 'ansible_module_cnos_vlan.py')
    if command == 'explode':
        z = zipfile.ZipFile(zipped_mod)
        for filename in z.namelist():
            if filename.startswith('/'):
                raise Exception('Something wrong with this module zip file: should not contain absolute paths')
            dest_filename = os.path.join(basedir, filename)
            if dest_filename.endswith(os.path.sep) and not os.path.exists(dest_filename):
                os.makedirs(dest_filename)
            else:
                directory = os.path.dirname(dest_filename)
                if not os.path.exists(directory):
                    os.makedirs(directory)
                f = open(dest_filename, 'wb')
                f.write(z.read(filename))
                f.close()
        f = open(args_path, 'wb')
        f.write(json_params)
        f.close()
        print('Module expanded into:')
        print('%s' % basedir)
        exitcode = 0
    elif command == 'execute':
        pythonpath = os.environ.get('PYTHONPATH')
        if pythonpath:
            os.environ['PYTHONPATH'] = ':'.join((basedir, pythonpath))
        else:
            os.environ['PYTHONPATH'] = basedir
        p = subprocess.Popen(['/usr/bin/python', script_path, args_path],
                env=os.environ, shell=False, stdout=subprocess.PIPE,
                stderr=subprocess.PIPE, stdin=subprocess.PIPE)
        (stdout, stderr) = p.communicate()
        if not isinstance(stderr, (bytes, unicode)):
            stderr = stderr.read()
        if not isinstance(stdout, (bytes, unicode)):
            stdout = stdout.read()
        if PY3:
            sys.stderr.buffer.write(stderr)
            sys.stdout.buffer.write(stdout)
        else:
            sys.stderr.write(stderr)
            sys.stdout.write(stdout)
        return p.returncode
    elif command == 'excommunicate':
        sys.argv = ['cnos_vlan', args_path]
        sys.path.insert(0, basedir)
        from ansible_module_cnos_vlan import main
        main()
        print('WARNING: Module returned to wrapper instead of exiting')
        sys.exit(1)
    else:
        print('WARNING: Unknown debug command.  Doing nothing.')
        exitcode = 0
    return exitcode
if __name__ == '__main__':
    ANSIBALLZ_PARAMS = json.dumps({"ANSIBLE_MODULE_ARGS": json.load(sys.stdin)})
    if PY3:
        ANSIBALLZ_PARAMS = ANSIBALLZ_PARAMS.encode('utf-8')
    try:
        temp_path = tempfile.mkdtemp(prefix='ansible_')
        zipped_mod = os.path.join(temp_path, 'ansible_modlib.zip')
        modlib = open(zipped_mod, 'wb')
        modlib.write(base64.b64decode(ZIPDATA))
        modlib.close()
        if len(sys.argv) == 2:
            exitcode = debug(sys.argv[1], zipped_mod, ANSIBALLZ_PARAMS)
        else:
            z = zipfile.ZipFile(zipped_mod, mode='r')
            module = os.path.join(temp_path, 'ansible_module_cnos_vlan.py')
            f = open(module, 'wb')
            f.write(z.read('ansible_module_cnos_vlan.py'))
            f.close()
            z = zipfile.ZipFile(zipped_mod, mode='a')
            sitecustomize = u'import sys\nsys.path.insert(0,"%s")\n' %  zipped_mod
            sitecustomize = sitecustomize.encode('utf-8')
            zinfo = zipfile.ZipInfo()
            zinfo.filename = 'sitecustomize.py'
            zinfo.date_time = ( 2017, 9, 11, 23, 31, 2)
            z.writestr(zinfo, sitecustomize)
            z.close()
            exitcode = invoke_module(module, zipped_mod, ANSIBALLZ_PARAMS)
    finally:
        try:
            shutil.rmtree(temp_path)
        except OSError:
            pass
    sys.exit(exitcode)